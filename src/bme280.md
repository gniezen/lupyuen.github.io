# Apache NuttX Driver for BME280 Sensor: Ported from Zephyr OS

üìù _3 Mar 2022_

![Bosch BME280 Sensor connected to Pine64 PineCone BL602 RISC-V Board](https://lupyuen.github.io/images/bme280-title.jpg)

_"Will [__Apache NuttX OS__](https://lupyuen.github.io/articles/nuttx) talk I2C with [__Bosch BME280 Sensor__](https://www.bosch-sensortec.com/products/environmental-sensors/humidity-sensors-bme280/)... On the [__BL602 RISC-V SoC__](https://lupyuen.github.io/articles/pinecone)?"_

...A friend and I pondered (8,000 miles apart) while working on the [__Temperature + Humidity + Air Pressure__](https://learn.sparkfun.com/tutorials/sparkfun-bme280-breakout-hookup-guide) combo sensor.

Sounds like a fun challenge...

-   NuttX __doesn't have a driver__ for the BME280 Sensor

    (Though it supports BMP280)

-   Can we port the BME280 Driver from __Zephyr OS__ with a few tweaks?

    (Spoiler: Yes we can!)

-   What's inside a __NuttX Sensor Driver__ anyway?

    (How to build our own driver)

-   NuttX on BL602 is __kinda new-ish__

    (Some features might not work the way we expect)

-   BL602's I2C Port has __interesting quirks__. Will it work?

    (Specifically: I2C Sub Address)

Read on to find out how we solved the challenge and created this driver...

-   [__lupyuen/bme280-nuttx__](https://github.com/lupyuen/bme280-nuttx)

# What's Next

TODO

Many Thanks to my [__GitHub Sponsors__](https://github.com/sponsors/lupyuen) for supporting my work! This article wouldn't have been possible without your support.

-   [Sponsor me a coffee](https://github.com/sponsors/lupyuen)

-   [Read "The RISC-V BL602 / BL604 Book"](https://lupyuen.github.io/articles/book)

-   [Check out my articles](https://lupyuen.github.io)

-   [RSS Feed](https://lupyuen.github.io/rss.xml)

_Got a question, comment or suggestion? Create an Issue or submit a Pull Request here..._

[`lupyuen.github.io/src/bme280.md`](https://github.com/lupyuen/lupyuen.github.io/blob/master/src/bme280.md)

# Notes

1.  This article is the expanded version of [this Twitter Thread](https://twitter.com/MisterTechBlog/status/1494301654186823683)



Will Apache #NuttX OS talk I2C with Bosch BME280 Sensor? (Temperature + Humidity + Air Pressure) ... Let's find out!

https://github.com/lupyuen/bme280-nuttx


Verify with Bus Pirate that our BME280 works OK ... Despite my horrid soldering üòÇ

https://github.com/lupyuen/bme280-nutt



Connect BME280 to #RISCV PineCone #BL602 @PINE64 ... Preferably not on a cooking pot üòÇ

https://github.com/lupyuen/bme280-nutt

TODO24

![](https://lupyuen.github.io/images/bme280-pot.jpg)


Enable the I2C Port and I2C Character Driver on Apache #NuttX OS ... So it will talk with BME280

https://github.com/lupyuen/bme280-nutt

TODO19

![](https://lupyuen.github.io/images/bme280-config1.png)



Apache #NuttX OS doesn't have a BME280 Driver ... Let's test the BMP280 Driver instead (Air Pressure only)

https://github.com/lupyuen/bme280-nutt

TODO21

![](https://lupyuen.github.io/images/bme280-config3.png)



We patch the I2C Address and Device ID in the #NuttX BMP280 Driver ... So it will work with BME280

https://github.com/lupyuen/bme280-nutt





TODO1

![](https://lupyuen.github.io/images/bme280-code1.png)

TODO2

![](https://lupyuen.github.io/images/bme280-code2a.png)

TODO25

![](https://lupyuen.github.io/images/bme280-run1.png)

TODO23

![](https://lupyuen.github.io/images/bme280-logic1.png)

TODO50

![](https://lupyuen.github.io/images/bme280-logic2.jpg)

TODO3

![](https://lupyuen.github.io/images/bme280-code3a.png)

TODO34

![](https://lupyuen.github.io/images/bme280-subaddress.png)

TODO4

![](https://lupyuen.github.io/images/bme280-code4a.png)

TODO5

![](https://lupyuen.github.io/images/bme280-code5a.png)

TODO27

![](https://lupyuen.github.io/images/bme280-run2a.png)

TODO29

![](https://lupyuen.github.io/images/bme280-run4a.png)

TODO22

![](https://lupyuen.github.io/images/bme280-config4a.png)

TODO30

![](https://lupyuen.github.io/images/bme280-run5a.png)

TODO35

![](https://lupyuen.github.io/images/bme280-zephyr1.png)

TODO6

![](https://lupyuen.github.io/images/bme280-code6a.png)

TODO7

![](https://lupyuen.github.io/images/bme280-code7a.png)

TODO8

![](https://lupyuen.github.io/images/bme280-code8a.png)

TODO9

![](https://lupyuen.github.io/images/bme280-code9a.png)

TODO10

![](https://lupyuen.github.io/images/bme280-code10.png)

TODO11

![](https://lupyuen.github.io/images/bme280-code11.png)

TODO32

![](https://lupyuen.github.io/images/bme280-run6a.png)

TODO12

![](https://lupyuen.github.io/images/bme280-code12.png)

TODO13

![](https://lupyuen.github.io/images/bme280-combine.png)

TODO14

![](https://lupyuen.github.io/images/bme280-combine1.png)

TODO15

![](https://lupyuen.github.io/images/bme280-combine2.png)

TODO16

![](https://lupyuen.github.io/images/bme280-combine2a.png)

TODO17

![](https://lupyuen.github.io/images/bme280-combine3.png)







