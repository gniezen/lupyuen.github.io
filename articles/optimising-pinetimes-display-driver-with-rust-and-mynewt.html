<!doctype html><html lang="en"><head><script src="//archive.org/includes/analytics.js?v=cf34f82" type="text/javascript"></script>
<script type="text/javascript">window.addEventListener('DOMContentLoaded',function(){var v=archive_analytics.values;v.service='wb';v.server_name='wwwb-app29.us.archive.org';v.server_ms=398;archive_analytics.send_pageview({});});</script><script type="text/javascript" src="/_static/js/playback.bundle.js?v=bQvHU8mx" charset="utf-8"></script>
<script type="text/javascript" src="/_static/js/wombat.js?v=cRqOKCOw" charset="utf-8"></script>
<script type="text/javascript">
  __wm.init("https://web.archive.org/web");
  __wm.wombat("https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","20200121150820","https://web.archive.org/","web","/_static/",
	      "1579619300");
</script>
<link rel="stylesheet" type="text/css" href="/_static/css/banner-styles.css?v=bsmaklHF" />
<link rel="stylesheet" type="text/css" href="/_static/css/iconochive.css?v=qtvMKcIJ" />
<!-- End Wayback Rewrite JS Include -->
<script>!function(c,f){var t,o,i,e=[],r={passive:!0,capture:!0},n=new Date,a="pointerup",u="pointercancel";function p(n,e){t||(t=e,o=n,i=new Date,w(f),s())}function s(){0<=o&&o<i-n&&(e.forEach(function(n){n(o,t)}),e=[])}function l(n){if(n.cancelable){var e=(1e12<n.timeStamp?new Date:performance.now())-n.timeStamp;"pointerdown"==n.type?function(n,e){function t(){p(n,e),i()}function o(){i()}function i(){f(a,t,r),f(u,o,r)}c(a,t,r),c(u,o,r)}(e,n):p(e,n)}}function w(e){["click","mousedown","keydown","touchstart","pointerdown"].forEach(function(n){e(n,l,r)})}w(c),self.perfMetrics=self.perfMetrics||{},self.perfMetrics.onFirstInputDelay=function(n){e.push(n),s()}}(addEventListener,removeEventListener)</script><title data-rh="true">Optimising PineTime’s Display Driver with Rust and Mynewt</title><meta data-rh="true" charset="utf-8"/><meta data-rh="true" name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/><meta data-rh="true" name="theme-color" content="#000000"/><meta data-rh="true" name="twitter:app:name:iphone" content="Medium"/><meta data-rh="true" name="twitter:app:id:iphone" content="828256236"/><meta data-rh="true" property="al:ios:app_name" content="Medium"/><meta data-rh="true" property="al:ios:app_store_id" content="828256236"/><meta data-rh="true" property="al:android:package" content="com.medium.reader"/><meta data-rh="true" property="fb:app_id" content="542599432471018"/><meta data-rh="true" property="og:site_name" content="Medium"/><meta data-rh="true" property="og:type" content="article"/><meta data-rh="true" property="article:published_time" content="2020-01-11T07:29:47.786Z"/><meta data-rh="true" name="title" content="Optimising PineTime’s Display Driver with Rust and Mynewt"/><meta data-rh="true" property="og:title" content="Optimising PineTime’s Display Driver with Rust and Mynewt"/><meta data-rh="true" property="twitter:title" content="Optimising PineTime’s Display Driver with Rust and Mynewt"/><meta data-rh="true" name="twitter:site" content="@Medium"/><meta data-rh="true" name="twitter:app:url:iphone" content="medium://p/3ba269ea2f5c"/><meta data-rh="true" property="al:android:url" content="medium://p/3ba269ea2f5c"/><meta data-rh="true" property="al:ios:url" content="medium://p/3ba269ea2f5c"/><meta data-rh="true" property="al:android:app_name" content="Medium"/><meta data-rh="true" name="description" content="Simple tweaks like Batched Updates and Non-Blocking SPI can have a huge impact on rendering performance… PineTime Smart Watch has been an awesome educational tool for teaching embedded coding with…"/><meta data-rh="true" property="og:description" content="Simple tweaks like Batched Updates and Non-Blocking SPI can have a huge impact on rendering performance…"/><meta data-rh="true" property="twitter:description" content="Simple tweaks like Batched Updates and Non-Blocking SPI can have a huge impact on rendering performance…"/><meta data-rh="true" property="og:url" content="https://web.archive.org/web/20200121150820/https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c"/><meta data-rh="true" property="al:web:url" content="https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c"/><meta data-rh="true" property="og:image" content="https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/1200/1*qWOFrWPOkQm-nf1shcDSSA.png"/><meta data-rh="true" name="twitter:image:src" content="https://miro.medium.com/max/1200/1*qWOFrWPOkQm-nf1shcDSSA.png"/><meta data-rh="true" name="twitter:card" content="summary_large_image"/><meta data-rh="true" property="article:author" content="https://medium.com/@ly.lee"/><meta data-rh="true" name="twitter:creator" content="@MisterTechBlog"/><meta data-rh="true" name="author" content="Lup Yuen Lee 李立源"/><meta data-rh="true" name="robots" content="index,follow"/><meta data-rh="true" name="referrer" content="unsafe-url"/><meta data-rh="true" name="twitter:label1" value="Reading time"/><meta data-rh="true" name="twitter:data1" value="14 min read"/><meta data-rh="true" name="parsely-post-id" content="3ba269ea2f5c"/><link data-rh="true" rel="search" type="application/opensearchdescription+xml" title="Medium" href="/web/20200121150820/https://medium.com/osd.xml"/><link data-rh="true" rel="apple-touch-icon" sizes="152x152" href="https://web.archive.org/web/20200121150820im_/https://cdn-images-1.medium.com/fit/c/152/152/1*8I-HPL0bfoIzGied-dzOvA.png"/><link data-rh="true" rel="apple-touch-icon" sizes="120x120" href="https://web.archive.org/web/20200121150820im_/https://cdn-images-1.medium.com/fit/c/120/120/1*8I-HPL0bfoIzGied-dzOvA.png"/><link data-rh="true" rel="apple-touch-icon" sizes="76x76" href="https://web.archive.org/web/20200121150820im_/https://cdn-images-1.medium.com/fit/c/76/76/1*8I-HPL0bfoIzGied-dzOvA.png"/><link data-rh="true" rel="apple-touch-icon" sizes="60x60" href="https://web.archive.org/web/20200121150820im_/https://cdn-images-1.medium.com/fit/c/60/60/1*8I-HPL0bfoIzGied-dzOvA.png"/><link data-rh="true" rel="mask-icon" href="https://web.archive.org/web/20200121150820im_/https://cdn-static-1.medium.com/_/fp/icons/monogram-mask.KPLCSFEZviQN0jQ7veN2RQ.svg" color="#171717"/><link data-rh="true" rel="icon" href="https://web.archive.org/web/20200121150820im_/https://cdn-static-1.medium.com/_/fp/icons/favicon-rebrand-medium.3Y6xpZ-0FSdWDnPM3hSBIA.ico"/><link data-rh="true" id="glyph_link" rel="stylesheet" type="text/css" href="https://web.archive.org/web/20200121150820cs_/https://glyph.medium.com/css/e/sr/latin/e/ssr/latin/e/ssb/latin/m2.css"/><link data-rh="true" rel="author" href="https://medium.com/@ly.lee"/><link data-rh="true" rel="canonical" href="https://web.archive.org/web/20200121150820/https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c"/><link data-rh="true" rel="alternate" href="https://web.archive.org/web/20200121150820/android-app://com.medium.reader/https/medium.com/p/3ba269ea2f5c"/><script data-rh="true" type="application/ld+json">{"@context":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttp:\u002F\u002Fschema.org","@type":"NewsArticle","image":["https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmiro.medium.com\u002Fmax\u002F1200\u002F1*qWOFrWPOkQm-nf1shcDSSA.png"],"url":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","dateCreated":"2019-12-28T23:35:03.457Z","datePublished":"2019-12-28T23:35:03.457Z","dateModified":"2020-01-11T07:29:48.125Z","headline":"Optimising PineTime’s Display Driver with Rust and Mynewt","name":"Optimising PineTime’s Display Driver with Rust and Mynewt","description":"Simple tweaks like Batched Updates and Non-Blocking SPI can have a huge impact on rendering performance… PineTime Smart Watch has been an awesome educational tool for teaching embedded coding with…","identifier":"3ba269ea2f5c","keywords":["Lite:true","Tag:Rust","Tag:Programming","Tag:Gadgets","Tag:Internet of Things","Tag:Embedded Systems","Elevated:false","LockedPostSource:LOCKED_POST_SOURCE_NONE","LayerCake:0"],"author":{"@type":"Person","name":"Lup Yuen Lee 李立源","url":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee"},"creator":["Lup Yuen Lee 李立源"],"publisher":{"@type":"Organization","name":"Medium","url":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002F","logo":{"@type":"ImageObject","width":308,"height":60,"url":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmiro.medium.com\u002Fmax\u002F616\u002F1*OMF3fSqH8t4xBJ9-6oZDZw.png"}},"mainEntityOfPage":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c"}</script><script data-rh="true">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://web.archive.org/web/20200121150820/https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-24232453-2', 'auto');
ga('send', 'pageview');</script><link rel="preload" href="https://web.archive.org/web/20200121150820/https://cdn.optimizely.com/js/16180790160.js" as="script"><style type="text/css" data-fela-rehydration="453" data-fela-type="STATIC">html{box-sizing:border-box}*, *:before, *:after{box-sizing:inherit}body{margin:0;padding:0;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;color:rgba(0,0,0,0.8);position:relative;min-height:100vh}h1, h2, h3, h4, h5, h6, dl, dd, ol, ul, menu, figure, blockquote, p, pre, form{margin:0}menu, ol, ul{padding:0;list-style:none;list-style-image:none}main{display:block}a{color:inherit;text-decoration:none}a, button, input{-webkit-tap-highlight-color:transparent}img, svg{vertical-align:middle}button{background:transparent;overflow:visible}button, input, optgroup, select, textarea{margin:0}</style><style type="text/css" data-fela-rehydration="453" data-fela-type="KEYFRAME">@-webkit-keyframes k1{0%{transform:scale(1);opacity:1}70%{transform:scale(1.4);opacity:0}100%{opacity:0}}@-moz-keyframes k1{0%{transform:scale(1);opacity:1}70%{transform:scale(1.4);opacity:0}100%{opacity:0}}@keyframes k1{0%{transform:scale(1);opacity:1}70%{transform:scale(1.4);opacity:0}100%{opacity:0}}</style><style type="text/css" data-fela-rehydration="453" data-fela-type="RULE">.a{font-family:medium-content-sans-serif-font, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif}.b{font-weight:400}.c{background-color:rgba(255, 255, 255, 1)}.l{height:100vh}.m{width:100vw}.n{display:flex}.o{align-items:center}.p{justify-content:center}.q{fill:rgba(0, 0, 0, 0.84)}.r{display:block}.s{position:fixed}.t{top:0}.u{left:0}.v{right:0}.w{z-index:500}.x{box-shadow:0 4px 12px 0 rgba(0, 0, 0, 0.05)}.ai{max-width:1192px}.aj{min-width:0}.ak{width:100%}.al{height:65px}.ao{flex:1 0 auto}.ap{display:none}.ar{flex:0 0 auto}.as{visibility:hidden}.at{color:inherit}.au{fill:inherit}.av{font-size:inherit}.aw{border:inherit}.ax{font-family:inherit}.ay{letter-spacing:inherit}.az{font-weight:inherit}.ba{padding:0}.bb{margin:0}.bc:hover{cursor:pointer}.bd:hover{color:rgba(0, 0, 0, 0.9)}.be:hover{fill:rgba(0, 0, 0, 0.9)}.bf:focus{outline:none}.bg:disabled{cursor:default}.bh:disabled{color:rgba(0, 0, 0, 0.54)}.bi:disabled{fill:rgba(0, 0, 0, 0.54)}.bj{font-family:medium-content-sans-serif-font, "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", Geneva, Arial, sans-serif}.bk{font-style:normal}.bl{line-height:20px}.bm{font-size:15.8px}.bn{letter-spacing:0px}.bo{color:rgba(0, 0, 0, 0.54)}.bp{fill:rgba(0, 0, 0, 0.54)}.bq{margin-left:16px}.br{color:rgba(2, 158, 116, 1)}.bs{fill:rgba(3, 168, 124, 1)}.bt:hover{color:rgba(1, 143, 105, 1)}.bu:hover{fill:rgba(2, 158, 116, 1)}.bv:disabled{color:rgba(3, 168, 124, 0.5)}.bw:disabled{fill:rgba(3, 168, 124, 0.5)}.bx{padding:8px 16px}.by{background:0}.bz{border-color:rgba(3, 168, 124, 1)}.ca:hover{border-color:rgba(2, 158, 116, 1)}.cb{border-radius:4px}.cc{border-width:1px}.cd{border-style:solid}.ce{box-sizing:border-box}.cf{display:inline-block}.cg{text-decoration:none}.ch{margin-bottom:0px}.cj{padding-left:24px}.ck{padding-right:24px}.cl{margin-left:auto}.cm{margin-right:auto}.cn{max-width:728px}.co{flex-direction:column}.cp{position:absolute}.cq{top:calc(100vh + 100px)}.cr{bottom:calc(100vh + 100px)}.cs{width:10px}.ct{pointer-events:none}.cu{word-break:break-word}.cv{word-wrap:break-word}.cw:after{display:block}.cx:after{content:""}.cy:after{clear:both}.cz{clear:both}.da{margin-top:0px}.db{transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1)}.dc{cursor:zoom-in}.dd{position:relative}.de{z-index:auto}.df{opacity:0}.dg{transition:opacity 100ms 400ms}.dh{height:100%}.di{overflow:hidden}.dj{will-change:transform}.dk{transform:translateZ(0)}.dl{margin:auto}.dm{background-color:rgba(0, 0, 0, 0.05)}.dn{padding-bottom:53.61596009975062%}.do{filter:blur(20px)}.dp{transform:scale(1.1)}.dq{visibility:visible}.dr{background:rgba(255, 255, 255, 1)}.ds{max-width:680px}.dt{line-height:1.23}.du{letter-spacing:0}.dv{color:rgba(0, 0, 0, 0.84)}.dw{font-family:medium-content-title-font, Georgia, Cambria, "Times New Roman", Times, serif}.eh{margin-bottom:-0.27em}.en{margin-top:32px}.eo{justify-content:space-between}.es{width:48px}.et{height:48px}.eu{flex-direction:row}.ev{width:calc(100% + 25px)}.ew{height:calc(100% + 25px)}.ex{top:50%}.ey{left:50%}.ez{transform:translateX(-50%) translateY(-50%)}.fa{border-radius:50%}.fb{margin-left:12px}.fc{margin-bottom:2px}.fe{font-weight:300}.ff{font-size:16px}.fg{max-height:20px}.fh{text-overflow:ellipsis}.fi{display:-webkit-box}.fj{-webkit-line-clamp:1}.fk{-webkit-box-orient:vertical}.fl:hover{text-decoration:underline}.fm{margin-left:8px}.fn{padding:0px 8px}.fo{border-color:rgba(0, 0, 0, 0.54)}.fp:hover{color:rgba(0, 0, 0, 0.97)}.fq:hover{fill:rgba(0, 0, 0, 0.97)}.fr:hover{border-color:rgba(0, 0, 0, 0.84)}.fs:disabled{fill:rgba(0, 0, 0, 0.76)}.ft:disabled{border-color:rgba(0, 0, 0, 0.2)}.fu:disabled{cursor:inherit}.fv:disabled:hover{color:rgba(0, 0, 0, 0.54)}.fw:disabled:hover{fill:rgba(0, 0, 0, 0.76)}.fx:disabled:hover{border-color:rgba(0, 0, 0, 0.2)}.fy{line-height:18px}.fz{font-size:15px}.ga{align-items:flex-end}.gi{padding-right:8px}.gj{margin-right:-6px}.gk{line-height:1.58}.gl{letter-spacing:-0.004em}.gm{font-family:medium-content-serif-font, Georgia, Cambria, "Times New Roman", Times, serif}.gx{margin-bottom:-0.46em}.gy{font-style:italic}.gz{background-repeat:repeat-x}.ha{background-image:linear-gradient(to right,rgba(0, 0, 0, 0.84) 100%,rgba(0, 0, 0, 0.84) 0);background-image:url('data:image/svg+xml;utf8,<svg preserveAspectRatio="none" viewBox="0 0 1 1" xmlns="http://www.w3.org/2000/svg"><line x1="0" y1="0" x2="1" y2="1" stroke="rgba(0, 0, 0, 0.84)" /></svg>')}.hb{background-size:1px 1px}.hc{background-position:0 1.05em;background-position:0 calc(1em + 1px)}.hq{padding-bottom:56.206088992974244%}.hr{line-height:1.4}.hs{margin-top:10px}.ht{text-align:center}.hw{list-style-type:decimal}.hx{margin-left:30px}.hy{padding-left:0px}.hz{font-weight:700}.if{font-family:medium-content-slab-serif-font, Georgia, Cambria, "Times New Roman", Times, serif}.ig{font-size:28px}.ih{border:none}.ii{margin-top:30px}.ij:before{content:"..."}.ik:before{letter-spacing:0.6em}.il:before{text-indent:0.6em}.im:before{font-style:italic}.in:before{line-height:1.4}.io{line-height:1.12}.ip{letter-spacing:-0.022em}.iq{font-weight:600}.iz{margin-bottom:-0.28em}.jf{padding-bottom:NaN%}.jg{padding:2px 4px}.jh{font-size:75%}.ji> strong{font-family:inherit}.jj{font-family:Menlo, Monaco, "Courier New", Courier, monospace}.jk{max-width:3050px}.jl{padding-bottom:96.72131147540985%}.jm{max-width:1987px}.jn{border-width:2px}.jo{border-color:rgba(255, 255, 255, 1)}.jp{float:left}.jq{margin-left:-150px}.jr{margin-right:30px}.js{width:75%}.jt{padding-bottom:10px}.jy{margin-bottom:16px}.jz{padding-bottom:63.05988928032209%}.ka{max-width:2083px}.kb{padding-bottom:62.50600096015363%}.kc{max-width:2023px}.kd{padding-bottom:64.45872466633712%}.ke{max-width:2602px}.kf{padding-bottom:81.47578785549577%}.kg{box-shadow:inset 3px 0 0 0 rgba(0, 0, 0, 0.84)}.kh{padding-left:23px}.ki{margin-left:-20px}.kj{max-width:5536px}.kk{padding-bottom:54.78684971098266%}.kl{max-width:720px}.km{padding-bottom:75%}.kn{max-width:3942px}.ko{padding-bottom:56.57026889903602%}.kp{max-width:4755px}.kq{padding-bottom:48.033648790746575%}.kw{box-shadow:0 1px 4px rgba(0, 0, 0, 0.1), inset 0 0 0 1px rgba(0, 0, 0, 0.1)}.kx{max-height:40px}.ky{-webkit-line-clamp:2}.kz{padding:0px}.la{padding:16px 20px}.lb{flex:1 1 auto}.ld{font-size:18px}.le{margin-top:8px}.lf{margin-top:12px}.lg{width:160px}.lh{background-image:url(https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/320/1*Gfl2dimLEVRKPB9BdCus7g.jpeg)}.li{background-origin:border-box}.lj{background-size:cover}.lk{height:167px}.ll{background-position:50% 50%}.lm{max-width:100%}.ln{box-shadow:inset 0 0 0 1px rgba(0, 0, 0, 0.1)}.lo{background-image:url(https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/320/1*1oFvRxqOf1kUmCAxPaJXpw.jpeg)}.lp{background-image:url(https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/320/1*P9NuG-tqsK3YKVo97v7PRA.png)}.lq{background-image:url(https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/320/1*t14h6Hs6uVUifppiEBptFQ.png)}.lr{will-change:opacity}.ls{width:188px}.lt{transform:translateX(406px)}.lu{top:calc(65px + 54px + 14px)}.lx{top:calc(65px + 54px + 40px)}.lz{width:131px}.ma{padding-top:28px}.mb{margin-bottom:19px}.mc{margin-left:-5px}.md{margin-right:5px}.me{outline:0}.mf{border:0}.mg{user-select:none}.mh{cursor:pointer}.mi> svg{pointer-events:none}.mj:active{border-style:none}.mk{-webkit-user-select:none}.ml{fill:rgba(0, 0, 0, 0.76)}.mm:focus{fill:rgba(0, 0, 0, 0.54)}.mn:hover{fill:rgba(0, 0, 0, 0.54)}.mo{margin-top:5px}.mp button{text-align:left}.mq{margin-top:40px}.mr{flex-wrap:wrap}.ms{margin-top:25px}.mt{list-style-type:none}.mu{margin-right:8px}.mv{margin-bottom:8px}.mw{border-radius:3px}.mx{padding:5px 10px}.my{background:rgba(0, 0, 0, 0.05)}.mz{line-height:22px}.na{margin-top:15px}.nb{margin-right:16px}.nc{border:1px solid rgba(0, 0, 0, 0.1)}.nd{height:60px}.ne{width:60px}.nr:hover{border-color:rgba(0, 0, 0, 0.54)}.ns:active{border-style:solid}.nt{z-index:2}.nv{padding-top:32px}.nw{border-top:1px solid rgba(0, 0, 0, 0.1)}.nx{margin-bottom:25px}.ny{margin-bottom:32px}.nz{min-height:80px}.oe{width:80px}.of{height:80px}.og{padding-left:102px}.oi{text-transform:uppercase}.oj{letter-spacing:0.05em}.ok{margin-bottom:6px}.ol{line-height:36px}.om{padding:4px 12px}.on{max-width:555px}.oo{max-width:450px}.op{line-height:24px}.or{padding-top:25px}.os{color:rgba(0, 0, 0, 0.76)}.ot{opacity:1}.ou{padding:20px}.ov{border:1px solid rgba(3, 168, 124, 1)}.ow{margin-top:64px}.ox{background-color:rgba(0, 0, 0, 0.02)}.oy{padding:60px 0}.oz{background-color:rgba(0, 0, 0, 0.9)}.pq{padding-bottom:48px}.pr{border-bottom:1px solid rgba(255, 255, 255, 0.54)}.ps{margin:0 -12px}.pt{margin:0 12px}.pu{flex:1 1 0}.pv{padding-bottom:12px}.pw:hover{color:rgba(255, 255, 255, 0.99)}.px:hover{fill:rgba(255, 255, 255, 0.99)}.py:disabled{color:rgba(255, 255, 255, 0.7)}.pz:disabled{fill:rgba(255, 255, 255, 0.7)}.qa{color:rgba(255, 255, 255, 0.98)}.qb{fill:rgba(255, 255, 255, 0.98)}.qc{text-align:inherit}.qd{font-size:21.6px}.qe{letter-spacing:-0.32px}.qf{color:rgba(255, 255, 255, 0.7)}.qg{fill:rgba(255, 255, 255, 0.7)}.qh{text-decoration:underline}.qi{padding-bottom:8px}.qj{padding-top:8px}.qk{width:200px}</style><style type="text/css" data-fela-rehydration="453" data-fela-type="RULE" media="all and (min-width: 1080px)">.d{display:none}.ah{margin:0 64px}.ef{font-size:40px}.eg{margin-top:0.78em}.em{line-height:48px}.gh{margin-left:30px}.gv{font-size:21px}.gw{margin-top:2em}.hk{max-width:1192px}.hp{margin-top:56px}.ie{margin-top:1.05em}.ix{font-size:34px}.iy{margin-top:1.25em}.je{margin-top:0.86em}.kv{margin-top:32px}.pn{padding-left:64px}.po{padding-right:64px}.pp{max-width:1320px}</style><style type="text/css" data-fela-rehydration="453" data-fela-type="RULE" media="all and (max-width: 1079.98px)">.e{display:none}.gg{margin-left:30px}.hu{margin-left:auto}.hv{text-align:center}.ju{float:none}.jv{margin-left:0}.jw{margin-right:0}.jx{width:100%}.pk{padding-left:64px}.pl{padding-right:64px}.pm{max-width:1080px}</style><style type="text/css" data-fela-rehydration="453" data-fela-type="RULE" media="all and (max-width: 903.98px)">.f{display:none}.gf{margin-left:30px}.ph{padding-left:48px}.pi{padding-right:48px}.pj{max-width:904px}</style><style type="text/css" data-fela-rehydration="453" data-fela-type="RULE" media="all and (max-width: 727.98px)">.g{display:none}.am{height:56px}.an{display:flex}.aq{display:block}.ci{margin-bottom:0px}.eq{margin-top:32px}.er{flex-direction:column-reverse}.gd{margin-bottom:30px}.ge{margin-left:0px}.lc{padding:10px 12px 10px}.oa{margin-bottom:24px}.ob{align-items:center}.oc{width:102px}.od{position:relative}.oh{padding-left:0}.oq{margin-top:24px}.pa{padding:32px 0}.pe{padding-left:24px}.pf{padding-right:24px}.pg{max-width:728px}.ql{width:140px}</style><style type="text/css" data-fela-rehydration="453" data-fela-type="RULE" media="all and (max-width: 551.98px)">.h{display:none}.ac{margin:0 24px}.dx{font-size:30px}.dy{margin-top:0.72em}.ei{line-height:40px}.ep{margin-top:32px}.fd{margin-bottom:0px}.gb{margin-bottom:30px}.gc{margin-left:0px}.gn{font-size:18px}.go{margin-top:1.56em}.hd{margin:0}.he{max-width:100%}.hl{margin-top:40px}.ia{margin-top:1.34em}.ir{margin-top:0.93em}.ja{margin-top:0.67em}.kr{margin-top:24px}.pb{padding-left:24px}.pc{padding-right:24px}.pd{max-width:552px}</style><style type="text/css" data-fela-rehydration="453" data-fela-type="RULE" media="all and (min-width: 904px) and (max-width: 1079.98px)">.i{display:none}.ag{margin:0 64px}.ed{font-size:40px}.ee{margin-top:0.78em}.el{line-height:48px}.gt{font-size:21px}.gu{margin-top:2em}.hj{max-width:1192px}.ho{margin-top:56px}.id{margin-top:1.05em}.iv{font-size:34px}.iw{margin-top:1.25em}.jd{margin-top:0.86em}.ku{margin-top:32px}</style><style type="text/css" data-fela-rehydration="453" data-fela-type="RULE" media="all and (min-width: 728px) and (max-width: 903.98px)">.j{display:none}.af{margin:0 48px}.eb{font-size:40px}.ec{margin-top:0.78em}.ek{line-height:48px}.gr{font-size:21px}.gs{margin-top:2em}.hh{margin:0}.hi{max-width:100%}.hn{margin-top:56px}.ic{margin-top:1.05em}.it{font-size:34px}.iu{margin-top:1.25em}.jc{margin-top:0.86em}.kt{margin-top:32px}</style><style type="text/css" data-fela-rehydration="453" data-fela-type="RULE" media="all and (min-width: 552px) and (max-width: 727.98px)">.k{display:none}.ae{margin:0 24px}.dz{font-size:30px}.ea{margin-top:0.72em}.ej{line-height:40px}.gp{font-size:18px}.gq{margin-top:1.56em}.hf{margin:0}.hg{max-width:100%}.hm{margin-top:40px}.ib{margin-top:1.34em}.is{margin-top:0.93em}.jb{margin-top:0.67em}.ks{margin-top:24px}</style><style type="text/css" data-fela-rehydration="453" data-fela-type="RULE" media="print">.ab{display:none}</style><style type="text/css" data-fela-rehydration="453" data-fela-type="RULE" media="(prefers-reduced-motion: no-preference)">.y{transition:transform 300ms ease}.z{will-change:transform}.lv{transition:opacity 200ms}.nf{transition:border-color 150ms ease}.ng::before{background:
      radial-gradient(circle, rgba(0, 0, 0, 0.84) 60%, transparent 70%)
    }.nh::before{border-radius:50%}.ni::before{content:""}.nj::before{display:block}.nk::before{z-index:0}.nl::before{left:0}.nm::before{height:100%}.nn::before{position:absolute}.no::before{top:0}.np::before{width:100%}.nq:hover::before{animation:k1 2000ms infinite cubic-bezier(.1,.12,.25,1)}.nu{transition:fill 200ms ease}</style><style type="text/css" data-fela-rehydration="453" data-fela-type="RULE" media="all and (max-width: 1230px)">.lw{display:none}</style><style type="text/css" data-fela-rehydration="453" data-fela-type="RULE" media="all and (max-width: 1198px)">.ly{display:none}</style></head><body><!-- BEGIN WAYBACK TOOLBAR INSERT -->
<style type="text/css">
body {
  margin-top:0 !important;
  padding-top:0 !important;
  /*min-width:800px !important;*/
}
</style>
<script>__wm.rw(0);</script>
<div id="wm-ipp-base" lang="en" style="display:none;direction:ltr;">
<div id="wm-ipp" style="position:fixed;left:0;top:0;right:0;">
<div id="wm-ipp-inside">
  <div style="position:relative;">
    <div id="wm-logo" style="float:left;width:110px;padding-top:12px;">
      <a href="/web/" title="Wayback Machine home page"><img src="/_static/images/toolbar/wayback-toolbar-logo-200.png" srcset="/_static/images/toolbar/wayback-toolbar-logo-100.png, /_static/images/toolbar/wayback-toolbar-logo-150.png 1.5x, /_static/images/toolbar/wayback-toolbar-logo-200.png 2x" alt="Wayback Machine" style="width:100px" border="0" /></a>
    </div>
    <div class="r" style="float:right;">
      <div id="wm-btns" style="text-align:right;height:25px;">
                  <div id="wm-save-snapshot-success">success</div>
          <div id="wm-save-snapshot-fail">fail</div>
          <a id="wm-save-snapshot-open" href="#"
	     title="Share via My Web Archive" >
            <span class="iconochive-web"></span>
          </a>
          <a href="https://archive.org/account/login.php"
             title="Sign In"
             id="wm-sign-in"
          >
            <span class="iconochive-person"></span>
          </a>
          <span id="wm-save-snapshot-in-progress" class="iconochive-web"></span>
        	<a href="http://faq.web.archive.org/" title="Get some help using the Wayback Machine" style="top:-6px;"><span class="iconochive-question" style="color:rgb(87,186,244);font-size:160%;"></span></a>
	<a id="wm-tb-close" href="#close" onclick="__wm.h(event);return false;" style="top:-2px;" title="Close the toolbar"><span class="iconochive-remove-circle" style="color:#888888;font-size:240%;"></span></a>
      </div>
      <div id="wm-share">
          <a href="/web/20200121150820/http://web.archive.org/screenshot/https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c"
             id="wm-screenshot"
             title="screenshot">
            <span class="wm-icon-screen-shot"></span>
          </a>
	<a id="wm-share-facebook" href="#" data-url="https://web.archive.org/web/20200121150820/https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" title="Share on Facebook" style="margin-right:5px;" target="_blank"><span class="iconochive-facebook" style="color:#3b5998;font-size:160%;"></span></a>
	<a id="wm-share-twitter" href="#" data-url="https://web.archive.org/web/20200121150820/https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" title="Share on Twitter" style="margin-right:5px;" target="_blank"><span class="iconochive-twitter" style="color:#1dcaff;font-size:160%;"></span></a>
      </div>
    </div>
    <table class="c" style="">
      <tbody>
	<tr>
	  <td class="u" colspan="2">
	    <form target="_top" method="get" action="/web/submit" name="wmtb" id="wmtb"><input type="text" name="url" id="wmtbURL" value="https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" onfocus="this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20200121150820" /><input type="submit" value="Go" /></form>
	  </td>
	  <td class="n" rowspan="2" style="width:110px;">
	    <table>
	      <tbody>
		<!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
		<tr class="m">
		  <td class="b" nowrap="nowrap">Dec</td>
		  <td class="c" id="displayMonthEl" title="You are here: 15:08:20 Jan 21, 2020">JAN</td>
		  <td class="f" nowrap="nowrap"><a href="https://web.archive.org/web/20200612094614/https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" title="12 Jun 2020"><strong>Jun</strong></a></td>
		</tr>
		<!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
		<tr class="d">
		  <td class="b" nowrap="nowrap"><a href="https://web.archive.org/web/20191228234642/https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" title="23:46:42 Dec 28, 2019"><img src="/_static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a></td>
		  <td class="c" id="displayDayEl" style="width:34px;font-size:24px;white-space:nowrap;" title="You are here: 15:08:20 Jan 21, 2020">21</td>
		  <td class="f" nowrap="nowrap"><a href="https://web.archive.org/web/20200612094614/https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" title="09:46:14 Jun 12, 2020"><img src="/_static/images/toolbar/wm_tb_nxt_on.png" alt="Next capture" width="14" height="16" border="0" /></a></td>
		</tr>
		<!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
		<tr class="y">
		  <td class="b" nowrap="nowrap">2019</td>
		  <td class="c" id="displayYearEl" title="You are here: 15:08:20 Jan 21, 2020">2020</td>
		  <td class="f" nowrap="nowrap">2021</td>
		</tr>
	      </tbody>
	    </table>
	  </td>
	</tr>
	<tr>
	  <td class="s">
	    	    <div id="wm-nav-captures">
	      	      <a class="t" href="/web/20200121150820*/https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" title="See a list of every capture for this URL">4 captures</a>
	      <div class="r" title="Timespan for captures of this URL">28 Dec 2019 - 12 Jun 2020</div>
	      </div>
	  </td>
	  <td class="k">
	    <a href="" id="wm-graph-anchor">
	      <div id="wm-ipp-sparkline" title="Explore captures for this URL" style="position: relative">
		<canvas id="wm-sparkline-canvas" width="650" height="27" border="0"></canvas>
	      </div>
	    </a>
	  </td>
	</tr>
      </tbody>
    </table>
    <div style="position:absolute;bottom:0;right:2px;text-align:right;">
      <a id="wm-expand" class="wm-btn wm-closed" href="#expand" onclick="__wm.ex(event);return false;"><span id="wm-expand-icon" class="iconochive-down-solid"></span> <span style="font-size:80%">About this capture</span></a>
    </div>
  </div>
    <div id="wm-capinfo" style="border-top:1px solid #777;display:none; overflow: hidden">
                    <div id="wm-capinfo-collected-by">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center">COLLECTED BY</div>
    <div style="padding:3px;position:relative" id="wm-collected-by-content">
            <div style="display:inline-block;vertical-align:top;width:50%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/webwidecrawl);"></span>
		Organization: <a style="color:#33f;" href="https://archive.org/details/webwidecrawl" target="_new"><span class="wm-title">Internet Archive</span></a>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  The Internet Archive discovers and captures web pages through many different web crawls.

At any given time several distinct crawls are running, some for months, and some every day or longer.

View the web archive through the <a href="http://archive.org/web/web.php">Wayback Machine</a>.
	</div>
	      </div>
      <div style="display:inline-block;vertical-align:top;width:49%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/liveweb)"></span>
		<div>Collection: <a style="color:#33f;" href="https://archive.org/details/liveweb" target="_new"><span class="wm-title">Live Web Proxy Crawls</span></a></div>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  Content crawled via the <a href="http://archive.org/web/web.php">Wayback Machine</a> Live Proxy mostly by the Save Page Now feature on web.archive.org.
<br><br>
Liveweb proxy is a component of Internet Archive’s wayback machine project. The liveweb proxy captures the content of a web page in real time, archives it into a ARC or WARC file and returns the ARC/WARC record back to the wayback machine to process. The recorded ARC/WARC file becomes part of the wayback machine in due course of time.
<br>
	</div>
	      </div>
    </div>
    </div>
    <div id="wm-capinfo-timestamps">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center" title="Timestamps for the elements of this page">TIMESTAMPS</div>
    <div>
      <div id="wm-capresources" style="margin:0 5px 5px 5px;max-height:250px;overflow-y:scroll !important"></div>
      <div id="wm-capresources-loading" style="text-align:left;margin:0 20px 5px 5px;display:none"><img src="/_static/images/loading.gif" alt="loading" /></div>
    </div>
    </div>
  </div></div></div></div><div id="donato" style="position:relative;width:100%;">
  <div id="donato-base">
    <iframe id="donato-if" src="https://archive.org/includes/donate.php?as_page=1&amp;platform=wb&amp;referer=https%3A//web.archive.org/web/20200121150820/https%3A//medium.com/%2540ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c"
	    scrolling="no" frameborder="0" style="width:100%; height:100%">
    </iframe>
  </div>
</div><script type="text/javascript">
__wm.bt(650,27,25,2,"web","https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","20200121150820",1996,"/_static/",["/_static/css/banner-styles.css?v=bsmaklHF","/_static/css/iconochive.css?v=qtvMKcIJ"]);
  __wm.rw(1);
</script>
<!-- END WAYBACK TOOLBAR INSERT --><div id="root"><div class="a b c"><div class="d e f g h i j k"></div><script>document.domain = document.domain;</script><script>window.PARSELY = window.PARSELY || {autotrack: false}</script><nav class="r s t u v c w x y z ab"><div class="branch-journeys-top"><div class="n p"><div class="ac ae af ag ah ai aj ak"><div class="al n o am an"><div class="r ao w"><div class="n o"><a href="/web/20200121150820/https://medium.com/?source=post_page-----3ba269ea2f5c----------------------" aria-label="Homepage" rel="noopener"><div class="ap g"><svg height="22" width="112" viewbox="0 0 111.5 22" class="q"><path d="M56.3 19.5c0 .4 0 .5.3.7l1.5 1.4v.1h-6.5V19c-.7 1.8-2.4 3-4.3 3-3.3 0-5.8-2.6-5.8-7.5 0-4.5 2.6-7.6 6.3-7.6 1.6-.1 3.1.8 3.8 2.4V3.2c0-.3-.1-.6-.3-.7l-1.4-1.4V1l6.5-.8v19.3zm-4.8-.8V9.5c-.5-.6-1.2-.9-1.9-.9-1.6 0-3.1 1.4-3.1 5.7 0 4 1.3 5.4 3 5.4.8.1 1.6-.3 2-1zm9.1 3.1V9.4c0-.3-.1-.6-.3-.7l-1.4-1.5v-.1h6.5v12.5c0 .4 0 .5.3.7l1.4 1.4v.1h-6.5zm-.2-19.2C60.4 1.2 61.5 0 63 0c1.4 0 2.6 1.2 2.6 2.6S64.4 5.3 63 5.3a2.6 2.6 0 0 1-2.6-2.7zm22.5 16.9c0 .4 0 .5.3.7l1.5 1.4v.1h-6.5v-3.2c-.6 2-2.4 3.4-4.5 3.4-2.9 0-4.4-2.1-4.4-6.2 0-1.9 0-4.1.1-6.5 0-.3-.1-.5-.3-.7L67.7 7v.1H74v8c0 2.6.4 4.4 2 4.4.9-.1 1.7-.6 2.1-1.3V9.5c0-.3-.1-.6-.3-.7l-1.4-1.5v-.2h6.5v12.4zm22 2.3c0-.5.1-6.5.1-7.9 0-2.6-.4-4.5-2.2-4.5-.9 0-1.8.5-2.3 1.3.2.8.3 1.7.3 2.5 0 1.8-.1 4.2-.1 6.5 0 .3.1.5.3.7l1.5 1.4v.1H96c0-.4.1-6.5.1-7.9 0-2.7-.4-4.5-2.2-4.5-.9 0-1.7.5-2.2 1.3v9c0 .4 0 .5.3.7l1.4 1.4v.1h-6.5V9.5c0-.3-.1-.6-.3-.7l-1.4-1.5v-.2h6.5v3.1a4.6 4.6 0 0 1 4.6-3.4c2.2 0 3.6 1.2 4.2 3.5.7-2.1 2.7-3.6 4.9-3.5 2.9 0 4.5 2.2 4.5 6.2 0 1.9-.1 4.2-.1 6.5-.1.3.1.6.3.7l1.4 1.4v.1h-6.6zm-81.4-2l1.9 1.9v.1h-9.8v-.1l2-1.9c.2-.2.3-.4.3-.7V7.3c0-.5 0-1.2.1-1.8L11.4 22h-.1L4.5 6.8c-.1-.4-.2-.4-.3-.6v10c-.1.7 0 1.3.3 1.9l2.7 3.6v.1H0v-.1L2.7 18c.3-.6.4-1.3.3-1.9v-11c0-.5-.1-1.1-.5-1.5L.7 1.1V1h7l5.8 12.9L18.6 1h6.8v.1l-1.9 2.2c-.2.2-.3.5-.3.7v15.2c0 .2.1.5.3.6zm7.6-5.9c0 3.8 1.9 5.3 4.2 5.3 1.9.1 3.6-1 4.4-2.7h.1c-.8 3.7-3.1 5.5-6.5 5.5-3.7 0-7.2-2.2-7.2-7.4 0-5.5 3.5-7.6 7.3-7.6 3.1 0 6.4 1.5 6.4 6.2v.8h-8.7zm0-.8h4.3v-.8c0-3.9-.8-4.9-2-4.9-1.4.1-2.3 1.6-2.3 5.7z"></path></svg></div><div class="r aq"><svg width="35" height="35" viewbox="5 5 35 35" class="q"><path d="M5 40V5h35v35H5zm8.56-12.63c0 .56-.03.69-.32 1.03L10.8 31.4v.4h6.97v-.4L15.3 28.4c-.29-.34-.34-.5-.34-1.03v-8.95l6.13 13.36h.71l5.26-13.36v10.64c0 .3 0 .35-.19.53l-1.85 1.8v.4h9.2v-.4l-1.83-1.8c-.18-.18-.2-.24-.2-.53V15.94c0-.3.02-.35.2-.53l1.82-1.8v-.4h-6.47l-4.62 11.55-5.2-11.54h-6.8v.4l2.15 2.63c.24.3.29.37.29.77v10.35z"></path></svg></div></a></div></div><div class="r ar w"><div class="n o"><div class="n g"><div class="as" id="lo-post-page-navbar-upsell-button"><div><a href="https://web.archive.org/web/20200121150820/https://medium.com/membership?source=upgrade_membership---nav_full------------------------" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener"><span class="bj b bk bl bm bn r bo bp">Become a member</span></a></div></div><div class="as" id="lo-post-page-navbar-sign-in-link"><div class="bq r"><span class="bj b bk bl bm bn r bo bp"><a href="https://web.archive.org/web/20200121150820/https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c&amp;source=post_page-----3ba269ea2f5c---------------------nav_reg-" class="br bs av aw ax ay az ba bb bc bt bu bf bg bv bw" rel="noopener">Sign in</a></span></div></div></div><div class="as" id="lo-post-page-navbar-get-started-button"><div class="bq r"><button class="bx by br bs bz bt bu ca bc cb bj b bk bl bm bn cc cd ce cf cg bf">Get started</button></div></div></div></div></div></div></div></div></nav><div class="ch al r ci am"></div><article><section class="cj ck cl cm ak cn ce n co"></section><span class="r"></span><div><div class="cp u cq cr cs ct"></div><section class="cu cv cw cx cy"><div class="cz ak"><figure class="da cz ak paragraph-image"><div class="db dc dd de ak"><div class="dl r dd dm"><div class="dn r"><div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/60/1*qWOFrWPOkQm-nf1shcDSSA.png?q=20" width="3208" height="1720" role="presentation"/></div><img class="df dg cp t u dh ak dr" width="3208" height="1720" role="presentation"/><noscript><img class="cp t u dh ak" src="https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/6416/1*qWOFrWPOkQm-nf1shcDSSA.png" width="3208" height="1720" role="presentation"/></noscript></div></div></div></figure></div><div class="n p"><div class="ac ae af ag ah ds aj ak"><div><div id="4cb4" class="dt du dv bk dw b dx dy dz ea eb ec ed ee ef eg eh"><h1 class="dw b dx ei dz ej eb ek ed el ef em dv">Optimising PineTime’s Display Driver with Rust and Mynewt</h1></div><div class="en"><div class="n eo ep eq er"><div class="o n"><div><a rel="noopener" href="/web/20200121150820/https://medium.com/@ly.lee?source=post_page-----3ba269ea2f5c----------------------"><div class="dd es et"><div class="bs n eu o p cp ev ew ex ey ez ct"><svg width="57" height="57" viewbox="0 0 57 57"><path fill-rule="evenodd" clip-rule="evenodd" d="M28.5 1.2A27.45 27.45 0 0 0 4.06 15.82L3 15.27A28.65 28.65 0 0 1 28.5 0C39.64 0 49.29 6.2 54 15.27l-1.06.55A27.45 27.45 0 0 0 28.5 1.2zM4.06 41.18A27.45 27.45 0 0 0 28.5 55.8a27.45 27.45 0 0 0 24.44-14.62l1.06.55A28.65 28.65 0 0 1 28.5 57 28.65 28.65 0 0 1 3 41.73l1.06-.55z"></path></svg></div><img alt="Lup Yuen Lee 李立源" class="r fa et es" src="https://web.archive.org/web/20200121150820im_/https://miro.medium.com/fit/c/96/96/1*KGohS3sQaUnr58gc0BIfoQ.jpeg" width="48" height="48"/></div></a></div><div class="fb ak r"><div class="n"><div style="flex:1"><span class="bj b bk bl bm bn r dv q"><div class="fc n o fd"><span class="bj fe ff bl di fg fh fi fj fk dv"><a class="at au av aw ax ay az ba bb bc fl bf bg bh bi" rel="noopener" href="/web/20200121150820/https://medium.com/@ly.lee?source=post_page-----3ba269ea2f5c----------------------">Lup Yuen Lee 李立源</a></span><div class="fm r ar h"><button class="fn dv q by fo fp fq fr bc bh fs ft fu fv fw fx cb bj b bk fy fz bn cc cd ce cf cg bf">Follow</button></div></div></span></div></div><span class="bj b bk bl bm bn r bo bp"><span class="bj fe ff bl di fg fh fi fj fk bo"><div><a class="at au av aw ax ay az ba bb bc fl bf bg bh bi" rel="noopener" href="/web/20200121150820/https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c?source=post_page-----3ba269ea2f5c----------------------">Dec 28, 2019</a> <!-- -->·<!-- --> <!-- -->14<!-- --> min read</div></span></span></div></div><div class="n ga gb gc gd ge gf gg gh ab"><div class="n o"><div class="gi r ar"><a href="//web.archive.org/web/20200121150820/https://medium.com/p/3ba269ea2f5c/share/twitter?source=post_actions_header---------------------------" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" target="_blank" rel="noopener nofollow"><svg width="29" height="29" class="q"><path d="M22.05 7.54a4.47 4.47 0 0 0-3.3-1.46 4.53 4.53 0 0 0-4.53 4.53c0 .35.04.7.08 1.05A12.9 12.9 0 0 1 5 6.89a5.1 5.1 0 0 0-.65 2.26c.03 1.6.83 2.99 2.02 3.79a4.3 4.3 0 0 1-2.02-.57v.08a4.55 4.55 0 0 0 3.63 4.44c-.4.08-.8.13-1.21.16l-.81-.08a4.54 4.54 0 0 0 4.2 3.15 9.56 9.56 0 0 1-5.66 1.94l-1.05-.08c2 1.27 4.38 2.02 6.94 2.02 8.3 0 12.86-6.9 12.84-12.85.02-.24 0-.43 0-.65a8.68 8.68 0 0 0 2.26-2.34c-.82.38-1.7.62-2.6.72a4.37 4.37 0 0 0 1.95-2.51c-.84.53-1.81.9-2.83 1.13z"></path></svg></a></div><div class="gi r ar"><a href="//web.archive.org/web/20200121150820/https://medium.com/p/3ba269ea2f5c/share/facebook?source=post_actions_header---------------------------" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" target="_blank" rel="noopener nofollow"><svg width="29" height="29" class="q"><path d="M23.2 5H5.8a.8.8 0 0 0-.8.8V23.2c0 .44.35.8.8.8h9.3v-7.13h-2.38V13.9h2.38v-2.38c0-2.45 1.55-3.66 3.74-3.66 1.05 0 1.95.08 2.2.11v2.57h-1.5c-1.2 0-1.48.57-1.48 1.4v1.96h2.97l-.6 2.97h-2.37l.05 7.12h5.1a.8.8 0 0 0 .79-.8V5.8a.8.8 0 0 0-.8-.79"></path></svg></a></div><div class="gj r ao"><a href="https://web.archive.org/web/20200121150820/https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c&amp;source=post_actions_header--------------------------bookmark_sidebar-" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener"><svg width="25" height="25" viewbox="0 0 25 25"><path d="M19 6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14.66h.01c.01.1.05.2.12.28a.5.5 0 0 0 .7.03l5.67-4.12 5.66 4.13a.5.5 0 0 0 .71-.03.5.5 0 0 0 .12-.29H19V6zm-6.84 9.97L7 19.64V6a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v13.64l-5.16-3.67a.49.49 0 0 0-.68 0z" fill-rule="evenodd"></path></svg></a></div></div></div></div></div></div><p id="7fd8" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><em class="gy">Simple tweaks like Batched Updates and Non-Blocking SPI can have a huge impact on rendering performance…</em></p><p id="fbba" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><a class="at cg gz ha hb hc" target="_blank" rel="noopener" href="/web/20200121150820/https://medium.com/swlh/sneak-peek-of-pinetime-smart-watch-and-why-its-perfect-for-teaching-iot-81b74161c159?source=friends_link&amp;sk=d9301466f5499bece3e7b638e99ec20d">PineTime Smart Watch</a> has been an awesome educational tool for teaching embedded coding with <a href="https://web.archive.org/web/20200121150820/https://doc.rust-lang.org/book/title-page.html" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">Rust</a> and <a href="https://web.archive.org/web/20200121150820/https://mynewt.apache.org/" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">Mynewt OS</a>… Check out PineTime articles <a class="at cg gz ha hb hc" target="_blank" rel="noopener" href="/web/20200121150820/https://medium.com/swlh/sneak-peek-of-pinetime-smart-watch-and-why-its-perfect-for-teaching-iot-81b74161c159?source=friends_link&amp;sk=d9301466f5499bece3e7b638e99ec20d">#1</a>, <a class="at cg gz ha hb hc" target="_blank" rel="noopener" href="/web/20200121150820/https://medium.com/@ly.lee/building-a-rust-driver-for-pinetimes-touch-controller-cbc1a5d5d3e9?source=friends_link&amp;sk=d8cf73fc943d9c0e960627d768f309cb">#2</a> and <a class="at cg gz ha hb hc" target="_blank" rel="noopener" href="/web/20200121150820/https://medium.com/@ly.lee/porting-druid-rust-widgets-to-pinetime-smart-watch-7e1d5a5d977a?source=friends_link&amp;sk=09b153c68483f7fa9e63350efd167b07">#3</a></p><p id="6bd8" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">But stare closely at the video demos in the articles… You’ll realise that the rendering of graphics on PineTime’s LCD display looks sluggish.</p><p id="2bbf" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><em class="gy">Can we expect speedy screen updates from a </em><a href="https://web.archive.org/web/20200121150820/https://store.pine64.org/?product=pinetime-dev-kit" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow"><em class="gy">$20 smart watch</em></a><em class="gy">… Powered by a </em><a href="https://web.archive.org/web/20200121150820/https://infocenter.nordicsemi.com/pdf/nRF52832_PS_v1.0.pdf" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow"><em class="gy">Nordic nRF52832 Microcontroller</em></a><em class="gy"> that drives an </em><a href="https://web.archive.org/web/20200121150820/https://wiki.pine64.org/images/5/54/ST7789V_v1.6.pdf" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow"><em class="gy">ST7789 Display Controller</em></a><em class="gy"> over </em><a href="https://web.archive.org/web/20200121150820/https://en.wikipedia.org/wiki/Serial_Peripheral_Interface" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow"><em class="gy">SPI</em></a><em class="gy">?</em></p><p id="7774" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><em class="gy">Yes we can!</em> Check the rendering performance of Rust and Mynewt OS on PineTime, before and after optimisation…</p></div></div><div class="cz"><div class="n p"><div class="hd he hf hg hh hi ag hj ah hk aj ak"><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="hq r"><iframe src="https://web.archive.org/web/20200121150820if_/https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2F_x6B-L5KOtU%3Ffeature%3Doembed&amp;url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D_x6B-L5KOtU&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2F_x6B-L5KOtU%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube" allowfullscreen="" frameborder="0" height="480" width="854" title="Blocking vs Non Blocking SPI on PineTime" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">Before and after optimising PineTime’s display driver</figcaption></figure></div></div></div><div class="n p"><div class="ac ae af ag ah ds aj ak"><p id="aa7f" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Today we’ll learn how we optimised the PineTime Display Driver to render text and graphics in sub-seconds…</p><ol class=""><li id="1e34" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx hw hx hy"><strong class="gm hz">We group the pixels to be rendered into rows and blocks.</strong> This allows graphics and text to be rendered in fewer SPI operations.</li><li id="b32b" class="gk gl dv bk gm b gn ia gp ib gr ic gt id gv ie gx hw hx hy"><strong class="gm hz">We changed Blocking SPI operations to Non-Blocking SPI operations. </strong>This enables the Rust rendering functions to be executed while SPI operations are running concurrently. <em class="gy">(</em><a href="https://web.archive.org/web/20200121150820/https://en.wikipedia.org/wiki/Graphics_pipeline" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow"><em class="gy">Think graphics rendering pipeline</em></a><em class="gy">)</em></li></ol></div></div></section><hr class="if fe ig ih ii ht ij ik il im in"/><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah ds aj ak"><h1 id="b1c9" class="io ip dv bk bj iq dx ir dz is it iu iv iw ix iy iz">Rendering PineTime Graphics Pixel by Pixel</h1><p id="3957" class="gk gl dv bk gm b gn ja gp jb gr jc gt jd gv je gx">Let’s look at a simple example to understand how the [<a href="https://web.archive.org/web/20200121150820/https://crates.io/crates/embedded-graphics" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">embedded-graphics</a>] and [<a href="https://web.archive.org/web/20200121150820/https://crates.io/crates/st7735-lcd" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">st7735-lcd</a>] crates work together to render graphics on PineTime’s LCD display. This code creates a rectangle with [embedded-graphics] and renders the rectangle to the [st7735-lcd] display…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/c5e793814862656246e5586536ab0bb4" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/piet-embedded/blob/master/piet-embedded-graphics/src/display.rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/piet-embedded/blob/master/piet-embedded-graphics/src/display.rs</a></figcaption></figure><p id="246f" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">When we trace the SPI requests generated by the [st7735-lcd] driver, we see lots of repetition…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/cbb8c56876ce3d8c8bd8f6a9cb2e5e4b" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/logs/spi-blocking.log" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/logs/spi-blocking.log</a></figcaption></figure><p id="39a3" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><em class="gy">(</em><a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/rust/mynewt/src/spi.rs#L183-L188" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow"><em class="gy">The SPI log was obtained by uncommenting this code</em></a><em class="gy">)</em></p><p id="fb87" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">For each pixel in the rectangle, the display driver is setting the X and Y coordinates of each pixel and setting the colour of each pixel… <em class="gy">Pixel by pixel! (0, 0), (0, 1), (0, 2), …</em></p><p id="3932" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">That’s not efficient for rendering graphics, pixel by pixel… <em class="gy">Why are [embedded-graphics] and [st7735-lcd] doing that?</em></p><p id="7847" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">That’s because [embedded-graphics] was designed to run on <strong class="gm hz">highly-constrained microcontrollers</strong> with very little RAM… Think STM32 Blue Pill, which has only <strong class="gm hz">20 KB RAM</strong>! That’s too little RAM for rendering rectangles and other graphics into RAM and copying the rendered RAM bitmap to the display. <em class="gy">How does [embedded-graphics] render graphics?</em></p><p id="0532" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">By using <a href="https://web.archive.org/web/20200121150820/https://doc.rust-lang.org/book/ch13-02-iterators.html" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow"><strong class="gm hz">Rust Iterators</strong></a>! Every graphic object to be rendered (rectangles, circles, even text) is transformed by [embedded-graphics] into a <strong class="gm hz">Rust Iterator that returns the (X, Y) coordinates of each pixel and its colour</strong>. This requires very little RAM because the pixel information is computed on the fly, only when the Iterator needs to return the next pixel.</p><p id="9b66" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Rendering a Pixel Iterator to the display is really easy and doesn’t need much RAM, like this…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/bd6be5f6a44d63bcc4376442e1a99b0c" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/st7735-lcd-batch-rs/blob/master/src/lib.rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/st7735-lcd-batch-rs/blob/master/src/lib.rs</a></figcaption></figure><p id="ee99" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Upon inspecting the <code class="dm jg jh ji jj b">set_pixel</code> function that’s called for each pixel, we see this…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/81250916adc217ac18411e3c8b3b219a" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/st7735-lcd-batch-rs/blob/master/src/lib.rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/st7735-lcd-batch-rs/blob/master/src/lib.rs</a></figcaption></figure><p id="4b14" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><em class="gy">A-ha!</em> We have discovered the code that creates all the repeated SPI requests for setting the (X, Y) coordinates and colour of each pixel!</p><p id="4d53" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Instead of updating the LED display pixel by pixel, <em class="gy">can we batch the pixels together and blast the entire batch of pixels in a single SPI request?</em></p><p id="7e43" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Digging into the [st7735-lcd] display driver code, we see this clue…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/4ac4d489b7dc69fbd0f785b4b3379220" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/st7735-lcd-batch-rs/blob/master/src/lib.rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/st7735-lcd-batch-rs/blob/master/src/lib.rs</a></figcaption></figure><p id="3079" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">See the difference? The function <code class="dm jg jh ji jj b">set_pixels</code> sets the pixel window to the region from <code class="dm jg jh ji jj b">(X Start, Y Start)</code> to <code class="dm jg jh ji jj b">(X End, Y End)</code>… Then it <strong class="gm hz">blasts a list of pixel colours</strong> to populate that entire window region!</p><p id="7936" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">When we call <code class="dm jg jh ji jj b">set_pixels</code> the SPI requests generated by the display driver would look like this… <em class="gy">(Note the long lists of pixel colours)</em></p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/f2ca75a37f0119aefb14d089af9f1e2e" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/logs/spi-non-blocking.log" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/logs/spi-non-blocking.log</a></figcaption></figure><p id="9799" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><em class="gy">But will this really improve rendering performance?</em> Let’s test this hypothesis the <a class="at cg gz ha hb hc" target="_blank" rel="noopener" href="/web/20200121150820/https://medium.com/@ly.lee/my-5-year-iot-mission-5f2f28348780?source=friends_link&amp;sk=8c9ab6f607d4b6af4a2b233e4096d623">Lean and Agile Way</a> by batching the pixels (in the simplest way possible) without disturbing too much [embedded-graphics] and [st7735-lcd] code…</p></div></div></section><hr class="if fe ig ih ii ht ij ik il im in"/><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah ds aj ak"><h1 id="8d93" class="io ip dv bk bj iq dx ir dz is it iu iv iw ix iy iz">Batching PineTime Pixels into Rows and Blocks</h1><p id="c037" class="gk gl dv bk gm b gn ja gp jb gr jc gt jd gv je gx">Here’s our situation…</p><ol class=""><li id="ce78" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx hw hx hy">[embedded-graphics] creates Rust Iterators for rendering graphic objects. Works with minimal RAM, but generates excessive SPI requests.</li><li id="19b3" class="gk gl dv bk gm b gn ia gp ib gr ic gt id gv ie gx hw hx hy">PineTime’s Nordic nRF52832 microcontroller has 64 KB of RAM… Not quite sufficient to render the entire 240x240 screen into RAM. (2 bytes of colour per pixel ✖ ️240 rows ✖ 240 columns = <strong class="gm hz">112.5 KB</strong>) RAM-based bitmap rendering is no go.</li></ol><p id="a21c" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><em class="gy">Is there a Middle Way…</em> Keeping the RAM-efficient Rust Iterators... But get the Iterators to <em class="gy">return small batches of pixels</em> (instead of returning individual pixels)? Let’s experiment with two very simple Rust Iterators: <strong class="gm hz">Pixel Row Iterator and Pixel Block Iterator!</strong></p><p id="77ce" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Suppose we ask [embedded-graphics] to render this trapezoid shape with 10 pixels…</p><figure class="hl hm hn ho hp cz cl cm paragraph-image"><div class="db dc dd de ak"><div class="cl cm jk"><div class="dl r dd dm"><div class="jl r"><div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/60/1*sXRkBs9tR1cieU9LwYb63Q.png?q=20" width="3050" height="2950" role="presentation"/></div><img class="df dg cp t u dh ak dr" width="3050" height="2950" role="presentation"/><noscript><img class="cp t u dh ak" src="https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/6100/1*sXRkBs9tR1cieU9LwYb63Q.png" width="3050" height="2950" role="presentation"/></noscript></div></div></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">10 pixels from the rendered letter K</figcaption></figure><p id="5925" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">[embedded-graphics] returns a Pixel Iterator that generates the 10 pixels from left to right, top to bottom…</p><figure class="hl hm hn ho hp cz dr jn cd jo jp jq jr js ba jt ju jv jw jx jy paragraph-image"><div class="db dc dd de ak"><div class="cl cm jm"><div class="dl r dd dm"><div class="jz r"><div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/60/1*kRvQ0Hg2xTZ6MhHgpCQhRw.png?q=20" width="1987" height="1253" role="presentation"/></div><img class="df dg cp t u dh ak dr" width="1987" height="1253" role="presentation"/><noscript><img class="cp t u dh ak" src="https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/3974/1*kRvQ0Hg2xTZ6MhHgpCQhRw.png" width="1987" height="1253" role="presentation"/></noscript></div></div></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">Zig-zag Pixel Iterator returned by [embedded-graphics]</figcaption></figure><p id="6153" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Which needs <strong class="gm hz">10 SPI requests</strong> to render, 1 pixel per SPI request. <em class="gy">(Let’s count only the set colour requests)</em></p><p id="6b71" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Since the Pixel Iterator produces pixels row by row, let’s create a <strong class="gm hz">Pixel Row Iterator</strong> that returns pixels grouped by row…</p><figure class="hl hm hn ho hp cz dr jn cd jo jp jq jr js ba jt ju jv jw jx jy paragraph-image"><div class="db dc dd de ak"><div class="cl cm ka"><div class="dl r dd dm"><div class="kb r"><div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/60/1*dD_OZ-xAR2L14peOvLfJTg.png?q=20" width="2083" height="1302" role="presentation"/></div><img class="df dg cp t u dh ak dr" width="2083" height="1302" role="presentation"/><noscript><img class="cp t u dh ak" src="https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/4166/1*dD_OZ-xAR2L14peOvLfJTg.png" width="2083" height="1302" role="presentation"/></noscript></div></div></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">Our Pixel Row Iterator returns 3 rows</figcaption></figure><p id="fd97" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><em class="gy">Awesome!</em> When we group the pixels into rows, we only need to make <strong class="gm hz">3 SPI requests</strong> to render all 10 pixels!</p><p id="5705" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><em class="gy">Can we do better?</em> What if we group consecutive rows of the same width into rectangular blocks… Creating a <strong class="gm hz">Pixel Block Iterator</strong>…</p><figure class="hl hm hn ho hp cz dr jn cd jo jp jq jr js ba jt ju jv jw jx jy paragraph-image"><div class="db dc dd de ak"><div class="cl cm kc"><div class="dl r dd dm"><div class="kd r"><div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/60/1*0kGCWh1acxSEV1q-L-t0Mg.png?q=20" width="2023" height="1304" role="presentation"/></div><img class="df dg cp t u dh ak dr" width="2023" height="1304" role="presentation"/><noscript><img class="cp t u dh ak" src="https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/4046/1*0kGCWh1acxSEV1q-L-t0Mg.png" width="2023" height="1304" role="presentation"/></noscript></div></div></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">Our Pixel Block Iterator returns 2 blocks</figcaption></figure><p id="2ed4" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><em class="gy">Yay!</em> We have grouped 10 pixels into 2 blocks… Only <strong class="gm hz">2 SPI requests</strong> to render all 10 pixels!</p><p id="f417" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><em class="gy">What’s the catch? How did we optimise 10 SPI requests into 2 SPI requests… Without sacrificing anything?</em></p><p id="32fb" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">While grouping the pixels into rows and blocks, we actually use more RAM. Every time the Pixel Row Iterator returns the next row, it needs up to <strong class="gm hz">8 bytes</strong> of temporary RAM storage (4 pixels with 2 colour bytes each).</p><p id="5c5e" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">And every time the Pixel Block Iterator returns the next block (max 8 pixels), it needs up to <strong class="gm hz">16 bytes</strong> of temporary RAM storage. Which isn’t a lot of RAM, if we keep our block size small. Also the Iterator will reuse the storage for each block returned, so we won’t need to worry about storing 2 or more blocks returned by the Iterator.</p><p id="3814" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">This is the classical <a href="https://web.archive.org/web/20200121150820/https://en.wikipedia.org/wiki/Space%E2%80%93time_tradeoff" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow"><strong class="gm hz">Space-Time Tradeoff</strong></a> in Computer Science… Sacrificing some storage space (RAM) to make things run faster.</p></div></div></section><hr class="if fe ig ih ii ht ij ik il im in"/><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah ds aj ak"><h1 id="1326" class="io ip dv bk bj iq dx ir dz is it iu iv iw ix iy iz">Pixel Row and Pixel Block Iterators</h1><p id="98b3" class="gk gl dv bk gm b gn ja gp jb gr jc gt jd gv je gx">Here’s the code for the Pixel Row Iterator that returns the next row of contiguous pixels…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/d690bcdb07e93f6caf8132e623ad1ca2" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">Pixel Row Iterator. From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/piet-embedded/blob/master/piet-embedded-graphics/src/batch.rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/piet-embedded/blob/master/piet-embedded-graphics/src/batch.rs</a></figcaption></figure><p id="68f8" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">And here’s the code for the Pixel Block Iterator that returns the next block of contiguous rows of the same width. Turns out we only need to tweak the code above slightly to get what we need… Instead of iterating over pixels, we now iterate over rows…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/fdbe3f8cfaeff4dc048a3aa9cbdb3a95" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">Pixel Block Iterator. From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/piet-embedded/blob/master/piet-embedded-graphics/src/batch.rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/piet-embedded/blob/master/piet-embedded-graphics/src/batch.rs</a></figcaption></figure><p id="c9b4" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Combining the Pixel Row Iterator and the Pixel Block Iterator, we get the <code class="dm jg jh ji jj b">draw_blocks</code> function that renders any [embedded-graphics] graphic object (including text) as pixel blocks…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/ca420086b14b219dec17375596ae274e" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">Rendering a graphic object as Pixel Blocks. From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/piet-embedded/blob/master/piet-embedded-graphics/src/batch.rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/piet-embedded/blob/master/piet-embedded-graphics/src/batch.rs</a></figcaption></figure><p id="b84b" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Thus we now render graphic objects as RAM-efficient chunks of pixels, instead of individual pixels. <em class="gy">Middle Way found!</em></p></div></div></section><hr class="if fe ig ih ii ht ij ik il im in"/><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah ds aj ak"><h1 id="20f4" class="io ip dv bk bj iq dx ir dz is it iu iv iw ix iy iz">Test the Pixel Row and Pixel Block Iterators</h1><p id="b629" class="gk gl dv bk gm b gn ja gp jb gr jc gt jd gv je gx"><em class="gy">“</em><a href="https://web.archive.org/web/20200121150820/https://en.wikipedia.org/wiki/Space%E2%80%93time_tradeoff" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow"><em class="gy">Space-Time Tradeoff</em></a><em class="gy"> called and wants to know how much space we’ll be allocating to make things run faster…”</em></p><p id="4d29" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">The more RAM storage we allocate for batching pixels into rows and blocks, the fewer SPI requests we need to make. The code currently sets the limits at <strong class="gm hz">100 pixels per row, 200 pixels per block</strong>…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/bdbd61470413869026d08d16866f619c" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">Pixel Row and Pixel Block Sizes. From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/piet-embedded/blob/master/piet-embedded-graphics/src/batch.rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/piet-embedded/blob/master/piet-embedded-graphics/src/batch.rs</a></figcaption></figure><p id="c26d" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Note that the rows and blocks are returned by the Iterators as <strong class="gm hz">[</strong><a href="https://web.archive.org/web/20200121150820/https://crates.io/crates/heapless" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow"><strong class="gm hz">heapless</strong></a><strong class="gm hz">] </strong><a href="https://web.archive.org/web/20200121150820/https://docs.rs/heapless/0.5.1/heapless/struct.Vec.html" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow"><strong class="gm hz">Vectors</strong></a>, which use fixed-size arrays to store Vectors. So that we don’t rely on Heap Memory, which is harder to manage on embedded devices like PineTime.</p><p id="2f26" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Any graphic object that’s <strong class="gm hz">100 pixels wide</strong> (or smaller) will be batched efficiently into pixels rows and blocks. Like this square of width 90 pixels created with [embedded-graphics]…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/52ce07ec157a8e6ad7ceb4580b2130c2" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/piet-embedded/blob/master/piet-embedded-graphics/src/display.rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/piet-embedded/blob/master/piet-embedded-graphics/src/display.rs</a></figcaption></figure><figure class="hl hm hn ho hp cz cl cm paragraph-image"><div class="db dc dd de ak"><div class="cl cm ke"><div class="dl r dd dm"><div class="kf r"><div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/60/1*oSpNIR4KMzDdDpaZwjLTFw.png?q=20" width="2602" height="2120" role="presentation"/></div><img class="df dg cp t u dh ak dr" width="2602" height="2120" role="presentation"/><noscript><img class="cp t u dh ak" src="https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/5204/1*oSpNIR4KMzDdDpaZwjLTFw.png" width="2602" height="2120" role="presentation"/></noscript></div></div></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">Square of width 90 pixels from the render demo</figcaption></figure><p id="f669" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">When we trace the rendering of the square, we see this log of pixel blocks…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/2586cb418173bc5f0424db1e8feef8ae" allowfullscreen="" frameborder="0" height="0" width="0" title="pixel-block.log" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/logs/pixel-block.log" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/logs/pixel-block.log</a></figcaption></figure><p id="f639" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><em class="gy">(</em><a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/piet-embedded/blob/master/piet-embedded-graphics/src/batch.rs#L122-L125" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow"><em class="gy">The log was created by uncommenting this code</em></a><em class="gy">)</em></p><p id="cd78" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Which means that we are indeed deconstructing the <strong class="gm hz">90x90 square</strong> into <strong class="gm hz">90x2 pixel blocks</strong> for efficient rendering.</p><blockquote class="kg kh ki"><p id="eacb" class="gk gl dv gy gm b gn go gp gq gr gs gt gu gv gw gx"><em class="bk">💎</em> This deconstruction doesn’t work so well for a square that occupies the entire 240x240 PineTime screen. I’ll let you think…<em class="bk"> 1️⃣ </em>Why this doesn’t work <em class="bk">2️⃣ </em>A solution for rendering the huge square efficiently <em class="bk">😀</em></p></blockquote></div></div></section><hr class="if fe ig ih ii ht ij ik il im in"/><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah ds aj ak"><h1 id="b211" class="io ip dv bk bj iq dx ir dz is it iu iv iw ix iy iz">Non-Blocking SPI on PineTime with Mynewt OS</h1><p id="2695" class="gk gl dv bk gm b gn ja gp jb gr jc gt jd gv je gx">We could go ahead and run the Pixel Row and Pixel Block Iterators to measure the rendering time… But we won’t. We are now rendering the screen as chunks of pixels, transmitting a long string of pixel colours in <strong class="gm hz">a single SPI request</strong>…</p><p id="6188" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">However our SPI code in PineTime isn’t optimised to handle large SPI requests… Whenever it transmits an SPI request, <em class="gy">it waits for the entire request to be transmitted</em> before returning to the caller. This is known as <strong class="gm hz">Blocking SPI</strong>.</p><p id="4a2c" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Here’s how we call <code class="dm jg jh ji jj b"><a href="https://web.archive.org/web/20200121150820/https://mynewt.apache.org/latest/os/modules/hal/hal_spi/hal_spi.html#c.hal_spi_txrx" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">hal_spi_txrx</a></code> to transmit a Blocking SPI request in Rust with Mynewt OS…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/a7427f99001dac1dd43f674acf625b2f" allowfullscreen="" frameborder="0" height="0" width="0" title="blocking-spi.rs" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/rust/mynewt/src/spi.rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/rust/mynewt/src/spi.rs</a></figcaption></figure><p id="8e2b" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Mynewt OS provides an efficient way to transmit SPI requests: <strong class="gm hz">Non-Blocking SPI</strong>. <code class="dm jg jh ji jj b"><a href="https://web.archive.org/web/20200121150820/https://mynewt.apache.org/latest/os/modules/hal/hal_spi/hal_spi.html#c.hal_spi_txrx_noblock" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">hal_spi_txrx_noblock</a></code> doesn’t hold up the caller while transmitting the request. Instead, Mynewt calls our Callback Function when the request has been completed.</p><p id="a8ba" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Here’s how we set up Non-Blocking SPI and call <code class="dm jg jh ji jj b">hal_spi_txrx_noblock</code>…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/f2ae86f5e56b8a8025e9bc3dc849d439" allowfullscreen="" frameborder="0" height="0" width="0" title="non-blocking-spi.rs" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/rust/mynewt/src/spi.rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/rust/mynewt/src/spi.rs</a></figcaption></figure><p id="53a7" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><code class="dm jg jh ji jj b">spi_noblock_handler</code> is our Callback Function in Rust. Mynewt won’t let us transmit a Non-Blocking SPI request while another is in progress, so our Callback Function needs to ensure that never happens. More about <code class="dm jg jh ji jj b">spi_noblock_handler</code> in a while.</p><blockquote class="kg kh ki"><p id="fc4d" class="gk gl dv gy gm b gn go gp gq gr gs gt gu gv gw gx"><em class="bk">💎 </em>What’s <code class="dm jg jh ji jj b"><a href="https://web.archive.org/web/20200121150820/https://doc.rust-lang.org/core/mem/fn.transmute.html" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">core::mem::transmute</a></code>? We use this function from the <a href="https://web.archive.org/web/20200121150820/https://doc.rust-lang.org/core/index.html" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">Rust Core Library</a> to cast pointer types when passing pointers and references from Rust to C. It’s similar to casting <code class="dm jg jh ji jj b">char *</code> to <code class="dm jg jh ji jj b">void *</code> in C.</p><p id="ab06" class="gk gl dv gy gm b gn go gp gq gr gs gt gu gv gw gx">Why don’t we need to specify the pointer type that we are casting to? Because the Rust Compiler performs <a href="https://web.archive.org/web/20200121150820/https://doc.rust-lang.org/stable/rust-by-example/types/inference.html" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">Type Inference</a> to deduce the pointer type.</p></blockquote></div></div></section><hr class="if fe ig ih ii ht ij ik il im in"/><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah ds aj ak"><h1 id="7ad3" class="io ip dv bk bj iq dx ir dz is it iu iv iw ix iy iz">Work Around an SPI Quirk</h1><p id="d6bc" class="gk gl dv bk gm b gn ja gp jb gr jc gt jd gv je gx"><em class="gy">Bad News:</em> Non-Blocking SPI doesn’t work 100% as advertised for Nordic nRF52832 Microcontroller, the heart of PineTime. <a href="https://web.archive.org/web/20200121150820/https://github.com/apache/mynewt-core/blob/master/hw/mcu/nordic/nrf52xxx/src/hal_spi.c#L1106-L1118" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">According to this note in Mynewt OS</a>, <strong class="gm hz">Non-Blocking SPI on nRF52832 fails if we’re sending a single byte over SPI</strong>.</p><p id="f6f1" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><em class="gy">But why would we send single-byte SPI requests anyway?</em></p><p id="614d" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Remember this SPI log that we captured earlier? We seem to be sending single bytes very often: <code class="dm jg jh ji jj b">2a</code>, <code class="dm jg jh ji jj b">2b</code> and <code class="dm jg jh ji jj b">2c</code>, which are <strong class="gm hz">Command Bytes</strong>…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/f2ca75a37f0119aefb14d089af9f1e2e" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/logs/spi-non-blocking.log" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/logs/spi-non-blocking.log</a></figcaption></figure><p id="6ca6" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">PineTime’s <a href="https://web.archive.org/web/20200121150820/https://wiki.pine64.org/images/5/54/ST7789V_v1.6.pdf" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">ST7789 Display Controller</a> has an unusual SPI interface with a special pin: the <strong class="gm hz">Data/Command (DC) Pin</strong>. The display controller expects our microcontroller to set the <strong class="gm hz">DC Pin to Low when sending the Command Byte</strong>, and set the <strong class="gm hz">DC Pin to High when sending Data Bytes</strong>…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/937414430f7c44ff91ef32796375bb19" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/rust/mynewt/src/spi.rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/rust/mynewt/src/spi.rs</a></figcaption></figure><p id="26f7" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Unfortunately our <strong class="gm hz">Command Bytes are single bytes</strong>, hence we see plenty of single-byte SPI requests. <em class="gy">All because of the need to flip the DC Pin!</em></p><p id="bddf" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">This complicates our SPI design but let’s overcome this microcontroller hardware defect with good firmware… <strong class="gm hz">All single-byte SPI requests are now sent the Blocking way</strong>, other requests are sent the Non-Blocking way…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/17f7d62e19a82c8f2f190fb5c4e06059" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/rust/mynewt/src/spi.rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/rust/mynewt/src/spi.rs</a></figcaption></figure><p id="8b9a" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">The code uses a Semaphore <code class="dm jg jh ji jj b">SPI_SEM</code> to wait for the Non-Blocking SPI operation to complete before proceeding. <code class="dm jg jh ji jj b">SPI_SEM</code> is signalled by our Callback Function <code class="dm jg jh ji jj b">spi_noblock_handler</code> like this…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/a7a6ce519e96d2b1ba3e43431fe2d756" allowfullscreen="" frameborder="0" height="0" width="0" title="spi_noblock_handler.rs" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/rust/mynewt/src/spi.rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/rust/mynewt/src/spi.rs</a></figcaption></figure><p id="747b" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><em class="gy">Something smells fishy…</em> <em class="gy">Why are we now waiting for a Non-Blocking SPI request to complete?</em></p><p id="4fa2" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Well this happens when we do things the <a class="at cg gz ha hb hc" target="_blank" rel="noopener" href="/web/20200121150820/https://medium.com/@ly.lee/my-5-year-iot-mission-5f2f28348780?source=friends_link&amp;sk=8c9ab6f607d4b6af4a2b233e4096d623">Lean and Agile Way</a>… When we hit problems (like the single-byte SPI issue), we assess various simple solutions before we select and implement the right permanent fix. <em class="gy">(And I don’t think we have found the right fix yet)</em></p><p id="4706" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">This Semaphore workaround also makes the function <code class="dm jg jh ji jj b">internal_spi_noblock_write</code> easier to troubleshoot… Whether the SPI request consists of a single byte or multiple bytes, <code class="dm jg jh ji jj b">internal_spi_noblock_write</code> will always wait for the SPI request to complete, instead of having diverging paths.</p><p id="5a97" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">This story also highlights the benefit of building our Rust firmware on top of an established Real Time Operating System like Mynewt OS… We quickly discover platform quirks that others have experienced, so that we can avoid the same trap.</p></div></div></section><hr class="if fe ig ih ii ht ij ik il im in"/><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah ds aj ak"><h1 id="7688" class="io ip dv bk bj iq dx ir dz is it iu iv iw ix iy iz">Render Graphics and Send SPI Requests Simultaneously on PineTime</h1><p id="1041" class="gk gl dv bk gm b gn ja gp jb gr jc gt jd gv je gx">Now we can send large SPI requests efficiently to PineTime’s LCD display. We are blocking on a Semaphore while waiting for the SPI request to be completed, which means that our CPU is actually free to do some other tasks while blocking.</p><p id="c77b" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><em class="gy">Can we do some [embedded-graphics] rendering while waiting for the SPI requests to be completed?</em></p><p id="079d" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Two problems with that…</p><ol class=""><li id="e4fd" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx hw hx hy">[embedded-graphics] creates Rust Iterators and SPI requests in temporary RAM storage. To let [embedded-graphics] continue working, we need to <strong class="gm hz">copy the generated SPI requests</strong> into RAM before sending the requests</li><li id="bfe8" class="gk gl dv bk gm b gn ia gp ib gr ic gt id gv ie gx hw hx hy">To perform [embedded-graphics] rendering independently from the SPI request transmission, we need a <strong class="gm hz">background task</strong>. The main task will render graphics with [embedded-graphics] (which is our current design), the background task will transmit SPI requests (this part is new).</li></ol><figure class="hl hm hn ho hp cz cl cm paragraph-image"><div class="db dc dd de ak"><div class="cl cm kj"><div class="dl r dd dm"><div class="kk r"><div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/60/1*B1WC9dfxTj1F4aHQ0-xcxg.jpeg?q=20" width="5536" height="3033" role="presentation"/></div><img class="df dg cp t u dh ak dr" width="5536" height="3033" role="presentation"/><noscript><img class="cp t u dh ak" src="https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/11072/1*B1WC9dfxTj1F4aHQ0-xcxg.jpeg" width="5536" height="3033" role="presentation"/></noscript></div></div></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">Rendering graphics and transmitting SPI requests at the same time on PineTime. Yes this is the Producer-Consumer Pattern found in many programs.</figcaption></figure><p id="79f7" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Fortunately Mynewt OS has everything we need to experiment with this multitasking…</p><ol class=""><li id="6c8a" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx hw hx hy">Mynewt’s <strong class="gm hz">Mbuf Chains</strong> may be used to copy SPI requests easily into a RAM space that’s specially managed by Mynewt OS</li><li id="cfe5" class="gk gl dv bk gm b gn ia gp ib gr ic gt id gv ie gx hw hx hy">Mynewt’s <strong class="gm hz">Mbuf Queues</strong> may be used to enqueue the SPI requests for transmission by the background task</li><li id="b503" class="gk gl dv bk gm b gn ia gp ib gr ic gt id gv ie gx hw hx hy">Mynewt lets us create a <strong class="gm hz">background task</strong> to send SPI requests from the Mbuf Queue</li></ol><p id="17b0" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Let’s look at Mbuf Chains, Mbuf Queues and Multitasking in Mynewt OS.</p></div></div></section><hr class="if fe ig ih ii ht ij ik il im in"/><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah ds aj ak"><h1 id="3cd0" class="io ip dv bk bj iq dx ir dz is it iu iv iw ix iy iz">Buffer SPI Requests with Mbuf Chains in Mynewt OS</h1><p id="16d8" class="gk gl dv bk gm b gn ja gp jb gr jc gt jd gv je gx">In the Unix world of Network Drivers, <a href="https://web.archive.org/web/20200121150820/https://mynewt.apache.org/latest/os/core_os/mbuf/mbuf.html" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow"><strong class="gm hz">Mbufs</strong></a> (short for Memory Buffers) are often used to store network packets. Mbufs were created to make common networking stack operations (like stripping and adding protocol headers) efficient and as copy-free as possible. <em class="gy">(Mbufs are also used by the NimBLE Bluetooth Stack, which we have seen in the </em><a class="at cg gz ha hb hc" target="_blank" rel="noopener" href="/web/20200121150820/https://medium.com/swlh/sneak-peek-of-pinetime-smart-watch-and-why-its-perfect-for-teaching-iot-81b74161c159?source=friends_link&amp;sk=d9301466f5499bece3e7b638e99ec20d"><em class="gy">first PineTime article</em></a><em class="gy">)</em></p><p id="6fc8" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><em class="gy">What makes Mbufs so versatile? How are they different from Heap Storage?</em></p><p id="b66c" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">When handling Network Packets (and SPI Requests), we need a quick way to allocate and deallocate buffers of varying sizes. When we request memory from Heap Storage, we get a contiguous block of RAM that’s exactly what we need (or maybe more). But it causes our Heap Storage to become <em class="gy">fragmented and poorly utilised.</em></p><figure class="hl hm hn ho hp cz cl cm paragraph-image"><div class="db dc dd de ak"><div class="cl cm kl"><div class="dl r dd dm"><div class="km r"><div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/60/0*re5J9-NnVP3D_vk9.png?q=20" width="720" height="540" role="presentation"/></div><img class="df dg cp t u dh ak dr" width="720" height="540" role="presentation"/><noscript><img class="cp t u dh ak" src="https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/1440/0*re5J9-NnVP3D_vk9.png" width="720" height="540" role="presentation"/></noscript></div></div></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">Chain of Mbufs. From <a href="https://web.archive.org/web/20200121150820/https://mynewt.apache.org/latest/os/core_os/mbuf/mbuf.html" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://mynewt.apache.org/latest/os/core_os/mbuf/mbuf.html</a></figcaption></figure><p id="845c" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">With Mbufs, we get a <strong class="gm hz">chain (linked list) of memory blocks</strong> instead. We can’t be sure how much RAM we’ll get in each block, but we can be sure that the total RAM in the entire chain meets what we need. <em class="gy">(The diagram above shows how Mynewt OS allocates Mbuf Chains in a compact way using fixed-size Mbuf blocks)</em></p><p id="78df" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><em class="gy">Isn’t it harder to code with a chain of memory blocks?</em> Yes, it makes coding more cumbersome, but Mbuf Chains will utilise our tiny pool of RAM on PineTime much better than a Heap Storage allocator.</p><p id="afff" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">With Rust and Mynewt OS, here’s how we allocate an Mbuf Chain and append our SPI request to the Mbuf Chain…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/6f779a766c9af5fee6523cae4bf98cb6" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/rust/mynewt/src/spi.rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/rust/mynewt/src/spi.rs</a></figcaption></figure><p id="b180" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">We may call <code class="dm jg jh ji jj b"><a href="https://web.archive.org/web/20200121150820/https://mynewt.apache.org/latest/os/core_os/mbuf/mbuf.html#c.os_mbuf_append" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">os_mbuf_append</a></code> as often as we like to append data to our Mbuf Chain, which keeps growing and growing… (Unlike Heap Storage blocks which are fixed-size). <em class="gy">So cool!</em></p><p id="51e0" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Here’s how we walk the Mbuf Chain to transmit each block of SPI data in the chain, and deallocate the chain when we’re done…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/d6a48faaf4d6a1b2c156f0dbee537d04" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/rust/mynewt/src/spi.rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/rust/mynewt/src/spi.rs</a></figcaption></figure><p id="15ec" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Note that we don’t transmit the entire Mbuf Chain of SPI data in a single SPI operation… We transmit the SPI data one Mbuf at a time. This works fine for PineTime’s ST7789 Display Controller. And with limited RAM, it’s best not to make an extra copy of the entire Mbuf Chain before transmitting.</p></div></div></section><hr class="if fe ig ih ii ht ij ik il im in"/><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah ds aj ak"><h1 id="e4e5" class="io ip dv bk bj iq dx ir dz is it iu iv iw ix iy iz">Enqueue SPI Requests with Mbuf Queues in Mynewt OS</h1><p id="b733" class="gk gl dv bk gm b gn ja gp jb gr jc gt jd gv je gx">After [embedded-graphics] has completed its rendering, we get an Mbuf Chain that contains the SPI request that will be transmitted to the PineTime Display Controller by the background task. Now we need a way to enqueue the SPI requests (Mbuf Chains) produced by [embedded-graphics]…</p><figure class="hl hm hn ho hp cz cl cm paragraph-image"><div class="db dc dd de ak"><div class="cl cm kn"><div class="dl r dd dm"><div class="ko r"><div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/60/1*n5g0mKyghlDkaCNhcfu2yQ.png?q=20" width="3942" height="2230" role="presentation"/></div><img class="df dg cp t u dh ak dr" width="3942" height="2230" role="presentation"/><noscript><img class="cp t u dh ak" src="https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/7884/1*n5g0mKyghlDkaCNhcfu2yQ.png" width="3942" height="2230" role="presentation"/></noscript></div></div></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">Enqueuing SPI requests in an MBuf Queue before transmitting</figcaption></figure><p id="c367" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">When we use Mbuf Chains in Mynewt OS, <em class="gy">we get Mbuf Queues for free!</em></p><p id="80b7" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Check the function <code class="dm jg jh ji jj b">spi_event_callback</code> from the last code snippet… It’s actually calling <code class="dm jg jh ji jj b"><a href="https://web.archive.org/web/20200121150820/https://mynewt.apache.org/latest/os/core_os/mbuf/mbuf.html#c.os_mqueue_get" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">os_mqueue_get</a></code> to read SPI requests (Mbuf Chains) from an Mbuf Queue named <code class="dm jg jh ji jj b">SPI_DATA_QUEUE</code>.</p><p id="a9ea" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Adding an SPI request to an Mbuf Queue is done by calling <code class="dm jg jh ji jj b">os_mqueue_put</code> in Rust like this…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/63fbb1025dc8a2893a551b5df042b21d" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/rust/mynewt/src/spi.rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/rust/mynewt/src/spi.rs</a></figcaption></figure><p id="e602" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><code class="dm jg jh ji jj b">spi_noblock_write</code> is the complete Rust function we use in our PineTime firmware to 1️⃣ Allocate an Mbuf Chain 2️⃣ Append the SPI request to the Mbuf Chain 3️⃣ Add the Mbuf Chain to the Mbuf Queue. <em class="gy">Yep it’s that easy to use Mbuf Chains and Mbuf Queues in Mynewt OS!</em></p></div></div></section><hr class="if fe ig ih ii ht ij ik il im in"/><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah ds aj ak"><h1 id="8904" class="io ip dv bk bj iq dx ir dz is it iu iv iw ix iy iz">Transmit Enqueued SPI Requests with Mynewt Background Task</h1><p id="56b6" class="gk gl dv bk gm b gn ja gp jb gr jc gt jd gv je gx">Here comes the final part of our quick experiment… Create a background task in Mynewt to read the Mbuf Queue and transmit each SPI request to PineTime’s Display Controller…</p><figure class="hl hm hn ho hp cz cl cm paragraph-image"><div class="db dc dd de ak"><div class="cl cm kp"><div class="dl r dd dm"><div class="kq r"><div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/60/1*c7kIxO4BfkJo3hhSUloHPw.png?q=20" width="4755" height="2284" role="presentation"/></div><img class="df dg cp t u dh ak dr" width="4755" height="2284" role="presentation"/><noscript><img class="cp t u dh ak" src="https://web.archive.org/web/20200121150820im_/https://miro.medium.com/max/9510/1*c7kIxO4BfkJo3hhSUloHPw.png" width="4755" height="2284" role="presentation"/></noscript></div></div></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">Transmitting SPI Requests enqueued in an Mbuf Queue</figcaption></figure><p id="a326" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">With Rust and Mynewt OS, here’s how we create a background task <code class="dm jg jh ji jj b">SPI_TASK</code> that runs the neverending function <code class="dm jg jh ji jj b">spi_task_func</code>…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/3aa070c3a2d5e75ac8e6211d2b53a446" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/rust/mynewt/src/spi.rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/rust/mynewt/src/spi.rs</a></figcaption></figure><p id="17a5" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><em class="gy">(Note that we’re calling Mynewt to create background tasks instead of using </em><a href="https://web.archive.org/web/20200121150820/https://doc.rust-lang.org/book/ch16-01-threads.html" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow"><em class="gy">Rust multitasking</em></a><em class="gy">, because Mynewt controls all our tasks on PineTime)</em></p><p id="1c59" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><code class="dm jg jh ji jj b">spi_task_func</code> runs forever, blocking until there’s a request in the Mbuf Queue, and executes the request. The request is handled by the function <code class="dm jg jh ji jj b">spi_event_callback</code> that we have seen earlier. <em class="gy">(How does Mynewt know that it should invoke </em><code class="dm jg jh ji jj b">spi_event_callback</code><em class="gy">? It’s defined in the call to </em><code class="dm jg jh ji jj b"><a href="https://web.archive.org/web/20200121150820/https://mynewt.apache.org/latest/os/core_os/mbuf/mbuf.html#c.os_mqueue_init" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">os_mqueue_init</a></code><em class="gy"> above.)</em></p><p id="2e59" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><code class="dm jg jh ji jj b"><a href="https://web.archive.org/web/20200121150820/https://mynewt.apache.org/latest/os/modules/hal/hal_watchdog/hal_watchdog.html#c.hal_watchdog_tickle" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">hal_watchdog_tickle</a></code> <em class="gy">appears oddly in the code… What is that?</em></p><p id="7560" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Mynewt helpfully pings our background task every couple of milliseconds, to make sure that it’s not hung… That’s why it’s called a <a href="https://web.archive.org/web/20200121150820/https://mynewt.apache.org/latest/os/modules/hal/hal_watchdog/hal_watchdog.html" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow"><strong class="gm hz">Watchdog</strong></a>.</p><p id="3458" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">To prevent Mynewt from raising a Watchdog Exception, we need to tell the Watchdog every couple of milliseconds that we are OK… By calling <code class="dm jg jh ji jj b"><a href="https://web.archive.org/web/20200121150820/https://mynewt.apache.org/latest/os/modules/hal/hal_watchdog/hal_watchdog.html#c.hal_watchdog_tickle" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">hal_watchdog_tickle</a></code></p></div></div></section><hr class="if fe ig ih ii ht ij ik il im in"/><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah ds aj ak"><h1 id="40dd" class="io ip dv bk bj iq dx ir dz is it iu iv iw ix iy iz">Optimised PineTime Display Driver… Assemble!</h1><p id="9b7e" class="gk gl dv bk gm b gn ja gp jb gr jc gt jd gv je gx">This has been a lengthy but quick <em class="gy">(two-week)</em> experiment in optimising the display rendering for PineTime. Here’s how we put everything together…</p><p id="5e60" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">1️⃣ We have <strong class="gm hz">batched the rendering of pixels by rows and by blocks</strong>. This batching code has been added to the [<a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/piet-embedded/blob/master/piet-embedded-graphics/src/batch.rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">piet-embedded</a>] crate that calls [embedded-graphics] to render 2D graphics and text on our PineTime.</p><p id="fcca" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">2️⃣ <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/piet-embedded/blob/master/piet-embedded-graphics/src/display.rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">The code that demos the batching of pixels</a> is also in the [piet-embedded] crate. Batching is enabled when we enable the <code class="dm jg jh ji jj b">noblock_spi</code> feature in [piet-embedded]’s <code class="dm jg jh ji jj b"><a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/piet-embedded/blob/master/piet-embedded-graphics/Cargo.toml" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">Cargo.toml</a></code> like this…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/5cc17eec02ddaea3ca97600b66f1b191" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/piet-embedded/blob/master/piet-embedded-graphics/Cargo.toml" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/piet-embedded/blob/master/piet-embedded-graphics/Cargo.toml</a></figcaption></figure><p id="0788" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">3️⃣ <code class="dm jg jh ji jj b">noblock_spi</code> is referenced in the demo code like this…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/c76a278e26007e740629430566e5c88e" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/piet-embedded/blob/master/piet-embedded-graphics/src/display.rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/piet-embedded/blob/master/piet-embedded-graphics/src/display.rs</a></figcaption></figure><p id="dd93" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">4️⃣ We have implemented <strong class="gm hz">Non-Blocking SPI with Mbuf Chains and Mbuf Queues</strong> (plus a background task). The code is located in the [<a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/rust/mynewt/src/spi.rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">mynewt</a>] crate.</p><p id="b3e4" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">5️⃣ We have forked the original [st7735-lcd] display driver into [<a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/st7735-lcd-batch-rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">st7735-lcd-batch</a>] to test Non-Blocking SPI. Non-Blocking SPI is enabled when we enable the <code class="dm jg jh ji jj b">noblock_spi</code> feature in [st7735-lcd-batch]’s <code class="dm jg jh ji jj b"><a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/st7735-lcd-batch-rs/blob/master/Cargo.toml" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">Cargo.toml</a></code>…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/86790e0afa31f536b3d31c387bb5c6b1" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/st7735-lcd-batch-rs/blob/master/Cargo.toml" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/st7735-lcd-batch-rs/blob/master/Cargo.toml</a></figcaption></figure><p id="93b7" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">6️⃣ <code class="dm jg jh ji jj b">noblock_spi</code> is referenced by [st7735-lcd-batch] like this…</p><figure class="hl hm hn ho hp cz"><div class="dl r dd"><div class="jf r"><iframe src="https://web.archive.org/web/20200121150820if_/https://medium.com/media/4a3914b2d3c4657d9400ac0100710b57" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/optimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ff hr hs ht cn cl cm hu hv bj fe">From <a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/st7735-lcd-batch-rs/blob/master/src/lib.rs" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/st7735-lcd-batch-rs/blob/master/src/lib.rs</a></figcaption></figure><p id="f603" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><em class="gy">(Plus a few other spots in that file)</em></p><p id="2256" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">We have attempted to optimise the display driver for PineTime… <em class="gy">But it’s far from optimal!</em></p><p id="6e00" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">There are a few parameters that we may tweak to make PineTime render faster… Just be mindful that some of these tweaks will take up precious RAM…</p><p id="c2e2" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">1️⃣ <code class="dm jg jh ji jj b"><a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/piet-embedded/blob/master/piet-embedded-graphics/src/batch.rs#L26" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">MaxRowSize</a></code>: Maximum number of pixels per batched row. Currently set to 100.</p><p id="d305" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">2️⃣ <code class="dm jg jh ji jj b"><a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/piet-embedded/blob/master/piet-embedded-graphics/src/batch.rs#L28" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">MaxBlockSize</a></code>: Maximum number of pixels per batched block. Currently set to 200.</p><p id="447c" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">3️⃣ <code class="dm jg jh ji jj b"><a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/rust/mynewt/src/spi.rs#L109" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">SPI_THROTTLE_SEM</a></code>: How many SPI requests are allowed to be enqueued before blocking the rendering task. Currently set to 2.</p><p id="05bc" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">4️⃣ <code class="dm jg jh ji jj b"><a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/apps/my_sensor_app/syscfg.yml#L100" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">OS_MAIN_STACK_SIZE</a></code>: Stack Size for the main task. Currently set to 16 KB</p><p id="85d7" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">5️⃣ <code class="dm jg jh ji jj b"><a href="https://web.archive.org/web/20200121150820/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/pinetime/apps/my_sensor_app/syscfg.yml#L102" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">MSYS_1_BLOCK_COUNT</a></code>: Number of Mbuf blocks available. Currently set to 64.</p></div></div></section><hr class="if fe ig ih ii ht ij ik il im in"/><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah ds aj ak"><h1 id="bef2" class="io ip dv bk bj iq dx ir dz is it iu iv iw ix iy iz">What’s Next?</h1><p id="1d10" class="gk gl dv bk gm b gn ja gp jb gr jc gt jd gv je gx"><a href="https://web.archive.org/web/20200121150820/https://store.pine64.org/?product=pinetime-dev-kit" class="at cg gz ha hb hc" target="_blank" rel="noopener nofollow">PineTime is available for purchase by general public</a>! Check this article for updated instructions to build and flash PineTime firmware…</p><div class="kr ks kt ku kv kw"><a rel="noopener" href="/web/20200121150820/https://medium.com/@ly.lee/build-and-flash-rust-mynewt-firmware-for-pinetime-smart-watch-5e14259c55"><div class="kz n ar"><div class="la n co p lb lc"><h2 class="bj iq ld bl dv"><div class="di kx fh fi ky fk">Build and Flash Rust+Mynewt Firmware for PineTime Smart Watch</div></h2><div class="le r"><h3 class="bj fe ff bl bo"><div class="di kx fh fi ky fk">All you need is a Raspberry Pi and a Windows or macOS computer!</div></h3></div><div class="lf r"><h4 class="bj fe fz bl bo"><div class="di kx fh fi ky fk">medium.com</div></h4></div></div><div class="lg r"><div class="lh r li lj lk lg ll lm ln"></div></div></div></a></div><p id="ac85" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">In the next article we’ll have…</p><p id="858c" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">1️⃣ The <strong class="gm hz">prebuilt Rust + Mynewt OS firmware</strong> that we may download and install on PineTime</p><p id="dfea" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">2️⃣ <strong class="gm hz">Instructions for flashing the firmware</strong> to PineTime with Raspberry Pi (or ST Link)</p><p id="6a1a" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">3️⃣ <strong class="gm hz">Instructions for developing our own Watch Apps</strong> with the <a class="at cg gz ha hb hc" target="_blank" rel="noopener" href="/web/20200121150820/https://medium.com/@ly.lee/porting-druid-rust-widgets-to-pinetime-smart-watch-7e1d5a5d977a?source=friends_link&amp;sk=09b153c68483f7fa9e63350efd167b07">druid Rust UI Framework</a></p><p id="3927" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx">Stay tuned!</p><p id="023f" class="gk gl dv bk gm b gn go gp gq gr gs gt gu gv gw gx"><em class="gy">Here are the other articles in the PineTime series…</em></p><div class="kr ks kt ku kv kw"><a rel="noopener" href="/web/20200121150820/https://medium.com/swlh/sneak-peek-of-pinetime-smart-watch-and-why-its-perfect-for-teaching-iot-81b74161c159"><div class="kz n ar"><div class="la n co p lb lc"><h2 class="bj iq ld bl dv"><div class="di kx fh fi ky fk">Sneak Peek of PineTime Smart Watch… And why it’s perfect for teaching IoT</div></h2><div class="le r"><h3 class="bj fe ff bl bo"><div class="di kx fh fi ky fk">I’m one of the lucky few who received the developer preview version of the PineTime Smart Watch by Pine64. (My official…</div></h3></div><div class="lf r"><h4 class="bj fe fz bl bo"><div class="di kx fh fi ky fk">medium.com</div></h4></div></div><div class="lg r"><div class="lo r li lj lk lg ll lm ln"></div></div></div></a></div><div class="kr ks kt ku kv kw"><a rel="noopener" href="/web/20200121150820/https://medium.com/@ly.lee/building-a-rust-driver-for-pinetimes-touch-controller-cbc1a5d5d3e9"><div class="kz n ar"><div class="la n co p lb lc"><h2 class="bj iq ld bl dv"><div class="di kx fh fi ky fk">Building a Rust Driver for PineTime’s Touch Controller</div></h2><div class="le r"><h3 class="bj fe ff bl bo"><div class="di kx fh fi ky fk">Pretend you’re my IoT student. I give you a PineTime Smart Watch and challenge you to “Make it work… Especially the…</div></h3></div><div class="lf r"><h4 class="bj fe fz bl bo"><div class="di kx fh fi ky fk">medium.com</div></h4></div></div><div class="lg r"><div class="lp r li lj lk lg ll lm ln"></div></div></div></a></div><div class="kr ks kt ku kv kw"><a rel="noopener" href="/web/20200121150820/https://medium.com/@ly.lee/porting-druid-rust-widgets-to-pinetime-smart-watch-7e1d5a5d977a"><div class="kz n ar"><div class="la n co p lb lc"><h2 class="bj iq ld bl dv"><div class="di kx fh fi ky fk">Porting [druid] Rust Widgets to PineTime Smart Watch</div></h2><div class="le r"><h3 class="bj fe ff bl bo"><div class="di kx fh fi ky fk">A button that responds to our tapping and increments a counter… That’s what we shall accomplish today on the PineTime…</div></h3></div><div class="lf r"><h4 class="bj fe fz bl bo"><div class="di kx fh fi ky fk">medium.com</div></h4></div></div><div class="lg r"><div class="lq r li lj lk lg ll lm ln"></div></div></div></a></div><div class="kr ks kt ku kv kw"><a rel="noopener" href="/web/20200121150820/https://medium.com/@ly.lee/build-and-flash-rust-mynewt-firmware-for-pinetime-smart-watch-5e14259c55"><div class="kz n ar"><div class="la n co p lb lc"><h2 class="bj iq ld bl dv"><div class="di kx fh fi ky fk">Build and Flash Rust+Mynewt Firmware for PineTime Smart Watch</div></h2><div class="le r"><h3 class="bj fe ff bl bo"><div class="di kx fh fi ky fk">All you need is a Raspberry Pi and a Windows or macOS computer!</div></h3></div><div class="lf r"><h4 class="bj fe fz bl bo"><div class="di kx fh fi ky fk">medium.com</div></h4></div></div><div class="lg r"><div class="lh r li lj lk lg ll lm ln"></div></div></div></a></div></div></div></section></div></article><div class="df ct lr s ak lx lv ly" data-test-id="post-sidebar"><div class="n p"><div class="ac ae af ag ah ai aj ak"><div class="lz n co"><div class="ct"><div class="ma mb mc n"><div class="n o"><div class="md r dd"><a href="https://web.archive.org/web/20200121150820/https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c&amp;source=post_sidebar-----3ba269ea2f5c---------------------clap_sidebar-" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener"><div class="ba me mf mg mh mi mj mk ml mm mn"><svg width="29" height="29"><g fill-rule="evenodd"><path d="M13.74 1l.76 2.97.76-2.97zM16.82 4.78l1.84-2.56-1.43-.47zM10.38 2.22l1.84 2.56-.41-3.03zM22.38 22.62a5.11 5.11 0 0 1-3.16 1.61l.49-.45c2.88-2.89 3.45-5.98 1.69-9.21l-1.1-1.94-.96-2.02c-.31-.67-.23-1.18.25-1.55a.84.84 0 0 1 .66-.16c.34.05.66.28.88.6l2.85 5.02c1.18 1.97 1.38 5.12-1.6 8.1M9.1 22.1l-5.02-5.02a1 1 0 0 1 .7-1.7 1 1 0 0 1 .72.3l2.6 2.6a.44.44 0 0 0 .63-.62L6.1 15.04l-1.75-1.75a1 1 0 1 1 1.41-1.41l4.15 4.15a.44.44 0 0 0 .63 0 .44.44 0 0 0 0-.62L6.4 11.26l-1.18-1.18a1 1 0 0 1 0-1.4 1.02 1.02 0 0 1 1.41 0l1.18 1.16L11.96 14a.44.44 0 0 0 .62 0 .44.44 0 0 0 0-.63L8.43 9.22a.99.99 0 0 1-.3-.7.99.99 0 0 1 .3-.7 1 1 0 0 1 1.41 0l7 6.98a.44.44 0 0 0 .7-.5l-1.35-2.85c-.31-.68-.23-1.19.25-1.56a.85.85 0 0 1 .66-.16c.34.06.66.28.88.6L20.63 15c1.57 2.88 1.07 5.54-1.55 8.16a5.62 5.62 0 0 1-5.06 1.65 9.35 9.35 0 0 1-4.93-2.72zM13 6.98l2.56 2.56c-.5.6-.56 1.41-.15 2.28l.26.56-4.25-4.25a.98.98 0 0 1-.12-.45 1 1 0 0 1 .29-.7 1.02 1.02 0 0 1 1.41 0zm8.89 2.06c-.38-.56-.9-.92-1.49-1.01a1.74 1.74 0 0 0-1.34.33c-.38.29-.61.65-.71 1.06a2.1 2.1 0 0 0-1.1-.56 1.78 1.78 0 0 0-.99.13l-2.64-2.64a1.88 1.88 0 0 0-2.65 0 1.86 1.86 0 0 0-.48.85 1.89 1.89 0 0 0-2.67-.01 1.87 1.87 0 0 0-.5.9c-.76-.75-2-.75-2.7-.04a1.88 1.88 0 0 0 0 2.66c-.3.12-.61.29-.87.55a1.88 1.88 0 0 0 0 2.66l.62.62a1.88 1.88 0 0 0-.9 3.16l5.01 5.02c1.6 1.6 3.52 2.64 5.4 2.96a7.16 7.16 0 0 0 1.18.1c1.03 0 2-.25 2.9-.7A5.9 5.9 0 0 0 23 23.24c3.34-3.34 3.08-6.93 1.74-9.17l-2.87-5.04z"></path></g></svg></div></a></div><div class="mo r"><div class="mp"><h4 class="bj fe ff bl bo"><button class="at au av aw ax ay az ba bb bc bd be bf bg bh bi">20 </button></h4></div></div></div></div><a href="https://web.archive.org/web/20200121150820/https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c&amp;source=post_sidebar--------------------------bookmark_sidebar-" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener"><svg width="25" height="25" viewbox="0 0 25 25"><path d="M19 6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14.66h.01c.01.1.05.2.12.28a.5.5 0 0 0 .7.03l5.67-4.12 5.66 4.13a.5.5 0 0 0 .71-.03.5.5 0 0 0 .12-.29H19V6zm-6.84 9.97L7 19.64V6a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v13.64l-5.16-3.67a.49.49 0 0 0-.68 0z" fill-rule="evenodd"></path></svg></a></div></div></div></div></div><div class="df ct lr s ls ey lt lu lv lw"></div><div><div class="mq cz n co p"><div class="n p"><div class="ac ae af ag ah ds aj ak"><div class="n mr"></div><div class="n o mr"></div><div class="ms r"><ul class="ba bb"><li class="cf mt mu mv"><a href="/web/20200121150820/https://medium.com/tag/rust" class="mw mx cg bo r my mz a b fz">Rust</a></li><li class="cf mt mu mv"><a href="/web/20200121150820/https://medium.com/tag/programming" class="mw mx cg bo r my mz a b fz">Programming</a></li><li class="cf mt mu mv"><a href="/web/20200121150820/https://medium.com/tag/gadgets" class="mw mx cg bo r my mz a b fz">Gadgets</a></li><li class="cf mt mu mv"><a href="/web/20200121150820/https://medium.com/tag/internet-of-things" class="mw mx cg bo r my mz a b fz">Internet of Things</a></li><li class="cf mt mu mv"><a href="/web/20200121150820/https://medium.com/tag/embedded-systems" class="mw mx cg bo r my mz a b fz">Embedded Systems</a></li></ul></div><div class="na n eo ab"><div class="n o"><div class="nb r dd"><a href="https://web.archive.org/web/20200121150820/https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c&amp;source=post_actions_footer-----3ba269ea2f5c---------------------clap_footer-" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener"><div class="c nc fa n o nd dd ne nf ng nh ni nj nk nl nm nn no np nq nr"><div class="ba me mf mg mh mi ns mk o dr fa n p nt u dh cp t ak ml mm mn nu"><svg width="33" height="33" viewbox="0 0 33 33"><path d="M28.86 17.34l-3.64-6.4c-.3-.43-.71-.73-1.16-.8a1.12 1.12 0 0 0-.9.21c-.62.5-.73 1.18-.32 2.06l1.22 2.6 1.4 2.45c2.23 4.09 1.51 8-2.15 11.66a9.6 9.6 0 0 1-.8.71 6.53 6.53 0 0 0 4.3-2.1c3.82-3.82 3.57-7.87 2.05-10.39zm-6.25 11.08c3.35-3.35 4-6.78 1.98-10.47L21.2 12c-.3-.43-.71-.72-1.16-.8a1.12 1.12 0 0 0-.9.22c-.62.49-.74 1.18-.32 2.06l1.72 3.63a.5.5 0 0 1-.81.57l-8.91-8.9a1.33 1.33 0 0 0-1.89 1.88l5.3 5.3a.5.5 0 0 1-.71.7l-5.3-5.3-1.49-1.49c-.5-.5-1.38-.5-1.88 0a1.34 1.34 0 0 0 0 1.89l1.49 1.5 5.3 5.28a.5.5 0 0 1-.36.86.5.5 0 0 1-.36-.15l-5.29-5.29a1.34 1.34 0 0 0-1.88 0 1.34 1.34 0 0 0 0 1.89l2.23 2.23L9.3 21.4a.5.5 0 0 1-.36.85.5.5 0 0 1-.35-.14l-3.32-3.33a1.33 1.33 0 0 0-1.89 0 1.32 1.32 0 0 0-.39.95c0 .35.14.69.4.94l6.39 6.4c3.53 3.53 8.86 5.3 12.82 1.35zM12.73 9.26l5.68 5.68-.49-1.04c-.52-1.1-.43-2.13.22-2.89l-3.3-3.3a1.34 1.34 0 0 0-1.88 0 1.33 1.33 0 0 0-.4.94c0 .22.07.42.17.61zm14.79 19.18a7.46 7.46 0 0 1-6.41 2.31 7.92 7.92 0 0 1-3.67.9c-3.05 0-6.12-1.63-8.36-3.88l-6.4-6.4A2.31 2.31 0 0 1 2 19.72a2.33 2.33 0 0 1 1.92-2.3l-.87-.87a2.34 2.34 0 0 1 0-3.3 2.33 2.33 0 0 1 1.24-.64l-.14-.14a2.34 2.34 0 0 1 0-3.3 2.39 2.39 0 0 1 3.3 0l.14.14a2.33 2.33 0 0 1 3.95-1.24l.09.09c.09-.42.29-.83.62-1.16a2.34 2.34 0 0 1 3.3 0l3.38 3.39a2.17 2.17 0 0 1 1.27-.17c.54.08 1.03.35 1.45.76.1-.55.41-1.03.9-1.42a2.12 2.12 0 0 1 1.67-.4 2.8 2.8 0 0 1 1.85 1.25l3.65 6.43c1.7 2.83 2.03 7.37-2.2 11.6zM13.22.48l-1.92.89 2.37 2.83-.45-3.72zm8.48.88L19.78.5l-.44 3.7 2.36-2.84zM16.5 3.3L15.48 0h2.04L16.5 3.3z" fill-rule="evenodd"></path></svg></div></div></a></div><div class="mo r"><div class="mp"><h4 class="bj fe ff bl dv"><button class="at au av aw ax ay az ba bb bc bd be bf bg bh bi">20 claps</button></h4></div></div></div><div class="n o"><div class="gi r ar"><a href="//web.archive.org/web/20200121150820/https://medium.com/p/3ba269ea2f5c/share/twitter?source=post_actions_footer---------------------------" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" target="_blank" rel="noopener nofollow"><svg width="29" height="29" class="q"><path d="M22.05 7.54a4.47 4.47 0 0 0-3.3-1.46 4.53 4.53 0 0 0-4.53 4.53c0 .35.04.7.08 1.05A12.9 12.9 0 0 1 5 6.89a5.1 5.1 0 0 0-.65 2.26c.03 1.6.83 2.99 2.02 3.79a4.3 4.3 0 0 1-2.02-.57v.08a4.55 4.55 0 0 0 3.63 4.44c-.4.08-.8.13-1.21.16l-.81-.08a4.54 4.54 0 0 0 4.2 3.15 9.56 9.56 0 0 1-5.66 1.94l-1.05-.08c2 1.27 4.38 2.02 6.94 2.02 8.3 0 12.86-6.9 12.84-12.85.02-.24 0-.43 0-.65a8.68 8.68 0 0 0 2.26-2.34c-.82.38-1.7.62-2.6.72a4.37 4.37 0 0 0 1.95-2.51c-.84.53-1.81.9-2.83 1.13z"></path></svg></a></div><div class="gi r ar"><a href="//web.archive.org/web/20200121150820/https://medium.com/p/3ba269ea2f5c/share/facebook?source=post_actions_footer---------------------------" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" target="_blank" rel="noopener nofollow"><svg width="29" height="29" class="q"><path d="M23.2 5H5.8a.8.8 0 0 0-.8.8V23.2c0 .44.35.8.8.8h9.3v-7.13h-2.38V13.9h2.38v-2.38c0-2.45 1.55-3.66 3.74-3.66 1.05 0 1.95.08 2.2.11v2.57h-1.5c-1.2 0-1.48.57-1.48 1.4v1.96h2.97l-.6 2.97h-2.37l.05 7.12h5.1a.8.8 0 0 0 .79-.8V5.8a.8.8 0 0 0-.8-.79"></path></svg></a></div><div class="gi r ar"><a href="https://web.archive.org/web/20200121150820/https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c&amp;source=post_actions_footer--------------------------bookmark_sidebar-" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener"><svg width="25" height="25" viewbox="0 0 25 25"><path d="M19 6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14.66h.01c.01.1.05.2.12.28a.5.5 0 0 0 .7.03l5.67-4.12 5.66 4.13a.5.5 0 0 0 .71-.03.5.5 0 0 0 .12-.29H19V6zm-6.84 9.97L7 19.64V6a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v13.64l-5.16-3.67a.49.49 0 0 0-.68 0z" fill-rule="evenodd"></path></svg></a></div><div class="cf" aria-hidden="true"><div class="r ar"><button class="at au av aw ax ay az ba bb bc bd be bf bg bh bi"><svg width="25" height="25" viewbox="-480.5 272.5 21 21" class="q"><path d="M-463 284.6c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5zm-7-.9c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5zm-7-.9c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5z"></path></svg></button></div></div></div></div><div class="nv nw nx ms r ab"><div class="ny nz r dd"><span class="r oa an ob"><div class="r cp oc od"><a rel="noopener" href="/web/20200121150820/https://medium.com/@ly.lee?source=follow_footer--------------------------follow_footer-"><div class="dd oe of"><div class="bs n eu o p cp ev ew ex ey ez ct"><svg width="91" height="91" viewbox="0 0 91 91"><path fill-rule="evenodd" clip-rule="evenodd" d="M45.5 1.4c-17.14 0-32 9.95-39.25 24.5L5 25.28C12.47 10.28 27.8 0 45.5 0S78.53 10.29 86 25.28l-1.25.62C77.5 11.35 62.65 1.4 45.5 1.4zM6.25 65.1c7.25 14.55 22.1 24.5 39.25 24.5 17.14 0 32-9.95 39.25-24.5l1.25.62C78.53 80.72 63.2 91 45.5 91S12.47 80.71 5 65.72l1.25-.62z"></path></svg></div><img alt="Lup Yuen Lee 李立源" class="r fa of oe" src="https://web.archive.org/web/20200121150820im_/https://miro.medium.com/fit/c/160/160/1*KGohS3sQaUnr58gc0BIfoQ.jpeg" width="80" height="80"/></div></a></div><span class="r"><div class="og r oh"><p class="bj fe fz bl bo oi oj">Written by</p></div><div class="og ok n oh"><div class="ak n o eo"><h2 class="bj iq ig ol dv"><a class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener" href="/web/20200121150820/https://medium.com/@ly.lee?source=follow_footer--------------------------follow_footer-">Lup Yuen Lee 李立源</a></h2><div class="r g"><button class="om dv q by fo fp fq fr bc bh fs ft fu fv fw fx cb bj b bk bl bm bn cc cd ce cf cg bf">Follow</button></div></div></div></span></span><div class="og on r oh aq"><div class="oo r"><h4 class="bj fe ld op bo">Techie and Educator in IoT 物聯網教師</h4></div><div class="ap oq aq"><button class="om dv q by fo fp fq fr bc bh fs ft fu fv fw fx cb bj b bk bl bm bn cc cd ce cf cg bf">Follow</button></div></div></div></div><div class="or nw r ab"><a href="https://web.archive.org/web/20200121150820/https://medium.com/p/3ba269ea2f5c/responses/show?source=follow_footer--------------------------follow_footer-" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener"><span class="os ot mh"><div class="ou ov cb r ht g"><span class="br">Write the first response</span></div></span></a></div></div></div><div class="ow r ox ab"><div class="n p"><div class="ac ae af ag ah ai aj ak"></div></div></div></div></div><div class="oy r oz pa"><section class="cl cm ak ce r pb pc pd pe pf pg ph pi pj pk pl pm pn po pp"><div class="pq pr ny n eo g"><div class="ps n eo"><div class="pt r pu"><div class="pv r"><a href="https://web.archive.org/web/20200121150820/https://medium.com/about?autoplay=1&amp;source=post_page-----3ba269ea2f5c----------------------" class="at au av aw ax ay az ba bb bc pw px bf bg py pz" rel="noopener"><h4 class="qa qb qc bj iq bk op qd qe r">Discover <!-- -->Medium</h4></a></div><span class="bj b bk bl bm bn r qf qg">Welcome to a place where words matter. On <!-- -->Medium<!-- -->, smart voices and original ideas take center stage - with no ads in sight.<!-- --> <a href="https://web.archive.org/web/20200121150820/https://medium.com/about?autoplay=1&amp;source=post_page-----3ba269ea2f5c----------------------" class="at au av aw ax ay az ba bb bc bf bg py pz qh" rel="noopener">Watch</a></span></div><div class="pt r pu"><div class="qi r"><a href="https://web.archive.org/web/20200121150820/https://medium.com/topics?source=post_page-----3ba269ea2f5c----------------------" class="at au av aw ax ay az ba bb bc pw px bf bg py pz" rel="noopener"><h4 class="qa qb qc bj iq bk op qd qe r">Make <!-- -->Medium<!-- --> yours</h4></a></div><span class="bj b bk bl bm bn r qf qg">Follow all the topics you care about, and we’ll deliver the best stories for you to your homepage and inbox.<!-- --> <a href="https://web.archive.org/web/20200121150820/https://medium.com/topics?source=post_page-----3ba269ea2f5c----------------------" class="at au av aw ax ay az ba bb bc bf bg py pz qh" rel="noopener">Explore</a></span></div><div class="pt r pu"><div class="pv r"><a href="https://web.archive.org/web/20200121150820/https://medium.com/membership?source=post_page-----3ba269ea2f5c----------------------" class="at au av aw ax ay az ba bb bc pw px bf bg py pz" rel="noopener"><h4 class="qa qb qc bj iq bk op qd qe r">Become a member</h4></a></div><span class="bj b bk bl bm bn r qf qg">Get unlimited access to the best stories on <!-- -->Medium<!-- --> — and support writers while you’re at it. Just $5/month.<!-- --> <a href="https://web.archive.org/web/20200121150820/https://medium.com/membership?source=post_page-----3ba269ea2f5c----------------------" class="at au av aw ax ay az ba bb bc bf bg py pz qh" rel="noopener">Upgrade</a></span></div></div></div><div class="n o eo"><a href="https://web.archive.org/web/20200121150820/https://medium.com/?source=post_page-----3ba269ea2f5c----------------------" class="at au av aw ax ay az ba bb bc pw px bf bg py pz" rel="noopener"><svg height="22" width="112" viewbox="0 0 111.5 22" class="qb"><path d="M56.3 19.5c0 .4 0 .5.3.7l1.5 1.4v.1h-6.5V19c-.7 1.8-2.4 3-4.3 3-3.3 0-5.8-2.6-5.8-7.5 0-4.5 2.6-7.6 6.3-7.6 1.6-.1 3.1.8 3.8 2.4V3.2c0-.3-.1-.6-.3-.7l-1.4-1.4V1l6.5-.8v19.3zm-4.8-.8V9.5c-.5-.6-1.2-.9-1.9-.9-1.6 0-3.1 1.4-3.1 5.7 0 4 1.3 5.4 3 5.4.8.1 1.6-.3 2-1zm9.1 3.1V9.4c0-.3-.1-.6-.3-.7l-1.4-1.5v-.1h6.5v12.5c0 .4 0 .5.3.7l1.4 1.4v.1h-6.5zm-.2-19.2C60.4 1.2 61.5 0 63 0c1.4 0 2.6 1.2 2.6 2.6S64.4 5.3 63 5.3a2.6 2.6 0 0 1-2.6-2.7zm22.5 16.9c0 .4 0 .5.3.7l1.5 1.4v.1h-6.5v-3.2c-.6 2-2.4 3.4-4.5 3.4-2.9 0-4.4-2.1-4.4-6.2 0-1.9 0-4.1.1-6.5 0-.3-.1-.5-.3-.7L67.7 7v.1H74v8c0 2.6.4 4.4 2 4.4.9-.1 1.7-.6 2.1-1.3V9.5c0-.3-.1-.6-.3-.7l-1.4-1.5v-.2h6.5v12.4zm22 2.3c0-.5.1-6.5.1-7.9 0-2.6-.4-4.5-2.2-4.5-.9 0-1.8.5-2.3 1.3.2.8.3 1.7.3 2.5 0 1.8-.1 4.2-.1 6.5 0 .3.1.5.3.7l1.5 1.4v.1H96c0-.4.1-6.5.1-7.9 0-2.7-.4-4.5-2.2-4.5-.9 0-1.7.5-2.2 1.3v9c0 .4 0 .5.3.7l1.4 1.4v.1h-6.5V9.5c0-.3-.1-.6-.3-.7l-1.4-1.5v-.2h6.5v3.1a4.6 4.6 0 0 1 4.6-3.4c2.2 0 3.6 1.2 4.2 3.5.7-2.1 2.7-3.6 4.9-3.5 2.9 0 4.5 2.2 4.5 6.2 0 1.9-.1 4.2-.1 6.5-.1.3.1.6.3.7l1.4 1.4v.1h-6.6zm-81.4-2l1.9 1.9v.1h-9.8v-.1l2-1.9c.2-.2.3-.4.3-.7V7.3c0-.5 0-1.2.1-1.8L11.4 22h-.1L4.5 6.8c-.1-.4-.2-.4-.3-.6v10c-.1.7 0 1.3.3 1.9l2.7 3.6v.1H0v-.1L2.7 18c.3-.6.4-1.3.3-1.9v-11c0-.5-.1-1.1-.5-1.5L.7 1.1V1h7l5.8 12.9L18.6 1h6.8v.1l-1.9 2.2c-.2.2-.3.5-.3.7v15.2c0 .2.1.5.3.6zm7.6-5.9c0 3.8 1.9 5.3 4.2 5.3 1.9.1 3.6-1 4.4-2.7h.1c-.8 3.7-3.1 5.5-6.5 5.5-3.7 0-7.2-2.2-7.2-7.4 0-5.5 3.5-7.6 7.3-7.6 3.1 0 6.4 1.5 6.4 6.2v.8h-8.7zm0-.8h4.3v-.8c0-3.9-.8-4.9-2-4.9-1.4.1-2.3 1.6-2.3 5.7z"></path></svg></a><span class="bj b bk bl bm bn r qf qg"><div class="qj qk n eo ql an"><a href="https://web.archive.org/web/20200121150820/https://medium.com/about?autoplay=1&amp;source=post_page-----3ba269ea2f5c----------------------" class="at au av aw ax ay az ba bb bc fl bf bg py pz" rel="noopener">About</a><a href="https://web.archive.org/web/20200121150820/https://help.medium.com/?source=post_page-----3ba269ea2f5c----------------------" class="at au av aw ax ay az ba bb bc fl bf bg py pz" rel="noopener">Help</a><a class="at au av aw ax ay az ba bb bc fl bf bg py pz" rel="noopener" href="/web/20200121150820/https://medium.com/policy/9db0094a1e0f?source=post_page-----3ba269ea2f5c----------------------">Legal</a></div></span></div></section></div></div></div><script src="https://web.archive.org/web/20200121150820js_/https://cdn.optimizely.com/js/16180790160.js"></script><script>window.__BUILD_ID__ = "development"</script><script>window.__GRAPHQL_URI__ = "https://web.archive.org/web/20200121150820/https://medium.com/_/graphql"</script><script>window.__PRELOADED_STATE__ = {"config":{"nodeEnv":"production","version":"master-20200117-211658-2a0663290f","productName":"Medium","publicUrl":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fcdn-client.medium.com\u002Flite","authDomain":"medium.com","authGoogleClientId":"216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com","favicon":"production","glyphUrl":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fglyph.medium.com","branchKey":"key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm","lightStep":{"name":"lite-web","host":"collector-medium.lightstep.com","token":"ce5be895bef60919541332990ac9fef2","appVersion":"master-20200117-211658-2a0663290f"},"algolia":{"appId":"MQ57UUUQZ2","apiKeySearch":"394474ced050e3911ae2249ecc774921","indexPrefix":"medium_","host":"-dsn.algolia.net"},"recaptchaKey":"6Lfc37IUAAAAAKGGtC6rLS13R1Hrw_BqADfS1LRk","sentry":{"dsn":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002F589e367c28ca47b195ce200d1507d18b@sentry.io\u002F1423575","environment":"production"},"isAmp":false,"googleAnalyticsCode":"UA-24232453-2","signInWallCustomDomainCollectionIds":["3a8144eabfe3","336d898217ee","61061eb0c96b","138adf9c44c","819cc2aaeee0"],"mediumOwnedAndOperatedCollectionIds":["544c7006046e","bcc38c8f6edf","444d13b52878","8d6b8a439e32","92d2092dc598","1285ba81cada","cb8577c9149e","8ccfed20cbb2","ae2a65f35510","3f6ecf56618","7b6769f2748b","fc8964313712","ef8e90590e66","191186aaafa0","d944778ce714","bdc4052bbdba","88d9857e584e"],"tierOneDomains":["medium.com","thebolditalic.com","arcdigital.media","towardsdatascience.com","uxdesign.cc","codeburst.io","psiloveyou.xyz","writingcooperative.com","entrepreneurshandbook.co","prototypr.io","betterhumans.coach.me","theascent.pub"],"defaultImages":{"avatar":{"imageId":"1*dmbNkD5D-u45r44go_cf0g.png","height":150,"width":150},"orgLogo":{"imageId":"1*OMF3fSqH8t4xBJ9-6oZDZw.png","height":106,"width":545},"postLogo":{"imageId":"1*3sela1OADrJr7dJk_CXaEQ.png","height":810,"width":1440}},"performanceTags":[]},"debug":{"requestId":"1e4bfb49-eb6f-43c4-ae6b-eaa68696626d","originalSpanCarrier":{"ot-tracer-spanid":"718bde50327df5b6","ot-tracer-traceid":"58e561d102ca24a0","ot-tracer-sampled":"true"}},"session":{"user":{"id":"lo_KU5LNfSKCYGC"},"xsrf":""},"stats":{"itemCount":0,"sending":false,"timeout":null,"backup":{}},"navigation":{"showBranchBanner":null,"hasRenderedBranchBanner":null,"hideGoogleOneTap":false,"branchData":{"loaded":false},"currentLocation":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","host":"medium.com","hostname":"medium.com","susiModal":{"step":null,"operation":"register","reportEventInfo":{"eventName":"","data":{}}}},"client":{"isBot":false,"isEu":false,"isNativeMedium":false,"isCustomDomain":false},"multiVote":{"clapsPerPost":{}},"metadata":{"faviconImageId":null}}</script><script>window.__APOLLO_STATE__ = {"ROOT_QUERY.variantFlags.0":{"name":"add_friction_to_signup","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.0.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.0.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.1":{"name":"allow_access","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.1.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.1.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.2":{"name":"allow_signup","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.2.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.2.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.3":{"name":"allow_test_auth","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.3.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.3.valueType":{"__typename":"VariantFlagString","value":"disallow"},"ROOT_QUERY.variantFlags.4":{"name":"assign_default_topic_to_posts","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.4.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.4.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.5":{"name":"available_annual_plan","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.5.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.5.valueType":{"__typename":"VariantFlagString","value":"2c754bcc2995"},"ROOT_QUERY.variantFlags.6":{"name":"available_monthly_plan","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.6.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.6.valueType":{"__typename":"VariantFlagString","value":"60e220181034"},"ROOT_QUERY.variantFlags.7":{"name":"branch_seo_metadata","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.7.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.7.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.8":{"name":"browsable_stream_config_bucket","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.8.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.8.valueType":{"__typename":"VariantFlagString","value":"curated-topics"},"ROOT_QUERY.variantFlags.9":{"name":"disable_gosocial_followers_that_you_follow","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.9.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.9.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.10":{"name":"disable_ios_resume_reading_toast","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.10.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.10.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.11":{"name":"disable_mobile_featured_chunk","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.11.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.11.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.12":{"name":"disable_post_recommended_from_friends_provider","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.12.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.12.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.13":{"name":"enable_android_local_currency","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.13.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.13.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.14":{"name":"enable_annual_renewal_reminder_email","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.14.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.14.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.15":{"name":"enable_app_flirty_thirty","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.15.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.15.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.16":{"name":"enable_auto_tier","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.16.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.16.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.17":{"name":"enable_automated_mission_control_triggers","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.17.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.17.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.18":{"name":"enable_branch_io","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.18.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.18.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.19":{"name":"enable_branding","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.19.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.19.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.20":{"name":"enable_branding_fonts","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.20.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.20.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.21":{"name":"enable_dedicated_series_tab_api_ios","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.21.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.21.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.22":{"name":"enable_different_grid","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.22.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.22.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.23":{"name":"enable_disregard_trunc_state_for_footer","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.23.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.23.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.24":{"name":"enable_edit_alt_text","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.24.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.24.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.25":{"name":"enable_email_sign_in_captcha","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.25.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.25.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.26":{"name":"enable_embedding_based_diversification","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.26.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.26.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.27":{"name":"enable_expanded_feature_chunk_pool","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.27.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.27.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.28":{"name":"enable_filter_by_resend_rules","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.28.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.28.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.29":{"name":"enable_first_name_on_paywall","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.29.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.29.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.30":{"name":"enable_geolocation_stripe_standard","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.30.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.30.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.31":{"name":"enable_google_one_tap","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.31.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.31.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.32":{"name":"enable_ios_post_stats","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.32.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.32.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.33":{"name":"enable_janky_spam_rules","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.33.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.33.valueType":{"__typename":"VariantFlagString","value":"users,posts"},"ROOT_QUERY.variantFlags.34":{"name":"enable_json_logs_trained_ranker","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.34.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.34.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.35":{"name":"enable_kafka_events","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.35.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.35.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.36":{"name":"enable_kbfd_rex","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.36.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.36.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.37":{"name":"enable_kbfd_rex_app_highlights","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.37.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.37.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.38":{"name":"enable_kbfd_rex_daily_digest","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.38.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.38.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.39":{"name":"enable_lite_membership_page","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.39.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.39.valueType":{"__typename":"VariantFlagString","value":"new-content"},"ROOT_QUERY.variantFlags.40":{"name":"enable_lite_notifications","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.40.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.40.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.41":{"name":"enable_lite_post","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.41.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.41.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.42":{"name":"enable_lite_post_cd","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.42.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.42.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.43":{"name":"enable_lite_post_highlights","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.43.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.43.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.44":{"name":"enable_lite_post_highlights_view_only","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.44.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.44.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.45":{"name":"enable_lite_profile","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.45.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.45.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.46":{"name":"enable_lite_pub_header_menu","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.46.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.46.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.47":{"name":"enable_lite_server_upstream_deadlines","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.47.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.47.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.48":{"name":"enable_lite_stories","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.48.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.48.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.49":{"name":"enable_lite_topics","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.49.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.49.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.50":{"name":"enable_lite_unread_notification_count_mutation","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.50.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.50.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.51":{"name":"enable_lo_scroll_away_metabar","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.51.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.51.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.52":{"name":"enable_logged_out_homepage_signup","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.52.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.52.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.53":{"name":"enable_marketing_emails","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.53.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.53.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.54":{"name":"enable_media_resource_try_catch","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.54.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.54.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.55":{"name":"enable_membership_remove_section_a","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.55.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.55.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.56":{"name":"enable_membership_thank_you_email","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.56.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.56.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.57":{"name":"enable_more_branch_data","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.57.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.57.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.58":{"name":"enable_new_collaborative_filtering_data","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.58.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.58.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.59":{"name":"enable_new_pub_modules","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.59.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.59.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.60":{"name":"enable_new_suspended_page","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.60.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.60.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.61":{"name":"enable_new_three_dot_menu","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.61.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.61.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.62":{"name":"enable_nonmember_reading_list_web","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.62.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.62.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.63":{"name":"enable_optimizely","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.63.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.63.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.64":{"name":"enable_parsely","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.64.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.64.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.65":{"name":"enable_patronus_on_kubernetes","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.65.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.65.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.66":{"name":"enable_popularity_feature","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.66.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.66.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.67":{"name":"enable_post_import","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.67.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.67.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.68":{"name":"enable_post_seo_settings_screen","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.68.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.68.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.69":{"name":"enable_post_settings_screen","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.69.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.69.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.70":{"name":"enable_primary_topic_for_mobile","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.70.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.70.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.71":{"name":"enable_recently_viewed_tab_on_web","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.71.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.71.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.72":{"name":"enable_rito_upstream_deadlines","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.72.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.72.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.73":{"name":"enable_rtr_channel","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.73.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.73.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.74":{"name":"enable_save_to_medium","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.74.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.74.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.75":{"name":"enable_sign_up_with_email","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.75.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.75.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.76":{"name":"enable_suggest_account","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.76.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.76.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.77":{"name":"enable_suggest_account_li","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.77.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.77.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.78":{"name":"enable_tick_landing_page","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.78.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.78.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.79":{"name":"enable_tipalti_onboarding","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.79.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.79.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.80":{"name":"enable_topic_lifecycle_email","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.80.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.80.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.81":{"name":"enable_tribute_landing_page","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.81.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.81.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.82":{"name":"enable_trumpland_landing_page","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.82.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.82.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.83":{"name":"glyph_font_set","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.83.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.83.valueType":{"__typename":"VariantFlagString","value":"m2"},"ROOT_QUERY.variantFlags.84":{"name":"google_sign_in_android","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.84.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.84.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.85":{"name":"is_not_medium_subscriber","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.85.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.85.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.86":{"name":"new_transition_page","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.86.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.86.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.87":{"name":"pub_sidebar","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.87.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.87.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.88":{"name":"rank_model","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.88.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.88.valueType":{"__typename":"VariantFlagString","value":"default"},"ROOT_QUERY.variantFlags.89":{"name":"redis_read_write_splitting","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.89.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.89.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.90":{"name":"signin_services","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.90.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.90.valueType":{"__typename":"VariantFlagString","value":"twitter,facebook,google,email,google-fastidv,google-one-tap"},"ROOT_QUERY.variantFlags.91":{"name":"signup_services","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.91.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.91.valueType":{"__typename":"VariantFlagString","value":"twitter,facebook,google,email,google-fastidv,google-one-tap"},"ROOT_QUERY.variantFlags.92":{"name":"use_new_admin_topic_backend","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.92.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.92.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.93":{"name":"use_sendgrid_queue_for_digest_sends","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.93.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.93.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY":{"variantFlags":[{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.0","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.1","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.2","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.3","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.4","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.5","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.6","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.7","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.8","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.9","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.10","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.11","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.12","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.13","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.14","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.15","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.16","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.17","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.18","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.19","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.20","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.21","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.22","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.23","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.24","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.25","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.26","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.27","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.28","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.29","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.30","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.31","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.32","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.33","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.34","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.35","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.36","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.37","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.38","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.39","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.40","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.41","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.42","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.43","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.44","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.45","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.46","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.47","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.48","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.49","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.50","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.51","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.52","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.53","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.54","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.55","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.56","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.57","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.58","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.59","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.60","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.61","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.62","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.63","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.64","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.65","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.66","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.67","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.68","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.69","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.70","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.71","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.72","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.73","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.74","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.75","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.76","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.77","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.78","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.79","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.80","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.81","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.82","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.83","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.84","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.85","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.86","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.87","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.88","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.89","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.90","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.91","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.92","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.93","typename":"VariantFlag"}],"viewer":null,"meterPost({\"postId\":\"3ba269ea2f5c\",\"postMeteringOptions\":{}})":{"type":"id","generated":false,"id":"MeteringInfo:singleton","typename":"MeteringInfo"},"postResult({\"id\":\"3ba269ea2f5c\"})":{"type":"id","generated":false,"id":"Post:3ba269ea2f5c","typename":"Post"}},"MeteringInfo:singleton":{"__typename":"MeteringInfo","postIds":{"type":"json","json":[]},"maxUnlockCount":3,"unlocksRemaining":3},"Post:3ba269ea2f5c":{"__typename":"Post","visibility":"PUBLIC","latestPublishedVersion":"c7c00c3dcc50","collection":null,"id":"3ba269ea2f5c","creator":{"type":"id","generated":false,"id":"User:1da08193a324","typename":"User"},"isLocked":false,"lockedSource":"LOCKED_POST_SOURCE_NONE","sequence":null,"mediumUrl":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","canonicalUrl":"","content({\"postMeteringOptions\":{}})":{"type":"id","generated":true,"id":"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}})","typename":"PostContent"},"firstPublishedAt":1577576103457,"isPublished":true,"layerCake":0,"primaryTopic":null,"title":"Optimising PineTime’s Display Driver with Rust and Mynewt","isLimitedState":false,"pendingCollection":null,"shareKey":null,"statusForCollection":null,"readingTime":13.95188679245283,"readingList":"READING_LIST_NONE","license":"ALL_RIGHTS_RESERVED","allowResponses":true,"tags":[{"type":"id","generated":false,"id":"Tag:rust","typename":"Tag"},{"type":"id","generated":false,"id":"Tag:programming","typename":"Tag"},{"type":"id","generated":false,"id":"Tag:gadgets","typename":"Tag"},{"type":"id","generated":false,"id":"Tag:internet-of-things","typename":"Tag"},{"type":"id","generated":false,"id":"Tag:embedded-systems","typename":"Tag"}],"viewerClapCount":0,"clapCount":20,"voterCount":5,"recommenders":[],"responsesCount":0,"collaborators":[],"translationSourcePost":null,"newsletterId":"","inResponseToPostResult":null,"inResponseToMediaResource":null,"curationEligibleAt":0,"isDistributionAlertDismissed":false,"audioVersionUrl":"","seoTitle":"","socialTitle":"","socialDek":"","metaDescription":"","latestPublishedAt":1578727787786,"previewContent":{"type":"id","generated":true,"id":"$Post:3ba269ea2f5c.previewContent","typename":"PreviewContent"},"previewImage":{"type":"id","generated":false,"id":"ImageMetadata:1*qWOFrWPOkQm-nf1shcDSSA.png","typename":"ImageMetadata"},"updatedAt":1578727788125,"topics":[],"seoDescription":"","isSuspended":false},"User:1da08193a324":{"id":"1da08193a324","__typename":"User","isSuspended":false,"allowNotes":true,"name":"Lup Yuen Lee 李立源","isFollowing":false,"username":"ly.lee","bio":"Techie and Educator in IoT 物聯網教師","imageId":"1*KGohS3sQaUnr58gc0BIfoQ.jpeg","mediumMemberAt":1571194811000,"isBlocking":false,"isPartnerProgramEnrolled":false,"twitterScreenName":"MisterTechBlog"},"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}})":{"isLockedPreviewOnly":false,"validatedShareKey":"","__typename":"PostContent","bodyModel":{"type":"id","generated":true,"id":"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel","typename":"RichText"}},"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.0":{"name":"63ff","startIndex":0,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.1":{"name":"f971","startIndex":11,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.2":{"name":"fe10","startIndex":33,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.3":{"name":"d674","startIndex":53,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.4":{"name":"3a6f","startIndex":61,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.5":{"name":"0c73","startIndex":74,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.6":{"name":"7946","startIndex":85,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.7":{"name":"921d","startIndex":101,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.8":{"name":"c015","startIndex":113,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.9":{"name":"751f","startIndex":126,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.10":{"name":"78a1","startIndex":134,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.11":{"name":"c566","startIndex":144,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.12":{"name":"6c79","startIndex":164,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel":{"sections":[{"type":"id","generated":true,"id":"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.0","typename":"Section"},{"type":"id","generated":true,"id":"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.1","typename":"Section"},{"type":"id","generated":true,"id":"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.2","typename":"Section"},{"type":"id","generated":true,"id":"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.3","typename":"Section"},{"type":"id","generated":true,"id":"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.4","typename":"Section"},{"type":"id","generated":true,"id":"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.5","typename":"Section"},{"type":"id","generated":true,"id":"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.6","typename":"Section"},{"type":"id","generated":true,"id":"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.7","typename":"Section"},{"type":"id","generated":true,"id":"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.8","typename":"Section"},{"type":"id","generated":true,"id":"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.9","typename":"Section"},{"type":"id","generated":true,"id":"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.10","typename":"Section"},{"type":"id","generated":true,"id":"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.11","typename":"Section"},{"type":"id","generated":true,"id":"$Post:3ba269ea2f5c.content({\"postMeteringOptions\":{}}).bodyModel.sections.12","typename":"Section"}],"paragraphs":[{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_0","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_1","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_2","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_3","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_4","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_5","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_6","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_7","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_8","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_9","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_10","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_11","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_12","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_13","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_14","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_15","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_16","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_17","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_18","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_19","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_20","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_21","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_22","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_23","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_24","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_25","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_26","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_27","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_28","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_29","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_30","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_31","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_32","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_33","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_34","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_35","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_36","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_37","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_38","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_39","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_40","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_41","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_42","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_43","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_44","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_45","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_46","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_47","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_48","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_49","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_50","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_51","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_52","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_53","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_54","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_55","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_56","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_57","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_58","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_59","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_60","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_61","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_62","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_63","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_64","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_65","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_66","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_67","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_68","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_69","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_70","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_71","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_72","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_73","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_74","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_75","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_76","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_77","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_78","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_79","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_80","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_81","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_82","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_83","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_84","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_85","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_86","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_87","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_88","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_89","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_90","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_91","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_92","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_93","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_94","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_95","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_96","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_97","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_98","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_99","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_100","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_101","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_102","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_103","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_104","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_105","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_106","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_107","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_108","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_109","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_110","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_111","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_112","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_113","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_114","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_115","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_116","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_117","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_118","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_119","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_120","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_121","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_122","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_123","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_124","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_125","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_126","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_127","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_128","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_129","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_130","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_131","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_132","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_133","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_134","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_135","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_136","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_137","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_138","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_139","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_140","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_141","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_142","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_143","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_144","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_145","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_146","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_147","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_148","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_149","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_150","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_151","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_152","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_153","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_154","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_155","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_156","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_157","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_158","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_159","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_160","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_161","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_162","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_163","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_164","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_165","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_166","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_167","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_168","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_169","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_170","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_171","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_172","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_173","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_174","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_175","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:c7c00c3dcc50_176","typename":"Paragraph"}],"__typename":"RichText"},"Paragraph:c7c00c3dcc50_0":{"id":"c7c00c3dcc50_0","name":"a8c7","type":"IMG","href":null,"layout":"FULL_WIDTH","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*qWOFrWPOkQm-nf1shcDSSA.png","typename":"ImageMetadata"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*qWOFrWPOkQm-nf1shcDSSA.png":{"id":"1*qWOFrWPOkQm-nf1shcDSSA.png","originalHeight":1720,"originalWidth":3208,"focusPercentX":null,"focusPercentY":null,"alt":null,"__typename":"ImageMetadata"},"Paragraph:c7c00c3dcc50_1":{"id":"c7c00c3dcc50_1","name":"4cb4","type":"H3","href":null,"layout":null,"metadata":null,"text":"Optimising PineTime’s Display Driver with Rust and Mynewt","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_2":{"id":"c7c00c3dcc50_2","name":"7fd8","type":"P","href":null,"layout":null,"metadata":null,"text":"Simple tweaks like Batched Updates and Non-Blocking SPI can have a huge impact on rendering performance…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_2.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_2.markups.0":{"type":"EM","start":0,"end":104,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_3":{"id":"c7c00c3dcc50_3","name":"fbba","type":"P","href":null,"layout":null,"metadata":null,"text":"PineTime Smart Watch has been an awesome educational tool for teaching embedded coding with Rust and Mynewt OS… Check out PineTime articles #1, #2 and #3","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_3.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_3.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_3.markups.2","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_3.markups.3","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_3.markups.4","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_3.markups.5","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_3.markups.0":{"type":"A","start":0,"end":20,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002Fswlh\u002Fsneak-peek-of-pinetime-smart-watch-and-why-its-perfect-for-teaching-iot-81b74161c159?source=friends_link&sk=d9301466f5499bece3e7b638e99ec20d","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_3.markups.1":{"type":"A","start":92,"end":96,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fdoc.rust-lang.org\u002Fbook\u002Ftitle-page.html","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_3.markups.2":{"type":"A","start":101,"end":110,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmynewt.apache.org\u002F","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_3.markups.3":{"type":"A","start":140,"end":142,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002Fswlh\u002Fsneak-peek-of-pinetime-smart-watch-and-why-its-perfect-for-teaching-iot-81b74161c159?source=friends_link&sk=d9301466f5499bece3e7b638e99ec20d","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_3.markups.4":{"type":"A","start":144,"end":146,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fbuilding-a-rust-driver-for-pinetimes-touch-controller-cbc1a5d5d3e9?source=friends_link&sk=d8cf73fc943d9c0e960627d768f309cb","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_3.markups.5":{"type":"A","start":151,"end":153,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fporting-druid-rust-widgets-to-pinetime-smart-watch-7e1d5a5d977a?source=friends_link&sk=09b153c68483f7fa9e63350efd167b07","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_4":{"id":"c7c00c3dcc50_4","name":"6bd8","type":"P","href":null,"layout":null,"metadata":null,"text":"But stare closely at the video demos in the articles… You’ll realise that the rendering of graphics on PineTime’s LCD display looks sluggish.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_5":{"id":"c7c00c3dcc50_5","name":"2bbf","type":"P","href":null,"layout":null,"metadata":null,"text":"Can we expect speedy screen updates from a $20 smart watch… Powered by a Nordic nRF52832 Microcontroller that drives an ST7789 Display Controller over SPI?","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_5.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_5.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_5.markups.2","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_5.markups.3","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_5.markups.4","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_5.markups.0":{"type":"A","start":43,"end":58,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fstore.pine64.org\u002F?product=pinetime-dev-kit","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_5.markups.1":{"type":"A","start":73,"end":104,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Finfocenter.nordicsemi.com\u002Fpdf\u002FnRF52832_PS_v1.0.pdf","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_5.markups.2":{"type":"A","start":120,"end":145,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fwiki.pine64.org\u002Fimages\u002F5\u002F54\u002FST7789V_v1.6.pdf","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_5.markups.3":{"type":"A","start":151,"end":154,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FSerial_Peripheral_Interface","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_5.markups.4":{"type":"EM","start":0,"end":155,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_6":{"id":"c7c00c3dcc50_6","name":"7774","type":"P","href":null,"layout":null,"metadata":null,"text":"Yes we can! Check the rendering performance of Rust and Mynewt OS on PineTime, before and after optimisation…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_6.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_6.markups.0":{"type":"EM","start":0,"end":11,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_7":{"id":"c7c00c3dcc50_7","name":"5aec","type":"IFRAME","href":null,"layout":"OUTSET_CENTER","metadata":null,"text":"Before and after optimising PineTime’s display driver","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_7.iframe","typename":"Iframe"},"mixtapeMetadata":null},"MediaResource:0e3ab0b6c454d6edb712cc130050eaf1":{"id":"0e3ab0b6c454d6edb712cc130050eaf1","iframeSrc":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fcdn.embedly.com\u002Fwidgets\u002Fmedia.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2F_x6B-L5KOtU%3Ffeature%3Doembed&url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D_x6B-L5KOtU&image=https%3A%2F%2Fi.ytimg.com%2Fvi%2F_x6B-L5KOtU%2Fhqdefault.jpg&key=a19fcc184b9711e1b4764040d3dc5c07&type=text%2Fhtml&schema=youtube","iframeHeight":480,"iframeWidth":854,"title":"Blocking vs Non Blocking SPI on PineTime","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_7.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:0e3ab0b6c454d6edb712cc130050eaf1","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_8":{"id":"c7c00c3dcc50_8","name":"aa7f","type":"P","href":null,"layout":null,"metadata":null,"text":"Today we’ll learn how we optimised the PineTime Display Driver to render text and graphics in sub-seconds…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_9":{"id":"c7c00c3dcc50_9","name":"1e34","type":"OLI","href":null,"layout":null,"metadata":null,"text":"We group the pixels to be rendered into rows and blocks. This allows graphics and text to be rendered in fewer SPI operations.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_9.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_9.markups.0":{"type":"STRONG","start":0,"end":56,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_10":{"id":"c7c00c3dcc50_10","name":"b32b","type":"OLI","href":null,"layout":null,"metadata":null,"text":"We changed Blocking SPI operations to Non-Blocking SPI operations. This enables the Rust rendering functions to be executed while SPI operations are running concurrently. (Think graphics rendering pipeline)","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_10.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_10.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_10.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_10.markups.0":{"type":"A","start":172,"end":205,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FGraphics_pipeline","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_10.markups.1":{"type":"STRONG","start":0,"end":67,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_10.markups.2":{"type":"EM","start":171,"end":206,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_11":{"id":"c7c00c3dcc50_11","name":"b1c9","type":"H3","href":null,"layout":null,"metadata":null,"text":"Rendering PineTime Graphics Pixel by Pixel","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_12":{"id":"c7c00c3dcc50_12","name":"3957","type":"P","href":null,"layout":null,"metadata":null,"text":"Let’s look at a simple example to understand how the [embedded-graphics] and [st7735-lcd] crates work together to render graphics on PineTime’s LCD display. This code creates a rectangle with [embedded-graphics] and renders the rectangle to the [st7735-lcd] display…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_12.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_12.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_12.markups.0":{"type":"A","start":54,"end":71,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fcrates.io\u002Fcrates\u002Fembedded-graphics","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_12.markups.1":{"type":"A","start":78,"end":88,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fcrates.io\u002Fcrates\u002Fst7735-lcd","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_13":{"id":"c7c00c3dcc50_13","name":"6ddb","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fpiet-embedded\u002Fblob\u002Fmaster\u002Fpiet-embedded-graphics\u002Fsrc\u002Fdisplay.rs","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_13.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_13.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_13.markups.0":{"type":"A","start":5,"end":95,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fpiet-embedded\u002Fblob\u002Fmaster\u002Fpiet-embedded-graphics\u002Fsrc\u002Fdisplay.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:c5e793814862656246e5586536ab0bb4":{"id":"c5e793814862656246e5586536ab0bb4","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_13.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:c5e793814862656246e5586536ab0bb4","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_14":{"id":"c7c00c3dcc50_14","name":"246f","type":"P","href":null,"layout":null,"metadata":null,"text":"When we trace the SPI requests generated by the [st7735-lcd] driver, we see lots of repetition…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_15":{"id":"c7c00c3dcc50_15","name":"b816","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Flogs\u002Fspi-blocking.log","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_15.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_15.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_15.markups.0":{"type":"A","start":5,"end":95,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Flogs\u002Fspi-blocking.log","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:cbb8c56876ce3d8c8bd8f6a9cb2e5e4b":{"id":"cbb8c56876ce3d8c8bd8f6a9cb2e5e4b","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_15.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:cbb8c56876ce3d8c8bd8f6a9cb2e5e4b","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_16":{"id":"c7c00c3dcc50_16","name":"39a3","type":"P","href":null,"layout":null,"metadata":null,"text":"(The SPI log was obtained by uncommenting this code)","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_16.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_16.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_16.markups.0":{"type":"A","start":1,"end":51,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Frust\u002Fmynewt\u002Fsrc\u002Fspi.rs#L183-L188","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_16.markups.1":{"type":"EM","start":0,"end":52,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_17":{"id":"c7c00c3dcc50_17","name":"fb87","type":"P","href":null,"layout":null,"metadata":null,"text":"For each pixel in the rectangle, the display driver is setting the X and Y coordinates of each pixel and setting the colour of each pixel… Pixel by pixel! (0, 0), (0, 1), (0, 2), …","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_17.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_17.markups.0":{"type":"EM","start":139,"end":180,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_18":{"id":"c7c00c3dcc50_18","name":"3932","type":"P","href":null,"layout":null,"metadata":null,"text":"That’s not efficient for rendering graphics, pixel by pixel… Why are [embedded-graphics] and [st7735-lcd] doing that?","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_18.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_18.markups.0":{"type":"EM","start":61,"end":117,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_19":{"id":"c7c00c3dcc50_19","name":"7847","type":"P","href":null,"layout":null,"metadata":null,"text":"That’s because [embedded-graphics] was designed to run on highly-constrained microcontrollers with very little RAM… Think STM32 Blue Pill, which has only 20 KB RAM! That’s too little RAM for rendering rectangles and other graphics into RAM and copying the rendered RAM bitmap to the display. How does [embedded-graphics] render graphics?","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_19.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_19.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_19.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_19.markups.0":{"type":"STRONG","start":58,"end":93,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_19.markups.1":{"type":"STRONG","start":154,"end":163,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_19.markups.2":{"type":"EM","start":292,"end":337,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_20":{"id":"c7c00c3dcc50_20","name":"0532","type":"P","href":null,"layout":null,"metadata":null,"text":"By using Rust Iterators! Every graphic object to be rendered (rectangles, circles, even text) is transformed by [embedded-graphics] into a Rust Iterator that returns the (X, Y) coordinates of each pixel and its colour. This requires very little RAM because the pixel information is computed on the fly, only when the Iterator needs to return the next pixel.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_20.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_20.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_20.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_20.markups.0":{"type":"A","start":9,"end":23,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fdoc.rust-lang.org\u002Fbook\u002Fch13-02-iterators.html","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_20.markups.1":{"type":"STRONG","start":9,"end":23,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_20.markups.2":{"type":"STRONG","start":139,"end":217,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_21":{"id":"c7c00c3dcc50_21","name":"9b66","type":"P","href":null,"layout":null,"metadata":null,"text":"Rendering a Pixel Iterator to the display is really easy and doesn’t need much RAM, like this…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_22":{"id":"c7c00c3dcc50_22","name":"f162","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fst7735-lcd-batch-rs\u002Fblob\u002Fmaster\u002Fsrc\u002Flib.rs","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_22.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_22.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_22.markups.0":{"type":"A","start":5,"end":74,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fst7735-lcd-batch-rs\u002Fblob\u002Fmaster\u002Fsrc\u002Flib.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:bd6be5f6a44d63bcc4376442e1a99b0c":{"id":"bd6be5f6a44d63bcc4376442e1a99b0c","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_22.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:bd6be5f6a44d63bcc4376442e1a99b0c","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_23":{"id":"c7c00c3dcc50_23","name":"ee99","type":"P","href":null,"layout":null,"metadata":null,"text":"Upon inspecting the set_pixel function that’s called for each pixel, we see this…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_23.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_23.markups.0":{"type":"CODE","start":20,"end":29,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_24":{"id":"c7c00c3dcc50_24","name":"40f0","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fst7735-lcd-batch-rs\u002Fblob\u002Fmaster\u002Fsrc\u002Flib.rs","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_24.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_24.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_24.markups.0":{"type":"A","start":5,"end":74,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fst7735-lcd-batch-rs\u002Fblob\u002Fmaster\u002Fsrc\u002Flib.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:81250916adc217ac18411e3c8b3b219a":{"id":"81250916adc217ac18411e3c8b3b219a","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_24.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:81250916adc217ac18411e3c8b3b219a","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_25":{"id":"c7c00c3dcc50_25","name":"4b14","type":"P","href":null,"layout":null,"metadata":null,"text":"A-ha! We have discovered the code that creates all the repeated SPI requests for setting the (X, Y) coordinates and colour of each pixel!","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_25.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_25.markups.0":{"type":"EM","start":0,"end":5,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_26":{"id":"c7c00c3dcc50_26","name":"4d53","type":"P","href":null,"layout":null,"metadata":null,"text":"Instead of updating the LED display pixel by pixel, can we batch the pixels together and blast the entire batch of pixels in a single SPI request?","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_26.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_26.markups.0":{"type":"EM","start":52,"end":146,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_27":{"id":"c7c00c3dcc50_27","name":"7e43","type":"P","href":null,"layout":null,"metadata":null,"text":"Digging into the [st7735-lcd] display driver code, we see this clue…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_28":{"id":"c7c00c3dcc50_28","name":"6126","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fst7735-lcd-batch-rs\u002Fblob\u002Fmaster\u002Fsrc\u002Flib.rs","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_28.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_28.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_28.markups.0":{"type":"A","start":5,"end":74,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fst7735-lcd-batch-rs\u002Fblob\u002Fmaster\u002Fsrc\u002Flib.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:4ac4d489b7dc69fbd0f785b4b3379220":{"id":"4ac4d489b7dc69fbd0f785b4b3379220","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_28.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:4ac4d489b7dc69fbd0f785b4b3379220","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_29":{"id":"c7c00c3dcc50_29","name":"3079","type":"P","href":null,"layout":null,"metadata":null,"text":"See the difference? The function set_pixels sets the pixel window to the region from (X Start, Y Start) to (X End, Y End)… Then it blasts a list of pixel colours to populate that entire window region!","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_29.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_29.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_29.markups.2","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_29.markups.3","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_29.markups.0":{"type":"CODE","start":33,"end":43,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_29.markups.1":{"type":"CODE","start":85,"end":103,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_29.markups.2":{"type":"CODE","start":107,"end":121,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_29.markups.3":{"type":"STRONG","start":131,"end":161,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_30":{"id":"c7c00c3dcc50_30","name":"7936","type":"P","href":null,"layout":null,"metadata":null,"text":"When we call set_pixels the SPI requests generated by the display driver would look like this… (Note the long lists of pixel colours)","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_30.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_30.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_30.markups.0":{"type":"CODE","start":13,"end":23,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_30.markups.1":{"type":"EM","start":95,"end":133,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_31":{"id":"c7c00c3dcc50_31","name":"100d","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Flogs\u002Fspi-non-blocking.log","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_31.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_31.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_31.markups.0":{"type":"A","start":5,"end":99,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Flogs\u002Fspi-non-blocking.log","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:f2ca75a37f0119aefb14d089af9f1e2e":{"id":"f2ca75a37f0119aefb14d089af9f1e2e","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_31.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:f2ca75a37f0119aefb14d089af9f1e2e","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_32":{"id":"c7c00c3dcc50_32","name":"9799","type":"P","href":null,"layout":null,"metadata":null,"text":"But will this really improve rendering performance? Let’s test this hypothesis the Lean and Agile Way by batching the pixels (in the simplest way possible) without disturbing too much [embedded-graphics] and [st7735-lcd] code…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_32.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_32.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_32.markups.0":{"type":"A","start":83,"end":101,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fmy-5-year-iot-mission-5f2f28348780?source=friends_link&sk=8c9ab6f607d4b6af4a2b233e4096d623","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_32.markups.1":{"type":"EM","start":0,"end":51,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_33":{"id":"c7c00c3dcc50_33","name":"8d93","type":"H3","href":null,"layout":null,"metadata":null,"text":"Batching PineTime Pixels into Rows and Blocks","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_34":{"id":"c7c00c3dcc50_34","name":"c037","type":"P","href":null,"layout":null,"metadata":null,"text":"Here’s our situation…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_35":{"id":"c7c00c3dcc50_35","name":"ce78","type":"OLI","href":null,"layout":null,"metadata":null,"text":"[embedded-graphics] creates Rust Iterators for rendering graphic objects. Works with minimal RAM, but generates excessive SPI requests.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_36":{"id":"c7c00c3dcc50_36","name":"19b3","type":"OLI","href":null,"layout":null,"metadata":null,"text":"PineTime’s Nordic nRF52832 microcontroller has 64 KB of RAM… Not quite sufficient to render the entire 240x240 screen into RAM. (2 bytes of colour per pixel ✖ ️240 rows ✖ 240 columns = 112.5 KB) RAM-based bitmap rendering is no go.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_36.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_36.markups.0":{"type":"STRONG","start":185,"end":193,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_37":{"id":"c7c00c3dcc50_37","name":"a21c","type":"P","href":null,"layout":null,"metadata":null,"text":"Is there a Middle Way… Keeping the RAM-efficient Rust Iterators... But get the Iterators to return small batches of pixels (instead of returning individual pixels)? Let’s experiment with two very simple Rust Iterators: Pixel Row Iterator and Pixel Block Iterator!","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_37.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_37.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_37.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_37.markups.0":{"type":"STRONG","start":219,"end":263,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_37.markups.1":{"type":"EM","start":0,"end":22,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_37.markups.2":{"type":"EM","start":92,"end":122,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_38":{"id":"c7c00c3dcc50_38","name":"77ce","type":"P","href":null,"layout":null,"metadata":null,"text":"Suppose we ask [embedded-graphics] to render this trapezoid shape with 10 pixels…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_39":{"id":"c7c00c3dcc50_39","name":"8c49","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*sXRkBs9tR1cieU9LwYb63Q.png","typename":"ImageMetadata"},"text":"10 pixels from the rendered letter K","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*sXRkBs9tR1cieU9LwYb63Q.png":{"id":"1*sXRkBs9tR1cieU9LwYb63Q.png","originalHeight":2950,"originalWidth":3050,"focusPercentX":null,"focusPercentY":null,"alt":null,"__typename":"ImageMetadata"},"Paragraph:c7c00c3dcc50_40":{"id":"c7c00c3dcc50_40","name":"5925","type":"P","href":null,"layout":null,"metadata":null,"text":"[embedded-graphics] returns a Pixel Iterator that generates the 10 pixels from left to right, top to bottom…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_41":{"id":"c7c00c3dcc50_41","name":"1ad8","type":"IMG","href":null,"layout":"OUTSET_LEFT","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*kRvQ0Hg2xTZ6MhHgpCQhRw.png","typename":"ImageMetadata"},"text":"Zig-zag Pixel Iterator returned by [embedded-graphics]","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*kRvQ0Hg2xTZ6MhHgpCQhRw.png":{"id":"1*kRvQ0Hg2xTZ6MhHgpCQhRw.png","originalHeight":1253,"originalWidth":1987,"focusPercentX":null,"focusPercentY":null,"alt":null,"__typename":"ImageMetadata"},"Paragraph:c7c00c3dcc50_42":{"id":"c7c00c3dcc50_42","name":"6153","type":"P","href":null,"layout":null,"metadata":null,"text":"Which needs 10 SPI requests to render, 1 pixel per SPI request. (Let’s count only the set colour requests)","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_42.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_42.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_42.markups.0":{"type":"STRONG","start":12,"end":27,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_42.markups.1":{"type":"EM","start":64,"end":106,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_43":{"id":"c7c00c3dcc50_43","name":"6b71","type":"P","href":null,"layout":null,"metadata":null,"text":"Since the Pixel Iterator produces pixels row by row, let’s create a Pixel Row Iterator that returns pixels grouped by row…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_43.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_43.markups.0":{"type":"STRONG","start":68,"end":86,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_44":{"id":"c7c00c3dcc50_44","name":"c106","type":"IMG","href":null,"layout":"OUTSET_LEFT","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*dD_OZ-xAR2L14peOvLfJTg.png","typename":"ImageMetadata"},"text":"Our Pixel Row Iterator returns 3 rows","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*dD_OZ-xAR2L14peOvLfJTg.png":{"id":"1*dD_OZ-xAR2L14peOvLfJTg.png","originalHeight":1302,"originalWidth":2083,"focusPercentX":null,"focusPercentY":null,"alt":null,"__typename":"ImageMetadata"},"Paragraph:c7c00c3dcc50_45":{"id":"c7c00c3dcc50_45","name":"fd97","type":"P","href":null,"layout":null,"metadata":null,"text":"Awesome! When we group the pixels into rows, we only need to make 3 SPI requests to render all 10 pixels!","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_45.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_45.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_45.markups.0":{"type":"STRONG","start":66,"end":80,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_45.markups.1":{"type":"EM","start":0,"end":8,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_46":{"id":"c7c00c3dcc50_46","name":"5705","type":"P","href":null,"layout":null,"metadata":null,"text":"Can we do better? What if we group consecutive rows of the same width into rectangular blocks… Creating a Pixel Block Iterator…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_46.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_46.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_46.markups.0":{"type":"STRONG","start":106,"end":126,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_46.markups.1":{"type":"EM","start":0,"end":17,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_47":{"id":"c7c00c3dcc50_47","name":"5b0a","type":"IMG","href":null,"layout":"OUTSET_LEFT","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*0kGCWh1acxSEV1q-L-t0Mg.png","typename":"ImageMetadata"},"text":"Our Pixel Block Iterator returns 2 blocks","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*0kGCWh1acxSEV1q-L-t0Mg.png":{"id":"1*0kGCWh1acxSEV1q-L-t0Mg.png","originalHeight":1304,"originalWidth":2023,"focusPercentX":null,"focusPercentY":null,"alt":null,"__typename":"ImageMetadata"},"Paragraph:c7c00c3dcc50_48":{"id":"c7c00c3dcc50_48","name":"2ed4","type":"P","href":null,"layout":null,"metadata":null,"text":"Yay! We have grouped 10 pixels into 2 blocks… Only 2 SPI requests to render all 10 pixels!","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_48.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_48.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_48.markups.0":{"type":"STRONG","start":51,"end":65,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_48.markups.1":{"type":"EM","start":0,"end":4,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_49":{"id":"c7c00c3dcc50_49","name":"f417","type":"P","href":null,"layout":null,"metadata":null,"text":"What’s the catch? How did we optimise 10 SPI requests into 2 SPI requests… Without sacrificing anything?","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_49.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_49.markups.0":{"type":"EM","start":0,"end":104,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_50":{"id":"c7c00c3dcc50_50","name":"32fb","type":"P","href":null,"layout":null,"metadata":null,"text":"While grouping the pixels into rows and blocks, we actually use more RAM. Every time the Pixel Row Iterator returns the next row, it needs up to 8 bytes of temporary RAM storage (4 pixels with 2 colour bytes each).","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_50.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_50.markups.0":{"type":"STRONG","start":145,"end":152,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_51":{"id":"c7c00c3dcc50_51","name":"5c5e","type":"P","href":null,"layout":null,"metadata":null,"text":"And every time the Pixel Block Iterator returns the next block (max 8 pixels), it needs up to 16 bytes of temporary RAM storage. Which isn’t a lot of RAM, if we keep our block size small. Also the Iterator will reuse the storage for each block returned, so we won’t need to worry about storing 2 or more blocks returned by the Iterator.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_51.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_51.markups.0":{"type":"STRONG","start":94,"end":102,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_52":{"id":"c7c00c3dcc50_52","name":"3814","type":"P","href":null,"layout":null,"metadata":null,"text":"This is the classical Space-Time Tradeoff in Computer Science… Sacrificing some storage space (RAM) to make things run faster.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_52.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_52.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_52.markups.0":{"type":"A","start":22,"end":41,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FSpace%E2%80%93time_tradeoff","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_52.markups.1":{"type":"STRONG","start":22,"end":41,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_53":{"id":"c7c00c3dcc50_53","name":"1326","type":"H3","href":null,"layout":null,"metadata":null,"text":"Pixel Row and Pixel Block Iterators","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_54":{"id":"c7c00c3dcc50_54","name":"98b3","type":"P","href":null,"layout":null,"metadata":null,"text":"Here’s the code for the Pixel Row Iterator that returns the next row of contiguous pixels…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_55":{"id":"c7c00c3dcc50_55","name":"a26b","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"Pixel Row Iterator. From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fpiet-embedded\u002Fblob\u002Fmaster\u002Fpiet-embedded-graphics\u002Fsrc\u002Fbatch.rs","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_55.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_55.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_55.markups.0":{"type":"A","start":25,"end":113,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fpiet-embedded\u002Fblob\u002Fmaster\u002Fpiet-embedded-graphics\u002Fsrc\u002Fbatch.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:d690bcdb07e93f6caf8132e623ad1ca2":{"id":"d690bcdb07e93f6caf8132e623ad1ca2","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_55.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:d690bcdb07e93f6caf8132e623ad1ca2","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_56":{"id":"c7c00c3dcc50_56","name":"68f8","type":"P","href":null,"layout":null,"metadata":null,"text":"And here’s the code for the Pixel Block Iterator that returns the next block of contiguous rows of the same width. Turns out we only need to tweak the code above slightly to get what we need… Instead of iterating over pixels, we now iterate over rows…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_57":{"id":"c7c00c3dcc50_57","name":"7d8e","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"Pixel Block Iterator. From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fpiet-embedded\u002Fblob\u002Fmaster\u002Fpiet-embedded-graphics\u002Fsrc\u002Fbatch.rs","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_57.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_57.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_57.markups.0":{"type":"A","start":27,"end":115,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fpiet-embedded\u002Fblob\u002Fmaster\u002Fpiet-embedded-graphics\u002Fsrc\u002Fbatch.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:fdbe3f8cfaeff4dc048a3aa9cbdb3a95":{"id":"fdbe3f8cfaeff4dc048a3aa9cbdb3a95","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_57.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:fdbe3f8cfaeff4dc048a3aa9cbdb3a95","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_58":{"id":"c7c00c3dcc50_58","name":"c9b4","type":"P","href":null,"layout":null,"metadata":null,"text":"Combining the Pixel Row Iterator and the Pixel Block Iterator, we get the draw_blocks function that renders any [embedded-graphics] graphic object (including text) as pixel blocks…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_58.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_58.markups.0":{"type":"CODE","start":74,"end":85,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_59":{"id":"c7c00c3dcc50_59","name":"c1a0","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"Rendering a graphic object as Pixel Blocks. From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fpiet-embedded\u002Fblob\u002Fmaster\u002Fpiet-embedded-graphics\u002Fsrc\u002Fbatch.rs","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_59.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_59.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_59.markups.0":{"type":"A","start":49,"end":137,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fpiet-embedded\u002Fblob\u002Fmaster\u002Fpiet-embedded-graphics\u002Fsrc\u002Fbatch.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:ca420086b14b219dec17375596ae274e":{"id":"ca420086b14b219dec17375596ae274e","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_59.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:ca420086b14b219dec17375596ae274e","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_60":{"id":"c7c00c3dcc50_60","name":"b84b","type":"P","href":null,"layout":null,"metadata":null,"text":"Thus we now render graphic objects as RAM-efficient chunks of pixels, instead of individual pixels. Middle Way found!","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_60.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_60.markups.0":{"type":"EM","start":100,"end":117,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_61":{"id":"c7c00c3dcc50_61","name":"20f4","type":"H3","href":null,"layout":null,"metadata":null,"text":"Test the Pixel Row and Pixel Block Iterators","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_62":{"id":"c7c00c3dcc50_62","name":"b629","type":"P","href":null,"layout":null,"metadata":null,"text":"“Space-Time Tradeoff called and wants to know how much space we’ll be allocating to make things run faster…”","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_62.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_62.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_62.markups.0":{"type":"A","start":1,"end":20,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FSpace%E2%80%93time_tradeoff","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_62.markups.1":{"type":"EM","start":0,"end":108,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_63":{"id":"c7c00c3dcc50_63","name":"4d29","type":"P","href":null,"layout":null,"metadata":null,"text":"The more RAM storage we allocate for batching pixels into rows and blocks, the fewer SPI requests we need to make. The code currently sets the limits at 100 pixels per row, 200 pixels per block…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_63.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_63.markups.0":{"type":"STRONG","start":153,"end":193,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_64":{"id":"c7c00c3dcc50_64","name":"7239","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"Pixel Row and Pixel Block Sizes. From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fpiet-embedded\u002Fblob\u002Fmaster\u002Fpiet-embedded-graphics\u002Fsrc\u002Fbatch.rs","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_64.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_64.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_64.markups.0":{"type":"A","start":38,"end":126,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fpiet-embedded\u002Fblob\u002Fmaster\u002Fpiet-embedded-graphics\u002Fsrc\u002Fbatch.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:bdbd61470413869026d08d16866f619c":{"id":"bdbd61470413869026d08d16866f619c","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_64.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:bdbd61470413869026d08d16866f619c","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_65":{"id":"c7c00c3dcc50_65","name":"c26d","type":"P","href":null,"layout":null,"metadata":null,"text":"Note that the rows and blocks are returned by the Iterators as [heapless] Vectors, which use fixed-size arrays to store Vectors. So that we don’t rely on Heap Memory, which is harder to manage on embedded devices like PineTime.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_65.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_65.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_65.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_65.markups.0":{"type":"A","start":64,"end":72,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fcrates.io\u002Fcrates\u002Fheapless","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_65.markups.1":{"type":"A","start":74,"end":81,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fdocs.rs\u002Fheapless\u002F0.5.1\u002Fheapless\u002Fstruct.Vec.html","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_65.markups.2":{"type":"STRONG","start":63,"end":81,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_66":{"id":"c7c00c3dcc50_66","name":"2f26","type":"P","href":null,"layout":null,"metadata":null,"text":"Any graphic object that’s 100 pixels wide (or smaller) will be batched efficiently into pixels rows and blocks. Like this square of width 90 pixels created with [embedded-graphics]…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_66.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_66.markups.0":{"type":"STRONG","start":26,"end":41,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_67":{"id":"c7c00c3dcc50_67","name":"1b6b","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fpiet-embedded\u002Fblob\u002Fmaster\u002Fpiet-embedded-graphics\u002Fsrc\u002Fdisplay.rs","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_67.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_67.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_67.markups.0":{"type":"A","start":5,"end":95,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fpiet-embedded\u002Fblob\u002Fmaster\u002Fpiet-embedded-graphics\u002Fsrc\u002Fdisplay.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:52ce07ec157a8e6ad7ceb4580b2130c2":{"id":"52ce07ec157a8e6ad7ceb4580b2130c2","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_67.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:52ce07ec157a8e6ad7ceb4580b2130c2","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_68":{"id":"c7c00c3dcc50_68","name":"3170","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*oSpNIR4KMzDdDpaZwjLTFw.png","typename":"ImageMetadata"},"text":"Square of width 90 pixels from the render demo","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*oSpNIR4KMzDdDpaZwjLTFw.png":{"id":"1*oSpNIR4KMzDdDpaZwjLTFw.png","originalHeight":2120,"originalWidth":2602,"focusPercentX":null,"focusPercentY":null,"alt":null,"__typename":"ImageMetadata"},"Paragraph:c7c00c3dcc50_69":{"id":"c7c00c3dcc50_69","name":"f669","type":"P","href":null,"layout":null,"metadata":null,"text":"When we trace the rendering of the square, we see this log of pixel blocks…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_70":{"id":"c7c00c3dcc50_70","name":"b919","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Flogs\u002Fpixel-block.log","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_70.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_70.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_70.markups.0":{"type":"A","start":5,"end":94,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Flogs\u002Fpixel-block.log","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:2586cb418173bc5f0424db1e8feef8ae":{"id":"2586cb418173bc5f0424db1e8feef8ae","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"pixel-block.log","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_70.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:2586cb418173bc5f0424db1e8feef8ae","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_71":{"id":"c7c00c3dcc50_71","name":"f639","type":"P","href":null,"layout":null,"metadata":null,"text":"(The log was created by uncommenting this code)","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_71.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_71.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_71.markups.0":{"type":"A","start":1,"end":46,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fpiet-embedded\u002Fblob\u002Fmaster\u002Fpiet-embedded-graphics\u002Fsrc\u002Fbatch.rs#L122-L125","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_71.markups.1":{"type":"EM","start":0,"end":47,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_72":{"id":"c7c00c3dcc50_72","name":"cd78","type":"P","href":null,"layout":null,"metadata":null,"text":"Which means that we are indeed deconstructing the 90x90 square into 90x2 pixel blocks for efficient rendering.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_72.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_72.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_72.markups.0":{"type":"STRONG","start":50,"end":62,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_72.markups.1":{"type":"STRONG","start":68,"end":85,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_73":{"id":"c7c00c3dcc50_73","name":"eacb","type":"BQ","href":null,"layout":null,"metadata":null,"text":"💎 This deconstruction doesn’t work so well for a square that occupies the entire 240x240 PineTime screen. I’ll let you think… 1️⃣ Why this doesn’t work 2️⃣ A solution for rendering the huge square efficiently 😀","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_73.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_73.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_73.markups.2","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_73.markups.3","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_73.markups.0":{"type":"EM","start":0,"end":2,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_73.markups.1":{"type":"EM","start":126,"end":131,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_73.markups.2":{"type":"EM","start":153,"end":157,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_73.markups.3":{"type":"EM","start":210,"end":212,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_74":{"id":"c7c00c3dcc50_74","name":"b211","type":"H3","href":null,"layout":null,"metadata":null,"text":"Non-Blocking SPI on PineTime with Mynewt OS","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_75":{"id":"c7c00c3dcc50_75","name":"2695","type":"P","href":null,"layout":null,"metadata":null,"text":"We could go ahead and run the Pixel Row and Pixel Block Iterators to measure the rendering time… But we won’t. We are now rendering the screen as chunks of pixels, transmitting a long string of pixel colours in a single SPI request…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_75.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_75.markups.0":{"type":"STRONG","start":211,"end":231,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_76":{"id":"c7c00c3dcc50_76","name":"6188","type":"P","href":null,"layout":null,"metadata":null,"text":"However our SPI code in PineTime isn’t optimised to handle large SPI requests… Whenever it transmits an SPI request, it waits for the entire request to be transmitted before returning to the caller. This is known as Blocking SPI.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_76.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_76.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_76.markups.0":{"type":"STRONG","start":216,"end":228,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_76.markups.1":{"type":"EM","start":117,"end":166,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_77":{"id":"c7c00c3dcc50_77","name":"4a2c","type":"P","href":null,"layout":null,"metadata":null,"text":"Here’s how we call hal_spi_txrx to transmit a Blocking SPI request in Rust with Mynewt OS…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_77.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_77.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_77.markups.0":{"type":"CODE","start":19,"end":31,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_77.markups.1":{"type":"A","start":19,"end":31,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmynewt.apache.org\u002Flatest\u002Fos\u002Fmodules\u002Fhal\u002Fhal_spi\u002Fhal_spi.html#c.hal_spi_txrx","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_78":{"id":"c7c00c3dcc50_78","name":"7939","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Frust\u002Fmynewt\u002Fsrc\u002Fspi.rs","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_78.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_78.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_78.markups.0":{"type":"A","start":5,"end":96,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Frust\u002Fmynewt\u002Fsrc\u002Fspi.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:a7427f99001dac1dd43f674acf625b2f":{"id":"a7427f99001dac1dd43f674acf625b2f","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"blocking-spi.rs","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_78.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:a7427f99001dac1dd43f674acf625b2f","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_79":{"id":"c7c00c3dcc50_79","name":"8e2b","type":"P","href":null,"layout":null,"metadata":null,"text":"Mynewt OS provides an efficient way to transmit SPI requests: Non-Blocking SPI. hal_spi_txrx_noblock doesn’t hold up the caller while transmitting the request. Instead, Mynewt calls our Callback Function when the request has been completed.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_79.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_79.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_79.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_79.markups.0":{"type":"CODE","start":80,"end":100,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_79.markups.1":{"type":"A","start":80,"end":100,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmynewt.apache.org\u002Flatest\u002Fos\u002Fmodules\u002Fhal\u002Fhal_spi\u002Fhal_spi.html#c.hal_spi_txrx_noblock","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_79.markups.2":{"type":"STRONG","start":62,"end":78,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_80":{"id":"c7c00c3dcc50_80","name":"a8ba","type":"P","href":null,"layout":null,"metadata":null,"text":"Here’s how we set up Non-Blocking SPI and call hal_spi_txrx_noblock…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_80.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_80.markups.0":{"type":"CODE","start":47,"end":67,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_81":{"id":"c7c00c3dcc50_81","name":"cbd3","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Frust\u002Fmynewt\u002Fsrc\u002Fspi.rs","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_81.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_81.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_81.markups.0":{"type":"A","start":5,"end":96,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Frust\u002Fmynewt\u002Fsrc\u002Fspi.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:f2ae86f5e56b8a8025e9bc3dc849d439":{"id":"f2ae86f5e56b8a8025e9bc3dc849d439","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"non-blocking-spi.rs","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_81.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:f2ae86f5e56b8a8025e9bc3dc849d439","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_82":{"id":"c7c00c3dcc50_82","name":"53a7","type":"P","href":null,"layout":null,"metadata":null,"text":"spi_noblock_handler is our Callback Function in Rust. Mynewt won’t let us transmit a Non-Blocking SPI request while another is in progress, so our Callback Function needs to ensure that never happens. More about spi_noblock_handler in a while.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_82.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_82.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_82.markups.0":{"type":"CODE","start":0,"end":19,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_82.markups.1":{"type":"CODE","start":212,"end":231,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_83":{"id":"c7c00c3dcc50_83","name":"fc4d","type":"BQ","href":null,"layout":null,"metadata":null,"text":"💎 What’s core::mem::transmute? We use this function from the Rust Core Library to cast pointer types when passing pointers and references from Rust to C. It’s similar to casting char * to void * in C.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_83.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_83.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_83.markups.2","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_83.markups.3","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_83.markups.4","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_83.markups.5","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_83.markups.0":{"type":"CODE","start":10,"end":30,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_83.markups.1":{"type":"CODE","start":179,"end":185,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_83.markups.2":{"type":"CODE","start":189,"end":195,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_83.markups.3":{"type":"A","start":10,"end":30,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fdoc.rust-lang.org\u002Fcore\u002Fmem\u002Ffn.transmute.html","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_83.markups.4":{"type":"A","start":62,"end":79,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fdoc.rust-lang.org\u002Fcore\u002Findex.html","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_83.markups.5":{"type":"EM","start":0,"end":3,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_84":{"id":"c7c00c3dcc50_84","name":"ab06","type":"BQ","href":null,"layout":null,"metadata":null,"text":"Why don’t we need to specify the pointer type that we are casting to? Because the Rust Compiler performs Type Inference to deduce the pointer type.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_84.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_84.markups.0":{"type":"A","start":105,"end":119,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fdoc.rust-lang.org\u002Fstable\u002Frust-by-example\u002Ftypes\u002Finference.html","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_85":{"id":"c7c00c3dcc50_85","name":"7ad3","type":"H3","href":null,"layout":null,"metadata":null,"text":"Work Around an SPI Quirk","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_86":{"id":"c7c00c3dcc50_86","name":"d6bc","type":"P","href":null,"layout":null,"metadata":null,"text":"Bad News: Non-Blocking SPI doesn’t work 100% as advertised for Nordic nRF52832 Microcontroller, the heart of PineTime. According to this note in Mynewt OS, Non-Blocking SPI on nRF52832 fails if we’re sending a single byte over SPI.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_86.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_86.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_86.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_86.markups.0":{"type":"A","start":119,"end":154,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Fapache\u002Fmynewt-core\u002Fblob\u002Fmaster\u002Fhw\u002Fmcu\u002Fnordic\u002Fnrf52xxx\u002Fsrc\u002Fhal_spi.c#L1106-L1118","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_86.markups.1":{"type":"STRONG","start":156,"end":230,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_86.markups.2":{"type":"EM","start":0,"end":9,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_87":{"id":"c7c00c3dcc50_87","name":"f6f1","type":"P","href":null,"layout":null,"metadata":null,"text":"But why would we send single-byte SPI requests anyway?","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_87.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_87.markups.0":{"type":"EM","start":0,"end":54,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_88":{"id":"c7c00c3dcc50_88","name":"614d","type":"P","href":null,"layout":null,"metadata":null,"text":"Remember this SPI log that we captured earlier? We seem to be sending single bytes very often: 2a, 2b and 2c, which are Command Bytes…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_88.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_88.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_88.markups.2","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_88.markups.3","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_88.markups.0":{"type":"CODE","start":95,"end":97,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_88.markups.1":{"type":"CODE","start":99,"end":101,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_88.markups.2":{"type":"CODE","start":106,"end":108,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_88.markups.3":{"type":"STRONG","start":120,"end":133,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_89":{"id":"c7c00c3dcc50_89","name":"4f3b","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Flogs\u002Fspi-non-blocking.log","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_89.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_89.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_89.markups.0":{"type":"A","start":5,"end":99,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Flogs\u002Fspi-non-blocking.log","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"$Paragraph:c7c00c3dcc50_89.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:f2ca75a37f0119aefb14d089af9f1e2e","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_90":{"id":"c7c00c3dcc50_90","name":"6ca6","type":"P","href":null,"layout":null,"metadata":null,"text":"PineTime’s ST7789 Display Controller has an unusual SPI interface with a special pin: the Data\u002FCommand (DC) Pin. The display controller expects our microcontroller to set the DC Pin to Low when sending the Command Byte, and set the DC Pin to High when sending Data Bytes…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_90.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_90.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_90.markups.2","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_90.markups.3","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_90.markups.0":{"type":"A","start":11,"end":36,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fwiki.pine64.org\u002Fimages\u002F5\u002F54\u002FST7789V_v1.6.pdf","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_90.markups.1":{"type":"STRONG","start":90,"end":111,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_90.markups.2":{"type":"STRONG","start":175,"end":218,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_90.markups.3":{"type":"STRONG","start":232,"end":270,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_91":{"id":"c7c00c3dcc50_91","name":"dad4","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Frust\u002Fmynewt\u002Fsrc\u002Fspi.rs","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_91.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_91.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_91.markups.0":{"type":"A","start":5,"end":96,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Frust\u002Fmynewt\u002Fsrc\u002Fspi.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:937414430f7c44ff91ef32796375bb19":{"id":"937414430f7c44ff91ef32796375bb19","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_91.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:937414430f7c44ff91ef32796375bb19","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_92":{"id":"c7c00c3dcc50_92","name":"26f7","type":"P","href":null,"layout":null,"metadata":null,"text":"Unfortunately our Command Bytes are single bytes, hence we see plenty of single-byte SPI requests. All because of the need to flip the DC Pin!","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_92.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_92.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_92.markups.0":{"type":"STRONG","start":18,"end":48,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_92.markups.1":{"type":"EM","start":99,"end":142,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_93":{"id":"c7c00c3dcc50_93","name":"bddf","type":"P","href":null,"layout":null,"metadata":null,"text":"This complicates our SPI design but let’s overcome this microcontroller hardware defect with good firmware… All single-byte SPI requests are now sent the Blocking way, other requests are sent the Non-Blocking way…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_93.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_93.markups.0":{"type":"STRONG","start":108,"end":166,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_94":{"id":"c7c00c3dcc50_94","name":"f792","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Frust\u002Fmynewt\u002Fsrc\u002Fspi.rs","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_94.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_94.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_94.markups.0":{"type":"A","start":5,"end":96,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Frust\u002Fmynewt\u002Fsrc\u002Fspi.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:17f7d62e19a82c8f2f190fb5c4e06059":{"id":"17f7d62e19a82c8f2f190fb5c4e06059","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_94.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:17f7d62e19a82c8f2f190fb5c4e06059","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_95":{"id":"c7c00c3dcc50_95","name":"8b9a","type":"P","href":null,"layout":null,"metadata":null,"text":"The code uses a Semaphore SPI_SEM to wait for the Non-Blocking SPI operation to complete before proceeding. SPI_SEM is signalled by our Callback Function spi_noblock_handler like this…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_95.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_95.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_95.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_95.markups.0":{"type":"CODE","start":26,"end":33,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_95.markups.1":{"type":"CODE","start":108,"end":115,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_95.markups.2":{"type":"CODE","start":154,"end":173,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_96":{"id":"c7c00c3dcc50_96","name":"013b","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Frust\u002Fmynewt\u002Fsrc\u002Fspi.rs","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_96.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_96.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_96.markups.0":{"type":"A","start":5,"end":96,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Frust\u002Fmynewt\u002Fsrc\u002Fspi.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:a7a6ce519e96d2b1ba3e43431fe2d756":{"id":"a7a6ce519e96d2b1ba3e43431fe2d756","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"spi_noblock_handler.rs","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_96.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:a7a6ce519e96d2b1ba3e43431fe2d756","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_97":{"id":"c7c00c3dcc50_97","name":"747b","type":"P","href":null,"layout":null,"metadata":null,"text":"Something smells fishy… Why are we now waiting for a Non-Blocking SPI request to complete?","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_97.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_97.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_97.markups.0":{"type":"EM","start":0,"end":23,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_97.markups.1":{"type":"EM","start":24,"end":90,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_98":{"id":"c7c00c3dcc50_98","name":"4fa2","type":"P","href":null,"layout":null,"metadata":null,"text":"Well this happens when we do things the Lean and Agile Way… When we hit problems (like the single-byte SPI issue), we assess various simple solutions before we select and implement the right permanent fix. (And I don’t think we have found the right fix yet)","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_98.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_98.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_98.markups.0":{"type":"A","start":40,"end":58,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fmy-5-year-iot-mission-5f2f28348780?source=friends_link&sk=8c9ab6f607d4b6af4a2b233e4096d623","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_98.markups.1":{"type":"EM","start":206,"end":257,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_99":{"id":"c7c00c3dcc50_99","name":"4706","type":"P","href":null,"layout":null,"metadata":null,"text":"This Semaphore workaround also makes the function internal_spi_noblock_write easier to troubleshoot… Whether the SPI request consists of a single byte or multiple bytes, internal_spi_noblock_write will always wait for the SPI request to complete, instead of having diverging paths.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_99.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_99.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_99.markups.0":{"type":"CODE","start":50,"end":76,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_99.markups.1":{"type":"CODE","start":170,"end":196,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_100":{"id":"c7c00c3dcc50_100","name":"5a97","type":"P","href":null,"layout":null,"metadata":null,"text":"This story also highlights the benefit of building our Rust firmware on top of an established Real Time Operating System like Mynewt OS… We quickly discover platform quirks that others have experienced, so that we can avoid the same trap.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_101":{"id":"c7c00c3dcc50_101","name":"7688","type":"H3","href":null,"layout":null,"metadata":null,"text":"Render Graphics and Send SPI Requests Simultaneously on PineTime","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_102":{"id":"c7c00c3dcc50_102","name":"1041","type":"P","href":null,"layout":null,"metadata":null,"text":"Now we can send large SPI requests efficiently to PineTime’s LCD display. We are blocking on a Semaphore while waiting for the SPI request to be completed, which means that our CPU is actually free to do some other tasks while blocking.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_103":{"id":"c7c00c3dcc50_103","name":"c77b","type":"P","href":null,"layout":null,"metadata":null,"text":"Can we do some [embedded-graphics] rendering while waiting for the SPI requests to be completed?","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_103.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_103.markups.0":{"type":"EM","start":0,"end":96,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_104":{"id":"c7c00c3dcc50_104","name":"079d","type":"P","href":null,"layout":null,"metadata":null,"text":"Two problems with that…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_105":{"id":"c7c00c3dcc50_105","name":"e4fd","type":"OLI","href":null,"layout":null,"metadata":null,"text":"[embedded-graphics] creates Rust Iterators and SPI requests in temporary RAM storage. To let [embedded-graphics] continue working, we need to copy the generated SPI requests into RAM before sending the requests","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_105.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_105.markups.0":{"type":"STRONG","start":142,"end":173,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_106":{"id":"c7c00c3dcc50_106","name":"bfe8","type":"OLI","href":null,"layout":null,"metadata":null,"text":"To perform [embedded-graphics] rendering independently from the SPI request transmission, we need a background task. The main task will render graphics with [embedded-graphics] (which is our current design), the background task will transmit SPI requests (this part is new).","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_106.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_106.markups.0":{"type":"STRONG","start":100,"end":115,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_107":{"id":"c7c00c3dcc50_107","name":"11dc","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*B1WC9dfxTj1F4aHQ0-xcxg.jpeg","typename":"ImageMetadata"},"text":"Rendering graphics and transmitting SPI requests at the same time on PineTime. Yes this is the Producer-Consumer Pattern found in many programs.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*B1WC9dfxTj1F4aHQ0-xcxg.jpeg":{"id":"1*B1WC9dfxTj1F4aHQ0-xcxg.jpeg","originalHeight":3033,"originalWidth":5536,"focusPercentX":null,"focusPercentY":null,"alt":null,"__typename":"ImageMetadata"},"Paragraph:c7c00c3dcc50_108":{"id":"c7c00c3dcc50_108","name":"79f7","type":"P","href":null,"layout":null,"metadata":null,"text":"Fortunately Mynewt OS has everything we need to experiment with this multitasking…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_109":{"id":"c7c00c3dcc50_109","name":"6c8a","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Mynewt’s Mbuf Chains may be used to copy SPI requests easily into a RAM space that’s specially managed by Mynewt OS","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_109.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_109.markups.0":{"type":"STRONG","start":9,"end":20,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_110":{"id":"c7c00c3dcc50_110","name":"cfe5","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Mynewt’s Mbuf Queues may be used to enqueue the SPI requests for transmission by the background task","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_110.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_110.markups.0":{"type":"STRONG","start":9,"end":20,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_111":{"id":"c7c00c3dcc50_111","name":"b503","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Mynewt lets us create a background task to send SPI requests from the Mbuf Queue","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_111.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_111.markups.0":{"type":"STRONG","start":24,"end":39,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_112":{"id":"c7c00c3dcc50_112","name":"17b0","type":"P","href":null,"layout":null,"metadata":null,"text":"Let’s look at Mbuf Chains, Mbuf Queues and Multitasking in Mynewt OS.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_113":{"id":"c7c00c3dcc50_113","name":"3cd0","type":"H3","href":null,"layout":null,"metadata":null,"text":"Buffer SPI Requests with Mbuf Chains in Mynewt OS","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_114":{"id":"c7c00c3dcc50_114","name":"16d8","type":"P","href":null,"layout":null,"metadata":null,"text":"In the Unix world of Network Drivers, Mbufs (short for Memory Buffers) are often used to store network packets. Mbufs were created to make common networking stack operations (like stripping and adding protocol headers) efficient and as copy-free as possible. (Mbufs are also used by the NimBLE Bluetooth Stack, which we have seen in the first PineTime article)","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_114.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_114.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_114.markups.2","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_114.markups.3","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_114.markups.0":{"type":"A","start":38,"end":43,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmynewt.apache.org\u002Flatest\u002Fos\u002Fcore_os\u002Fmbuf\u002Fmbuf.html","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_114.markups.1":{"type":"A","start":337,"end":359,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002Fswlh\u002Fsneak-peek-of-pinetime-smart-watch-and-why-its-perfect-for-teaching-iot-81b74161c159?source=friends_link&sk=d9301466f5499bece3e7b638e99ec20d","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_114.markups.2":{"type":"STRONG","start":38,"end":43,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_114.markups.3":{"type":"EM","start":259,"end":360,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_115":{"id":"c7c00c3dcc50_115","name":"6fc8","type":"P","href":null,"layout":null,"metadata":null,"text":"What makes Mbufs so versatile? How are they different from Heap Storage?","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_115.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_115.markups.0":{"type":"EM","start":0,"end":72,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_116":{"id":"c7c00c3dcc50_116","name":"b66c","type":"P","href":null,"layout":null,"metadata":null,"text":"When handling Network Packets (and SPI Requests), we need a quick way to allocate and deallocate buffers of varying sizes. When we request memory from Heap Storage, we get a contiguous block of RAM that’s exactly what we need (or maybe more). But it causes our Heap Storage to become fragmented and poorly utilised.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_116.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_116.markups.0":{"type":"EM","start":284,"end":315,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_117":{"id":"c7c00c3dcc50_117","name":"23dd","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:0*re5J9-NnVP3D_vk9.png","typename":"ImageMetadata"},"text":"Chain of Mbufs. From https:\u002F\u002Fmynewt.apache.org\u002Flatest\u002Fos\u002Fcore_os\u002Fmbuf\u002Fmbuf.html","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_117.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*re5J9-NnVP3D_vk9.png":{"id":"0*re5J9-NnVP3D_vk9.png","originalHeight":540,"originalWidth":720,"focusPercentX":null,"focusPercentY":null,"alt":null,"__typename":"ImageMetadata"},"Paragraph:c7c00c3dcc50_117.markups.0":{"type":"A","start":21,"end":79,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmynewt.apache.org\u002Flatest\u002Fos\u002Fcore_os\u002Fmbuf\u002Fmbuf.html","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_118":{"id":"c7c00c3dcc50_118","name":"845c","type":"P","href":null,"layout":null,"metadata":null,"text":"With Mbufs, we get a chain (linked list) of memory blocks instead. We can’t be sure how much RAM we’ll get in each block, but we can be sure that the total RAM in the entire chain meets what we need. (The diagram above shows how Mynewt OS allocates Mbuf Chains in a compact way using fixed-size Mbuf blocks)","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_118.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_118.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_118.markups.0":{"type":"STRONG","start":21,"end":57,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_118.markups.1":{"type":"EM","start":200,"end":307,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_119":{"id":"c7c00c3dcc50_119","name":"78df","type":"P","href":null,"layout":null,"metadata":null,"text":"Isn’t it harder to code with a chain of memory blocks? Yes, it makes coding more cumbersome, but Mbuf Chains will utilise our tiny pool of RAM on PineTime much better than a Heap Storage allocator.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_119.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_119.markups.0":{"type":"EM","start":0,"end":54,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_120":{"id":"c7c00c3dcc50_120","name":"afff","type":"P","href":null,"layout":null,"metadata":null,"text":"With Rust and Mynewt OS, here’s how we allocate an Mbuf Chain and append our SPI request to the Mbuf Chain…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_121":{"id":"c7c00c3dcc50_121","name":"5419","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Frust\u002Fmynewt\u002Fsrc\u002Fspi.rs","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_121.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_121.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_121.markups.0":{"type":"A","start":5,"end":96,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Frust\u002Fmynewt\u002Fsrc\u002Fspi.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:6f779a766c9af5fee6523cae4bf98cb6":{"id":"6f779a766c9af5fee6523cae4bf98cb6","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_121.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:6f779a766c9af5fee6523cae4bf98cb6","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_122":{"id":"c7c00c3dcc50_122","name":"b180","type":"P","href":null,"layout":null,"metadata":null,"text":"We may call os_mbuf_append as often as we like to append data to our Mbuf Chain, which keeps growing and growing… (Unlike Heap Storage blocks which are fixed-size). So cool!","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_122.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_122.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_122.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_122.markups.0":{"type":"CODE","start":12,"end":26,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_122.markups.1":{"type":"A","start":12,"end":26,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmynewt.apache.org\u002Flatest\u002Fos\u002Fcore_os\u002Fmbuf\u002Fmbuf.html#c.os_mbuf_append","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_122.markups.2":{"type":"EM","start":165,"end":173,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_123":{"id":"c7c00c3dcc50_123","name":"51e0","type":"P","href":null,"layout":null,"metadata":null,"text":"Here’s how we walk the Mbuf Chain to transmit each block of SPI data in the chain, and deallocate the chain when we’re done…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_124":{"id":"c7c00c3dcc50_124","name":"7e68","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Frust\u002Fmynewt\u002Fsrc\u002Fspi.rs","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_124.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_124.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_124.markups.0":{"type":"A","start":5,"end":96,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Frust\u002Fmynewt\u002Fsrc\u002Fspi.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:d6a48faaf4d6a1b2c156f0dbee537d04":{"id":"d6a48faaf4d6a1b2c156f0dbee537d04","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_124.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:d6a48faaf4d6a1b2c156f0dbee537d04","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_125":{"id":"c7c00c3dcc50_125","name":"15ec","type":"P","href":null,"layout":null,"metadata":null,"text":"Note that we don’t transmit the entire Mbuf Chain of SPI data in a single SPI operation… We transmit the SPI data one Mbuf at a time. This works fine for PineTime’s ST7789 Display Controller. And with limited RAM, it’s best not to make an extra copy of the entire Mbuf Chain before transmitting.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_126":{"id":"c7c00c3dcc50_126","name":"e4e5","type":"H3","href":null,"layout":null,"metadata":null,"text":"Enqueue SPI Requests with Mbuf Queues in Mynewt OS","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_127":{"id":"c7c00c3dcc50_127","name":"b733","type":"P","href":null,"layout":null,"metadata":null,"text":"After [embedded-graphics] has completed its rendering, we get an Mbuf Chain that contains the SPI request that will be transmitted to the PineTime Display Controller by the background task. Now we need a way to enqueue the SPI requests (Mbuf Chains) produced by [embedded-graphics]…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_128":{"id":"c7c00c3dcc50_128","name":"dfc5","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*n5g0mKyghlDkaCNhcfu2yQ.png","typename":"ImageMetadata"},"text":"Enqueuing SPI requests in an MBuf Queue before transmitting","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*n5g0mKyghlDkaCNhcfu2yQ.png":{"id":"1*n5g0mKyghlDkaCNhcfu2yQ.png","originalHeight":2230,"originalWidth":3942,"focusPercentX":null,"focusPercentY":null,"alt":null,"__typename":"ImageMetadata"},"Paragraph:c7c00c3dcc50_129":{"id":"c7c00c3dcc50_129","name":"c367","type":"P","href":null,"layout":null,"metadata":null,"text":"When we use Mbuf Chains in Mynewt OS, we get Mbuf Queues for free!","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_129.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_129.markups.0":{"type":"EM","start":38,"end":66,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_130":{"id":"c7c00c3dcc50_130","name":"80b7","type":"P","href":null,"layout":null,"metadata":null,"text":"Check the function spi_event_callback from the last code snippet… It’s actually calling os_mqueue_get to read SPI requests (Mbuf Chains) from an Mbuf Queue named SPI_DATA_QUEUE.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_130.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_130.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_130.markups.2","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_130.markups.3","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_130.markups.0":{"type":"CODE","start":19,"end":37,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_130.markups.1":{"type":"CODE","start":88,"end":101,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_130.markups.2":{"type":"CODE","start":162,"end":176,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_130.markups.3":{"type":"A","start":88,"end":101,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmynewt.apache.org\u002Flatest\u002Fos\u002Fcore_os\u002Fmbuf\u002Fmbuf.html#c.os_mqueue_get","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_131":{"id":"c7c00c3dcc50_131","name":"a9ea","type":"P","href":null,"layout":null,"metadata":null,"text":"Adding an SPI request to an Mbuf Queue is done by calling os_mqueue_put in Rust like this…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_131.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_131.markups.0":{"type":"CODE","start":58,"end":71,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_132":{"id":"c7c00c3dcc50_132","name":"2df9","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Frust\u002Fmynewt\u002Fsrc\u002Fspi.rs","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_132.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_132.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_132.markups.0":{"type":"A","start":5,"end":96,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Frust\u002Fmynewt\u002Fsrc\u002Fspi.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:63fbb1025dc8a2893a551b5df042b21d":{"id":"63fbb1025dc8a2893a551b5df042b21d","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_132.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:63fbb1025dc8a2893a551b5df042b21d","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_133":{"id":"c7c00c3dcc50_133","name":"e602","type":"P","href":null,"layout":null,"metadata":null,"text":"spi_noblock_write is the complete Rust function we use in our PineTime firmware to 1️⃣ Allocate an Mbuf Chain 2️⃣ Append the SPI request to the Mbuf Chain 3️⃣ Add the Mbuf Chain to the Mbuf Queue. Yep it’s that easy to use Mbuf Chains and Mbuf Queues in Mynewt OS!","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_133.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_133.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_133.markups.0":{"type":"CODE","start":0,"end":17,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_133.markups.1":{"type":"EM","start":197,"end":264,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_134":{"id":"c7c00c3dcc50_134","name":"8904","type":"H3","href":null,"layout":null,"metadata":null,"text":"Transmit Enqueued SPI Requests with Mynewt Background Task","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_135":{"id":"c7c00c3dcc50_135","name":"56b6","type":"P","href":null,"layout":null,"metadata":null,"text":"Here comes the final part of our quick experiment… Create a background task in Mynewt to read the Mbuf Queue and transmit each SPI request to PineTime’s Display Controller…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_136":{"id":"c7c00c3dcc50_136","name":"ba6c","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*c7kIxO4BfkJo3hhSUloHPw.png","typename":"ImageMetadata"},"text":"Transmitting SPI Requests enqueued in an Mbuf Queue","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*c7kIxO4BfkJo3hhSUloHPw.png":{"id":"1*c7kIxO4BfkJo3hhSUloHPw.png","originalHeight":2284,"originalWidth":4755,"focusPercentX":null,"focusPercentY":null,"alt":null,"__typename":"ImageMetadata"},"Paragraph:c7c00c3dcc50_137":{"id":"c7c00c3dcc50_137","name":"a326","type":"P","href":null,"layout":null,"metadata":null,"text":"With Rust and Mynewt OS, here’s how we create a background task SPI_TASK that runs the neverending function spi_task_func…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_137.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_137.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_137.markups.0":{"type":"CODE","start":64,"end":72,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_137.markups.1":{"type":"CODE","start":108,"end":121,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_138":{"id":"c7c00c3dcc50_138","name":"5ef9","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Frust\u002Fmynewt\u002Fsrc\u002Fspi.rs","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_138.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_138.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_138.markups.0":{"type":"A","start":5,"end":96,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Frust\u002Fmynewt\u002Fsrc\u002Fspi.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:3aa070c3a2d5e75ac8e6211d2b53a446":{"id":"3aa070c3a2d5e75ac8e6211d2b53a446","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_138.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:3aa070c3a2d5e75ac8e6211d2b53a446","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_139":{"id":"c7c00c3dcc50_139","name":"17a5","type":"P","href":null,"layout":null,"metadata":null,"text":"(Note that we’re calling Mynewt to create background tasks instead of using Rust multitasking, because Mynewt controls all our tasks on PineTime)","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_139.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_139.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_139.markups.0":{"type":"A","start":76,"end":93,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fdoc.rust-lang.org\u002Fbook\u002Fch16-01-threads.html","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_139.markups.1":{"type":"EM","start":0,"end":145,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_140":{"id":"c7c00c3dcc50_140","name":"1c59","type":"P","href":null,"layout":null,"metadata":null,"text":"spi_task_func runs forever, blocking until there’s a request in the Mbuf Queue, and executes the request. The request is handled by the function spi_event_callback that we have seen earlier. (How does Mynewt know that it should invoke spi_event_callback? It’s defined in the call to os_mqueue_init above.)","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_140.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_140.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_140.markups.2","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_140.markups.3","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_140.markups.4","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_140.markups.5","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_140.markups.6","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_140.markups.7","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_140.markups.0":{"type":"CODE","start":0,"end":13,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_140.markups.1":{"type":"CODE","start":145,"end":163,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_140.markups.2":{"type":"CODE","start":235,"end":253,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_140.markups.3":{"type":"CODE","start":283,"end":297,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_140.markups.4":{"type":"A","start":283,"end":297,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmynewt.apache.org\u002Flatest\u002Fos\u002Fcore_os\u002Fmbuf\u002Fmbuf.html#c.os_mqueue_init","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_140.markups.5":{"type":"EM","start":191,"end":235,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_140.markups.6":{"type":"EM","start":253,"end":283,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_140.markups.7":{"type":"EM","start":297,"end":305,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_141":{"id":"c7c00c3dcc50_141","name":"2e59","type":"P","href":null,"layout":null,"metadata":null,"text":"hal_watchdog_tickle appears oddly in the code… What is that?","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_141.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_141.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_141.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_141.markups.0":{"type":"CODE","start":0,"end":19,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_141.markups.1":{"type":"A","start":0,"end":19,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmynewt.apache.org\u002Flatest\u002Fos\u002Fmodules\u002Fhal\u002Fhal_watchdog\u002Fhal_watchdog.html#c.hal_watchdog_tickle","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_141.markups.2":{"type":"EM","start":20,"end":60,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_142":{"id":"c7c00c3dcc50_142","name":"7560","type":"P","href":null,"layout":null,"metadata":null,"text":"Mynewt helpfully pings our background task every couple of milliseconds, to make sure that it’s not hung… That’s why it’s called a Watchdog.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_142.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_142.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_142.markups.0":{"type":"A","start":131,"end":139,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmynewt.apache.org\u002Flatest\u002Fos\u002Fmodules\u002Fhal\u002Fhal_watchdog\u002Fhal_watchdog.html","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_142.markups.1":{"type":"STRONG","start":131,"end":139,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_143":{"id":"c7c00c3dcc50_143","name":"3458","type":"P","href":null,"layout":null,"metadata":null,"text":"To prevent Mynewt from raising a Watchdog Exception, we need to tell the Watchdog every couple of milliseconds that we are OK… By calling hal_watchdog_tickle","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_143.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_143.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_143.markups.0":{"type":"CODE","start":138,"end":157,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_143.markups.1":{"type":"A","start":138,"end":157,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmynewt.apache.org\u002Flatest\u002Fos\u002Fmodules\u002Fhal\u002Fhal_watchdog\u002Fhal_watchdog.html#c.hal_watchdog_tickle","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_144":{"id":"c7c00c3dcc50_144","name":"40dd","type":"H3","href":null,"layout":null,"metadata":null,"text":"Optimised PineTime Display Driver… Assemble!","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_145":{"id":"c7c00c3dcc50_145","name":"9b7e","type":"P","href":null,"layout":null,"metadata":null,"text":"This has been a lengthy but quick (two-week) experiment in optimising the display rendering for PineTime. Here’s how we put everything together…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_145.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_145.markups.0":{"type":"EM","start":34,"end":44,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_146":{"id":"c7c00c3dcc50_146","name":"5e60","type":"P","href":null,"layout":null,"metadata":null,"text":"1️⃣ We have batched the rendering of pixels by rows and by blocks. This batching code has been added to the [piet-embedded] crate that calls [embedded-graphics] to render 2D graphics and text on our PineTime.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_146.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_146.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_146.markups.0":{"type":"A","start":109,"end":122,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fpiet-embedded\u002Fblob\u002Fmaster\u002Fpiet-embedded-graphics\u002Fsrc\u002Fbatch.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_146.markups.1":{"type":"STRONG","start":12,"end":65,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_147":{"id":"c7c00c3dcc50_147","name":"fcca","type":"P","href":null,"layout":null,"metadata":null,"text":"2️⃣ The code that demos the batching of pixels is also in the [piet-embedded] crate. Batching is enabled when we enable the noblock_spi feature in [piet-embedded]’s Cargo.toml like this…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_147.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_147.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_147.markups.2","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_147.markups.3","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_147.markups.0":{"type":"CODE","start":124,"end":135,"href":"","anchorType":"LINK","userId":"","linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_147.markups.1":{"type":"CODE","start":165,"end":175,"href":"","anchorType":"LINK","userId":"","linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_147.markups.2":{"type":"A","start":4,"end":46,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fpiet-embedded\u002Fblob\u002Fmaster\u002Fpiet-embedded-graphics\u002Fsrc\u002Fdisplay.rs","anchorType":"LINK","userId":"","linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_147.markups.3":{"type":"A","start":165,"end":175,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fpiet-embedded\u002Fblob\u002Fmaster\u002Fpiet-embedded-graphics\u002FCargo.toml","anchorType":"LINK","userId":"","linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_148":{"id":"c7c00c3dcc50_148","name":"a60b","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fpiet-embedded\u002Fblob\u002Fmaster\u002Fpiet-embedded-graphics\u002FCargo.toml","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_148.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_148.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_148.markups.0":{"type":"A","start":5,"end":91,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fpiet-embedded\u002Fblob\u002Fmaster\u002Fpiet-embedded-graphics\u002FCargo.toml","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:5cc17eec02ddaea3ca97600b66f1b191":{"id":"5cc17eec02ddaea3ca97600b66f1b191","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_148.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:5cc17eec02ddaea3ca97600b66f1b191","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_149":{"id":"c7c00c3dcc50_149","name":"0788","type":"P","href":null,"layout":null,"metadata":null,"text":"3️⃣ noblock_spi is referenced in the demo code like this…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_149.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_149.markups.0":{"type":"CODE","start":4,"end":15,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_150":{"id":"c7c00c3dcc50_150","name":"d197","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fpiet-embedded\u002Fblob\u002Fmaster\u002Fpiet-embedded-graphics\u002Fsrc\u002Fdisplay.rs","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_150.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_150.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_150.markups.0":{"type":"A","start":5,"end":95,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fpiet-embedded\u002Fblob\u002Fmaster\u002Fpiet-embedded-graphics\u002Fsrc\u002Fdisplay.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:c76a278e26007e740629430566e5c88e":{"id":"c76a278e26007e740629430566e5c88e","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_150.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:c76a278e26007e740629430566e5c88e","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_151":{"id":"c7c00c3dcc50_151","name":"dd93","type":"P","href":null,"layout":null,"metadata":null,"text":"4️⃣ We have implemented Non-Blocking SPI with Mbuf Chains and Mbuf Queues (plus a background task). The code is located in the [mynewt] crate.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_151.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_151.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_151.markups.0":{"type":"A","start":128,"end":134,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Frust\u002Fmynewt\u002Fsrc\u002Fspi.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_151.markups.1":{"type":"STRONG","start":24,"end":73,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_152":{"id":"c7c00c3dcc50_152","name":"b3e4","type":"P","href":null,"layout":null,"metadata":null,"text":"5️⃣ We have forked the original [st7735-lcd] display driver into [st7735-lcd-batch] to test Non-Blocking SPI. Non-Blocking SPI is enabled when we enable the noblock_spi feature in [st7735-lcd-batch]’s Cargo.toml…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_152.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_152.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_152.markups.2","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_152.markups.3","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_152.markups.0":{"type":"CODE","start":157,"end":168,"href":"","anchorType":"LINK","userId":"","linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_152.markups.1":{"type":"CODE","start":201,"end":211,"href":"","anchorType":"LINK","userId":"","linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_152.markups.2":{"type":"A","start":66,"end":82,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fst7735-lcd-batch-rs","anchorType":"LINK","userId":"","linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_152.markups.3":{"type":"A","start":201,"end":211,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fst7735-lcd-batch-rs\u002Fblob\u002Fmaster\u002FCargo.toml","anchorType":"LINK","userId":"","linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_153":{"id":"c7c00c3dcc50_153","name":"5dfc","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fst7735-lcd-batch-rs\u002Fblob\u002Fmaster\u002FCargo.toml","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_153.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_153.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_153.markups.0":{"type":"A","start":5,"end":74,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fst7735-lcd-batch-rs\u002Fblob\u002Fmaster\u002FCargo.toml","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:86790e0afa31f536b3d31c387bb5c6b1":{"id":"86790e0afa31f536b3d31c387bb5c6b1","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_153.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:86790e0afa31f536b3d31c387bb5c6b1","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_154":{"id":"c7c00c3dcc50_154","name":"93b7","type":"P","href":null,"layout":null,"metadata":null,"text":"6️⃣ noblock_spi is referenced by [st7735-lcd-batch] like this…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_154.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_154.markups.0":{"type":"CODE","start":4,"end":15,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_155":{"id":"c7c00c3dcc50_155","name":"b7ed","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fst7735-lcd-batch-rs\u002Fblob\u002Fmaster\u002Fsrc\u002Flib.rs","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_155.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_155.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_155.markups.0":{"type":"A","start":5,"end":74,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fst7735-lcd-batch-rs\u002Fblob\u002Fmaster\u002Fsrc\u002Flib.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:4a3914b2d3c4657d9400ac0100710b57":{"id":"4a3914b2d3c4657d9400ac0100710b57","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Foptimising-pinetimes-display-driver-with-rust-and-mynewt-3ba269ea2f5c","__typename":"MediaResource"},"$Paragraph:c7c00c3dcc50_155.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:4a3914b2d3c4657d9400ac0100710b57","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:c7c00c3dcc50_156":{"id":"c7c00c3dcc50_156","name":"f603","type":"P","href":null,"layout":null,"metadata":null,"text":"(Plus a few other spots in that file)","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_156.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_156.markups.0":{"type":"EM","start":0,"end":37,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_157":{"id":"c7c00c3dcc50_157","name":"2256","type":"P","href":null,"layout":null,"metadata":null,"text":"We have attempted to optimise the display driver for PineTime… But it’s far from optimal!","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_157.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_157.markups.0":{"type":"EM","start":63,"end":89,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_158":{"id":"c7c00c3dcc50_158","name":"6e00","type":"P","href":null,"layout":null,"metadata":null,"text":"There are a few parameters that we may tweak to make PineTime render faster… Just be mindful that some of these tweaks will take up precious RAM…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_159":{"id":"c7c00c3dcc50_159","name":"c2e2","type":"P","href":null,"layout":null,"metadata":null,"text":"1️⃣ MaxRowSize: Maximum number of pixels per batched row. Currently set to 100.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_159.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_159.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_159.markups.0":{"type":"CODE","start":4,"end":14,"href":"","anchorType":"LINK","userId":"","linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_159.markups.1":{"type":"A","start":4,"end":14,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fpiet-embedded\u002Fblob\u002Fmaster\u002Fpiet-embedded-graphics\u002Fsrc\u002Fbatch.rs#L26","anchorType":"LINK","userId":"","linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_160":{"id":"c7c00c3dcc50_160","name":"d305","type":"P","href":null,"layout":null,"metadata":null,"text":"2️⃣ MaxBlockSize: Maximum number of pixels per batched block. Currently set to 200.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_160.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_160.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_160.markups.0":{"type":"CODE","start":4,"end":16,"href":"","anchorType":"LINK","userId":"","linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_160.markups.1":{"type":"A","start":4,"end":16,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fpiet-embedded\u002Fblob\u002Fmaster\u002Fpiet-embedded-graphics\u002Fsrc\u002Fbatch.rs#L28","anchorType":"LINK","userId":"","linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_161":{"id":"c7c00c3dcc50_161","name":"447c","type":"P","href":null,"layout":null,"metadata":null,"text":"3️⃣ SPI_THROTTLE_SEM: How many SPI requests are allowed to be enqueued before blocking the rendering task. Currently set to 2.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_161.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_161.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_161.markups.0":{"type":"CODE","start":4,"end":20,"href":"","anchorType":"LINK","userId":"","linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_161.markups.1":{"type":"A","start":4,"end":20,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Frust\u002Fmynewt\u002Fsrc\u002Fspi.rs#L109","anchorType":"LINK","userId":"","linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_162":{"id":"c7c00c3dcc50_162","name":"05bc","type":"P","href":null,"layout":null,"metadata":null,"text":"4️⃣ OS_MAIN_STACK_SIZE: Stack Size for the main task. Currently set to 16 KB","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_162.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_162.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_162.markups.0":{"type":"CODE","start":4,"end":22,"href":"","anchorType":"LINK","userId":"","linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_162.markups.1":{"type":"A","start":4,"end":22,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Fapps\u002Fmy_sensor_app\u002Fsyscfg.yml#L100","anchorType":"LINK","userId":"","linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_163":{"id":"c7c00c3dcc50_163","name":"85d7","type":"P","href":null,"layout":null,"metadata":null,"text":"5️⃣ MSYS_1_BLOCK_COUNT: Number of Mbuf blocks available. Currently set to 64.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_163.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_163.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_163.markups.0":{"type":"CODE","start":4,"end":22,"href":"","anchorType":"LINK","userId":"","linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_163.markups.1":{"type":"A","start":4,"end":22,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Fpinetime\u002Fapps\u002Fmy_sensor_app\u002Fsyscfg.yml#L102","anchorType":"LINK","userId":"","linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_164":{"id":"c7c00c3dcc50_164","name":"bef2","type":"H3","href":null,"layout":null,"metadata":null,"text":"What’s Next?","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_165":{"id":"c7c00c3dcc50_165","name":"1d10","type":"P","href":null,"layout":null,"metadata":null,"text":"PineTime is available for purchase by general public! Check this article for updated instructions to build and flash PineTime firmware…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_165.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_165.markups.0":{"type":"A","start":0,"end":52,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fstore.pine64.org\u002F?product=pinetime-dev-kit","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_166":{"id":"c7c00c3dcc50_166","name":"8e9e","type":"MIXTAPE_EMBED","href":null,"layout":null,"metadata":null,"text":"Build and Flash Rust+Mynewt Firmware for PineTime Smart Watch\nAll you need is a Raspberry Pi and a Windows or macOS computer!medium.com","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_166.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_166.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_166.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_166.mixtapeMetadata","typename":"MixtapeMetadata"}},"Paragraph:c7c00c3dcc50_166.markups.0":{"type":"A","start":0,"end":135,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fbuild-and-flash-rust-mynewt-firmware-for-pinetime-smart-watch-5e14259c55","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_166.markups.1":{"type":"STRONG","start":0,"end":61,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_166.markups.2":{"type":"EM","start":62,"end":125,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"$Paragraph:c7c00c3dcc50_166.mixtapeMetadata":{"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fbuild-and-flash-rust-mynewt-firmware-for-pinetime-smart-watch-5e14259c55","thumbnailImageId":"1*Gfl2dimLEVRKPB9BdCus7g.jpeg","mediaResourceId":"1*Gfl2dimLEVRKPB9BdCus7g.jpeg","__typename":"MixtapeMetadata"},"Paragraph:c7c00c3dcc50_167":{"id":"c7c00c3dcc50_167","name":"ac85","type":"P","href":null,"layout":null,"metadata":null,"text":"In the next article we’ll have…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_168":{"id":"c7c00c3dcc50_168","name":"858c","type":"P","href":null,"layout":null,"metadata":null,"text":"1️⃣ The prebuilt Rust + Mynewt OS firmware that we may download and install on PineTime","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_168.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_168.markups.0":{"type":"STRONG","start":8,"end":42,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_169":{"id":"c7c00c3dcc50_169","name":"dfea","type":"P","href":null,"layout":null,"metadata":null,"text":"2️⃣ Instructions for flashing the firmware to PineTime with Raspberry Pi (or ST Link)","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_169.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_169.markups.0":{"type":"STRONG","start":4,"end":42,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_170":{"id":"c7c00c3dcc50_170","name":"6a1a","type":"P","href":null,"layout":null,"metadata":null,"text":"3️⃣ Instructions for developing our own Watch Apps with the druid Rust UI Framework","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_170.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_170.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_170.markups.0":{"type":"A","start":60,"end":83,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fporting-druid-rust-widgets-to-pinetime-smart-watch-7e1d5a5d977a?source=friends_link&sk=09b153c68483f7fa9e63350efd167b07","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_170.markups.1":{"type":"STRONG","start":4,"end":50,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_171":{"id":"c7c00c3dcc50_171","name":"3927","type":"P","href":null,"layout":null,"metadata":null,"text":"Stay tuned!","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_172":{"id":"c7c00c3dcc50_172","name":"023f","type":"P","href":null,"layout":null,"metadata":null,"text":"Here are the other articles in the PineTime series…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_172.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:c7c00c3dcc50_172.markups.0":{"type":"EM","start":0,"end":51,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_173":{"id":"c7c00c3dcc50_173","name":"3ef1","type":"MIXTAPE_EMBED","href":null,"layout":null,"metadata":null,"text":"Sneak Peek of PineTime Smart Watch… And why it’s perfect for teaching IoT\nI’m one of the lucky few who received the developer preview version of the PineTime Smart Watch by Pine64. (My official…medium.com","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_173.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_173.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_173.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_173.mixtapeMetadata","typename":"MixtapeMetadata"}},"Paragraph:c7c00c3dcc50_173.markups.0":{"type":"A","start":0,"end":204,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002Fswlh\u002Fsneak-peek-of-pinetime-smart-watch-and-why-its-perfect-for-teaching-iot-81b74161c159","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_173.markups.1":{"type":"STRONG","start":0,"end":73,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_173.markups.2":{"type":"EM","start":74,"end":194,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"$Paragraph:c7c00c3dcc50_173.mixtapeMetadata":{"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002Fswlh\u002Fsneak-peek-of-pinetime-smart-watch-and-why-its-perfect-for-teaching-iot-81b74161c159","thumbnailImageId":"1*1oFvRxqOf1kUmCAxPaJXpw.jpeg","mediaResourceId":"1*1oFvRxqOf1kUmCAxPaJXpw.jpeg","__typename":"MixtapeMetadata"},"Paragraph:c7c00c3dcc50_174":{"id":"c7c00c3dcc50_174","name":"606b","type":"MIXTAPE_EMBED","href":null,"layout":null,"metadata":null,"text":"Building a Rust Driver for PineTime’s Touch Controller\nPretend you’re my IoT student. I give you a PineTime Smart Watch and challenge you to “Make it work… Especially the…medium.com","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_174.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_174.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_174.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_174.mixtapeMetadata","typename":"MixtapeMetadata"}},"Paragraph:c7c00c3dcc50_174.markups.0":{"type":"A","start":0,"end":181,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fbuilding-a-rust-driver-for-pinetimes-touch-controller-cbc1a5d5d3e9","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_174.markups.1":{"type":"STRONG","start":0,"end":54,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_174.markups.2":{"type":"EM","start":55,"end":171,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"$Paragraph:c7c00c3dcc50_174.mixtapeMetadata":{"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fbuilding-a-rust-driver-for-pinetimes-touch-controller-cbc1a5d5d3e9","thumbnailImageId":"1*P9NuG-tqsK3YKVo97v7PRA.png","mediaResourceId":"1*P9NuG-tqsK3YKVo97v7PRA.png","__typename":"MixtapeMetadata"},"Paragraph:c7c00c3dcc50_175":{"id":"c7c00c3dcc50_175","name":"02c0","type":"MIXTAPE_EMBED","href":null,"layout":null,"metadata":null,"text":"Porting [druid] Rust Widgets to PineTime Smart Watch\nA button that responds to our tapping and increments a counter… That’s what we shall accomplish today on the PineTime…medium.com","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_175.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_175.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_175.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_175.mixtapeMetadata","typename":"MixtapeMetadata"}},"Paragraph:c7c00c3dcc50_175.markups.0":{"type":"A","start":0,"end":181,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fporting-druid-rust-widgets-to-pinetime-smart-watch-7e1d5a5d977a","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_175.markups.1":{"type":"STRONG","start":0,"end":52,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_175.markups.2":{"type":"EM","start":53,"end":171,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"$Paragraph:c7c00c3dcc50_175.mixtapeMetadata":{"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fporting-druid-rust-widgets-to-pinetime-smart-watch-7e1d5a5d977a","thumbnailImageId":"1*t14h6Hs6uVUifppiEBptFQ.png","mediaResourceId":"1*t14h6Hs6uVUifppiEBptFQ.png","__typename":"MixtapeMetadata"},"Paragraph:c7c00c3dcc50_176":{"id":"c7c00c3dcc50_176","name":"cc63","type":"MIXTAPE_EMBED","href":null,"layout":null,"metadata":null,"text":"Build and Flash Rust+Mynewt Firmware for PineTime Smart Watch\nAll you need is a Raspberry Pi and a Windows or macOS computer!medium.com","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_176.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_176.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:c7c00c3dcc50_176.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":{"type":"id","generated":true,"id":"$Paragraph:c7c00c3dcc50_176.mixtapeMetadata","typename":"MixtapeMetadata"}},"Paragraph:c7c00c3dcc50_176.markups.0":{"type":"A","start":0,"end":135,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fbuild-and-flash-rust-mynewt-firmware-for-pinetime-smart-watch-5e14259c55","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_176.markups.1":{"type":"STRONG","start":0,"end":61,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:c7c00c3dcc50_176.markups.2":{"type":"EM","start":62,"end":125,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"$Paragraph:c7c00c3dcc50_176.mixtapeMetadata":{"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20200121150820\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fbuild-and-flash-rust-mynewt-firmware-for-pinetime-smart-watch-5e14259c55","thumbnailImageId":"1*Gfl2dimLEVRKPB9BdCus7g.jpeg","mediaResourceId":"1*Gfl2dimLEVRKPB9BdCus7g.jpeg","__typename":"MixtapeMetadata"},"Tag:rust":{"id":"rust","displayTitle":"Rust","__typename":"Tag"},"Tag:programming":{"id":"programming","displayTitle":"Programming","__typename":"Tag"},"Tag:gadgets":{"id":"gadgets","displayTitle":"Gadgets","__typename":"Tag"},"Tag:internet-of-things":{"id":"internet-of-things","displayTitle":"Internet of Things","__typename":"Tag"},"Tag:embedded-systems":{"id":"embedded-systems","displayTitle":"Embedded Systems","__typename":"Tag"},"$Post:3ba269ea2f5c.previewContent":{"subtitle":"Simple tweaks like Batched Updates and Non-Blocking SPI can have a huge impact on rendering performance…","__typename":"PreviewContent"}}</script><script src="https://web.archive.org/web/20200121150820js_/https://cdn-client.medium.com/lite/static/js/manifest.0668c53e.js"></script><script src="https://web.archive.org/web/20200121150820js_/https://cdn-client.medium.com/lite/static/js/vendors~main.a133fb80.chunk.js"></script><script src="https://web.archive.org/web/20200121150820js_/https://cdn-client.medium.com/lite/static/js/main.c0f7b894.chunk.js"></script><script src="https://web.archive.org/web/20200121150820js_/https://cdn-client.medium.com/lite/static/js/vendors~screen.collection.packageBuilder~screen.landingpages.pres45~screen.landingpages.tribute~scre~3e410f11.d2f0cb5c.chunk.js"></script>
<script src="https://web.archive.org/web/20200121150820js_/https://cdn-client.medium.com/lite/static/js/screen.collection.packageBuilder~screen.landingpages.pres45~screen.landingpages.tribute~screen.post~~4767c889.4d21fc30.chunk.js"></script>
<script src="https://web.archive.org/web/20200121150820js_/https://cdn-client.medium.com/lite/static/js/screen.collection.packageBuilder~screen.landingpages.pres45~screen.landingpages.tribute~screen.post~~73c4bb05.7c8a8baf.chunk.js"></script>
<script src="https://web.archive.org/web/20200121150820js_/https://cdn-client.medium.com/lite/static/js/screen.post~screen.post.amp~screen.profile~screen.sequence.library~screen.sequence.post~screen.stori~aba94ffa.c7982213.chunk.js"></script>
<script src="https://web.archive.org/web/20200121150820js_/https://cdn-client.medium.com/lite/static/js/screen.post.b1a02927.chunk.js"></script><script>window.main();</script></body></html><!--
     FILE ARCHIVED ON 15:08:20 Jan 21, 2020 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 12:23:15 Feb 20, 2021.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  exclusion.robots.policy: 0.415
  LoadShardBlock: 131.642 (3)
  captures_list: 181.994
  RedisCDXSource: 1.422
  CDXLines.iter: 27.187 (3)
  PetaboxLoader3.resolve: 99.928
  esindex: 0.018
  PetaboxLoader3.datanode: 143.019 (4)
  exclusion.robots: 0.432
  load_resource: 165.674
-->