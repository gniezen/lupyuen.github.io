<!doctype html>
<html lang="en">

<head>
  <link rel="stylesheet" type="text/css" href="/_static/css/banner-styles.css?v=bsmaklHF" />
  <link rel="stylesheet" type="text/css" href="/_static/css/iconochive.css?v=qtvMKcIJ" />
  <!-- End Wayback Rewrite JS Include -->
  <title data-rh="true">STM32 Blue Pill — Analyse and Optimise Your RAM and ROM</title>
  <meta data-rh="true" charset="utf-8" />
  <meta data-rh="true" name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1" />
  <meta data-rh="true" name="theme-color" content="#000000" />
  <meta data-rh="true" name="twitter:app:name:iphone" content="Medium" />
  <meta data-rh="true" name="twitter:app:id:iphone" content="828256236" />
  <meta data-rh="true" property="al:ios:app_name" content="Medium" />
  <meta data-rh="true" property="al:ios:app_store_id" content="828256236" />
  <meta data-rh="true" property="al:android:package" content="com.medium.reader" />
  <meta data-rh="true" property="fb:app_id" content="542599432471018" />
  <meta data-rh="true" property="og:site_name" content="Medium" />
  <meta data-rh="true" property="og:type" content="article" />
  <meta data-rh="true" property="article:published_time" content="2019-04-22T11:34:13.692Z" />
  <meta data-rh="true" name="title" content="STM32 Blue Pill — Analyse and Optimise Your RAM and ROM" />
  <meta data-rh="true" property="og:title" content="STM32 Blue Pill — Analyse and Optimise Your RAM and ROM" />
  <meta data-rh="true" property="twitter:title" content="STM32 Blue Pill — Analyse and Optimise Your RAM and ROM" />
  <meta data-rh="true" name="twitter:site" content="@Medium" />
  <meta data-rh="true" name="twitter:app:url:iphone" content="medium://p/9fc805e16ed7" />
  <meta data-rh="true" property="al:android:url" content="medium://p/9fc805e16ed7" />
  <meta data-rh="true" property="al:ios:url" content="medium://p/9fc805e16ed7" />
  <meta data-rh="true" property="al:android:app_name" content="Medium" />
  <meta data-rh="true" name="description" content="Tips and tools to prevent Blue Pill Bloat" />
  <meta data-rh="true" property="og:description" content="Tips and tools to prevent Blue Pill Bloat" />
  <meta data-rh="true" property="twitter:description" content="Tips and tools to prevent Blue Pill Bloat" />
  <meta data-rh="true" property="og:url"
    content="https://web.archive.org/web/20191216120206/https://medium.com/@ly.lee/stm32-blue-pill-analyse-and-optimise-your-ram-and-rom-9fc805e16ed7" />
  <meta data-rh="true" property="al:web:url"
    content="https://medium.com/@ly.lee/stm32-blue-pill-analyse-and-optimise-your-ram-and-rom-9fc805e16ed7" />
  <meta data-rh="true" property="og:image"
    content="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/1200/1*sqHQVxWsmoA7_PW7j9_GJQ.png" />
  <meta data-rh="true" name="twitter:image:src"
    content="https://miro.medium.com/max/1200/1*sqHQVxWsmoA7_PW7j9_GJQ.png" />
  <meta data-rh="true" name="twitter:card" content="summary_large_image" />
  <meta data-rh="true" property="article:author" content="https://medium.com/@ly.lee" />
  <meta data-rh="true" name="twitter:creator" content="@MisterTechBlog" />
  <meta data-rh="true" name="author" content="Lup Yuen Lee 李立源" />
  <meta data-rh="true" name="robots" content="index,follow" />
  <meta data-rh="true" name="referrer" content="unsafe-url" />
  <meta data-rh="true" name="twitter:label1" value="Reading time" />
  <meta data-rh="true" name="twitter:data1" value="15 min read" />
  <meta data-rh="true" name="parsely-post-id" content="9fc805e16ed7" />
  <link data-rh="true" rel="publisher" href="https://plus.google.com/103654360130207659246" />
  <link data-rh="true" rel="search" type="application/opensearchdescription+xml" title="Medium"
    href="/web/20191216120206/https://medium.com/osd.xml" />
  <link data-rh="true" rel="apple-touch-icon" sizes="152x152"
    href="https://web.archive.org/web/20191216120206im_/https://cdn-images-1.medium.com/fit/c/152/152/1*8I-HPL0bfoIzGied-dzOvA.png" />
  <link data-rh="true" rel="apple-touch-icon" sizes="120x120"
    href="https://web.archive.org/web/20191216120206im_/https://cdn-images-1.medium.com/fit/c/120/120/1*8I-HPL0bfoIzGied-dzOvA.png" />
  <link data-rh="true" rel="apple-touch-icon" sizes="76x76"
    href="https://web.archive.org/web/20191216120206im_/https://cdn-images-1.medium.com/fit/c/76/76/1*8I-HPL0bfoIzGied-dzOvA.png" />
  <link data-rh="true" rel="apple-touch-icon" sizes="60x60"
    href="https://web.archive.org/web/20191216120206im_/https://cdn-images-1.medium.com/fit/c/60/60/1*8I-HPL0bfoIzGied-dzOvA.png" />
  <link data-rh="true" rel="mask-icon"
    href="https://web.archive.org/web/20191216120206im_/https://cdn-static-1.medium.com/_/fp/icons/monogram-mask.KPLCSFEZviQN0jQ7veN2RQ.svg"
    color="#171717" />
  <link data-rh="true" rel="icon"
    href="https://web.archive.org/web/20191216120206im_/https://cdn-static-1.medium.com/_/fp/icons/favicon-rebrand-medium.3Y6xpZ-0FSdWDnPM3hSBIA.ico" />
  <link data-rh="true" id="glyph_link" rel="stylesheet" type="text/css"
    href="https://web.archive.org/web/20191216120206cs_/https://glyph.medium.com/css/e/sr/latin/e/ssr/latin/e/ssb/latin/m2.css" />
  <link data-rh="true" rel="author" href="https://medium.com/@ly.lee" />
  <link data-rh="true" rel="canonical"
    href="https://web.archive.org/web/20191216120206/https://medium.com/@ly.lee/stm32-blue-pill-analyse-and-optimise-your-ram-and-rom-9fc805e16ed7" />
  <link data-rh="true" rel="alternate"
    href="https://web.archive.org/web/20191216120206/android-app://com.medium.reader/https/medium.com/p/9fc805e16ed7" />

<!-- Begin scripts/rustdoc-header.html: Header for Custom Markdown files processed by rustdoc, like chip8.md -->
<link rel="alternate" type="application/rss+xml" title="RSS Feed for lupyuen" href="/rss.xml" />
<link rel="stylesheet" type="text/css" href="../normalize.css">
<link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle">

<link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle">
<link rel="stylesheet" type="text/css" href="../prism.css">
<script src="../storage.js"></script><noscript>
<link rel="stylesheet" href="../noscript.css"></noscript>
<link rel="shortcut icon" href="../favicon.ico">
<style type="text/css">
    #crate-search {
        background-image: url("../down-arrow.svg");
    }
    a {
        color: #77d;
    }
</style>
<!-- End scripts/rustdoc-header.html -->

</head>

<body>
  <div id="root">
    <div class="a b c">
      <article class="meteredContent">
        <section class="cy cz da db ak dc ct n dd"></section><span class="r"></span>
        <div>
          <div class="de u df dg dh di"></div>
          <section class="dj dk dl dm dn">
            <div class="do ak">
              <figure class="dp do ak paragraph-image">

                
                <p><img src="https://lupyuen.github.io/images/legacy2/n1.png" /></p>


                <div class="dq dr ds dt ak">
                  <div class="dz r ds ea">
                    <div class="eb r">
                      <div class="du dv de t u dw ak ax dx dy"><img class="de t u dw ak ec ed ee"
                          src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/60/1*sqHQVxWsmoA7_PW7j9_GJQ.png?q=20"
                          width="2733" height="1166" role="presentation" /></div><img class="du dv de t u dw ak ef"
                        width="2733" height="1166" role="presentation" /><noscript><img class="de t u dw ak"
                          src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/5466/1*sqHQVxWsmoA7_PW7j9_GJQ.png"
                          width="2733" height="1166" role="presentation" /></noscript>
                    </div>
                  </div>
                </div>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <div>
                  <div id="d5b5" class="eh ei ar bz ej b ek el em en eo ep eq">
                    <h1 class="ej b ek er ar">STM32 Blue Pill — Analyse and Optimise Your RAM and ROM</h1>
                  </div>
                  <div class="es">
                    <div class="n et eu ev ew">
                      <div class="o n">
                        <div><a rel="noopener"
                            href="/web/20191216120206/https://medium.com/@ly.lee?source=post_page-----9fc805e16ed7----------------------">
                            <div class="ds ex ey">
                              <div class="ch n ez o p de fa fb fc fd fe di"><svg width="57" height="57"
                                  viewbox="0 0 57 57">
                                  <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M28.5 1.2A27.45 27.45 0 0 0 4.06 15.82L3 15.27A28.65 28.65 0 0 1 28.5 0C39.64 0 49.29 6.2 54 15.27l-1.06.55A27.45 27.45 0 0 0 28.5 1.2zM4.06 41.18A27.45 27.45 0 0 0 28.5 55.8a27.45 27.45 0 0 0 24.44-14.62l1.06.55A28.65 28.65 0 0 1 28.5 57 28.65 28.65 0 0 1 3 41.73l1.06-.55z">
                                  </path>
                                </svg></div><img alt="Lup Yuen Lee 李立源" class="r ff ey ex"
                                src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/fit/c/96/96/1*KGohS3sQaUnr58gc0BIfoQ.jpeg"
                                width="48" height="48" />
                            </div>
                          </a></div>
                        <div class="fg ak r">
                          <div class="n">
                            <div style="flex:1"><span class="by b bz ca cb cc r ar q">
                                <div class="fh n o fi"><span class="by fj fk ca ax fl fm au av aw ar"><a
                                      class="bi bj bk bl bm bn bo bp bq br fn bu bv bw bx" rel="noopener"
                                      href="/web/20191216120206/https://medium.com/@ly.lee?source=post_page-----9fc805e16ed7----------------------">Lup
                                      Yuen Lee 李立源</a></span>
                                  <div class="fo r bh h"><button
                                      class="fp ar q cn fq fr fs ft br bw fu fv fw fx fy fz cq by b bz ga gb cc cr cs ct cu cv bu">Follow</button>
                                  </div>
                                </div>
                              </span></div>
                          </div><span class="by b bz ca cb cc r cd ce"><span class="by fj fk ca ax fl fm au av aw cd">
                              <div><a class="bi bj bk bl bm bn bo bp bq br fn bu bv bw bx" rel="noopener"
                                  href="/web/20191216120206/https://medium.com/@ly.lee/stm32-blue-pill-analyse-and-optimise-your-ram-and-rom-9fc805e16ed7?source=post_page-----9fc805e16ed7----------------------">Jan
                                  24</a> <!-- -->·
                                <!-- -->
                                <!-- -->15
                                <!-- --> min read<span style="padding-left:4px"><svg class="star-15px_svg__svgIcon-use"
                                    width="15" height="15" viewbox="0 0 15 15" style="margin-top:-2px">
                                    <path
                                      d="M7.44 2.32c.03-.1.09-.1.12 0l1.2 3.53a.29.29 0 0 0 .26.2h3.88c.11 0 .13.04.04.1L9.8 8.33a.27.27 0 0 0-.1.29l1.2 3.53c.03.1-.01.13-.1.07l-3.14-2.18a.3.3 0 0 0-.32 0L4.2 12.22c-.1.06-.14.03-.1-.07l1.2-3.53a.27.27 0 0 0-.1-.3L2.06 6.16c-.1-.06-.07-.12.03-.12h3.89a.29.29 0 0 0 .26-.19l1.2-3.52z">
                                    </path>
                                  </svg></span>
                              </div>
                            </span></span>
                        </div>
                      </div>
                      <div class="n gc gd ge gf gg gh gi gj ab">
                        <div class="n o">
                          <div class="gk r bh"><a
                              href="//web.archive.org/web/20191216120206/https://medium.com/p/9fc805e16ed7/share/twitter?source=post_actions_header---------------------------"
                              class="bi bj bk bl bm bn bo bp bq br bs bt bu bv bw bx" target="_blank"
                              rel="noopener"><svg width="29" height="29" class="q">
                                <path
                                  d="M22.05 7.54a4.47 4.47 0 0 0-3.3-1.46 4.53 4.53 0 0 0-4.53 4.53c0 .35.04.7.08 1.05A12.9 12.9 0 0 1 5 6.89a5.1 5.1 0 0 0-.65 2.26c.03 1.6.83 2.99 2.02 3.79a4.3 4.3 0 0 1-2.02-.57v.08a4.55 4.55 0 0 0 3.63 4.44c-.4.08-.8.13-1.21.16l-.81-.08a4.54 4.54 0 0 0 4.2 3.15 9.56 9.56 0 0 1-5.66 1.94l-1.05-.08c2 1.27 4.38 2.02 6.94 2.02 8.3 0 12.86-6.9 12.84-12.85.02-.24 0-.43 0-.65a8.68 8.68 0 0 0 2.26-2.34c-.82.38-1.7.62-2.6.72a4.37 4.37 0 0 0 1.95-2.51c-.84.53-1.81.9-2.83 1.13z">
                                </path>
                              </svg></a></div>
                          <div class="gk r bh"><a
                              href="//web.archive.org/web/20191216120206/https://medium.com/p/9fc805e16ed7/share/facebook?source=post_actions_header---------------------------"
                              class="bi bj bk bl bm bn bo bp bq br bs bt bu bv bw bx" target="_blank"
                              rel="noopener"><svg width="29" height="29" class="q">
                                <path
                                  d="M23.2 5H5.8a.8.8 0 0 0-.8.8V23.2c0 .44.35.8.8.8h9.3v-7.13h-2.38V13.9h2.38v-2.38c0-2.45 1.55-3.66 3.74-3.66 1.05 0 1.95.08 2.2.11v2.57h-1.5c-1.2 0-1.48.57-1.48 1.4v1.96h2.97l-.6 2.97h-2.37l.05 7.12h5.1a.8.8 0 0 0 .79-.8V5.8a.8.8 0 0 0-.8-.79">
                                </path>
                              </svg></a></div>
                          <div class="gl r ao">
                            <div>
                              <div class="cu" role="tooltip" aria-hidden="true"><a
                                  href="https://web.archive.org/web/20191216120206/https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Fstm32-blue-pill-analyse-and-optimise-your-ram-and-rom-9fc805e16ed7&amp;source=post_actions_header--------------------------bookmark_sidebar-"
                                  class="bi bj bk bl bm bn bo bp bq br bs bt bu bv bw bx" rel="noopener"><svg width="25"
                                    height="25" viewbox="0 0 25 25">
                                    <path
                                      d="M19 6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14.66h.01c.01.1.05.2.12.28a.5.5 0 0 0 .7.03l5.67-4.12 5.66 4.13a.5.5 0 0 0 .71-.03.5.5 0 0 0 .12-.29H19V6zm-6.84 9.97L7 19.64V6a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v13.64l-5.16-3.67a.49.49 0 0 0-.68 0z"
                                      fill-rule="evenodd"></path>
                                  </svg></a></div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <p id="4a8c" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Someday our Blue Pill development
                  tools will get so smart… And automatically flag out seemingly innocuous changes we made (like adding
                  <code class="ea ha hb hc hd b">sprintf()</code>) that caused our Blue Pill program to bloat beyond
                  Blue Pill’s built-in 64 KB of ROM and 20 KB of RAM.</p>
                <p id="73cc" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">But until that day comes, we have
                  to stay vigilant. And learn the tips and tools in this article to prevent Blue Pill Bloat…</p>
                <ol class="">
                  <li id="29ca" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz he hf hg">We’ll create a sample
                    Blue Pill program with <strong class="go hh">Visual Studio Code and PlatformIO</strong></li>
                  <li id="bad5" class="gm gn ar bz go b gp hi gr hj gt hk gv hl gx hm gz he hf hg">Study the <strong
                      class="go hh">Linker Script</strong> that was used to create the Blue Pill executable, and the
                    <strong class="go hh">Memory Layout</strong> that it enforces</li>
                  <li id="9ece" class="gm gn ar bz go b gp hi gr hj gt hk gv hl gx hm gz he hf hg">Learn what’s inside
                    the <strong class="go hh">Text, Data and BSS Sections </strong>of a Blue Pill executable</li>
                  <li id="4990" class="gm gn ar bz go b gp hi gr hj gt hk gv hl gx hm gz he hf hg">Understand how the
                    <strong class="go hh">Stack and Heap</strong> are organised</li>
                  <li id="10fd" class="gm gn ar bz go b gp hi gr hj gt hk gv hl gx hm gz he hf hg">Analyse RAM and ROM
                    usage with <strong class="go hh">Google Sheets and the Linker Map</strong></li>
                  <li id="bce3" class="gm gn ar bz go b gp hi gr hj gt hk gv hl gx hm gz he hf hg">Peek at the <strong
                      class="go hh">Assembly Code</strong> generated by the compiler, as well as the <strong
                      class="go hh">Vector Map</strong> and <code
                      class="ea ha hb hc hd b"><strong class="go hh">reset_handler()</strong></code> used during Blue
                    Pill startup</li>
                  <li id="79a7" class="gm gn ar bz go b gp hi gr hj gt hk gv hl gx hm gz he hf hg">Lastly, some tips I
                    have learnt from <strong class="go hh">optimising a huge Blue Pill program</strong></li>
                </ol>
                <p id="ffd9" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">So if you’re giving up on Blue
                  Pill because you thought 64 KB of ROM and 20 KB of RAM can’t do much… this article will amaze you!</p>
                <blockquote class="hn ho hp">
                  <p id="3501" class="gm gn ar hq go b gp gq gr gs gt gu gv gw gx gy gz"><em class="bz">💎</em> When you
                    see sections marked by a diamond… If you’re new to STM32 Blue Pill programming, skip these sections
                    because they will be hard to understand. In these sections I’ll explain some advanced Blue Pill
                    features that we’ll be seeing in future articles, as we stack up more functions and optimise them.
                  </p>
                </blockquote>
              </div>
            </div>
          </section>
          <hr class="hr fj hs ht hu hv hw hx hy hz ia" />
          <section class="dj dk dl dm dn">
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <h1 id="6a72" class="ib ic ar bz by id ie if ig ih ii ij ik il im in io">Create A Sample Blue Pill
                  Program</h1>
                <p id="4214" class="gm gn ar bz go b gp ip gr iq gt ir gv is gx it gz">We’ll use <a
                    href="https://code.visualstudio.com/"
                    class="bi cv iu iv iw ix" target="_blank" rel="noopener nofollow">Visual Studio Code</a> and the
                  PlatformIO Extension to create a simple LED blink program for analysing the RAM and ROM usage.</p>
                <p id="8b5e" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Follow the steps in the video
                  below to install the PlatformIO Extension and create the sample program. Please copy the updated
                  content from <a
                    href="https://github.com/lupyuen/stm32bluepill-blink"
                    class="bi cv iu iv iw ix" target="_blank" rel="noopener nofollow">my GitHub repository</a> for the
                  following files:</p>
                <p id="8bf9" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz"><strong
                    class="go hh">platformio.ini</strong>: <code
                    class="ea ha hb hc hd b"><a href="https://github.com/lupyuen/stm32bluepill-blink/blob/master/platformio.ini" class="bi cv iu iv iw ix" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-blink/blob/master/platformio.ini</a></code>
                </p>
                <p id="ab62" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz"><strong
                    class="go hh">main.c</strong>: <code
                    class="ea ha hb hc hd b"><a href="https://github.com/lupyuen/stm32bluepill-blink/blob/master/src/main.c" class="bi cv iu iv iw ix" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-blink/blob/master/src/main.c</a></code>
                </p>
                <p id="cf1e" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">If you don’t have a Blue Pill and
                  ST Link, you may skip the <strong class="go hh">Build</strong> and <strong
                    class="go hh">Upload</strong> steps in the video. This article doesn’t require a Blue Pill to run
                  the demos. Click “CC” to view the instructions in the video…</p>
              </div>
            </div>
            <div class="do ak">
              <figure class="iy iz ja jb jc do">
                <div class="dz r ds">
                  <div class="jd r"><iframe
                      src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FcmHQxd_qGl8%3Ffeature%3Doembed&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DcmHQxd_qGl8&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2FcmHQxd_qGl8%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube"
                      allowfullscreen="" frameborder="0" height="480" width="640"
                      title="Installing PlatformIO and creating a sample program for STM32 Blue Pill"
                      class="de t u dw ak" scrolling="auto"></iframe></div>
                </div>
              </figure>
            </div>
          </section>
          <hr class="hr fj hs ht hu hv hw hx hy hz ia" />
          <section class="dj dk dl dm dn">
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <h1 id="0210" class="ib ic ar bz by id ie if ig ih ii ij ik il im in io">Blue Pill Project Build</h1>
                <p id="1686" class="gm gn ar bz go b gp ip gr iq gt ir gv is gx it gz">What happens when you click the
                  <strong class="go hh">Build</strong> button to build a Blue Pill executable?</p>
                <p id="edab" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">1️⃣ The C compiler <code
                    class="ea ha hb hc hd b">arm-none-eabi-gcc</code> compiles <code
                    class="ea ha hb hc hd b">main.c</code> into <code class="ea ha hb hc hd b">main.o</code></p>
                <p id="587d" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">2️⃣ The Linker <code
                    class="ea ha hb hc hd b">arm-none-eabi-ld</code> links main.o with some code libraries (Standard C
                  Library, Math Library, libopencm3) to resolve the functions called by <code
                    class="ea ha hb hc hd b">main.o</code></p>
                <p id="8b1d" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">3️⃣ The Linker generates the Blue
                  Pill executable <code class="ea ha hb hc hd b">firmware.elf</code> and the Blue Pill ROM image <code
                    class="ea ha hb hc hd b">firmware.bin</code>, ready to be flashed into the Blue Pill</p>
                <p id="df17" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">For our simple blink demo, the
                  Linker generates a tiny Blue Pill executable file (744 bytes of ROM, 8 bytes of RAM)…</p>
                <pre
                  class="iy iz ja jb jc je jf jg"><span id="2316" class="jh ic ar bz hd b fk ji jj r jk">Linking .pioenvs/bluepill_f103c8/firmware.elf<br/>Memory region         Used Size  Region Size  %age Used<br/><strong class="hd hh">rom</strong>:                   <strong class="hd hh">744</strong> B        <strong class="hd hh">64</strong> KB      1.14%<br/><strong class="hd hh">ram</strong>:                     <strong class="hd hh">8</strong> B        <strong class="hd hh">20</strong> KB      0.04%</span></pre>
                <p id="2e90" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">How does the Linker know what to
                  put into RAM and ROM? It uses a <strong class="go hh">Linker Script</strong> that contains a list of
                  rules about what functions and variables to put into RAM or ROM. Let’s look at the Linker Script…</p>
              </div>
            </div>
          </section>
          <hr class="hr fj hs ht hu hv hw hx hy hz ia" />
          <section class="dj dk dl dm dn">
            <div class="do ak">
              <figure class="iy iz ja jb jc do ak paragraph-image">
                                
                <p><img src="https://lupyuen.github.io/images/legacy2/n2.png" /></p>


                <div class="dq dr ds dt ak">
                  <div class="dz r ds ea">
                    <div class="jl r">
                      <div class="du dv de t u dw ak ax dx dy"><img class="de t u dw ak ec ed ee"
                          src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/60/1*zZ6x5ANl91EJ98jl-Pr2NQ.png?q=20"
                          width="11378" height="3268" role="presentation" /></div><img class="du dv de t u dw ak ef"
                        width="11378" height="3268" role="presentation" /><noscript><img class="de t u dw ak"
                          src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/22756/1*zZ6x5ANl91EJ98jl-Pr2NQ.png"
                          width="11378" height="3268" role="presentation" /></noscript>
                    </div>
                  </div>
                </div>
                <figcaption class="cd fk jm jn hv dc da db jo jp by fj">Blue Pill Memory Layout</figcaption>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <h1 id="0e2d" class="ib ic ar bz by id ie jq ig jr ii js ik jt im ju io">Linker Script</h1>
                <p id="a01f" class="gm gn ar bz go b gp ip gr iq gt ir gv is gx it gz">To understand the above memory
                  layout, let’s look at the Linker Script that was used to generate the Blue Pill executable. Open the
                  following file in Visual Studio Code…</p>
                <p id="6714" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz"><strong class="go hh">For
                    Windows</strong>: <code
                    class="ea ha hb hc hd b">%userprofile%\.platformio\packages\framework-libopencm3\lib\stm32\f1\stm32f103x8.ld</code>
                </p>
                <p id="301d" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz"><strong class="go hh">For Mac and
                    Linux</strong>: <code
                    class="ea ha hb hc hd b">~/.platformio/packages/framework-libopencm3/lib/stm32/f1/stm32f103x8.ld</code>
                </p>
                <p id="fb8a" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Or open the web version of the
                  Linker Script (split into 2 files):</p>
                <p id="5c5f" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz"><code
                    class="ea ha hb hc hd b"><a href="https://github.com/libopencm3/libopencm3/blob/master/lib/stm32/f1/stm32f103x8.ld" class="bi cv iu iv iw ix" target="_blank" rel="noopener nofollow">https://github.com/libopencm3/libopencm3/blob/master/lib/stm32/f1/stm32f103x8.ld</a></code>
                </p>
                <p id="52b3" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz"><code
                    class="ea ha hb hc hd b"><a href="https://github.com/libopencm3/libopencm3/blob/master/lib/cortex-m-generic.ld" class="bi cv iu iv iw ix" target="_blank" rel="noopener nofollow">https://github.com/libopencm3/libopencm3/blob/master/lib/cortex-m-generic.ld</a></code>
                </p>
                <pre
                  class="iy iz ja jb jc je jf jg"><span id="d463" class="jh ic ar bz hd b fk ji jj r jk">MEMORY  /* Define memory regions. */<br/>{<br/>  <strong class="hd hh">rom</strong> (rx)  : ORIGIN = <strong class="hd hh">0x08000000</strong>, LENGTH = <strong class="hd hh">64K</strong><br/>  <strong class="hd hh">ram</strong> (rwx) : ORIGIN = <strong class="hd hh">0x20000000</strong>, LENGTH = <strong class="hd hh">20K</strong><br/>}</span></pre>
                <p id="f249" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">This defines the overall memory
                  layout for Blue Pill: 64 KB ROM starting at address <code class="ea ha hb hc hd b">0x0800 0000</code>,
                  20 KB RAM starting at <code class="ea ha hb hc hd b">0x2000 0000</code>. So all addresses on the Blue
                  Pill look like <code class="ea ha hb hc hd b">0x08…</code> or <code
                    class="ea ha hb hc hd b">0x20…</code></p>
                <p id="adaa" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Each Memory Region (RAM, ROM)
                  consists of multiple Sections, which are defined as follows…</p>
                <pre
                  class="iy iz ja jb jc je jf jg"><span id="ea92" class="jh ic ar bz hd b fk ji jj r jk">SECTIONS  /*  Define sections.  */<br/>{<br/>  .<strong class="hd hh">text</strong> : {<br/>    ...      /*  <strong class="hd hh">Vector table</strong>    */<br/>    ...      /*  <strong class="hd hh">Program code</strong>    */<br/>    ...      /*  <strong class="hd hh">Read-only data</strong>  */<br/>  } &gt;<strong class="hd hh">rom</strong></span><span id="8ec6" class="jh ic ar bz hd b fk jv jw jx jy jz jj r jk">  .<strong class="hd hh">data</strong> : {  /*  Read-write initialised data      */<br/>    ...<br/>  } &gt;<strong class="hd hh">ram</strong> AT &gt;<strong class="hd hh">rom</strong></span><span id="e65b" class="jh ic ar bz hd b fk jv jw jx jy jz jj r jk">  .<strong class="hd hh">bss</strong> : {   /*  Read-write zero initialised data  */<br/>    ...<br/>  } &gt;<strong class="hd hh">ram</strong></span></pre>
                <h1 id="5e09" class="ib ic ar bz by id ie jq ig jr ii js ik jt im ju io">Text Section</h1>
                <figure class="iy iz ja jb jc do da db paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/n3.png" /></p>

                  <div class="dq dr ds dt ak">
                    <div class="da db ka">
                      <div class="dz r ds ea">
                        <div class="kb r">
                          <div class="du dv de t u dw ak ax dx dy"><img class="de t u dw ak ec ed ee"
                              src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/60/1*uP8-cYDUC9muFv5OK6ck3Q.png?q=20"
                              width="6734" height="3268" role="presentation" /></div><img class="du dv de t u dw ak ef"
                            width="6734" height="3268" role="presentation" /><noscript><img class="de t u dw ak"
                              src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/13468/1*uP8-cYDUC9muFv5OK6ck3Q.png"
                              width="6734" height="3268" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                  <figcaption class="cd fk jm jn hv dc da db jo jp by fj">Blue Pill ROM, containing the Text Section and
                    the Data Section</figcaption>
                </figure>
                <p id="627d" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">The <strong class="go hh">Text
                    Section</strong> is stored in ROM (read only) and contains:</p>
                <ol class="">
                  <li id="d1ba" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz he hf hg"><strong
                      class="go hh">Vector Table: </strong>Defines the program start address and the interrupt routines,
                    to be explained in a while</li>
                  <li id="c3f6" class="gm gn ar bz go b gp hi gr hj gt hk gv hl gx hm gz he hf hg"><strong
                      class="go hh">Executable Program Code: </strong>The compiled machine code for each function</li>
                  <li id="0e8e" class="gm gn ar bz go b gp hi gr hj gt hk gv hl gx hm gz he hf hg"><strong
                      class="go hh">Read-Only Data: </strong>Constant strings and other constant data that cannot be
                    changed</li>
                </ol>
                <h1 id="1f09" class="ib ic ar bz by id ie jq ig jr ii js ik jt im ju io">Data and BSS Sections</h1>
                <figure class="iy iz ja jb jc do da db paragraph-image">  

                  
                  <p><img src="https://lupyuen.github.io/images/legacy2/n4.png" /></p>
    
                  <div class="dq dr ds dt ak">
                    <div class="da db kc">
                      <div class="dz r ds ea">
                        <div class="kd r">
                          <div class="du dv de t u dw ak ax dx dy"><img class="de t u dw ak ec ed ee"
                              src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/60/1*ak8ZheQTXliNBL4wrLpTUw.png?q=20"
                              width="4654" height="3268" role="presentation" /></div><img class="du dv de t u dw ak ef"
                            width="4654" height="3268" role="presentation" /><noscript><img class="de t u dw ak"
                              src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/9308/1*ak8ZheQTXliNBL4wrLpTUw.png"
                              width="4654" height="3268" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                  <figcaption class="cd fk jm jn hv dc da db jo jp by fj">Blue Pill RAM, containing the Data Section,
                    BSS Section, Heap and Stack</figcaption>
                </figure>
                <p id="4cd0" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Global Variables in the Blue Pill
                  program will be allocated in the <strong class="go hh">Data Section</strong> or <strong
                    class="go hh">BSS Section </strong>(both are in RAM). What’s the difference?</p>
                <pre
                  class="iy iz ja jb jc je jf jg"><span id="e503" class="jh ic ar bz hd b fk ji jj r jk">int bss_var;         //  Will be allocated in BSS Section (RAM). <br/>int data_var = 123;  //  Will be allocated in Data Section (RAM and ROM).</span></pre>
                <p id="818a" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Let’s say we have the above two
                  global variables defined. The first variable <code
                    class="ea ha hb hc hd b"><strong class="go hh">bss_var</strong></code> is automatically initialised
                  to 0 (or <code class="ea ha hb hc hd b">NULL</code> for pointers) according to the C specification.
                  <strong class="go hh">Global variables initialised to 0 or </strong><code
                    class="ea ha hb hc hd b"><strong class="go hh">NULL</strong></code><strong class="go hh"> are
                    allocated in the BSS Section</strong>. (We’ll see later that the initialisation is done in <code
                    class="ea ha hb hc hd b">reset_handler()</code>.)</p>
                <p id="dd7a" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">As for <code
                    class="ea ha hb hc hd b"><strong class="go hh">data_var</strong></code>, it has an initial non-zero
                  value, <code class="ea ha hb hc hd b">123</code>. <code
                    class="ea ha hb hc hd b"><strong class="go hh">data_var</strong></code> will have 2 copies in
                  memory:</p>
                <ol class="">
                  <li id="88ce" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz he hf hg">One read-only copy in
                    the <strong class="go hh">ROM</strong>, within the<strong class="go hh"> Data Section</strong>, that
                    remembers the initial value <code class="ea ha hb hc hd b">123</code> permanently, across restarts.
                  </li>
                  <li id="0020" class="gm gn ar bz go b gp hi gr hj gt hk gv hl gx hm gz he hf hg">Another read-write
                    copy in <strong class="go hh">RAM</strong>, within the <strong class="go hh">Data Section</strong>,
                    that is set to <code class="ea ha hb hc hd b">123</code> upon startup. But as the program runs, the
                    value may change.</li>
                </ol>
                <p id="31d8" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">That’s why we see two copies of
                  Data Section in the Memory Layout (think of it as a Reference Copy vs a Working Copy). Also we see
                  this peculiar rule in the Linker Script…</p>
                <pre
                  class="iy iz ja jb jc je jf jg"><span id="aaeb" class="jh ic ar bz hd b fk ji jj r jk">.<strong class="hd hh">data</strong> : {  /*  Read-write initialised data      */<br/>    ...<br/>  } &gt;<strong class="hd hh">ram</strong> AT &gt;<strong class="hd hh">rom</strong></span></pre>
                <p id="a86c" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">The directive <code
                    class="ea ha hb hc hd b">&gt;ram AT &gt;rom</code> simply means “allocate in RAM and in ROM”. If
                  you’re wondering why it’s called BSS… <a
                    href="https://en.wikipedia.org/wiki/.bss"
                    class="bi cv iu iv iw ix" target="_blank" rel="noopener nofollow">here’s the story</a>.</p>
                <h1 id="ce00" class="ib ic ar bz by id ie jq ig jr ii js ik jt im ju io">Stack</h1>
                <pre
                  class="iy iz ja jb jc je jf jg"><span id="6af7" class="jh ic ar bz hd b fk ji jj r jk">PROVIDE(<br/>    <strong class="hd hh">_stack</strong> = <strong class="hd hh">ORIGIN</strong>(ram) + <strong class="hd hh">LENGTH</strong>(ram)<br/>);</span></pre>
                <figure class="iy iz ja jb jc do ef kf cs kg kh ki kj kk bp kl km kn ko kp kq paragraph-image">
                  
                  <p><img src="https://lupyuen.github.io/images/legacy2/n5.png" /></p>
    

                  <div class="dq dr ds dt ak">
                    <div class="da db ke">
                      <div class="dz r ds ea">
                        <div class="kr r">
                          <div class="du dv de t u dw ak ax dx dy"><img class="de t u dw ak ec ed ee"
                              src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/60/1*VKO8I09cGPX_A7t-4vKi_A.png?q=20"
                              width="2833" height="1985" role="presentation" /></div><img class="du dv de t u dw ak ef"
                            width="2833" height="1985" role="presentation" /><noscript><img class="de t u dw ak"
                              src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/5666/1*VKO8I09cGPX_A7t-4vKi_A.png"
                              width="2833" height="1985" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <p id="d850" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">The <strong
                    class="go hh">Stack</strong> keeps track of the local variables within each function call. It starts
                  at the <strong class="go hh">top of RAM (</strong><code
                    class="ea ha hb hc hd b"><strong class="go hh">0x2000 4FFF</strong></code><strong class="go hh">)
                    and grows downwards</strong>. So for this program…</p>
                <pre
                  class="iy iz ja jb jc je jf jg"><span id="faeb" class="jh ic ar bz hd b fk ji jj r jk">void gpio_setup(void) { ... }</span><span id="3b92" class="jh ic ar bz hd b fk jv jw jx jy jz jj r jk">int main(void) {<br/>    int stack_var = bss_var++ + data_var++;<br/>    gpio_setup();<br/>    ...</span></pre>
                <p id="f36b" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">We will see in the Stack (from
                  high address to low address)…</p>
                <ol class="">
                  <li id="9d7a" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz he hf hg">One Stack Frame for
                    <code class="ea ha hb hc hd b"><strong class="go hh">main()</strong></code>. It contains the value
                    of <code class="ea ha hb hc hd b"><strong class="go hh">stack_var</strong></code>.</li>
                  <li id="4363" class="gm gn ar bz go b gp hi gr hj gt hk gv hl gx hm gz he hf hg">One Stack Frame
                    for<strong class="go hh"> </strong><code
                      class="ea ha hb hc hd b"><strong class="go hh">gpio_setup()</strong></code>. It contains the
                    values of the local variables in <code class="ea ha hb hc hd b">gpio_setup()</code>.</li>
                  <li id="bdd8" class="gm gn ar bz go b gp hi gr hj gt hk gv hl gx hm gz he hf hg">Plus Stack Frames for
                    other functions called by <code class="ea ha hb hc hd b">gpio_setup()</code>.</li>
                </ol>
                <p id="e0b5" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">What happens when the Stack hits
                  the BSS Section? That’s when our program crashes with an “Out Of Stack Space” error. We should never
                  allow this to happen — be careful with recursive functions.</p>
                <h1 id="6e51" class="ib ic ar bz by id ie jq ig jr ii js ik jt im ju io"><strong
                    class="bo">Heap</strong></h1>
                <p id="1979" class="gm gn ar bz go b gp ip gr iq gt ir gv is gx it gz">If we use <code
                    class="ea ha hb hc hd b"><strong class="go hh">new</strong></code><strong class="go hh"> in C++ and
                  </strong><code class="ea ha hb hc hd b"><strong class="go hh">malloc()</strong></code><strong
                    class="go hh"> in C</strong>, the dynamic memory storage will be allocated from the <strong
                    class="go hh">Heap. </strong>The Heap lies between the BSS Section and the Stack. Yes it’s a tight
                  squeeze in 20 KB of shared RAM and might cause problems with the Stack. That’s why I avoid using the
                  Heap wherever possible.</p>
                <blockquote class="hn ho hp">
                  <p id="a95e" class="gm gn ar hq go b gp gq gr gs gt gu gv gw gx gy gz"><em class="bz">💎</em> Can we
                    create additional Memory Regions and Sections? Yes we can! I created custom Memory Regions <code
                      class="ea ha hb hc hd b">bootrom</code> and <code class="ea ha hb hc hd b">bootram</code>, each
                    with its own Sections, in this Linker Script (this allows me to partition the Blue Pill RAM and ROM
                    for the Bootloader and for the Application): <code
                      class="ea ha hb hc hd b"><a href="https://github.com/lupyuen/codal-libopencm3/blob/master/ld/stm32f103x8.ld" class="bi cv iu iv iw ix" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/codal-libopencm3/blob/master/ld/stm32f103x8.ld</a></code>
                  </p>
                </blockquote>
              </div>
            </div>
          </section>
          <hr class="hr fj hs ht hu hv hw hx hy hz ia" />
          <section class="dj dk dl dm dn">
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <h1 id="d3f7" class="ib ic ar bz by id ie if ig ih ii ij ik il im in io">Linker Map</h1>
                <p id="c185" class="gm gn ar bz go b gp ip gr iq gt ir gv is gx it gz">Now that we understand how RAM
                  and ROM are used in Blue Pill, let’s learn to analyse the memory usage of a simple program — our blink
                  demo.</p>
                <p id="e7e1" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">After building the project, open
                  the <code class="ea ha hb hc hd b"><strong class="go hh">firmware.map</strong></code> file located at
                  the top folder of the project. Or <a
                    href="https://github.com/lupyuen/stm32bluepill-blink/blob/master/firmware.map"
                    class="bi cv iu iv iw ix" target="_blank" rel="noopener nofollow">browse the web version</a>.</p>
                <p id="7b2c" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz"><code
                    class="ea ha hb hc hd b">firmware.map</code> is the <strong class="go hh">Linker Map</strong> that
                  tells us all the RAM and ROM allocated for the functions and variables in our program. So if we run
                  out of RAM or ROM, the Linker Map <code class="ea ha hb hc hd b">firmware.map</code> is the right file
                  to check. It was created when we specified this Linker Command-Line Option in <code
                    class="ea ha hb hc hd b">platformio.ini</code>: <code
                    class="ea ha hb hc hd b">-Wl,-Map,firmware.map</code></p>
                <p id="6e07" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz"><code
                    class="ea ha hb hc hd b">firmware.map</code> is very dense with lots of numbers. Later we’ll use
                  Google Sheets to analyse the Linker Map. But meanwhile have a look at this to understand how the
                  Linker Map is structured (skip to line 90 in <code class="ea ha hb hc hd b">firmware.map</code>)…</p>
              </div>
            </div>
            <div class="do ak">
              <figure class="iy iz ja jb jc do ak paragraph-image">
                  
                <p><img src="https://lupyuen.github.io/images/legacy2/n6.png" /></p>
  

                <div class="dz r ds ea">
                  <div class="ks r">
                    <div class="du dv de t u dw ak ax dx dy"><img class="de t u dw ak ec ed ee"
                        src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/60/1*7pOPNjiW-3uxp_QpRcjlEw.png?q=20"
                        width="1046" height="674" role="presentation" /></div><img class="du dv de t u dw ak ef"
                      width="1046" height="674" role="presentation" /><noscript><img class="de t u dw ak"
                        src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/2092/1*7pOPNjiW-3uxp_QpRcjlEw.png"
                        width="1046" height="674" role="presentation" /></noscript>
                  </div>
                </div>
                <figcaption class="cd fk jm jn hv dc da db jo jp by fj">Quick peek at the Linker Map firmware.map
                </figcaption>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <p id="7585" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Remember the variables <code
                    class="ea ha hb hc hd b">bss_var, data_var, stack_var</code> in <code
                    class="ea ha hb hc hd b">main.c</code>?</p>
                <p id="8427" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Let’s use the Linker Map to
                  verify that <code class="ea ha hb hc hd b">bss_var</code> is indeed allocated in the BSS Section and
                  <code class="ea ha hb hc hd b">data_var</code> is allocated in the Data Section. And <code
                    class="ea ha hb hc hd b">stack_var</code> should not appear in the Linker Map because it’s allocated
                  on the Stack only when the <code class="ea ha hb hc hd b">main()</code> function executes…</p>
              </div>
            </div>
            <div class="do ak">
              <figure class="iy iz ja jb jc do ak paragraph-image">
                  
                <p><img src="https://lupyuen.github.io/images/legacy2/n7.png" /></p>
  

                <div class="dz r ds ea">
                  <div class="kt r">
                    <div class="du dv de t u dw ak ax dx dy"><img class="de t u dw ak ec ed ee"
                        src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/60/1*FV14ibSTojC5sS6XONntxA.png?q=20"
                        width="1782" height="1104" role="presentation" /></div><img class="du dv de t u dw ak ef"
                      width="1782" height="1104" role="presentation" /><noscript><img class="de t u dw ak"
                        src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/3564/1*FV14ibSTojC5sS6XONntxA.png"
                        width="1782" height="1104" role="presentation" /></noscript>
                  </div>
                </div>
                <figcaption class="cd fk jm jn hv dc da db jo jp by fj">Verify that data_var and bss_var are allocated
                  in the Data / BSS Sections according to the Linker Map firmware.map</figcaption>
              </figure>
            </div>
          </section>
          <hr class="hr fj hs ht hu hv hw hx hy hz ia" />
          <section class="dj dk dl dm dn">
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <h1 id="4a1d" class="ib ic ar bz by id ie if ig ih ii ij ik il im in io">Disassemble the Blue Pill
                  Executable</h1>
                <p id="4c97" class="gm gn ar bz go b gp ip gr iq gt ir gv is gx it gz">We’ll get back to the Linker Map
                  in a while. There are times when you’ll have to account for every single byte of code or data in your
                  program. Like when you’re investigating why a function takes up so much code or data. For such
                  situations, inspecting the <strong class="go hh">Assembly Code</strong> generated by the Blue Pill
                  compiler may be helpful.</p>
                <p id="886f" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Let’s set up a Task in Visual
                  Studio Code to dump (or disassemble) the Assembly Code into <code
                    class="ea ha hb hc hd b">firmware.dump</code>…</p>
                <ol class="">
                  <li id="fd50" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz he hf hg">Click <code
                      class="ea ha hb hc hd b">Terminal → Configure Tasks</code></li>
                  <li id="8956" class="gm gn ar bz go b gp hi gr hj gt hk gv hl gx hm gz he hf hg">In <code
                      class="ea ha hb hc hd b">tasks.json</code> file that appears, replace the contents by the contents
                    of this file: <code
                      class="ea ha hb hc hd b"><a href="https://github.com/lupyuen/stm32bluepill-blink/blob/master/.vscode/tasks.json" class="bi cv iu iv iw ix" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-blink/blob/master/.vscode/tasks.json</a></code>
                  </li>
                  <li id="356b" class="gm gn ar bz go b gp hi gr hj gt hk gv hl gx hm gz he hf hg">Click <code
                      class="ea ha hb hc hd b">Terminal → Run Task → 🔎 Disassemble STM32 Blue Pill</code></li>
                </ol>
                <p id="49dc" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">This generates a <code
                    class="ea ha hb hc hd b">firmware.dump</code> file from the <code
                    class="ea ha hb hc hd b">firmware.elf</code> executable that was created by the PlatformIO build
                  step. In case you’re curious, the command looks like this…</p>
                <pre
                  class="iy iz ja jb jc je jf jg"><span id="385a" class="jh ic ar bz hd b fk ji jj r jk">~/.platformio/packages/toolchain-gccarmnoneeabi/bin/arm-none-eabi-objdump --wide --syms --source --line-numbers .pioenvs/bluepill_f103c8/firmware.elf &gt;firmware.dump</span></pre>
                <p id="0ce8" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">To see the Assembly Code, open
                  the <code class="ea ha hb hc hd b">firmware.dump</code> file located at the top folder of your
                  project. Or open the web copy: <code
                    class="ea ha hb hc hd b"><a href="https://github.com/lupyuen/stm32bluepill-blink/blob/master/firmware.dump" class="bi cv iu iv iw ix" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-blink/blob/master/firmware.dump</a></code>
                </p>
              </div>
            </div>
            <div class="do ak">
              <figure class="iy iz ja jb jc do ak paragraph-image">
                  
                <p><img src="https://lupyuen.github.io/images/legacy2/n8.png" /></p>
  

                <div class="dq dr ds dt ak">
                  <div class="dz r ds ea">
                    <div class="ku r">
                      <div class="du dv de t u dw ak ax dx dy"><img class="de t u dw ak ec ed ee"
                          src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/60/1*a4Jh5J7oXBHg5_GL7V7b5g.png?q=20"
                          width="1560" height="852" role="presentation" /></div><img class="du dv de t u dw ak ef"
                        width="1560" height="852" role="presentation" /><noscript><img class="de t u dw ak"
                          src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/3120/1*a4Jh5J7oXBHg5_GL7V7b5g.png"
                          width="1560" height="852" role="presentation" /></noscript>
                    </div>
                  </div>
                </div>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <p id="f375" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Here we see every single byte of
                  <strong class="go hh">Machine Code</strong> generated by the C compiler (the green column). To the
                  right is the <strong class="go hh">Assembly Code</strong> that corresponds to the Machine Code. The
                  lines in yellow refer to the <strong class="go hh">C Source Code</strong> that was used to generate
                  the Assembly Code .</p>
                <p id="f289" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Fortunately the Blue Pill uses a
                  RISC-based processor (Arm Cortex-M3) so the Assembly Code is easier to understand: <code
                    class="ea ha hb hc hd b">ldr</code> for Load Register, <code class="ea ha hb hc hd b">str</code> for
                  Store Register, … For details, check out the <a
                    href="https://www.st.com/content/ccc/resource/technical/document/programming_manual/5b/ca/8d/83/56/7f/40/08/CD00228163.pdf/files/CD00228163.pdf/jcr:content/translations/en.CD00228163.pdf"
                    class="bi cv iu iv iw ix" target="_blank" rel="noopener nofollow">STM32 Cortex®-M3 programming
                    manual</a>.</p>
                <p id="48b8" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz"><strong class="go hh">Every Blue
                    Pill program begins execution at the ROM start address </strong><code
                    class="ea ha hb hc hd b"><strong class="go hh">0x0800 0000</strong></code>… but don’t take me word
                  for it, take a peek at <code class="ea ha hb hc hd b">firmware.dump</code> at address <code
                    class="ea ha hb hc hd b">0x0800 0000</code>…</p>
              </div>
            </div>
            <div class="do ak">
              <figure class="iy iz ja jb jc do ak paragraph-image">
                  
                <p><img src="https://lupyuen.github.io/images/legacy2/n9.png" /></p>
  

                <div class="dz r ds ea">
                  <div class="kv r">
                    <div class="du dv de t u dw ak ax dx dy"><img class="de t u dw ak ec ed ee"
                        src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/60/1*6N77NJreDqeIOnfg56VhhQ.png?q=20"
                        width="1648" height="1238" role="presentation" /></div><img class="du dv de t u dw ak ef"
                      width="1648" height="1238" role="presentation" /><noscript><img class="de t u dw ak"
                        src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/3296/1*6N77NJreDqeIOnfg56VhhQ.png"
                        width="1648" height="1238" role="presentation" /></noscript>
                  </div>
                </div>
                <figcaption class="cd fk jm jn hv dc da db jo jp by fj">Disassembly of Blue Pill ROM at 0x0800 0000
                </figcaption>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <p id="e285" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">That doesn’t look like executable
                  Machine Code. But when we group the bytes into 32 bits (4 bytes each), familiar addresses begin to
                  emerge (Hint: Blue Pill addresses all begin with <code class="ea ha hb hc hd b">0x08</code> or <code
                    class="ea ha hb hc hd b">0x20</code>)…</p>
                <pre
                  class="iy iz ja jb jc je jf jg"><span id="afc4" class="jh ic ar bz hd b fk ji jj r jk">8000000: 0x2000 5000  →  start of stack in RAM (grows downwards)</span><span id="2a40" class="jh ic ar bz hd b fk jv jw jx jy jz jj r jk">8000004: 0x0800 0255  →  reset_handler() function in ROM</span><span id="9525" class="jh ic ar bz hd b fk jv jw jx jy jz jj r jk">8000008: 0x0800 0251  →  null_handler() function in ROM</span><span id="d2c7" class="jh ic ar bz hd b fk jv jw jx jy jz jj r jk">800000C: 0x0800 024F  →  blocking_handler() function in ROM</span><span id="bdd2" class="jh ic ar bz hd b fk jv jw jx jy jz jj r jk">8000010: 0x0800 024F  →  blocking_handler() function in ROM</span><span id="d840" class="jh ic ar bz hd b fk jv jw jx jy jz jj r jk">8000014: 0x0800 024F  →  blocking_handler() function in ROM</span></pre>
                <p id="06da" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">If you cross-reference the 32-bit
                  numbers with <code class="ea ha hb hc hd b">firmware.dump</code>, you’ll realise that this block of
                  numbers actually contains important info like…</p>
                <ul class="">
                  <li id="bc6e" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz kw hf hg"><code
                      class="ea ha hb hc hd b">0x2000 5000</code>: Start address of the stack (which grows downwards).
                    It also marks the end of RAM.</li>
                  <li id="1f71" class="gm gn ar bz go b gp hi gr hj gt hk gv hl gx hm gz kw hf hg"><code
                      class="ea ha hb hc hd b">0x0800 0255</code>: Address of the <code
                      class="ea ha hb hc hd b">reset_handler()</code> function, which is the entry point for the program
                    and initialises the global variables.</li>
                  <li id="35db" class="gm gn ar bz go b gp hi gr hj gt hk gv hl gx hm gz kw hf hg"><code
                      class="ea ha hb hc hd b">0x0800 0251</code>: Address of the <code
                      class="ea ha hb hc hd b">null_handler()</code> function. This is an interrupt service routine that
                    does nothing.</li>
                  <li id="829e" class="gm gn ar bz go b gp hi gr hj gt hk gv hl gx hm gz kw hf hg"><code
                      class="ea ha hb hc hd b">0x0800 024F</code>: Address of the <code
                      class="ea ha hb hc hd b">blocking_handler()</code> function. This is an interrupt service routine
                    that loops forever (because the Blue Pill can’t recover from the exception that has occurred).</li>
                </ul>
                <p id="6434" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">This list of addresses at <code
                    class="ea ha hb hc hd b">0x0800 0000</code> is known as the <strong class="go hh">Vector
                    Table</strong>.</p>
              </div>
            </div>
          </section>
          <hr class="hr fj hs ht hu hv hw hx hy hz ia" />
          <section class="dj dk dl dm dn">
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <h1 id="be72" class="ib ic ar bz by id ie if ig ih ii ij ik il im in io">Vector Table</h1>
                <p id="add1" class="gm gn ar bz go b gp ip gr iq gt ir gv is gx it gz"><strong class="go hh">Every Blue
                    Pill program must have a Vector Table at the start of ROM, </strong><code
                    class="ea ha hb hc hd b"><strong class="go hh">0x0800 0000</strong></code>. Because without it, the
                  Blue Pill won’t know <strong class="go hh">where in RAM to allocate the Stack</strong>, and <strong
                    class="go hh">which function to call to execute the program</strong> (i.e. the <code
                    class="ea ha hb hc hd b">reset_handler()</code> function).</p>
                <p id="9ccf" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">The Vector Table structure is
                  defined here…</p>
                <p id="b00a" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz"><strong class="go hh">For
                    Windows</strong>: <code
                    class="ea ha hb hc hd b">%userprofile%\.platformio\packages\framework-libopencm3\lib\stm32\f1\vector_nvic.c</code>
                </p>
                <p id="6f14" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz"><strong class="go hh">For Mac and
                    Linux</strong>: <code
                    class="ea ha hb hc hd b">~/.platformio/packages/framework-libopencm3/lib/stm32/f1/vector_nvic.c</code>
                </p>
                <figure class="iy iz ja jb jc do">
                 
                  <p><script src="https://gist.github.com/lupyuen/414ba9585203cf2392448f06bf5df2c5.js"></script></p>


                  <figcaption class="cd fk jm jn hv dc da db jo jp by fj">Arm Vector Table Definition</figcaption>
                </figure>
                <p id="12cb" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">The Vector Table is defined by
                  Arm (not STM). The Vector Table also includes a complete list of <strong class="go hh">Interrupt
                    Service Routines</strong> that will be called when an interrupt is triggered. For example, <code
                    class="ea ha hb hc hd b">rtc_alarm_isr()</code> is the interrupt service routine that will be called
                  when the Real-Time Clock triggers an Alarm Interrupt on the Blue Pill.</p>
                <p id="e58d" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">What happens when you don’t
                  define any interrupt service routines? libopencm3 will provide one of the following default interrupt
                  service routines for the interrupt, depending on the nature of the interrupt…</p>
                <ul class="">
                  <li id="a731" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz kw hf hg"><code
                      class="ea ha hb hc hd b"><strong class="go hh">null_handler()</strong>:</code>This is an interrupt
                    service routine that does nothing. <code class="ea ha hb hc hd b">null_handler()</code> is the
                    default interrupt service routine for non-critical interrupts, like the Real-Time Clock Alarm
                    Interrupt.</li>
                  <li id="d167" class="gm gn ar bz go b gp hi gr hj gt hk gv hl gx hm gz kw hf hg"><code
                      class="ea ha hb hc hd b"><strong class="go hh">blocking_handler()</strong></code>: This is an
                    interrupt service routine that loops forever and never returns. <code
                      class="ea ha hb hc hd b">blocking_handler()</code> is the default interrupt service routine for
                    critical exceptions that will prevent Blue Pill from operating correctly. Hard Fault is a serious
                    exception that uses the <code class="ea ha hb hc hd b">blocking_handler()</code> by default.</li>
                </ul>
                <figure class="iy iz ja jb jc do">
                
                  <p><script src="https://gist.github.com/lupyuen/29e705123797b69ae2bb32165e53c8b6.js"></script></p>


                  <figcaption class="cd fk jm jn hv dc da db jo jp by fj"><code
                      class="ea ha hb hc hd b">null_handler() and blocking_handler() f</code>rom <a
                      href="https://github.com/libopencm3/libopencm3/blob/master/lib/cm3/vector.c"
                      class="bi cv iu iv iw ix" target="_blank"
                      rel="noopener nofollow">https://github.com/libopencm3/libopencm3/blob/master/lib/cm3/vector.c</a>
                  </figcaption>
                </figure>
              </div>
            </div>
          </section>
          <hr class="hr fj hs ht hu hv hw hx hy hz ia" />
          <section class="dj dk dl dm dn">
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <figure class="iy iz ja jb jc do">
           
                  <p><script src="https://gist.github.com/lupyuen/235dd135317e14ab8c42f892d65a5404.js"></script></p>


                  <figcaption class="cd fk jm jn hv dc da db jo jp by fj"><code
                      class="ea ha hb hc hd b">reset_handler() f</code>rom <a
                      href="https://github.com/libopencm3/libopencm3/blob/master/lib/cm3/vector.c"
                      class="bi cv iu iv iw ix" target="_blank"
                      rel="noopener nofollow">https://github.com/libopencm3/libopencm3/blob/master/lib/cm3/vector.c</a>
                  </figcaption>
                </figure>
                <h1 id="bf1b" class="ib ic ar bz by id ie jq ig jr ii js ik jt im ju io">reset_handler() Function</h1>
                <p id="f399" class="gm gn ar bz go b gp ip gr iq gt ir gv is gx it gz"><code
                    class="ea ha hb hc hd b">reset_handler()</code> is the function that’s executed when the Blue Pill
                  starts up. libopencm3 provides a default <code class="ea ha hb hc hd b">reset_handler()</code>
                  function. According to the code above…</p>
                <ol class="">
                  <li id="ee95" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz he hf hg"><code
                      class="ea ha hb hc hd b"><strong class="go hh">reset_handler()</strong></code><strong
                      class="go hh"> copies the Data Section from ROM to RAM</strong>. The Data Section contains
                    variables that are initialised to non-zero values. (Remember that the Data Section exists in ROM <em
                      class="hq">and</em> RAM?)</li>
                  <li id="2a01" class="gm gn ar bz go b gp hi gr hj gt hk gv hl gx hm gz he hf hg"><code
                      class="ea ha hb hc hd b"><strong class="go hh">reset_handler()</strong></code><strong
                      class="go hh"> initialises variables in the BSS Section to 0 or NULL (for pointers)</strong>.</li>
                  <li id="9457" class="gm gn ar bz go b gp hi gr hj gt hk gv hl gx hm gz he hf hg"><code
                      class="ea ha hb hc hd b"><strong class="go hh">reset_handler()</strong></code><strong
                      class="go hh"> calls our </strong><code
                      class="ea ha hb hc hd b"><strong class="go hh">main()</strong></code><strong class="go hh">
                      function after initialisation. </strong>So all variables in the Data and BSS Sections will be set
                    to their proper initial values when our <code class="ea ha hb hc hd b">main()</code> function runs.
                  </li>
                  <li id="719c" class="gm gn ar bz go b gp hi gr hj gt hk gv hl gx hm gz he hf hg">For C++ programs,
                    <code class="ea ha hb hc hd b">reset_handler()</code> also calls the C++ Constructor Methods to
                    create global C++ objects. It calls the C++ Destructor Methods to destroy global C++ objects when
                    <code class="ea ha hb hc hd b">main()</code> returns. But this rarely happens because for most Blue
                    Pill programs, the <code class="ea ha hb hc hd b">main()</code> function runs forever in a loop
                    handling events.</li>
                </ol>
                <p id="321d" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">So <code
                    class="ea ha hb hc hd b">reset_handler()</code> (like the Vector Table) is essential for Blue Pill
                  operation. Don’t tamper with it, just make sure it’s always in ROM. Be careful when coding C++
                  Constructor Methods — they are called before <code class="ea ha hb hc hd b">main()</code>.</p>
                <blockquote class="hn ho hp">
                  <p id="fd8b" class="gm gn ar hq go b gp gq gr gs gt gu gv gw gx gy gz"><em class="bz">💎</em> <strong
                      class="go hh">Can we override the default </strong><code
                      class="ea ha hb hc hd b"><strong class="go hh">reset_handler()</strong></code><strong
                      class="go hh"> and use our own? </strong>Yes we can! I used a custom <code
                      class="ea ha hb hc hd b">reset_handler()</code> here to start either the Baseloader, Bootloader or
                    Application, depending on the settings stored in battery-backed memory: <code
                      class="ea ha hb hc hd b"><a href="https://github.com/lupyuen/codal-libopencm3/blob/master/stm32/hal/reset_handler.c" class="bi cv iu iv iw ix" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/codal-libopencm3/blob/master/stm32/hal/reset_handler.c</a></code>
                  </p>
                  <p id="751b" class="gm gn ar hq go b gp gq gr gs gt gu gv gw gx gy gz"><em class="bz">💎</em> <strong
                      class="go hh">Why does the Vector Table point to </strong><code
                      class="ea ha hb hc hd b"><strong class="go hh">0x0800 0255</strong></code><strong class="go hh">
                      instead of </strong><code
                      class="ea ha hb hc hd b"><strong class="go hh">0x0800 0254</strong></code><strong class="go hh">,
                      the actual address of </strong><code
                      class="ea ha hb hc hd b"><strong class="go hh"><em class="bz">reset_handler()</em></strong></code><strong
                      class="go hh">? </strong>Because Arm says “<a
                      href="https://www.st.com/content/ccc/resource/technical/document/programming_manual/5b/ca/8d/83/56/7f/40/08/CD00228163.pdf/files/CD00228163.pdf/jcr:content/translations/en.CD00228163.pdf"
                      class="bi cv iu iv iw ix" target="_blank" rel="noopener nofollow">the least-significant bit of
                      each vector must be 1, indicating that the exception handler is Thumb code</a>”. This applies to
                    the addresses of interrupt service routines in the Vector Table too.</p>
                  <p id="b13b" class="gm gn ar hq go b gp gq gr gs gt gu gv gw gx gy gz"><em class="bz">💎</em> <strong
                      class="go hh">Can we use Multiple Vector Tables?</strong> Yes we can! Here’s the Baseloader Code
                    that I created to flash the updated Bootloader Code in ROM. Before overwriting the Bootloader Code
                    (which includes the Vector Table) it installs a temporary Vector Table in RAM by pointing the <code
                      class="ea ha hb hc hd b">SCB_VTOR</code> register to the new Vector Table (because we don’t want
                    the Blue Pill to get confused if an exception occurs during flashing). This is also known as
                    “Relocating the Vector Table”… <code
                      class="ea ha hb hc hd b"><a href="https://github.com/lupyuen/codal-libopencm3/blob/master/stm32/baseloader/baseloader.c" class="bi cv iu iv iw ix" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/codal-libopencm3/blob/master/stm32/baseloader/baseloader.c</a></code>
                  </p>
                </blockquote>
                <h1 id="cd59" class="ib ic ar bz by id ie jq ig jr ii js ik jt im ju io">Use Google Sheets To Analyse
                  The Linker Map</h1>
                <p id="47fc" class="gm gn ar bz go b gp ip gr iq gt ir gv is gx it gz">As you recall, the Linker Map
                  file <code class="ea ha hb hc hd b">firmware.map</code> can be hard to analyse because it’s full of
                  details. What if we used a Google Sheets spreadsheet to crunch the file and show us only the details
                  that we need, to guide us in trimming down our RAM and ROM usage?</p>
                <p id="917f" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Check out this Blue Pill Memory
                  Map that was generated from our sample blink program…</p>
                <div class="ky kz la lb lc ld"><a
                    href="https://docs.google.com/spreadsheets/d/1F_j782DVhuUm1KspFxU2E3PQ1tuQd0QjPI81WqCyDrw/edit?source=post_page-----9fc805e16ed7----------------------#gid=381366828&amp;fvid=1359565135"
                    rel="noopener nofollow">
                    <section class="lg da db ak ct n bh lh li lj lk ll lm ln lo lp lq lr ls lt lu lv">
                      <div class="lw n dd p lx ly">
                        <h2 class="by id lz ca ar">
                          <div class="ax le fm au lf aw">Blue Pill Memory Map (1) - Blink only</div>
                        </h2>
                        <div class="ma r">
                          <h3 class="by fj fk ca cd">
                            <div class="ax le fm au lf aw">0 a(vectoro) pioenvs/bluepill_f103c8/libFrameworkLibOpenCM3
                              .pioenvs/bluepill_f103c8/libFrameworkLibOpenCM3.a(vector.o)…</div>
                          </h3>
                        </div>
                        <div class="mb r">
                          <h4 class="by fj gb ca cd">
                            <div class="ax le fm au lf aw">docs.google.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="mc r">
                        <div class="md r me mf mg mc mh mi mj"></div>
                      </div>
                    </section>
                  </a></div>
                <p id="699a" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">The spreadsheet contains formulas
                  to parse the lines from <code class="ea ha hb hc hd b">firmware.map</code>, extract the columns that
                  we need, and sort the functions and variables by size. Here are the highlights of the spreadsheet…</p>
              </div>
            </div>
            <div class="do ak">
              <figure class="iy iz ja jb jc do ak paragraph-image">
                  
                <p><img src="https://lupyuen.github.io/images/legacy2/n10.png" /></p>
  

                <div class="dz r ds ea">
                  <div class="mk r">
                    <div class="du dv de t u dw ak ax dx dy"><img class="de t u dw ak ec ed ee"
                        src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/60/1*2nDA4MEnHpvgwAJ_mfKkIg.png?q=20"
                        width="1503" height="506" role="presentation" /></div><img class="du dv de t u dw ak ef"
                      width="1503" height="506" role="presentation" /><noscript><img class="de t u dw ak"
                        src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/3006/1*2nDA4MEnHpvgwAJ_mfKkIg.png"
                        width="1503" height="506" role="presentation" /></noscript>
                  </div>
                </div>
                <figcaption class="cd fk jm jn hv dc da db jo jp by fj">Sample Google Sheets spreadsheet that analyses
                  the Linker Map file firmware.map</figcaption>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <p id="a26f" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">You can use the Google Sheets
                  Template to analyse your own Linker Map files…</p>
                <p id="f6d3" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">1️⃣ Click this link to open the
                  Memory Map template…</p>
                <div class="ky kz la lb lc ld"><a
                    href="https://docs.google.com/spreadsheets/d/1U_fh1UZZVWjcuUGTKg2JWYoHpfxZocge4s7rbFZpwzo/edit?usp=sharing&amp;source=post_page-----9fc805e16ed7----------------------"
                    rel="noopener nofollow">
                    <section class="lg da db ak ct n bh lh li lj lk ll lm ln lo lp lq lr ls lt lu lv">
                      <div class="lw n dd p lx ly">
                        <h2 class="by id lz ca ar">
                          <div class="ax le fm au lf aw">Blue Pill Memory Map - Template</div>
                        </h2>
                        <div class="ma r">
                          <h3 class="by fj fk ca cd">
                            <div class="ax le fm au lf aw">Import THIS GOOGLE SHEET PARSES YOUR LINKER MAP AND
                              GROUPS/SORTS YOUR SYMBOLS BY SIZE (1) CLICK &quot;FILE -&gt; MAKE A COPY&quot;…</div>
                          </h3>
                        </div>
                        <div class="mb r">
                          <h4 class="by fj gb ca cd">
                            <div class="ax le fm au lf aw">docs.google.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="mc r">
                        <div class="ml r me mf mg mc mh mi mj"></div>
                      </div>
                    </section>
                  </a></div>
                <p id="cd2a" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">2️⃣ Click <code
                    class="ea ha hb hc hd b"><strong class="go hh">File → Make A Copy</strong></code> to copy the file
                  into your Google Drive storage</p>
                <p id="dc40" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">3️⃣ Paste the contents of your
                  Linker Map file <code class="ea ha hb hc hd b">firmware.map</code> into the <code
                    class="ea ha hb hc hd b"><strong class="go hh">Import</strong></code> sheet</p>
                <p id="8870" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">4️⃣ Click the <code
                    class="ea ha hb hc hd b"><strong class="go hh">Symbols</strong></code> sheet</p>
                <p id="b651" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">5️⃣ Click <code
                    class="ea ha hb hc hd b"><strong class="go hh">Data → Filter Views → All Objects By Size</strong></code>
                </p>
                <p id="6871" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">This video shows you the steps.
                  Click “CC” to view the instructions in the video…</p>
              </div>
            </div>
            <div class="do ak">
              <figure class="iy iz ja jb jc do">
                <div class="dz r ds">
                  <div class="jd r"><iframe
                      src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FOMXwJREgm5Y%3Ffeature%3Doembed&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DOMXwJREgm5Y&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2FOMXwJREgm5Y%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube"
                      allowfullscreen="" frameborder="0" height="480" width="640"
                      title="Analysing Blue Pill Linker Memory Map" class="de t u dw ak" scrolling="auto"></iframe>
                  </div>
                </div>
                <figcaption class="cd fk jm jn hv dc da db jo jp by fj">Using Google Sheets to analyse the Linker Map
                  firmware.map</figcaption>
              </figure>
            </div>
          </section>
          <hr class="hr fj hs ht hu hv hw hx hy hz ia" />
          <section class="dj dk dl dm dn">
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <h1 id="44b9" class="ib ic ar bz by id ie if ig ih ii ij ik il im in io">What Happens When We Add
                  sprintf()?</h1>
                <p id="6c61" class="gm gn ar bz go b gp ip gr iq gt ir gv is gx it gz"><code
                    class="ea ha hb hc hd b"><a href="http://www.cplusplus.com/reference/cstdio/sprintf/" class="bi cv iu iv iw ix" target="_blank" rel="noopener nofollow">sprintf()</a></code><a
                    href="http://www.cplusplus.com/reference/cstdio/sprintf/"
                    class="bi cv iu iv iw ix" target="_blank" rel="noopener nofollow"> is a common C function</a> used
                  for formatting numbers as strings. What happens to the RAM and ROM usage when we add it to our Blue
                  Pill program? Try it out yourself…</p>
                <p id="2d89" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">1️⃣ Edit <code
                    class="ea ha hb hc hd b">main.c</code>. Insert the lines below marked <code
                    class="ea ha hb hc hd b">// Added line</code></p>
                <figure class="iy iz ja jb jc do">
                
                  <p><script src="https://gist.github.com/lupyuen/fe2d133517042db6040eba210ecd06cd.js"></script></p>


                </figure>
                <p id="ec3c" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">2️⃣ Build the project in Visual
                  Studio Code</p>
                <p id="5d0c" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">3️⃣ Copy the contents of <code
                    class="ea ha hb hc hd b">firmware.map</code> into a new copy of the <a
                    href="https://docs.google.com/spreadsheets/d/1U_fh1UZZVWjcuUGTKg2JWYoHpfxZocge4s7rbFZpwzo/edit?usp=sharing"
                    class="bi cv iu iv iw ix" target="_blank" rel="noopener nofollow">Memory Map Template</a></p>
                <p id="57f5" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">4️⃣ Click the <code
                    class="ea ha hb hc hd b"><strong class="go hh">Symbols</strong></code> sheet</p>
                <p id="1d23" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">5️⃣ Click <code
                    class="ea ha hb hc hd b"><strong class="go hh">Data → Filter Views → All Objects By Size</strong></code>
                </p>
                <p id="f5e1" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Before adding <code
                    class="ea ha hb hc hd b">sprintf()</code>, the build output show this as the RAM and ROM usage…</p>
                <pre
                  class="iy iz ja jb jc je jf jg"><span id="7f31" class="jh ic ar bz hd b fk ji jj r jk">Linking .pioenvs/bluepill_f103c8/firmware.elf<br/>Memory region         Used Size  Region Size  %age Used<br/><strong class="hd hh">rom</strong>:                   <strong class="hd hh">744</strong> B        <strong class="hd hh">64</strong> KB      <strong class="hd hh">1.14</strong>%<br/><strong class="hd hh">ram</strong>:                     <strong class="hd hh">8</strong> B        <strong class="hd hh">20</strong> KB      <strong class="hd hh">0.04</strong>%</span></pre>
                <p id="6f66" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">But after adding <code
                    class="ea ha hb hc hd b">sprintf()</code>, the <strong class="go hh">ROM usage has increased from 1%
                    to 33%</strong>!</p>
                <pre
                  class="iy iz ja jb jc je jf jg"><span id="6d1c" class="jh ic ar bz hd b fk ji jj r jk">Linking .pioenvs/bluepill_f103c8/firmware.elf<br/>Memory region         Used Size  Region Size  %age Used<br/><strong class="hd hh">rom</strong>:                  <strong class="hd hh">22,132</strong> B        <strong class="hd hh">64</strong> KB     <strong class="hd hh">33.77</strong>%<br/><strong class="hd hh">ram</strong>:                   <strong class="hd hh">2,576</strong> B        <strong class="hd hh">20</strong> KB     <strong class="hd hh">12.58</strong>%</span></pre>
                <p id="8a8f" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">What cause the ROM usage to jump
                  so much? Take a look at the Memory Map you have created. Or check out my copy of the Memory Map…</p>
                <div class="ky kz la lb lc ld"><a
                    href="https://docs.google.com/spreadsheets/d/1ZfOGWiYJzpt1yYK86tdpoqn_u9CirU2wduPrjnRZkbg/edit?source=post_page-----9fc805e16ed7----------------------#gid=381366828&amp;fvid=1359565135"
                    rel="noopener nofollow">
                    <section class="lg da db ak ct n bh lh li lj lk ll lm ln lo lp lq lr ls lt lu lv">
                      <div class="lw n dd p lx ly">
                        <h2 class="by id lz ca ar">
                          <div class="ax le fm au lf aw">Blue Pill Memory Map (2) - Blink with sprintf</div>
                        </h2>
                        <div class="ma r">
                          <h3 class="by fj fk ca cd">
                            <div class="ax le fm au lf aw">Symbols
                              Size,Function,Section,Subsection,Symbol,Library,Folder,Path,Offset,Line Number,Line
                              0,Subsection…</div>
                          </h3>
                        </div>
                        <div class="mb r">
                          <h4 class="by fj gb ca cd">
                            <div class="ax le fm au lf aw">docs.google.com</div>
                          </h4>
                        </div>
                      </div>
                    </section>
                  </a></div>
                <p id="953b" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Did you notice the changes in the
                  Memory Map after adding <code class="ea ha hb hc hd b">sprintf()</code>? Here’s a summary…</p>
              </div>
            </div>
            <div class="do ak">
              <figure class="iy iz ja jb jc do ak paragraph-image">
                  
                <p><img src="https://lupyuen.github.io/images/legacy2/n11.png" /></p>
  

                <div class="dz r ds ea">
                  <div class="mm r">
                    <div class="du dv de t u dw ak ax dx dy"><img class="de t u dw ak ec ed ee"
                        src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/60/1*NCuQu79ZZDMm6IzyyMXbGQ.png?q=20"
                        width="1142" height="690" role="presentation" /></div><img class="du dv de t u dw ak ef"
                      width="1142" height="690" role="presentation" /><noscript><img class="de t u dw ak"
                        src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/2284/1*NCuQu79ZZDMm6IzyyMXbGQ.png"
                        width="1142" height="690" role="presentation" /></noscript>
                  </div>
                </div>
                <figcaption class="cd fk jm jn hv dc da db jo jp by fj">Memory Map after adding sprintf()</figcaption>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <p id="7c2d" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Because of the added baggage, I
                  don’t use <code class="ea ha hb hc hd b">sprintf()</code> and the <code
                    class="ea ha hb hc hd b">stdio</code> library in my Blue Pill programs. For logging, I wrote a
                  library that performs simple formatting of numbers: <code
                    class="ea ha hb hc hd b"><a href="https://github.com/lupyuen/codal-libopencm3/tree/master/stm32/logger" class="bi cv iu iv iw ix" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/codal-libopencm3/tree/master/stm32/logger</a></code>
                </p>
                <p id="158e" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">So now we have learnt how to use
                  Google Sheets to analyse the Linker Map to find large functions and variables. This should help fix
                  most of our Blue Pill memory problems… though sometimes we will need to use special tricks to cut down
                  on memory usage. Read on for some tips…</p>
              </div>
            </div>
          </section>
          <hr class="hr fj hs ht hu hv hw hx hy hz ia" />
          <section class="dj dk dl dm dn">
            <div class="do ak">
              <figure class="iy iz ja jb jc do ak paragraph-image">
                  
                <p><img src="https://lupyuen.github.io/images/legacy2/n12.png" /></p>
  

                <div class="dz r ds ea">
                  <div class="mn r">
                    <div class="du dv de t u dw ak ax dx dy"><img class="de t u dw ak ec ed ee"
                        src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/60/1*MN4FFf4lzTijRJr-f2g9NA.png?q=20"
                        width="1107" height="770" role="presentation" /></div><img class="du dv de t u dw ak ef"
                      width="1107" height="770" role="presentation" /><noscript><img class="de t u dw ak"
                        src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/2214/1*MN4FFf4lzTijRJr-f2g9NA.png"
                        width="1107" height="770" role="presentation" /></noscript>
                  </div>
                </div>
                <figcaption class="cd fk jm jn hv dc da db jo jp by fj">Memory Map from the port of MakeCode to Blue
                  Pill</figcaption>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <h1 id="3a25" class="ib ic ar bz by id ie jq ig jr ii js ik jt im ju io">Optimising A Huge Memory Map
                </h1>
                <p id="7970" class="gm gn ar bz go b gp ip gr iq gt ir gv is gx it gz">The Memory Map above is from a
                  complicated project that I’m doing in my spare time… <a class="bi cv iu iv iw ix" target="_blank"
                    rel="noopener"
                    href="/web/20191216120206/https://medium.com/@ly.lee/work-in-progress-stm32-blue-pill-visual-programming-with-makecode-codal-and-libopencm3-422d308f252e">Porting
                    the MakeCode visual programming tool (used in the BBC micro:bit) to Blue Pill.</a> I used this
                  Memory Map to optimise the MakeCode runtime for Blue Pill. Here’s the file for the above Memory Map…
                </p>
                <div class="ky kz la lb lc ld"><a
                    href="https://docs.google.com/spreadsheets/d/1DWFoh0Ui9j294htHzQrH-s6MuPRXct2zN8M9pj53CBk/edit?source=post_page-----9fc805e16ed7----------------------#gid=381366828&amp;fvid=1359565135"
                    rel="noopener nofollow">
                    <section class="lg da db ak ct n bh lh li lj lk ll lm ln lo lp lq lr ls lt lu lv">
                      <div class="lw n dd p lx ly">
                        <h2 class="by id lz ca ar">
                          <div class="ax le fm au lf aw">MakeCode Blue Pill Map (2) — Before Optimisation</div>
                        </h2>
                        <div class="ma r">
                          <h3 class="by fj fk ca cd">
                            <div class="ax le fm au lf aw">Symbols
                              Size,Function,Section,Subsection,Symbol,Library,Folder,Path,Offset,Line Number,Line
                              0,Subsection…</div>
                          </h3>
                        </div>
                        <div class="mb r">
                          <h4 class="by fj gb ca cd">
                            <div class="ax le fm au lf aw">docs.google.com</div>
                          </h4>
                        </div>
                      </div>
                    </section>
                  </a></div>
                <p id="152f" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">50 KB of code and read-only data
                  - Why is it so huge? This happens when we port over code from a higher-capacity microcontroller
                  (micro:bit) to the Blue Pill. (The same thing happened when I attempted to port MicroPython to Blue
                  Pill.) Compare the BBC micro:bit specs to Blue Pill…</p>
                <pre
                  class="iy iz ja jb jc je jf jg"><span id="5af4" class="jh ic ar bz hd b fk ji jj r jk">BBC micro:bit   <strong class="hd hh">256</strong> KB ROM    <strong class="hd hh">16</strong> KB RAM<br/>Blue Pill        <strong class="hd hh">64</strong> KB ROM    <strong class="hd hh">20</strong> KB RAM</span></pre>
                <p id="4b14" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Can we really squeeze a micro:bit
                  program into Blue Pill?</p>
              </div>
            </div>
            <div class="do ak">
              <figure class="iy iz ja jb jc do ak paragraph-image">
                  
                <p><img src="https://lupyuen.github.io/images/legacy2/n13.png" /></p>
  

                <div class="dz r ds ea">
                  <div class="mo r">
                    <div class="du dv de t u dw ak ax dx dy"><img class="de t u dw ak ec ed ee"
                        src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/60/1*3DGjmQJot2LRDQzR-dwJRA.png?q=20"
                        width="1098" height="697" role="presentation" /></div><img class="du dv de t u dw ak ef"
                      width="1098" height="697" role="presentation" /><noscript><img class="de t u dw ak"
                        src="https://web.archive.org/web/20191216120206im_/https://miro.medium.com/max/2196/1*3DGjmQJot2LRDQzR-dwJRA.png"
                        width="1098" height="697" role="presentation" /></noscript>
                  </div>
                </div>
                <figcaption class="cd fk jm jn hv dc da db jo jp by fj">Memory Map from the port of MakeCode to Blue
                  Pill, after optimisation</figcaption>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <p id="bbab" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Yes we can! I used the Memory Map
                  to identify the large objects to be fixed. After optimisation, the program is a lot smaller (shown
                  above). Here is the optimised Memory Map file…</p>
                <div class="ky kz la lb lc ld"><a
                    href="https://docs.google.com/spreadsheets/d/1OmD1XmUQJTIiXklYx-eui27MFBBhnXrCNaJwSUFDiN8/edit?source=post_page-----9fc805e16ed7----------------------#gid=381366828&amp;fvid=1359565135"
                    rel="noopener nofollow">
                    <section class="lg da db ak ct n bh lh li lj lk ll lm ln lo lp lq lr ls lt lu lv">
                      <div class="lw n dd p lx ly">
                        <h2 class="by id lz ca ar">
                          <div class="ax le fm au lf aw">MakeCode Blue Pill Map (7) - With Bootloader Optimised</div>
                        </h2>
                        <div class="ma r">
                          <h3 class="by fj fk ca cd">
                            <div class="ax le fm au lf aw">Symbols
                              Size,Function,Section,Subsection,Symbol,Library,Folder,Path,Offset,Line Number,Line
                              0,Subsection…</div>
                          </h3>
                        </div>
                        <div class="mb r">
                          <h4 class="by fj gb ca cd">
                            <div class="ax le fm au lf aw">docs.google.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="mc r">
                        <div class="mp r me mf mg mc mh mi mj"></div>
                      </div>
                    </section>
                  </a></div>
                <p id="8934" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz"><strong class="go hh">Using
                    Google Sheets to analyse the Linker Map is perfect for such porting projects</strong>, it really
                  helps to pinpoint the bloat so we can decide how to trim it down.</p>
              </div>
            </div>
          </section>
          <hr class="hr fj hs ht hu hv hw hx hy hz ia" />
          <section class="dj dk dl dm dn">
            <div class="do ak">
              <figure class="iy iz ja jb jc do">
                <div class="dz r ds">
                  <div class="jd r"><iframe
                      src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FDSNDvrVOJns%3Ffeature%3Doembed&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DDSNDvrVOJns&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2FDSNDvrVOJns%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube"
                      allowfullscreen="" frameborder="0" height="480" width="640"
                      title="STM32 Blue Pill USB Bootloader and MakeCode" class="de t u dw ak"
                      scrolling="auto"></iframe></div>
                </div>
                <figcaption class="cd fk jm jn hv dc da db jo jp by fj">Work In Progress: Porting MakeCode to Blue Pill
                </figcaption>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <h1 id="6416" class="ib ic ar bz by id ie jq ig jr ii js ik jt im ju io">What’s Next</h1>
                <p id="8f3b" class="gm gn ar bz go b gp ip gr iq gt ir gv is gx it gz">Porting the MakeCode visual
                  programming tool to Blue Pill is incredibly complicated, but I learnt a lot from the process. This is
                  the first article that documents one of the complicated porting tasks: memory optimisation. Coming up:
                  More articles from my Blue Pill porting experience…</p>
                <p id="6e43" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">1️⃣ Replacing the standard math
                  functions by smaller <code class="ea ha hb hc hd b">qfplib</code> library</p>
                <div class="ky kz la lb lc ld"><a rel="noopener"
                    href="/web/20191216120206/https://medium.com/@ly.lee/stm32-blue-pill-shrink-your-math-libraries-with-qfplib-55093aab163a?source=post_page-----9fc805e16ed7----------------------">
                    <section class="lg da db ak ct n bh lh li lj lk ll lm ln lo lp lq lr ls lt lu lv">
                      <div class="lw n dd p lx ly">
                        <h2 class="by id lz ca ar">
                          <div class="ax le fm au lf aw">STM32 Blue Pill – Shrink your math libraries with Qfplib</div>
                        </h2>
                        <div class="ma r">
                          <h3 class="by fj fk ca cd">
                            <div class="ax le fm au lf aw">Floating-point math libraries can bloat your Blue Pill code.
                              Here’s one way to fix that</div>
                          </h3>
                        </div>
                        <div class="mb r">
                          <h4 class="by fj gb ca cd">
                            <div class="ax le fm au lf aw">medium.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="mc r">
                        <div class="mq r me mf mg mc mh mi mj"></div>
                      </div>
                    </section>
                  </a></div>
                <p id="9c19" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">2️⃣ Unit testing the math
                  functions with the QEMU Blue Pill Emulator</p>
                <div class="ky kz la lb lc ld"><a rel="noopener"
                    href="/web/20191216120206/https://medium.com/@ly.lee/stm32-blue-pill-unit-testing-with-qemu-blue-pill-emulator-9d88002a68b2?source=post_page-----9fc805e16ed7----------------------">
                    <section class="lg da db ak ct n bh lh li lj lk ll lm ln lo lp lq lr ls lt lu lv">
                      <div class="lw n dd p lx ly">
                        <h2 class="by id lz ca ar">
                          <div class="ax le fm au lf aw">STM32 Blue Pill — Unit Testing with Qemu Blue Pill Emulator
                          </div>
                        </h2>
                        <div class="ma r">
                          <h3 class="by fj fk ca cd">
                            <div class="ax le fm au lf aw">Unit Testing can help to stop bugs before they pollute the
                              entire IoT chain</div>
                          </h3>
                        </div>
                        <div class="mb r">
                          <h4 class="by fj gb ca cd">
                            <div class="ax le fm au lf aw">medium.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="mc r">
                        <div class="mr r me mf mg mc mh mi mj"></div>
                      </div>
                    </section>
                  </a></div>
                <p id="e771" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">3️⃣ Creating a WebUSB Bootloader
                  for MakeCode</p>
                <div class="ky kz la lb lc ld"><a rel="noopener"
                    href="/web/20191216120206/https://medium.com/@ly.lee/stm32-blue-pill-dissecting-the-webusb-bootloader-for-makecode-b7f1a1508e89?source=post_page-----9fc805e16ed7----------------------">
                    <section class="lg da db ak ct n bh lh li lj lk ll lm ln lo lp lq lr ls lt lu lv">
                      <div class="lw n dd p lx ly">
                        <h2 class="by id lz ca ar">
                          <div class="ax le fm au lf aw">STM32 Blue Pill — Dissecting the WebUSB Bootloader for MakeCode
                          </div>
                        </h2>
                        <div class="ma r">
                          <h3 class="by fj fk ca cd">
                            <div class="ax le fm au lf aw">How the MakeCode Bootloader for Blue Pill implements flashing
                              over WebUSB</div>
                          </h3>
                        </div>
                        <div class="mb r">
                          <h4 class="by fj gb ca cd">
                            <div class="ax le fm au lf aw">medium.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="mc r">
                        <div class="ms r me mf mg mc mh mi mj"></div>
                      </div>
                    </section>
                  </a></div>
                <p id="4bd5" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">4️⃣ Updating the Bootloader with
                  a tiny Baseloader</p>
                <div class="ky kz la lb lc ld"><a rel="noopener"
                    href="/web/20191216120206/https://medium.com/@ly.lee/stm32-blue-pill-bootloading-the-webusb-bootloader-63398ef5eb76?source=post_page-----9fc805e16ed7----------------------">
                    <section class="lg da db ak ct n bh lh li lj lk ll lm ln lo lp lq lr ls lt lu lv">
                      <div class="lw n dd p lx ly">
                        <h2 class="by id lz ca ar">
                          <div class="ax le fm au lf aw">STM32 Blue Pill — Bootloading the WebUSB Bootloader</div>
                        </h2>
                        <div class="ma r">
                          <h3 class="by fj fk ca cd">
                            <div class="ax le fm au lf aw">How does the WebUSB Bootloader upgrade itself? With a special
                              Baseloader</div>
                          </h3>
                        </div>
                        <div class="mb r">
                          <h4 class="by fj gb ca cd">
                            <div class="ax le fm au lf aw">medium.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="mc r">
                        <div class="mt r me mf mg mc mh mi mj"></div>
                      </div>
                    </section>
                  </a></div>
                <p id="e442" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">So don’t throw out the Blue Pill
                  yet, there’s so much more you can do with it!</p>
                <p id="33ba" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz"><strong
                    class="go hh">UPDATE</strong>: I have written a new series of articles on Blue Pill programming with
                  Apache Mynewt realtime operating system, check this out…</p>
                <div class="ky kz la lb lc ld"><a rel="noopener"
                    href="/web/20191216120206/https://medium.com/@ly.lee/create-your-iot-gadget-with-apache-mynewt-and-stm32-blue-pill-d689b3ca725?source=post_page-----9fc805e16ed7----------------------">
                    <section class="lg da db ak ct n bh lh li lj lk ll lm ln lo lp lq lr ls lt lu lv">
                      <div class="lw n dd p lx ly">
                        <h2 class="by id lz ca ar">
                          <div class="ax le fm au lf aw">Create your IoT gadget with Apache Mynewt and STM32 Blue Pill
                          </div>
                        </h2>
                        <div class="ma r">
                          <h3 class="by fj fk ca cd">
                            <div class="ax le fm au lf aw">Apache Mynewt is an open-source realtime OS for
                              microcontrollers that supports multitasking sensors</div>
                          </h3>
                        </div>
                        <div class="mb r">
                          <h4 class="by fj gb ca cd">
                            <div class="ax le fm au lf aw">medium.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="mc r">
                        <div class="mu r me mf mg mc mh mi mj"></div>
                      </div>
                    </section>
                  </a></div>
                <p id="8b8e" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">I used the memory map spreadsheet
                  to analyse the ROM usage of my Apache Mynewt application…</p>
                <div class="ky kz la lb lc ld"><a rel="noopener"
                    href="/web/20191216120206/https://medium.com/@ly.lee/connect-stm32-blue-pill-to-esp8266-with-apache-mynewt-7edceb9e3b8d?source=post_page-----9fc805e16ed7----------------------">
                    <section class="lg da db ak ct n bh lh li lj lk ll lm ln lo lp lq lr ls lt lu lv">
                      <div class="lw n dd p lx ly">
                        <h2 class="by id lz ca ar">
                          <div class="ax le fm au lf aw">Connect STM32 Blue Pill to ESP8266 with Apache Mynewt</div>
                        </h2>
                        <div class="ma r">
                          <h3 class="by fj fk ca cd">
                            <div class="ax le fm au lf aw">Send sensor data to a CoAP server and perform WiFi
                              Geolocation with ESP8266</div>
                          </h3>
                        </div>
                        <div class="mb r">
                          <h4 class="by fj gb ca cd">
                            <div class="ax le fm au lf aw">medium.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="mc r">
                        <div class="mv r me mf mg mc mh mi mj"></div>
                      </div>
                    </section>
                  </a></div>
              </div>
            </div>
          </section>
        </div>
      </article>
    </div>
  </div>
</body>

</html>
<!--
     FILE ARCHIVED ON 12:02:06 Dec 16, 2019 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 01:30:30 Feb 23, 2021.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  exclusion.robots: 0.326
  esindex: 0.01
  load_resource: 364.547
  captures_list: 142.881
  PetaboxLoader3.resolve: 305.344
  exclusion.robots.policy: 0.315
  PetaboxLoader3.datanode: 83.097 (4)
  RedisCDXSource: 1.828
  LoadShardBlock: 108.503 (3)
  CDXLines.iter: 28.651 (3)
-->