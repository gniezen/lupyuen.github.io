<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <title>Build a PinePhone App with Zig and zgt</title>

    
    <!-- Begin scripts/articles/*-header.html: Article Header for Custom Markdown files processed by rustdoc, like chip8.md -->
<meta property="og:title" 
    content="Build a PinePhone App with Zig and zgt" 
    data-rh="true">
<meta property="og:description" 
    content="Can we use Zig to code PinePhone Apps? Maybe make them simpler and safer? Let's find out!"
    data-rh="true">
<meta property="og:image" 
    content="https://lupyuen.github.io/images/pinephone-title.jpg">
<meta property="og:type" 
    content="article" data-rh="true">
<!-- End scripts/articles/*-header.html -->
<!-- Begin scripts/rustdoc-header.html: Header for Custom Markdown files processed by rustdoc, like chip8.md -->
<link rel="alternate" type="application/rss+xml" title="RSS Feed for lupyuen" href="/rss.xml" />
<link rel="stylesheet" type="text/css" href="../normalize.css">
<link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle">
<link rel="stylesheet" type="text/css" href="../dark.css">
<link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle">
<link rel="stylesheet" type="text/css" href="../prism.css">
<script src="../storage.js"></script><noscript>
<link rel="stylesheet" href="../noscript.css"></noscript>
<link rel="shortcut icon" href="../favicon.ico">
<style type="text/css">
    #crate-search {
        background-image: url("../down-arrow.svg");
    }
    a {
        color: #77d;
    }
</style>
<!-- End scripts/rustdoc-header.html -->


</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

        <!-- Begin scripts/rustdoc-before.html: Pre-HTML for Custom Markdown files processed by rustdoc, like chip8.md -->

    <!-- Begin Theme Picker -->
    <div class="theme-picker" style="left: 0"><button id="theme-picker" aria-label="Pick another theme!"><img src="../brush.svg"
        width="18" alt="Pick another theme!"></button>
        <div id="theme-choices"></div>
    </div>
    <script src="../theme.js"></script>
    <script src="../prism.js"></script>
    <!-- Theme Picker -->

    <!-- End scripts/rustdoc-before.html -->
    

    <h1 class="title">Build a PinePhone App with Zig and zgt</h1>
    <nav id="TOC"><ul>
<li><a href="#inside-the-app">1 Inside The App</a><ul>
<li><a href="#import-libraries">1.1 Import Libraries</a><ul></ul></li>
<li><a href="#main-function">1.2 Main Function</a><ul></ul></li>
<li><a href="#set-the-widgets">1.3 Set the Widgets</a><ul></ul></li>
<li><a href="#show-the-window">1.4 Show the Window</a><ul></ul></li>
<li><a href="#handle-the-buttons">1.5 Handle the Buttons</a><ul></ul></li></ul></li>
<li><a href="#install-zig-compiler">2 Install Zig Compiler</a><ul></ul></li>
<li><a href="#install-zigmod">3 Install Zigmod</a><ul></ul></li>
<li><a href="#build-the-app">4 Build The App</a><ul></ul></li>
<li><a href="#run-the-app">5 Run The App</a><ul></ul></li>
<li><a href="#vscode-remote">6 VSCode Remote</a><ul></ul></li>
<li><a href="#pinebook-pro">7 Pinebook Pro</a><ul></ul></li>
<li><a href="#whats-next">8 What‚Äôs Next</a><ul></ul></li>
<li><a href="#notes">9 Notes</a><ul></ul></li></ul></nav><p>üìù <em>30 Jun 2022</em></p>
<p><img src="https://lupyuen.github.io/images/pinephone-title.jpg" alt="PinePhone App with Zig and zgt" /></p>
<p><a href="https://ziglang.org"><strong>Zig</strong></a> is a new-ish Programming Language that works well with C. And it comes with built-in <a href="https://ziglang.org/documentation/master/#Undefined-Behavior"><strong>Safety Checks</strong></a> at runtime.</p>
<p><a href="https://wiki.pine64.org/index.php/PinePhone"><strong>PinePhone</strong></a> is an Arm64 Linux Phone. PinePhone Apps are typically coded in C with GUI Toolkits like <a href="https://www.gtk.org"><strong>GTK</strong></a>.</p>
<p><em>Can we use Zig to code PinePhone Apps? Maybe make them a little simpler and safer?</em></p>
<p>Let‚Äôs find out! Our Zig App shall call the <strong>zgt GUI Library</strong>, which works with Linux (GTK), Windows and WebAssembly‚Ä¶</p>
<ul>
<li><a href="https://github.com/zenith391/zgt"><strong>zenith391/zgt</strong></a></li>
</ul>
<p>zgt is in Active Development, some features may change. </p>
<p><a href="https://github.com/zenith391/zgt">(Please support the zgt project! üôè)</a></p>
<p>Join me as we dive into our <strong>Zig App for PinePhone</strong>‚Ä¶</p>
<ul>
<li><a href="https://github.com/lupyuen/zig-pinephone-gui"><strong>lupyuen/zig-pinephone-gui</strong></a></li>
</ul>
<blockquote>
<p><img src="https://lupyuen.github.io/images/pinephone-screen2.png" alt="PinePhone App with Zig and zgt" /></p>
</blockquote>
<h1 id="inside-the-app"><a href="#inside-the-app">1 Inside The App</a></h1>
<p>TODO</p>
<p><img src="https://lupyuen.github.io/images/pinephone-code1a.png" alt="Source Code for our app" /></p>
<p><a href="https://github.com/lupyuen/zig-pinephone-gui/blob/main/src/main.zig">(Source)</a></p>
<h2 id="import-libraries"><a href="#import-libraries">1.1 Import Libraries</a></h2>
<p>We begin by importing the <a href="https://github.com/zenith391/zgt"><strong>zgt GUI Library</strong></a> and <a href="https://ziglang.org/documentation/master/#Zig-Standard-Library"><strong>Zig Standard Library</strong></a> into our app: <a href="https://github.com/lupyuen/zig-pinephone-gui/blob/main/src/main.zig#L1-L4">main.zig</a></p>
<div class="example-wrap"><pre class="language-zig"><code>// Import the zgt library and Zig Standard Library
const zgt = @import(&quot;zgt&quot;);
const std = @import(&quot;std&quot;);</code></pre></div>
<p>The Zig Standard Library has all kinds of <strong>Algos, Data Structures and Definitions</strong>.</p>
<p><a href="https://ziglang.org/documentation/master/std/">(More about the Zig Standard Library)</a></p>
<h2 id="main-function"><a href="#main-function">1.2 Main Function</a></h2>
<p>Next we define the <strong>Main Function</strong> for our app: <a href="https://github.com/lupyuen/zig-pinephone-gui/blob/main/src/main.zig#L4-L13">main.zig</a></p>
<div class="example-wrap"><pre class="language-zig"><code>/// Main Function for our app
pub fn main() !void {</code></pre></div>
<p>‚Äú<strong><code>!void</code></strong>‚Äù says that‚Ä¶</p>
<ul>
<li>
<p>Our Main Function doesn‚Äôt return any value.</p>
<p>(Hence ‚Äú<code>void</code>‚Äù)</p>
</li>
<li>
<p>But our function might return an <a href="https://ziglang.org/documentation/master/#Errors"><strong>Error</strong></a></p>
<p>(Hence the ‚Äú<code>!</code>‚Äù)</p>
</li>
</ul>
<p>Then we initialise the zgt Library and <strong>fetch the Window</strong> for our app‚Ä¶</p>
<div class="example-wrap"><pre class="language-zig"><code>  // Init the zgt library
  try zgt.backend.init();

  // Fetch the Window
  var window = try zgt.Window.init();</code></pre></div>
<p><em>Why the <code>try</code>?</em></p>
<p>Remember that our Main Function can <strong>return an Error</strong>.</p>
<p>When <a href="https://ziglang.org/documentation/master/#try">‚Äú<strong><code>try</code></strong>‚Äù</a> detects an Error in the Called Function (like ‚Äúzgt.backend.init‚Äù), it stops the Main Function and returns the Error to the caller.</p>
<h2 id="set-the-widgets"><a href="#set-the-widgets">1.3 Set the Widgets</a></h2>
<p>Now we <strong>populate the Widgets</strong> for our Window: <a href="https://github.com/lupyuen/zig-pinephone-gui/blob/main/src/main.zig#L13-L36">main.zig</a></p>
<div class="example-wrap"><pre class="language-zig"><code>  // Set the Window Contents
  try window.set(

    // One Column of Widgets
    zgt.Column(.{}, .{

      // Top Row of Widgets
      zgt.Row(.{}, .{

        // Save Button
        zgt.Button(.{ 
            .label   = &quot;Save&quot;, 
            .onclick = buttonClicked 
        }),

        // Run Button
        zgt.Button(.{ 
            .label   = &quot;Run&quot;,  
            .onclick = buttonClicked 
        }),
      }),  // End of Row</code></pre></div>
<p>This code creates a Row of Widgets: <strong>Save Button</strong> and <strong>Run Button</strong>.</p>
<p>(We‚Äôll talk about <strong>buttonClicked</strong> in a while)</p>
<p>Next we add an <strong>Editable Text Area</strong>‚Ä¶</p>
<div class="example-wrap"><pre class="language-zig"><code>      // Expanded means the widget will take all the space it can
      // in the parent container
      zgt.Expanded(

        // Editable Text Area
        zgt.TextArea(.{ 
            .text = &quot;Hello World!\n\nThis is a Zig GUI App...\n\nBuilt for PinePhone...\n\nWith zgt Library!&quot; 
        })
      )
    })  // End of Column
  );  // End of Window</code></pre></div>
<p><em>What‚Äôs <code>.{ ... }</code>?</em></p>
<p><code>.{ ... }</code> creates an <a href="https://ziglearn.org/chapter-1/#anonymous-structs"><strong>Anonymous Struct</strong></a> that matches the Struct Type that‚Äôs expected by the Called Function (like ‚Äúzgt.Button‚Äù).</p>
<p>Thus this code‚Ä¶</p>
<div class="example-wrap"><pre class="language-zig"><code>// Button with Anonymous Struct
zgt.Button(.{ 
  .label   = &quot;Save&quot;, 
  .onclick = buttonClicked 
}),</code></pre></div>
<p>Is actually a shortcut for‚Ä¶</p>
<div class="example-wrap"><pre class="language-zig"><code>// Button with &quot;zgt.Button_Impl.Config&quot;
zgt.Button(zgt.Button_Impl.Config { 
  .label   = &quot;Save&quot;, 
  .onclick = buttonClicked 
}),</code></pre></div>
<p>Because the ‚Äúzgt.Button‚Äù function expects a Struct of type ‚Äúzgt.Button_Impl.Config‚Äù.</p>
<h2 id="show-the-window"><a href="#show-the-window">1.4 Show the Window</a></h2>
<p>We set the Window Size and <strong>show the Window</strong>: <a href="https://github.com/lupyuen/zig-pinephone-gui/blob/main/src/main.zig#L36-L46">main.zig</a></p>
<div class="example-wrap"><pre class="language-zig"><code>  // Resize the Window (might not be correct for PinePhone)
  window.resize(800, 600);

  // Show the Window
  window.show();</code></pre></div>
<p>Finally we start the <strong>Event Loop</strong> that will handle Touch Events‚Ä¶</p>
<div class="example-wrap"><pre class="language-zig"><code>  // Run the Event Loop to handle Touch Events
  zgt.runEventLoop();

}  // End of Main Function</code></pre></div>
<p>We‚Äôre done with our Main Function!</p>
<p>Let‚Äôs talk about the Event Handling for our Buttons‚Ä¶</p>
<p><img src="https://lupyuen.github.io/images/pinephone-code2a.png" alt="Handle the Buttons" /></p>
<p><a href="https://github.com/lupyuen/zig-pinephone-gui/blob/main/src/main.zig">(Source)</a></p>
<h2 id="handle-the-buttons"><a href="#handle-the-buttons">1.5 Handle the Buttons</a></h2>
<p>TODO</p>
<p><a href="https://github.com/lupyuen/zig-pinephone-gui/blob/main/src/main.zig#L46-L55">main.zig</a></p>
<div class="example-wrap"><pre class="language-zig"><code>/// This function is called when the Buttons are clicked
fn buttonClicked(button: *zgt.Button_Impl) !void {

  // Print the Button Label to console
  std.log.info(
    &quot;You clicked button with text {s}&quot;,
    .{ button.getLabel() }
  );
}</code></pre></div>
<p>TODO: <code>*zgt.Button_Impl</code></p>
<p>This app is based on the zgt demo‚Ä¶</p>
<ul>
<li><a href="https://github.com/zenith391/zgt#usage"><strong>zenith391/zgt</strong></a></li>
</ul>
<p>For comparison, here‚Äôs a typical GTK app coded in C‚Ä¶</p>
<ul>
<li><a href="https://www.gtk.org/docs/getting-started/hello-world"><strong>GTK App in C</strong></a></li>
</ul>
<p>Though I think our Zig app looks more like Vala than C‚Ä¶</p>
<ul>
<li><a href="https://www.gtk.org/docs/language-bindings/vala"><strong>GTK App in Vala</strong></a></li>
</ul>
<p><em>How do I learn Zig?</em></p>
<p>Zig hasn‚Äôt reached version 1.0 yet so the docs are a little spotty. This is probably the best tutorial for Zig:</p>
<ul>
<li><a href="https://ziglearn.org"><strong>Zig Learn</strong></a></li>
</ul>
<p>After that the Zig Reference Reference Manual will be easier to understand:</p>
<ul>
<li><a href="https://ziglang.org/documentation/master"><strong>Zig Reference Manual</strong></a></li>
</ul>
<p>We need to refer to the Zig Standard Library as well:</p>
<ul>
<li><a href="https://ziglang.org/documentation/master/std"><strong>Zig Standard Library</strong></a></li>
</ul>
<h1 id="install-zig-compiler"><a href="#install-zig-compiler">2 Install Zig Compiler</a></h1>
<p>TODO</p>
<p>On PinePhone, download the latest Zig Compiler <code>zig-linux-aarch64</code> from‚Ä¶</p>
<ul>
<li><a href="https://ziglang.org/download"><strong>Zig Compiler Downloads</strong></a></li>
</ul>
<div class="example-wrap"><pre class="language-bash"><code># Download the Zig Compiler
curl -O -L https://ziglang.org/builds/zig-linux-aarch64-0.10.0-dev.2674+d980c6a38.tar.xz

# Extract the Zig Compiler
tar xf zig-linux-aarch64-0.10.0-dev.2674+d980c6a38.tar.xz

# Add to PATH. TODO: Also add this line to ~/.bashrc
export PATH=&quot;$HOME/zig-linux-aarch64-0.10.0-dev.2674+d980c6a38:$PATH&quot;

# Test the Zig Compiler, should show &quot;0.10.0-dev.2674+d980c6a38&quot;
zig version</code></pre></div>
<p><img src="https://lupyuen.github.io/images/pinephone-compiler.jpg" alt="Zig Compiler on PinePhone" /></p>
<p><em>Will Zig Compiler run on any PinePhone?</em></p>
<p>I tested the Zig Compiler with Manjaro Phosh on PinePhone (pic above), but it will probably work on any PinePhone distro since the Zig Compiler is a self-contained Arm64 Binary.</p>
<p><a href="https://twitter.com/techneo/status/1539510460726509568">(Zig Compiler works with Mobian on PinePhone too)</a></p>
<h1 id="install-zigmod"><a href="#install-zigmod">3 Install Zigmod</a></h1>
<p>TODO</p>
<p>Download the latest <a href="https://nektro.github.io/zigmod/">Zigmod Package Manager</a> <code>zigmod-aarch64-linux</code> from‚Ä¶</p>
<ul>
<li><a href="https://github.com/nektro/zigmod/releases"><strong>Zigmod Releases</strong></a></li>
</ul>
<div class="example-wrap"><pre class="language-bash"><code># Download Zigmod Package Manager
curl -O -L https://github.com/nektro/zigmod/releases/download/r80/zigmod-aarch64-linux

# Make it executable
chmod +x zigmod-aarch64-linux 

# Move it to the Zig Compiler directory, rename as zigmod
mv zigmod-aarch64-linux zig-linux-aarch64-0.10.0-dev.2674+d980c6a38/zigmod

# Test Zigmod, should show &quot;zigmod r80 linux aarch64 musl&quot;
zigmod</code></pre></div><h1 id="build-the-app"><a href="#build-the-app">4 Build The App</a></h1>
<p>TODO</p>
<p>To build the app on PinePhone‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code># Download the Source Code
git clone --recursive https://github.com/lupyuen/zig-pinephone-gui
cd zig-pinephone-gui

# Install the dependencies for zgt library
pushd libs/zgt
zigmod fetch
popd

# Build the app
zig build</code></pre></div>
<p><a href="https://gist.github.com/lupyuen/a44bc3faaf6d674d2b227aeb992ccfb8">(See the Build Log)</a></p>
<p>If the build fails, check that the <code>gtk+-3.0</code> library is installed on PinePhone. <a href="https://github.com/zenith391/zgt/blob/master/build.zig#L9-L13">(Here‚Äôs why)</a></p>
<p><a href="https://twitter.com/techneo/status/1539828828213616640">(The app builds OK on Mobian after installing <code>gtk+-3.0</code>)</a></p>
<h1 id="run-the-app"><a href="#run-the-app">5 Run The App</a></h1>
<p>TODO</p>
<p>To run the app on PinePhone‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>zig-out/bin/zig-pinephone-gui</code></pre></div>
<p>We should see the screen below.</p>
<p>When we tap the <code>Run</code> and <code>Save</code> buttons, we should see‚Ä¶</p>
<div class="example-wrap"><pre class="language-text"><code>info: You clicked button with text Run
info: You clicked button with text Save</code></pre></div>
<p>Yep we have successfully built a Zig GUI App for PinePhone with zgt! üéâ</p>
<p><em>Is the app fast and responsive on PinePhone?</em></p>
<p>Yep it feels as fast and responsive as a GTK app coded in C.</p>
<p>Remember that Zig is a compiled language, and our compiled app is directly calling the GTK Library.</p>
<p><img src="https://lupyuen.github.io/images/PXL_20220622_061922131%7E2.jpg" alt="Zig GUI App for PinePhone" /></p>
<h1 id="vscode-remote"><a href="#vscode-remote">6 VSCode Remote</a></h1>
<p>TODO</p>
<p>For convenience, we may use VSCode Remote to do Remote Development with PinePhone‚Ä¶</p>
<ul>
<li><a href="https://code.visualstudio.com/docs/remote/remote-overview"><strong>VSCode Remote</strong></a></li>
</ul>
<p>Just connect VSCode to PinePhone via SSH, as described here‚Ä¶</p>
<ul>
<li><a href="https://code.visualstudio.com/docs/remote/ssh"><strong>VSCode Remote with SSH</strong></a></li>
</ul>
<p>Remember to install the Zig Extension for VSCode‚Ä¶</p>
<ul>
<li><a href="https://github.com/ziglang/vscode-zig"><strong>Zig Extension for VSCode</strong></a></li>
</ul>
<p><img src="https://lupyuen.github.io/images/pinephone-vscode.png" alt="VSCode Remote on PinePhone" /></p>
<h1 id="pinebook-pro"><a href="#pinebook-pro">7 Pinebook Pro</a></h1>
<p>TODO</p>
<p><em>Will the Zig GUI App run on Arm64 laptops like Pinebook Pro?</em></p>
<p>Yep! The same steps above will work on Pinebook Pro.</p>
<p>Here‚Äôs our Zig GUI App running with Manjaro Xfce on Pinebook Pro‚Ä¶</p>
<p><img src="https://lupyuen.github.io/images/pinephone-pinebook.png" alt="Our app running with Manjaro Xfce on Pinebook Pro" /></p>
<h1 id="whats-next"><a href="#whats-next">8 What‚Äôs Next</a></h1>
<p>TODO</p>
<p>I hope this article has inspired you to create PinePhone apps in Zig!</p>
<p>Many Thanks to my <a href="https://github.com/sponsors/lupyuen"><strong>GitHub Sponsors</strong></a> for supporting my work! This article wouldn‚Äôt have been possible without your support.</p>
<ul>
<li>
<p><a href="https://github.com/sponsors/lupyuen"><strong>Sponsor me a coffee</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io"><strong>Check out my articles</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/rss.xml"><strong>RSS Feed</strong></a></p>
</li>
</ul>
<p><em>Got a question, comment or suggestion? Create an Issue or submit a Pull Request here‚Ä¶</em></p>
<p><a href="https://github.com/lupyuen/lupyuen.github.io/blob/master/src/pinephone.md"><strong><code>lupyuen.github.io/src/pinephone.md</code></strong></a></p>
<h1 id="notes"><a href="#notes">9 Notes</a></h1>
<ol>
<li>This article is the expanded version of <a href="https://twitter.com/MisterTechBlog/status/1539782929114484736"><strong>this Twitter Thread</strong></a></li>
</ol>
<p><img src="https://lupyuen.github.io/images/pinephone-title2.jpg" alt="PinePhone App with Zig and zgt" /></p>

    
</body>
</html>