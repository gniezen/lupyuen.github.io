<!doctype html><html lang="en"><head><script src="//archive.org/includes/analytics.js?v=cf34f82" type="text/javascript"></script>
<script type="text/javascript">window.addEventListener('DOMContentLoaded',function(){var v=archive_analytics.values;v.service='wb';v.server_name='wwwb-app56.us.archive.org';v.server_ms=620;archive_analytics.send_pageview({});});</script><script type="text/javascript" src="/_static/js/playback.bundle.js?v=bQvHU8mx" charset="utf-8"></script>
<script type="text/javascript" src="/_static/js/wombat.js?v=cRqOKCOw" charset="utf-8"></script>
<script type="text/javascript">
  __wm.init("https://web.archive.org/web");
  __wm.wombat("https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90?source=friends_link&sk=e232e68dc7c91dd4397e96d7dbde543a","20191204194117","https://web.archive.org/","web","/_static/",
	      "1575488477");
</script>
<link rel="stylesheet" type="text/css" href="/_static/css/banner-styles.css?v=bsmaklHF" />
<link rel="stylesheet" type="text/css" href="/_static/css/iconochive.css?v=qtvMKcIJ" />
<!-- End Wayback Rewrite JS Include -->
<script>!function(c,f){var t,o,i,e=[],r={passive:!0,capture:!0},n=new Date,a="pointerup",u="pointercancel";function p(n,e){t||(t=e,o=n,i=new Date,w(f),s())}function s(){0<=o&&o<i-n&&(e.forEach(function(n){n(o,t)}),e=[])}function l(n){if(n.cancelable){var e=(1e12<n.timeStamp?new Date:performance.now())-n.timeStamp;"pointerdown"==n.type?function(n,e){function t(){p(n,e),i()}function o(){i()}function i(){f(a,t,r),f(u,o,r)}c(a,t,r),c(u,o,r)}(e,n):p(e,n)}}function w(e){["click","mousedown","keydown","touchstart","pointerdown"].forEach(function(n){e(n,l,r)})}w(c),self.perfMetrics=self.perfMetrics||{},self.perfMetrics.onFirstInputDelay=function(n){e.push(n),s()}}(addEventListener,removeEventListener)</script><title data-rh="true">Low Power NB-IoT on STM32 Blue Pill with Apache Mynewt and Embedded Rust</title><meta data-rh="true" charset="utf-8"/><meta data-rh="true" name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/><meta data-rh="true" name="theme-color" content="#000000"/><meta data-rh="true" name="twitter:app:name:iphone" content="Medium"/><meta data-rh="true" name="twitter:app:id:iphone" content="828256236"/><meta data-rh="true" property="al:ios:app_name" content="Medium"/><meta data-rh="true" property="al:ios:app_store_id" content="828256236"/><meta data-rh="true" property="al:android:package" content="com.medium.reader"/><meta data-rh="true" property="fb:app_id" content="542599432471018"/><meta data-rh="true" property="og:site_name" content="Medium"/><meta data-rh="true" property="og:type" content="article"/><meta data-rh="true" property="article:published_time" content="2019-10-18T05:45:42.236Z"/><meta data-rh="true" name="title" content="Low Power NB-IoT on STM32 Blue Pill with Apache Mynewt and Embedded Rust"/><meta data-rh="true" property="og:title" content="Low Power NB-IoT on STM32 Blue Pill with Apache Mynewt and Embedded Rust"/><meta data-rh="true" property="twitter:title" content="Low Power NB-IoT on STM32 Blue Pill with Apache Mynewt and Embedded Rust"/><meta data-rh="true" name="twitter:site" content="@Medium"/><meta data-rh="true" name="twitter:app:url:iphone" content="medium://p/cef5a3ecdd90"/><meta data-rh="true" property="al:android:url" content="medium://p/cef5a3ecdd90"/><meta data-rh="true" property="al:ios:url" content="medium://p/cef5a3ecdd90"/><meta data-rh="true" property="al:android:app_name" content="Medium"/><meta data-rh="true" name="description" content="How much power do Quectel NB-IoT modules consume? Let’s find out with the RuiDeng DPS 3005"/><meta data-rh="true" property="og:description" content="How much power do Quectel NB-IoT modules consume? Let’s find out with the RuiDeng DPS 3005"/><meta data-rh="true" property="twitter:description" content="How much power do Quectel NB-IoT modules consume? Let’s find out with the RuiDeng DPS 3005"/><meta data-rh="true" property="og:url" content="https://web.archive.org/web/20191204194117/https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90"/><meta data-rh="true" property="al:web:url" content="https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90"/><meta data-rh="true" property="og:image" content="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/1200/1*kEsNkF1AtQAE8J5ggHDH8w.png"/><meta data-rh="true" name="twitter:image:src" content="https://miro.medium.com/max/1200/1*kEsNkF1AtQAE8J5ggHDH8w.png"/><meta data-rh="true" name="twitter:card" content="summary_large_image"/><meta data-rh="true" property="article:author" content="https://medium.com/@ly.lee"/><meta data-rh="true" name="twitter:creator" content="@MisterTechBlog"/><meta data-rh="true" name="author" content="Lup Yuen Lee 李立源"/><meta data-rh="true" name="robots" content="index,follow"/><meta data-rh="true" name="referrer" content="unsafe-url"/><meta data-rh="true" name="twitter:label1" value="Reading time"/><meta data-rh="true" name="twitter:data1" value="16 min read"/><meta data-rh="true" name="parsely-post-id" content="cef5a3ecdd90"/><link data-rh="true" rel="publisher" href="https://plus.google.com/103654360130207659246"/><link data-rh="true" rel="search" type="application/opensearchdescription+xml" title="Medium" href="/web/20191204194117/https://medium.com/osd.xml"/><link data-rh="true" rel="apple-touch-icon" sizes="152x152" href="https://web.archive.org/web/20191204194117im_/https://cdn-images-1.medium.com/fit/c/152/152/1*8I-HPL0bfoIzGied-dzOvA.png"/><link data-rh="true" rel="apple-touch-icon" sizes="120x120" href="https://web.archive.org/web/20191204194117im_/https://cdn-images-1.medium.com/fit/c/120/120/1*8I-HPL0bfoIzGied-dzOvA.png"/><link data-rh="true" rel="apple-touch-icon" sizes="76x76" href="https://web.archive.org/web/20191204194117im_/https://cdn-images-1.medium.com/fit/c/76/76/1*8I-HPL0bfoIzGied-dzOvA.png"/><link data-rh="true" rel="apple-touch-icon" sizes="60x60" href="https://web.archive.org/web/20191204194117im_/https://cdn-images-1.medium.com/fit/c/60/60/1*8I-HPL0bfoIzGied-dzOvA.png"/><link data-rh="true" rel="mask-icon" href="https://web.archive.org/web/20191204194117im_/https://cdn-static-1.medium.com/_/fp/icons/monogram-mask.KPLCSFEZviQN0jQ7veN2RQ.svg" color="#171717"/><link data-rh="true" rel="icon" href="https://web.archive.org/web/20191204194117im_/https://cdn-static-1.medium.com/_/fp/icons/favicon-rebrand-medium.3Y6xpZ-0FSdWDnPM3hSBIA.ico"/><link data-rh="true" id="glyph_link" rel="stylesheet" type="text/css" href="https://web.archive.org/web/20191204194117cs_/https://glyph.medium.com/css/e/sr/latin/e/ssr/latin/e/ssb/latin/m2.css"/><link data-rh="true" rel="author" href="https://medium.com/@ly.lee"/><link data-rh="true" rel="canonical" href="https://web.archive.org/web/20191204194117/https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90"/><link data-rh="true" rel="alternate" href="https://web.archive.org/web/20191204194117/android-app://com.medium.reader/https/medium.com/p/cef5a3ecdd90"/><script data-rh="true" type="application/ld+json">{"@context":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttp:\u002F\u002Fschema.org","@type":"NewsArticle","image":["https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fmiro.medium.com\u002Fmax\u002F1200\u002F1*kEsNkF1AtQAE8J5ggHDH8w.png"],"url":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90","dateCreated":"2019-08-30T12:25:35.187Z","datePublished":"2019-08-30T12:25:35.187Z","dateModified":"2019-10-18T05:45:42.626Z","headline":"Low Power NB-IoT on STM32 Blue Pill with Apache Mynewt and Embedded Rust","name":"Low Power NB-IoT on STM32 Blue Pill with Apache Mynewt and Embedded Rust","description":"How much power do Quectel NB-IoT modules consume? Let’s find out with the RuiDeng DPS 3005","identifier":"cef5a3ecdd90","keywords":["Lite:true","Tag:Programming","Tag:Rust","Tag:Stm32","Tag:Internet of Things","Tag:Nb Iot","Elevated:false","LockedPostSource:LOCKED_POST_SOURCE_NONE","LayerCake:0"],"author":{"@type":"Person","name":"Lup Yuen Lee 李立源","url":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee"},"creator":["Lup Yuen Lee 李立源"],"publisher":{"@type":"Organization","name":"Medium","url":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fmedium.com\u002F","logo":{"@type":"ImageObject","width":308,"height":60,"url":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fmiro.medium.com\u002Fmax\u002F616\u002F1*OMF3fSqH8t4xBJ9-6oZDZw.png"}},"mainEntityOfPage":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90"}</script><script data-rh="true">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://web.archive.org/web/20191204194117/https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-24232453-2', 'auto');
ga('send', 'pageview');</script><link rel="preload" href="https://web.archive.org/web/20191204194117/https://cdn.optimizely.com/js/16180790160.js" as="script"><style type="text/css" data-fela-rehydration="478" data-fela-type="STATIC">html{box-sizing:border-box}*, *:before, *:after{box-sizing:inherit}body{margin:0;padding:0;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;color:rgba(0,0,0,0.8);position:relative;min-height:100vh}h1, h2, h3, h4, h5, h6, dl, dd, ol, ul, menu, figure, blockquote, p, pre, form{margin:0}menu, ol, ul{padding:0;list-style:none;list-style-image:none}main{display:block}a{color:inherit;text-decoration:none}a, button, input{-webkit-tap-highlight-color:transparent}img, svg{vertical-align:middle}button{background:transparent;overflow:visible}button, input, optgroup, select, textarea{margin:0}</style><style type="text/css" data-fela-rehydration="478" data-fela-type="KEYFRAME">@-webkit-keyframes k1{0%{transform:scale(1);opacity:1}70%{transform:scale(1.4);opacity:0}100%{opacity:0}}@-moz-keyframes k1{0%{transform:scale(1);opacity:1}70%{transform:scale(1.4);opacity:0}100%{opacity:0}}@keyframes k1{0%{transform:scale(1);opacity:1}70%{transform:scale(1.4);opacity:0}100%{opacity:0}}</style><style type="text/css" data-fela-rehydration="478" data-fela-type="RULE">.a{font-family:medium-content-sans-serif-font, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif}.b{font-weight:400}.c{background-color:rgba(255, 255, 255, 1)}.l{height:100vh}.m{width:100vw}.n{display:flex}.o{align-items:center}.p{justify-content:center}.q{fill:rgba(0, 0, 0, 0.84)}.r{display:block}.s{position:fixed}.t{top:0}.u{left:0}.v{right:0}.w{z-index:500}.x{box-shadow:0 4px 12px 0 rgba(0, 0, 0, 0.05)}.ai{max-width:1192px}.aj{min-width:0}.ak{width:100%}.al{height:65px}.ao{flex:1 0 auto}.ap{display:none}.ar{flex:0 0 auto}.as{visibility:hidden}.at{color:inherit}.au{fill:inherit}.av{font-size:inherit}.aw{border:inherit}.ax{font-family:inherit}.ay{letter-spacing:inherit}.az{font-weight:inherit}.ba{padding:0}.bb{margin:0}.bc:hover{cursor:pointer}.bd:hover{color:rgba(0, 0, 0, 0.9)}.be:hover{fill:rgba(0, 0, 0, 0.9)}.bf:focus{outline:none}.bg:disabled{cursor:default}.bh:disabled{color:rgba(0, 0, 0, 0.54)}.bi:disabled{fill:rgba(0, 0, 0, 0.54)}.bj{font-family:medium-content-sans-serif-font, "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", Geneva, Arial, sans-serif}.bk{font-style:normal}.bl{line-height:20px}.bm{font-size:15.8px}.bn{letter-spacing:0px}.bo{color:rgba(0, 0, 0, 0.54)}.bp{fill:rgba(0, 0, 0, 0.54)}.bq{margin-left:16px}.br{color:rgba(2, 158, 116, 1)}.bs{fill:rgba(3, 168, 124, 1)}.bt:hover{color:rgba(1, 143, 105, 1)}.bu:hover{fill:rgba(2, 158, 116, 1)}.bv:disabled{color:rgba(3, 168, 124, 0.5)}.bw:disabled{fill:rgba(3, 168, 124, 0.5)}.bx{padding:8px 16px}.by{background:0}.bz{border-color:rgba(3, 168, 124, 1)}.ca:hover{border-color:rgba(2, 158, 116, 1)}.cb{border-radius:4px}.cc{border-width:1px}.cd{border-style:solid}.ce{box-sizing:border-box}.cf{display:inline-block}.cg{text-decoration:none}.ch{margin-bottom:0px}.cj{padding-left:24px}.ck{padding-right:24px}.cl{margin-left:auto}.cm{margin-right:auto}.cn{max-width:728px}.co{flex-direction:column}.cp{position:absolute}.cq{top:calc(100vh + 100px)}.cr{bottom:calc(100vh + 100px)}.cs{width:10px}.ct{pointer-events:none}.cu{word-break:break-word}.cv{word-wrap:break-word}.cw:after{display:block}.cx:after{content:""}.cy:after{clear:both}.cz{clear:both}.da{margin-top:0px}.db{transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1)}.dc{cursor:zoom-in}.dd{position:relative}.de{z-index:auto}.df{opacity:0}.dg{transition:opacity 100ms 400ms}.dh{height:100%}.di{overflow:hidden}.dj{will-change:transform}.dk{transform:translateZ(0)}.dl{margin:auto}.dm{background-color:rgba(0, 0, 0, 0.05)}.dn{padding-bottom:59.803921568627445%}.do{filter:blur(20px)}.dp{transform:scale(1.1)}.dq{visibility:visible}.dr{background:rgba(255, 255, 255, 1)}.ds{font-size:16px}.dt{line-height:1.4}.du{margin-top:10px}.dv{text-align:center}.dy{font-weight:300}.dz{max-width:680px}.ea{line-height:1.23}.eb{letter-spacing:0}.ec{color:rgba(0, 0, 0, 0.84)}.ed{font-family:medium-content-title-font, Georgia, Cambria, "Times New Roman", Times, serif}.ee{font-size:40px}.ek{margin-bottom:-0.27em}.el{line-height:48px}.em{margin-top:32px}.en{justify-content:space-between}.er{width:48px}.es{height:48px}.et{flex-direction:row}.eu{width:calc(100% + 25px)}.ev{height:calc(100% + 25px)}.ew{top:50%}.ex{left:50%}.ey{transform:translateX(-50%) translateY(-50%)}.ez{border-radius:50%}.fa{margin-left:12px}.fb{margin-bottom:2px}.fd{max-height:20px}.fe{text-overflow:ellipsis}.ff{display:-webkit-box}.fg{-webkit-line-clamp:1}.fh{-webkit-box-orient:vertical}.fi:hover{text-decoration:underline}.fj{margin-left:8px}.fk{padding:0px 8px}.fl{border-color:rgba(0, 0, 0, 0.54)}.fm:hover{color:rgba(0, 0, 0, 0.97)}.fn:hover{fill:rgba(0, 0, 0, 0.97)}.fo:hover{border-color:rgba(0, 0, 0, 0.84)}.fp:disabled{fill:rgba(0, 0, 0, 0.76)}.fq:disabled{border-color:rgba(0, 0, 0, 0.2)}.fr:disabled{cursor:inherit}.fs:disabled:hover{color:rgba(0, 0, 0, 0.54)}.ft:disabled:hover{fill:rgba(0, 0, 0, 0.76)}.fu:disabled:hover{border-color:rgba(0, 0, 0, 0.2)}.fv{line-height:18px}.fw{font-size:15px}.fx{align-items:flex-end}.gf{padding-right:8px}.gg{margin-right:-6px}.gh{line-height:1.58}.gi{letter-spacing:-0.004em}.gj{font-family:medium-content-serif-font, Georgia, Cambria, "Times New Roman", Times, serif}.gu{margin-bottom:-0.46em}.gv{background-repeat:repeat-x}.gw{background-image:linear-gradient(to right,rgba(0, 0, 0, 0.84) 100%,rgba(0, 0, 0, 0.84) 0);background-image:url('data:image/svg+xml;utf8,<svg preserveAspectRatio="none" viewBox="0 0 1 1" xmlns="http://www.w3.org/2000/svg"><line x1="0" y1="0" x2="1" y2="1" stroke="rgba(0, 0, 0, 0.84)" /></svg>')}.gx{background-size:1px 1px}.gy{background-position:0 1.05em;background-position:0 calc(1em + 1px)}.he{padding-bottom:22.663408674404398%}.hf{padding-bottom:22.705018359853124%}.hg{padding-bottom:25.75%}.hh{font-style:italic}.hi{font-weight:700}.hr{max-width:1563px}.hs{padding-bottom:5px}.ht{padding-top:5px}.hu{padding-bottom:45.361484325015994%}.hv{font-family:medium-content-slab-serif-font, Georgia, Cambria, "Times New Roman", Times, serif}.hw{font-size:28px}.hx{border:none}.hy{margin-top:30px}.hz:before{content:"..."}.ia:before{letter-spacing:0.6em}.ib:before{text-indent:0.6em}.ic:before{font-style:italic}.id:before{line-height:1.4}.ie{line-height:1.12}.if{letter-spacing:-0.022em}.ig{font-weight:600}.ir{margin-bottom:-0.28em}.ix{padding:2px 4px}.iy{font-size:75%}.iz> strong{font-family:inherit}.ja{font-family:Menlo, Monaco, "Courier New", Courier, monospace}.jb{box-shadow:inset 3px 0 0 0 rgba(0, 0, 0, 0.84)}.jc{padding-left:23px}.jd{margin-left:-20px}.je{max-width:1597px}.jf{padding-bottom:45.02191609267376%}.jg{padding-bottom:NaN%}.jh{padding:20px}.ji{background:rgba(0, 0, 0, 0.05)}.jj{overflow-x:auto}.jk{line-height:1.18}.jl{margin-top:-0.09em}.jm{margin-bottom:-0.09em}.jn{white-space:pre-wrap}.jo{max-width:360px}.jp{border-width:2px}.jq{border-color:rgba(255, 255, 255, 1)}.jr{float:left}.js{margin-left:-150px}.jt{margin-right:30px}.ju{width:75%}.jv{padding-bottom:10px}.ka{margin-bottom:16px}.kb{padding-bottom:189.44444444444446%}.kc{padding-bottom:57.824933687002655%}.kd{max-width:1648px}.ke{padding-bottom:45.02427184466019%}.kf{max-width:1622px}.kg{padding-bottom:45.745992601726265%}.kh{max-width:3264px}.ki{padding-bottom:75%}.kj{max-width:657px}.kk{padding-bottom:82.34398782343987%}.kl{max-width:6003px}.km{padding-bottom:33.34999167083125%}.kn{max-width:1800px}.ko{padding-bottom:2.7777777777777777%}.kp{padding-left:30px}.kq{line-height:1.48}.kr{letter-spacing:-0.014em}.ks{color:rgba(0, 0, 0, 0.76)}.kt{font-size:24px}.kz{font-size:30px}.la{line-height:44px}.lg{padding-bottom:62.46936274509804%}.ll{max-width:2322px}.lm{padding-bottom:105.42635658914729%}.ln{max-width:1854px}.lo{padding-bottom:58.25242718446602%}.lu{box-shadow:0 1px 4px rgba(0, 0, 0, 0.1), inset 0 0 0 1px rgba(0, 0, 0, 0.1)}.lv{max-height:40px}.lw{-webkit-line-clamp:2}.lx{padding:0px}.mn{padding:16px 20px}.mo{flex:1 1 auto}.mq{font-size:18px}.mr{margin-top:8px}.ms{margin-top:12px}.mt{width:160px}.mu{background-image:url(https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/320/1*XcYoOVYrHL-Dv8-MsRkLLw.png)}.mv{background-origin:border-box}.mw{background-size:cover}.mx{height:167px}.my{background-position:50% 50%}.mz{max-width:100%}.na{box-shadow:inset 0 0 0 1px rgba(0, 0, 0, 0.1)}.nb{max-width:957px}.nc{padding-bottom:42.215256008359454%}.nd{max-width:1654px}.ne{padding-bottom:134.64328899637243%}.nf{max-width:794px}.ng{padding-bottom:85.89420654911838%}.nh{padding-bottom:84.41582336706531%}.ni{will-change:opacity}.nj{top:calc(65px + 54px + 40px)}.nm{width:131px}.nn{padding-top:28px}.no{margin-bottom:19px}.np{margin-left:-5px}.nq{margin-right:5px}.nr{outline:0}.ns{border:0}.nt{user-select:none}.nu{cursor:pointer}.nv> svg{pointer-events:none}.nw:active{border-style:none}.nx{-webkit-user-select:none}.ny{fill:rgba(0, 0, 0, 0.76)}.nz:focus{fill:rgba(0, 0, 0, 0.54)}.oa:hover{fill:rgba(0, 0, 0, 0.54)}.ob{margin-top:5px}.oc button{text-align:left}.od{width:188px}.oe{transform:translateX(406px)}.of{top:calc(65px + 54px + 14px)}.oh{margin-top:40px}.oi{flex-wrap:wrap}.oj{margin-top:25px}.ok{list-style-type:none}.ol{margin-right:8px}.om{margin-bottom:8px}.on{border-radius:3px}.oo{padding:5px 10px}.op{line-height:22px}.oq{margin-top:15px}.or{margin-right:16px}.os{border:1px solid rgba(0, 0, 0, 0.1)}.ot{height:60px}.ou{width:60px}.ph:hover{border-color:rgba(0, 0, 0, 0.54)}.pi:active{border-style:solid}.pj{z-index:2}.pl{padding-top:32px}.pm{border-top:1px solid rgba(0, 0, 0, 0.1)}.pn{margin-bottom:25px}.po{margin-bottom:32px}.pp{min-height:80px}.pu{width:80px}.pv{height:80px}.pw{padding-left:102px}.py{text-transform:uppercase}.pz{letter-spacing:0.05em}.qa{margin-bottom:6px}.qb{line-height:36px}.qc{padding:4px 12px}.qd{max-width:555px}.qe{max-width:450px}.qf{line-height:24px}.qh{padding-top:25px}.qi{opacity:1}.qj{border:1px solid rgba(3, 168, 124, 1)}.qk{margin-top:64px}.ql{background-color:rgba(0, 0, 0, 0.02)}.qm{padding:60px 0}.qn{background-color:rgba(0, 0, 0, 0.9)}.qp{padding-bottom:48px}.qq{border-bottom:1px solid rgba(255, 255, 255, 0.54)}.qr{margin:0 -12px}.qs{margin:0 12px}.qt{flex:1 1 0}.qu{padding-bottom:12px}.qv:hover{color:rgba(255, 255, 255, 0.99)}.qw:hover{fill:rgba(255, 255, 255, 0.99)}.qx:disabled{color:rgba(255, 255, 255, 0.7)}.qy:disabled{fill:rgba(255, 255, 255, 0.7)}.qz{color:rgba(255, 255, 255, 0.98)}.ra{fill:rgba(255, 255, 255, 0.98)}.rb{text-align:inherit}.rc{font-size:21.6px}.rd{letter-spacing:-0.32px}.re{color:rgba(255, 255, 255, 0.7)}.rf{fill:rgba(255, 255, 255, 0.7)}.rg{text-decoration:underline}.rh{padding-bottom:8px}.ri{padding-top:8px}.rj{width:200px}</style><style type="text/css" data-fela-rehydration="478" data-fela-type="RULE" media="all and (min-width: 1080px)">.d{display:none}.ah{margin:0 64px}.ej{margin-top:0.78em}.ge{margin-left:30px}.gs{font-size:21px}.gt{margin-top:2em}.hd{margin-top:56px}.hq{max-width:1192px}.ip{font-size:34px}.iq{margin-top:1.25em}.iw{margin-top:0.86em}.ky{margin-top:2.75em}.lf{margin-top:80px}.lt{margin-top:32px}.mk{padding-left:64px}.ml{padding-right:64px}.mm{max-width:1320px}</style><style type="text/css" data-fela-rehydration="478" data-fela-type="RULE" media="all and (max-width: 1079.98px)">.e{display:none}.dw{margin-left:auto}.dx{text-align:center}.gd{margin-left:30px}.jw{float:none}.jx{margin-left:0}.jy{margin-right:0}.jz{width:100%}.mh{padding-left:64px}.mi{padding-right:64px}.mj{max-width:1080px}</style><style type="text/css" data-fela-rehydration="478" data-fela-type="RULE" media="all and (max-width: 903.98px)">.f{display:none}.gc{margin-left:30px}.lh{float:none}.li{margin-left:0}.lj{margin-right:0}.lk{width:100%}.me{padding-left:48px}.mf{padding-right:48px}.mg{max-width:904px}</style><style type="text/css" data-fela-rehydration="478" data-fela-type="RULE" media="all and (max-width: 727.98px)">.g{display:none}.am{height:56px}.an{display:flex}.aq{display:block}.ci{margin-bottom:0px}.ep{margin-top:32px}.eq{flex-direction:column-reverse}.ga{margin-bottom:30px}.gb{margin-left:0px}.mb{padding-left:24px}.mc{padding-right:24px}.md{max-width:728px}.mp{padding:10px 12px 10px}.pq{margin-bottom:24px}.pr{align-items:center}.ps{width:102px}.pt{position:relative}.px{padding-left:0}.qg{margin-top:24px}.qo{padding:32px 0}.rk{width:140px}</style><style type="text/css" data-fela-rehydration="478" data-fela-type="RULE" media="all and (max-width: 551.98px)">.h{display:none}.ac{margin:0 24px}.ef{margin-top:0.39em}.eo{margin-top:32px}.fc{margin-bottom:0px}.fy{margin-bottom:30px}.fz{margin-left:0px}.gk{font-size:18px}.gl{margin-top:1.56em}.gz{margin-top:40px}.hj{margin:0}.hk{max-width:100%}.ih{font-size:30px}.ii{margin-top:0.93em}.is{margin-top:0.67em}.ku{margin-top:1.42em}.lb{margin-top:48px}.lp{margin-top:24px}.ly{padding-left:24px}.lz{padding-right:24px}.ma{max-width:552px}</style><style type="text/css" data-fela-rehydration="478" data-fela-type="RULE" media="all and (min-width: 904px) and (max-width: 1079.98px)">.i{display:none}.ag{margin:0 64px}.ei{margin-top:0.78em}.gq{font-size:21px}.gr{margin-top:2em}.hc{margin-top:56px}.hp{max-width:1192px}.in{font-size:34px}.io{margin-top:1.25em}.iv{margin-top:0.86em}.kx{margin-top:2.75em}.le{margin-top:80px}.ls{margin-top:32px}</style><style type="text/css" data-fela-rehydration="478" data-fela-type="RULE" media="all and (min-width: 728px) and (max-width: 903.98px)">.j{display:none}.af{margin:0 48px}.eh{margin-top:0.78em}.go{font-size:21px}.gp{margin-top:2em}.hb{margin-top:56px}.hn{margin:0}.ho{max-width:100%}.il{font-size:34px}.im{margin-top:1.25em}.iu{margin-top:0.86em}.kw{margin-top:2.75em}.ld{margin-top:80px}.lr{margin-top:32px}</style><style type="text/css" data-fela-rehydration="478" data-fela-type="RULE" media="all and (min-width: 552px) and (max-width: 727.98px)">.k{display:none}.ae{margin:0 24px}.eg{margin-top:0.39em}.gm{font-size:18px}.gn{margin-top:1.56em}.ha{margin-top:40px}.hl{margin:0}.hm{max-width:100%}.ij{font-size:30px}.ik{margin-top:0.93em}.it{margin-top:0.67em}.kv{margin-top:1.42em}.lc{margin-top:48px}.lq{margin-top:24px}</style><style type="text/css" data-fela-rehydration="478" data-fela-type="RULE" media="print">.ab{display:none}</style><style type="text/css" data-fela-rehydration="478" data-fela-type="RULE" media="(prefers-reduced-motion: no-preference)">.y{transition:transform 300ms ease}.z{will-change:transform}.nk{transition:opacity 200ms}.ov{transition:border-color 150ms ease}.ow::before{background:
      radial-gradient(circle, rgba(0, 0, 0, 0.84) 60%, transparent 70%)
    }.ox::before{border-radius:50%}.oy::before{content:""}.oz::before{display:block}.pa::before{z-index:0}.pb::before{left:0}.pc::before{height:100%}.pd::before{position:absolute}.pe::before{top:0}.pf::before{width:100%}.pg:hover::before{animation:k1 2000ms infinite cubic-bezier(.1,.12,.25,1)}.pk{transition:fill 200ms ease}</style><style type="text/css" data-fela-rehydration="478" data-fela-type="RULE" media="all and (max-width: 1198px)">.nl{display:none}</style><style type="text/css" data-fela-rehydration="478" data-fela-type="RULE" media="all and (max-width: 1230px)">.og{display:none}</style></head><body><!-- BEGIN WAYBACK TOOLBAR INSERT -->
<style type="text/css">
body {
  margin-top:0 !important;
  padding-top:0 !important;
  /*min-width:800px !important;*/
}
</style>
<script>__wm.rw(0);</script>
<div id="wm-ipp-base" lang="en" style="display:none;direction:ltr;">
<div id="wm-ipp" style="position:fixed;left:0;top:0;right:0;">
<div id="wm-ipp-inside">
  <div style="position:relative;">
    <div id="wm-logo" style="float:left;width:110px;padding-top:12px;">
      <a href="/web/" title="Wayback Machine home page"><img src="/_static/images/toolbar/wayback-toolbar-logo-200.png" srcset="/_static/images/toolbar/wayback-toolbar-logo-100.png, /_static/images/toolbar/wayback-toolbar-logo-150.png 1.5x, /_static/images/toolbar/wayback-toolbar-logo-200.png 2x" alt="Wayback Machine" style="width:100px" border="0" /></a>
    </div>
    <div class="r" style="float:right;">
      <div id="wm-btns" style="text-align:right;height:25px;">
                  <div id="wm-save-snapshot-success">success</div>
          <div id="wm-save-snapshot-fail">fail</div>
          <a id="wm-save-snapshot-open" href="#"
	     title="Share via My Web Archive" >
            <span class="iconochive-web"></span>
          </a>
          <a href="https://archive.org/account/login.php"
             title="Sign In"
             id="wm-sign-in"
          >
            <span class="iconochive-person"></span>
          </a>
          <span id="wm-save-snapshot-in-progress" class="iconochive-web"></span>
        	<a href="http://faq.web.archive.org/" title="Get some help using the Wayback Machine" style="top:-6px;"><span class="iconochive-question" style="color:rgb(87,186,244);font-size:160%;"></span></a>
	<a id="wm-tb-close" href="#close" onclick="__wm.h(event);return false;" style="top:-2px;" title="Close the toolbar"><span class="iconochive-remove-circle" style="color:#888888;font-size:240%;"></span></a>
      </div>
      <div id="wm-share">
          <a href="/web/20191204194117/http://web.archive.org/screenshot/https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90?source=friends_link&sk=e232e68dc7c91dd4397e96d7dbde543a"
             id="wm-screenshot"
             title="screenshot">
            <span class="wm-icon-screen-shot"></span>
          </a>
	<a id="wm-share-facebook" href="#" data-url="https://web.archive.org/web/20191204194117/https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90?source=friends_link&amp;sk=e232e68dc7c91dd4397e96d7dbde543a" title="Share on Facebook" style="margin-right:5px;" target="_blank"><span class="iconochive-facebook" style="color:#3b5998;font-size:160%;"></span></a>
	<a id="wm-share-twitter" href="#" data-url="https://web.archive.org/web/20191204194117/https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90?source=friends_link&amp;sk=e232e68dc7c91dd4397e96d7dbde543a" title="Share on Twitter" style="margin-right:5px;" target="_blank"><span class="iconochive-twitter" style="color:#1dcaff;font-size:160%;"></span></a>
      </div>
    </div>
    <table class="c" style="">
      <tbody>
	<tr>
	  <td class="u" colspan="2">
	    <form target="_top" method="get" action="/web/submit" name="wmtb" id="wmtb"><input type="text" name="url" id="wmtbURL" value="https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90?source=friends_link&sk=e232e68dc7c91dd4397e96d7dbde543a" onfocus="this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20191204194117" /><input type="submit" value="Go" /></form>
	  </td>
	  <td class="n" rowspan="2" style="width:110px;">
	    <table>
	      <tbody>
		<!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
		<tr class="m">
		  <td class="b" nowrap="nowrap">Nov</td>
		  <td class="c" id="displayMonthEl" title="You are here: 19:41:17 Dec 04, 2019">DEC</td>
		  <td class="f" nowrap="nowrap">Jan</td>
		</tr>
		<!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
		<tr class="d">
		  <td class="b" nowrap="nowrap"><img src="/_static/images/toolbar/wm_tb_prv_off.png" alt="Previous capture" width="14" height="16" border="0" /></td>
		  <td class="c" id="displayDayEl" style="width:34px;font-size:24px;white-space:nowrap;" title="You are here: 19:41:17 Dec 04, 2019">04</td>
		  <td class="f" nowrap="nowrap"><img src="/_static/images/toolbar/wm_tb_nxt_off.png" alt="Next capture" width="14" height="16" border="0" /></td>
		</tr>
		<!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
		<tr class="y">
		  <td class="b" nowrap="nowrap">2018</td>
		  <td class="c" id="displayYearEl" title="You are here: 19:41:17 Dec 04, 2019">2019</td>
		  <td class="f" nowrap="nowrap">2020</td>
		</tr>
	      </tbody>
	    </table>
	  </td>
	</tr>
	<tr>
	  <td class="s">
	    	    <div id="wm-nav-captures">
	      	      <a class="t" href="/web/20191204194117*/https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90?source=friends_link&sk=e232e68dc7c91dd4397e96d7dbde543a" title="See a list of every capture for this URL">1 capture</a>
	      <div class="r" title="Timespan for captures of this URL">04 Dec 2019</div>
	      </div>
	  </td>
	  <td class="k">
	    <a href="" id="wm-graph-anchor">
	      <div id="wm-ipp-sparkline" title="Explore captures for this URL" style="position: relative">
		<canvas id="wm-sparkline-canvas" width="650" height="27" border="0"></canvas>
	      </div>
	    </a>
	  </td>
	</tr>
      </tbody>
    </table>
    <div style="position:absolute;bottom:0;right:2px;text-align:right;">
      <a id="wm-expand" class="wm-btn wm-closed" href="#expand" onclick="__wm.ex(event);return false;"><span id="wm-expand-icon" class="iconochive-down-solid"></span> <span style="font-size:80%">About this capture</span></a>
    </div>
  </div>
    <div id="wm-capinfo" style="border-top:1px solid #777;display:none; overflow: hidden">
                    <div id="wm-capinfo-collected-by">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center">COLLECTED BY</div>
    <div style="padding:3px;position:relative" id="wm-collected-by-content">
            <div style="display:inline-block;vertical-align:top;width:50%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/ArchiveIt-Partner-1028);"></span>
		Organization: <a style="color:#33f;" href="https://archive.org/details/ArchiveIt-Partner-1028" target="_new"><span class="wm-title">Mark Graham&#39;s Archive-IT Collections</span></a>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  This is a set of web collections curated by Mark Graham using the <a href="http://archive-it.org">Archive-IT</a> service of the <a href="http//archive.org">Internet Archive.</a>
<br>
<br>
They include web captures of the ISKME.org website as well as captures from sites hosted by IGC.org.
<br>
<br>
<br><br>
These web captures are available to the general public.
<br>
<br>
For more information about this collection please feel free to contact Mark via <a href="mailto:mark@archive.org?Subject=Question%20about%20you%20Archive-IT%20Collection" target="_top">Send Mail</a>
	</div>
	      </div>
      <div style="display:inline-block;vertical-align:top;width:49%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/ArchiveIt-Collection-8332)"></span>
		<div>Collection: <a style="color:#33f;" href="https://archive.org/details/ArchiveIt-Collection-8332" target="_new"><span class="wm-title">General Crawls</span></a></div>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  Archive-It Partner 1028: Mark Graham - Collection 8332: General Crawls
	</div>
	      </div>
    </div>
    </div>
    <div id="wm-capinfo-timestamps">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center" title="Timestamps for the elements of this page">TIMESTAMPS</div>
    <div>
      <div id="wm-capresources" style="margin:0 5px 5px 5px;max-height:250px;overflow-y:scroll !important"></div>
      <div id="wm-capresources-loading" style="text-align:left;margin:0 20px 5px 5px;display:none"><img src="/_static/images/loading.gif" alt="loading" /></div>
    </div>
    </div>
  </div></div></div></div><div id="donato" style="position:relative;width:100%;">
  <div id="donato-base">
    <iframe id="donato-if" src="https://archive.org/includes/donate.php?as_page=1&amp;platform=wb&amp;referer=https%3A//web.archive.org/web/20191204194117/https%3A//medium.com/%2540ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90%3Fsource%3Dfriends_link%26sk%3De232e68dc7c91dd4397e96d7dbde543a"
	    scrolling="no" frameborder="0" style="width:100%; height:100%">
    </iframe>
  </div>
</div><script type="text/javascript">
__wm.bt(650,27,25,2,"web","https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90?source=friends_link&sk=e232e68dc7c91dd4397e96d7dbde543a","20191204194117",1996,"/_static/",["/_static/css/banner-styles.css?v=bsmaklHF","/_static/css/iconochive.css?v=qtvMKcIJ"]);
  __wm.rw(1);
</script>
<!-- END WAYBACK TOOLBAR INSERT --><div id="root"><div class="a b c"><div class="d e f g h i j k"></div><script>document.domain = document.domain;</script><script>window.PARSELY = window.PARSELY || {autotrack: false}</script><nav class="r s t u v c w x y z ab"><div class="branch-journeys-top"><div class="n p"><div class="ac ae af ag ah ai aj ak"><div class="al n o am an"><div class="r ao w"><div class="n o"><a aria-label="Homepage" rel="noopener" href="/web/20191204194117/https://medium.com/?source=post_page-----cef5a3ecdd90----------------------"><div class="ap g"><svg height="22" width="112" viewbox="0 0 111.5 22" class="q"><path d="M56.3 19.5c0 .4 0 .5.3.7l1.5 1.4v.1h-6.5V19c-.7 1.8-2.4 3-4.3 3-3.3 0-5.8-2.6-5.8-7.5 0-4.5 2.6-7.6 6.3-7.6 1.6-.1 3.1.8 3.8 2.4V3.2c0-.3-.1-.6-.3-.7l-1.4-1.4V1l6.5-.8v19.3zm-4.8-.8V9.5c-.5-.6-1.2-.9-1.9-.9-1.6 0-3.1 1.4-3.1 5.7 0 4 1.3 5.4 3 5.4.8.1 1.6-.3 2-1zm9.1 3.1V9.4c0-.3-.1-.6-.3-.7l-1.4-1.5v-.1h6.5v12.5c0 .4 0 .5.3.7l1.4 1.4v.1h-6.5zm-.2-19.2C60.4 1.2 61.5 0 63 0c1.4 0 2.6 1.2 2.6 2.6S64.4 5.3 63 5.3a2.6 2.6 0 0 1-2.6-2.7zm22.5 16.9c0 .4 0 .5.3.7l1.5 1.4v.1h-6.5v-3.2c-.6 2-2.4 3.4-4.5 3.4-2.9 0-4.4-2.1-4.4-6.2 0-1.9 0-4.1.1-6.5 0-.3-.1-.5-.3-.7L67.7 7v.1H74v8c0 2.6.4 4.4 2 4.4.9-.1 1.7-.6 2.1-1.3V9.5c0-.3-.1-.6-.3-.7l-1.4-1.5v-.2h6.5v12.4zm22 2.3c0-.5.1-6.5.1-7.9 0-2.6-.4-4.5-2.2-4.5-.9 0-1.8.5-2.3 1.3.2.8.3 1.7.3 2.5 0 1.8-.1 4.2-.1 6.5 0 .3.1.5.3.7l1.5 1.4v.1H96c0-.4.1-6.5.1-7.9 0-2.7-.4-4.5-2.2-4.5-.9 0-1.7.5-2.2 1.3v9c0 .4 0 .5.3.7l1.4 1.4v.1h-6.5V9.5c0-.3-.1-.6-.3-.7l-1.4-1.5v-.2h6.5v3.1a4.6 4.6 0 0 1 4.6-3.4c2.2 0 3.6 1.2 4.2 3.5.7-2.1 2.7-3.6 4.9-3.5 2.9 0 4.5 2.2 4.5 6.2 0 1.9-.1 4.2-.1 6.5-.1.3.1.6.3.7l1.4 1.4v.1h-6.6zm-81.4-2l1.9 1.9v.1h-9.8v-.1l2-1.9c.2-.2.3-.4.3-.7V7.3c0-.5 0-1.2.1-1.8L11.4 22h-.1L4.5 6.8c-.1-.4-.2-.4-.3-.6v10c-.1.7 0 1.3.3 1.9l2.7 3.6v.1H0v-.1L2.7 18c.3-.6.4-1.3.3-1.9v-11c0-.5-.1-1.1-.5-1.5L.7 1.1V1h7l5.8 12.9L18.6 1h6.8v.1l-1.9 2.2c-.2.2-.3.5-.3.7v15.2c0 .2.1.5.3.6zm7.6-5.9c0 3.8 1.9 5.3 4.2 5.3 1.9.1 3.6-1 4.4-2.7h.1c-.8 3.7-3.1 5.5-6.5 5.5-3.7 0-7.2-2.2-7.2-7.4 0-5.5 3.5-7.6 7.3-7.6 3.1 0 6.4 1.5 6.4 6.2v.8h-8.7zm0-.8h4.3v-.8c0-3.9-.8-4.9-2-4.9-1.4.1-2.3 1.6-2.3 5.7z"></path></svg></div><div class="r aq"><svg width="35" height="35" viewbox="5 5 35 35" class="q"><path d="M5 40V5h35v35H5zm8.56-12.63c0 .56-.03.69-.32 1.03L10.8 31.4v.4h6.97v-.4L15.3 28.4c-.29-.34-.34-.5-.34-1.03v-8.95l6.13 13.36h.71l5.26-13.36v10.64c0 .3 0 .35-.19.53l-1.85 1.8v.4h9.2v-.4l-1.83-1.8c-.18-.18-.2-.24-.2-.53V15.94c0-.3.02-.35.2-.53l1.82-1.8v-.4h-6.47l-4.62 11.55-5.2-11.54h-6.8v.4l2.15 2.63c.24.3.29.37.29.77v10.35z"></path></svg></div></a></div></div><div class="r ar w"><div class="n o"><div class="n g"><div class="as" id="lo-post-page-navbar-upsell-button"><div><a href="https://web.archive.org/web/20191204194117/https://medium.com/membership?source=upgrade_membership---nav_full------------------------" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener"><span class="bj b bk bl bm bn r bo bp">Become a member</span></a></div></div><div class="as" id="lo-post-page-navbar-sign-in-link"><div class="bq r"><span class="bj b bk bl bm bn r bo bp"><a href="https://web.archive.org/web/20191204194117/https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90&amp;source=post_page-----cef5a3ecdd90---------------------nav_reg-" class="br bs av aw ax ay az ba bb bc bt bu bf bg bv bw" rel="noopener">Sign in</a></span></div></div></div><div class="as" id="lo-post-page-navbar-get-started-button"><div class="bq r"><button class="bx by br bs bz bt bu ca bc cb bj b bk bl bm bn cc cd ce cf cg bf">Get started</button></div></div></div></div></div></div></div></div></nav><div class="ch al r ci am"></div><article><section class="cj ck cl cm ak cn ce n co"></section><span class="r"></span><div><div class="cp u cq cr cs ct"></div><section class="cu cv cw cx cy"><div class="cz ak"><figure class="da cz ak paragraph-image"><div class="db dc dd de ak"><div class="dl r dd dm"><div class="dn r"><div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/60/1*kEsNkF1AtQAE8J5ggHDH8w.png?q=20" width="3264" height="1952" role="presentation"/></div><img class="df dg cp t u dh ak dr" width="3264" height="1952" role="presentation"/><noscript><img class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/6528/1*kEsNkF1AtQAE8J5ggHDH8w.png" width="3264" height="1952" role="presentation"/></noscript></div></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">RuiDeng DPS 3005 Power Monitor measuring the power consumption of STM32 Blue Pill connected to Quectel BC95-G NB-IoT module</figcaption></figure></div><div class="n p"><div class="ac ae af ag ah dz aj ak"><div><div id="1bb6" class="ea eb ec bk ed b ee ef eg eh ei ej ek"><h1 class="ed b ee el ec">Low Power NB-IoT on STM32 Blue Pill with Apache Mynewt and Embedded Rust</h1></div><div class="em"><div class="n en eo ep eq"><div class="o n"><div><a rel="noopener" href="/web/20191204194117/https://medium.com/@ly.lee?source=post_page-----cef5a3ecdd90----------------------"><div class="dd er es"><div class="bs n et o p cp eu ev ew ex ey ct"><svg width="57" height="57" viewbox="0 0 57 57"><path fill-rule="evenodd" clip-rule="evenodd" d="M28.5 1.2A27.45 27.45 0 0 0 4.06 15.82L3 15.27A28.65 28.65 0 0 1 28.5 0C39.64 0 49.29 6.2 54 15.27l-1.06.55A27.45 27.45 0 0 0 28.5 1.2zM4.06 41.18A27.45 27.45 0 0 0 28.5 55.8a27.45 27.45 0 0 0 24.44-14.62l1.06.55A28.65 28.65 0 0 1 28.5 57 28.65 28.65 0 0 1 3 41.73l1.06-.55z"></path></svg></div><img alt="Lup Yuen Lee 李立源" class="r ez es er" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/fit/c/96/96/1*KGohS3sQaUnr58gc0BIfoQ.jpeg" width="48" height="48"/></div></a></div><div class="fa ak r"><div class="n"><div style="flex:1"><span class="bj b bk bl bm bn r ec q"><div class="fb n o fc"><span class="bj dy ds bl di fd fe ff fg fh ec"><a class="at au av aw ax ay az ba bb bc fi bf bg bh bi" rel="noopener" href="/web/20191204194117/https://medium.com/@ly.lee?source=post_page-----cef5a3ecdd90----------------------">Lup Yuen Lee 李立源</a></span><div class="fj r ar h"><button class="fk ec q by fl fm fn fo bc bh fp fq fr fs ft fu cb bj b bk fv fw bn cc cd ce cf cg bf">Follow</button></div></div></span></div></div><span class="bj b bk bl bm bn r bo bp"><span class="bj dy ds bl di fd fe ff fg fh bo"><div><a class="at au av aw ax ay az ba bb bc fi bf bg bh bi" rel="noopener" href="/web/20191204194117/https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90?source=post_page-----cef5a3ecdd90----------------------">Aug 30</a> <!-- -->·<!-- --> <!-- -->16<!-- --> min read</div></span></span></div></div><div class="n fx fy fz ga gb gc gd ge ab"><div class="n o"><div class="gf r ar"><a href="//web.archive.org/web/20191204194117/https://medium.com/p/cef5a3ecdd90/share/twitter?source=post_actions_header---------------------------" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" target="_blank" rel="noopener"><svg width="29" height="29" class="q"><path d="M22.05 7.54a4.47 4.47 0 0 0-3.3-1.46 4.53 4.53 0 0 0-4.53 4.53c0 .35.04.7.08 1.05A12.9 12.9 0 0 1 5 6.89a5.1 5.1 0 0 0-.65 2.26c.03 1.6.83 2.99 2.02 3.79a4.3 4.3 0 0 1-2.02-.57v.08a4.55 4.55 0 0 0 3.63 4.44c-.4.08-.8.13-1.21.16l-.81-.08a4.54 4.54 0 0 0 4.2 3.15 9.56 9.56 0 0 1-5.66 1.94l-1.05-.08c2 1.27 4.38 2.02 6.94 2.02 8.3 0 12.86-6.9 12.84-12.85.02-.24 0-.43 0-.65a8.68 8.68 0 0 0 2.26-2.34c-.82.38-1.7.62-2.6.72a4.37 4.37 0 0 0 1.95-2.51c-.84.53-1.81.9-2.83 1.13z"></path></svg></a></div><div class="gf r ar"><a href="//web.archive.org/web/20191204194117/https://medium.com/p/cef5a3ecdd90/share/linkedIn?source=post_actions_header---------------------------" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" target="_blank" rel="noopener"><svg width="29" height="29" viewbox="0 0 29 29" fill="none" class="q"><path d="M5 6.36C5 5.61 5.63 5 6.4 5h16.2c.77 0 1.4.61 1.4 1.36v16.28c0 .75-.63 1.36-1.4 1.36H6.4c-.77 0-1.4-.6-1.4-1.36V6.36z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M10.76 20.9v-8.57H7.89v8.58h2.87zm-1.44-9.75c1 0 1.63-.65 1.63-1.48-.02-.84-.62-1.48-1.6-1.48-.99 0-1.63.64-1.63 1.48 0 .83.62 1.48 1.59 1.48h.01zM12.35 20.9h2.87v-4.79c0-.25.02-.5.1-.7.2-.5.67-1.04 1.46-1.04 1.04 0 1.46.8 1.46 1.95v4.59h2.87v-4.92c0-2.64-1.42-3.87-3.3-3.87-1.55 0-2.23.86-2.61 1.45h.02v-1.24h-2.87c.04.8 0 8.58 0 8.58z" fill="#fff"></path></svg></a></div><div class="gf r ar"><a href="//web.archive.org/web/20191204194117/https://medium.com/p/cef5a3ecdd90/share/facebook?source=post_actions_header---------------------------" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" target="_blank" rel="noopener"><svg width="29" height="29" class="q"><path d="M23.2 5H5.8a.8.8 0 0 0-.8.8V23.2c0 .44.35.8.8.8h9.3v-7.13h-2.38V13.9h2.38v-2.38c0-2.45 1.55-3.66 3.74-3.66 1.05 0 1.95.08 2.2.11v2.57h-1.5c-1.2 0-1.48.57-1.48 1.4v1.96h2.97l-.6 2.97h-2.37l.05 7.12h5.1a.8.8 0 0 0 .79-.8V5.8a.8.8 0 0 0-.8-.79"></path></svg></a></div><div class="gg r ao"><div><div class="cf"><a href="https://web.archive.org/web/20191204194117/https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90&amp;source=post_actions_header--------------------------bookmark_sidebar-" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener"><svg width="25" height="25" viewbox="0 0 25 25"><path d="M19 6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14.66h.01c.01.1.05.2.12.28a.5.5 0 0 0 .7.03l5.67-4.12 5.66 4.13a.5.5 0 0 0 .71-.03.5.5 0 0 0 .12-.29H19V6zm-6.84 9.97L7 19.64V6a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v13.64l-5.16-3.67a.49.49 0 0 0-.68 0z" fill-rule="evenodd"></path></svg></a></div></div></div></div></div></div></div></div><p id="9328" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">In this article we’ll learn to optimise the power consumption of the <a class="at cg gv gw gx gy" target="_blank" rel="noopener" href="/web/20191204194117/https://medium.com/@ly.lee/rust-rocks-nb-iot-stm32-blue-pill-with-quectel-bc95-g-on-apache-mynewt-ef62a7e28f7e?source=friends_link&amp;sk=aaa21371f68a07c543066b6b89a760f0">NB-IoT Sensor Application in the previous tutorial</a> from this jagged power-hungry mess…</p></div></div><div class="cz ak"><figure class="gz ha hb hc hd cz ak paragraph-image"><div class="dl r dd dm"><div class="he r"><div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/60/1*1t_LDe0SVfohlSUBPfY42A.png?q=20" width="1637" height="371" role="presentation"/></div><img class="df dg cp t u dh ak dr" width="1637" height="371" role="presentation"/><noscript><img class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/3274/1*1t_LDe0SVfohlSUBPfY42A.png" width="1637" height="371" role="presentation"/></noscript></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Power consumed by our IoT sensor device before optimisation. From <a href="https://web.archive.org/web/20191204194117/https://docs.google.com/spreadsheets/d/1QptBX2wn_RC5-oaVPyxynbmKROO5ElfHJyNcqcX0YhA/edit?usp=sharing" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://docs.google.com/spreadsheets/d/1QptBX2wn_RC5-oaVPyxynbmKROO5ElfHJyNcqcX0YhA/edit?usp=sharing</a></figcaption></figure></div><div class="n p"><div class="ac ae af ag ah dz aj ak"><p id="2b80" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">To these well-disciplined bars…</p></div></div><div class="cz ak"><figure class="gz ha hb hc hd cz ak paragraph-image"><div class="dl r dd dm"><div class="hf r"><div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/60/1*EdofQd-ZJegbGWRqgSrrRg.png?q=20" width="1634" height="371" role="presentation"/></div><img class="df dg cp t u dh ak dr" width="1634" height="371" role="presentation"/><noscript><img class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/3268/1*EdofQd-ZJegbGWRqgSrrRg.png" width="1634" height="371" role="presentation"/></noscript></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Power consumed by our IoT sensor device after optimisation. From <a href="https://web.archive.org/web/20191204194117/https://docs.google.com/spreadsheets/d/1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo/edit?usp=sharing" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://docs.google.com/spreadsheets/d/1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo/edit?usp=sharing</a></figcaption></figure></div><div class="n p"><div class="ac ae af ag ah dz aj ak"><p id="e50d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">It’s a simple application (coded in Embedded Rust) that polls Blue Pill’s internal temperature sensor and transmits the sensor data to a server over NB-IoT.</p><p id="8c29" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The power optimisation (recorded with a $25 <a href="https://web.archive.org/web/20191204194117/https://www.aliexpress.com/item/32684316119.html" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">RuiDeng DPS 3005 Power Monitor</a>) becomes more apparent when we compare the charts side by side…</p></div></div><div class="cz ak"><figure class="gz ha hb hc hd cz ak paragraph-image"><div class="db dc dd de ak"><div class="dl r dd dm"><div class="hg r"><div class="df dg cp t u dh ak di dj dk"><img alt="Before: Device consumes at least 20 milliAmperes of current. After: Reduced to 3 milliAmperes with Deep Sleep Standby Mode" class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/60/1*r2BOfUOGYrl-ottE9bYI6A.png?q=20" width="3200" height="824"/></div><img alt="Before: Device consumes at least 20 milliAmperes of current. After: Reduced to 3 milliAmperes with Deep Sleep Standby Mode" class="df dg cp t u dh ak dr" width="3200" height="824"/><noscript><img alt="Before: Device consumes at least 20 milliAmperes of current. After: Reduced to 3 milliAmperes with Deep Sleep Standby Mode" class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/6400/1*r2BOfUOGYrl-ottE9bYI6A.png" width="3200" height="824"/></noscript></div></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Power consumed by our IoT sensor device before and after optimisation. From <a href="https://web.archive.org/web/20191204194117/https://docs.google.com/spreadsheets/d/1QptBX2wn_RC5-oaVPyxynbmKROO5ElfHJyNcqcX0YhA/edit?usp=sharing" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://docs.google.com/spreadsheets/d/1QptBX2wn_RC5-oaVPyxynbmKROO5ElfHJyNcqcX0YhA/edit?usp=sharing</a> and <a href="https://web.archive.org/web/20191204194117/https://docs.google.com/spreadsheets/d/1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo/edit?usp=sharing" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://docs.google.com/spreadsheets/d/1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo/edit?usp=sharing</a></figcaption></figure></div><div class="n p"><div class="ac ae af ag ah dz aj ak"><p id="49c3" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">From the charts above we can see the secret to long battery life is this…</p><p id="9c97" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="hh">Stay in Deep Sleep for as long as possible!</em></p><p id="7f4c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Our sensor device doesn’t need to transmit sensor data every second. When it sleeps for a minute or more between transmissions, the battery life is dramatically increased.</p><p id="2eef" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">However we need to be sure that our NB-IoT module won’t become totally disconnected from the network as Blue Pill sleeps. We have the solution for that.</p><p id="2091" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="hh">Can we go below 3 milliAmperes?</em></p><p id="2774" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Yes we can! Scrutinise the photo at the top of the article… Notice that TWO power LEDs are still lit: Power LED for Blue Pill and Power LED for the NB-IoT breakout board.</p><p id="1c6e" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The two LEDs are always lit, even during Deep Sleep. If we desolder the two LEDs, the current consumed will surely drop way below 3 milliAmperes. My colleague Upton Lai has previously <a href="https://web.archive.org/web/20191204194117/https://www.linkedin.com/feed/update/urn:li:activity:6473079182715863040/" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">desoldered the Blue Pill Power LED</a> and recorded <strong class="gj hi">10 microAmperes</strong> of power consumption in Deep Sleep! (Without NB-IoT)</p><p id="cfd3" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">But for now we’ll keep the LEDs… My intent is to let you recreate this experiment easily using off-the-shelf hardware. So that you can follow me and discover for yourself the right way to conserve power.</p><p id="25bf" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="hh">There’s something odd about the Current values in the charts…</em></p><p id="173c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Yes the charts look different from High School Physics because I rendered the charts (in Google Sheets) using a <strong class="gj hi">Logarithmic Scale</strong>.</p><p id="5562" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">This makes the chart look more scenic and poetic like a rolling hill… instead of a desolate landscape with steep mountains and treacherous crevices. And I assure you that no values have been altered. (Just check the Google Sheets)</p></div></div><div class="cz"><div class="n p"><div class="hj hk hl hm hn ho ag hp ah hq aj ak"><figure class="gz ha hb hc hd cz hs ht paragraph-image"><div class="db dc dd de ak"><div class="cl cm hr"><div class="dl r dd dm"><div class="hu r"><div class="df dg cp t u dh ak di dj dk"><img alt="Log vs Logless" class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/60/1*i9uoKxnFd6S84RWOlDBQSw.png?q=20" width="1563" height="709"/></div><img alt="Log vs Logless" class="df dg cp t u dh ak dr" width="1563" height="709"/><noscript><img alt="Log vs Logless" class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/3126/1*i9uoKxnFd6S84RWOlDBQSw.png" width="1563" height="709"/></noscript></div></div></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Logarithmic Scale vs Normal Scale. From <a href="https://web.archive.org/web/20191204194117/https://docs.google.com/spreadsheets/d/1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo/edit?usp=sharing" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://docs.google.com/spreadsheets/d/1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo/edit?usp=sharing</a></figcaption></figure></div></div></div></section><hr class="hv dy hw hx hy dv hz ia ib ic id"/><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah dz aj ak"><h1 id="f913" class="ie if ec bk bj ig ih ii ij ik il im in io ip iq ir">Quectel NB-IoT Power Consumption</h1><p id="1439" class="gh gi ec bk gj b gk is gm it go iu gq iv gs iw gu">It’s important to power down the NB-IoT module when we have transmitted the data: <code class="dm ix iy iz ja b">AT+CFUN=0</code></p><p id="9a0e" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">According to the documentation for the above command in <em class="hh">“Quectel BC95-G &amp; BC68 AT Commands Manual”…</em></p><blockquote class="jb jc jd"><p id="b54d" class="gh gi ec hh gj b gk gl gm gn go gp gq gr gs gt gu">Deep sleep mode will be entered when the system is quiescent, but only if it has been enabled by the network.</p></blockquote></div></div><div class="cz"><div class="n p"><div class="hj hk hl hm hn ho ag hp ah hq aj ak"><figure class="gz ha hb hc hd cz hs ht paragraph-image"><div class="db dc dd de ak"><div class="cl cm je"><div class="dl r dd dm"><div class="jf r"><div class="df dg cp t u dh ak di dj dk"><img alt="Transmit AT+NSOSTF ⩽ 400 mA. Power Down AT+CFUN=0. Deep Sleep 3mA. Wakeup AT+CFUN=1. Attach to NB-IoT AT+CGATT=1 40 mA" class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/60/1*712vnIvAlWuCMgVyxNcBgQ.png?q=20" width="1597" height="719"/></div><img alt="Transmit AT+NSOSTF ⩽ 400 mA. Power Down AT+CFUN=0. Deep Sleep 3mA. Wakeup AT+CFUN=1. Attach to NB-IoT AT+CGATT=1 40 mA" class="df dg cp t u dh ak dr" width="1597" height="719"/><noscript><img alt="Transmit AT+NSOSTF ⩽ 400 mA. Power Down AT+CFUN=0. Deep Sleep 3mA. Wakeup AT+CFUN=1. Attach to NB-IoT AT+CGATT=1 40 mA" class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/3194/1*712vnIvAlWuCMgVyxNcBgQ.png" width="1597" height="719"/></noscript></div></div></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Optimised NB-IoT Power Consumption. From <a href="https://web.archive.org/web/20191204194117/https://docs.google.com/spreadsheets/d/1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo/edit#gid=1194739783" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://docs.google.com/spreadsheets/d/1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo/edit#gid=1194739783</a></figcaption></figure></div></div></div><div class="n p"><div class="ac ae af ag ah dz aj ak"><p id="7d91" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Instead of keeping our device always connected to NB-IoT, we would have to reattach to the NB-IoT network (<code class="dm ix iy iz ja b">AT+CGATT=1</code>) every time we wake up. Attaching to the NB-IoT network may take a few seconds, consuming 40 milliAmperes throughout.</p><p id="e387" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="hh">(Mr Stefan de Lange kindly pointed out that we could attach to the NB-IoT network at power on instead of wakeup. We’ll explore that in a future article. Thanks Stefan!)</em></p><p id="841a" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The actual NB-IoT transmission takes a split second, reaching peaks of about 400 milliAmperes.</p><p id="4c43" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Here’s the log from my optimised Blue Pill, chronicling the events after Deep Sleep Wakeup…</p><figure class="gz ha hb hc hd cz"><div class="dl r dd"><div class="jg r"><iframe src="https://web.archive.org/web/20191204194117if_/https://medium.com/media/ddac5c0e051ffd66b7c07543e789de8b" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Blue Pill Log from <a href="https://web.archive.org/web/20191204194117/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/logs/standalone-node-standby.log" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/logs/standalone-node-standby.log</a></figcaption></figure><p id="80e1" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Note that we used the <code class="dm ix iy iz ja b">NSOSTF</code> command instead of <code class="dm ix iy iz ja b">NSOST</code> to send a UDP packet with flags. In my previous article we used…</p><pre class="gz ha hb hc hd jh ji jj"><span id="544b" class="jk if ec bk ja b ds jl jm r jn">AT+NSOST=1,104.199.85.211,5683,174,(data)…</span></pre><p id="8f7e" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Now we use…</p><pre class="gz ha hb hc hd jh ji jj"><span id="4efc" class="jk if ec bk ja b ds jl jm r jn">AT+<strong class="ja hi">NSOSTF</strong>=1,104.199.85.211,5683,<strong class="ja hi">0x200</strong>,174,(data)…</span></pre><p id="6819" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The extra parameter <code class="dm ix iy iz ja b">0x200</code> is the “Early Release” flag… It tells the NB-IoT network that we are not expecting any response messages. So we can safely go to sleep and save power.</p><p id="b6cf" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The “Early Release” flag was recommended by Mr Henk Vergonet at <a href="https://web.archive.org/web/20191204194117/https://forum.iot.t-mobile.nl/topic/278/how-much-battery-lifetime-can-we-expect-with-a-sara-n200-module-on-our-iot-network/2" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">T-Mobile Netherlands</a></p><figure class="gz ha hb hc hd cz dr jp cd jq jr js jt ju ba jv jw jx jy jz ka paragraph-image"><div class="cl cm jo"><div class="dl r dd dm"><div class="kb r"><div class="df dg cp t u dh ak di dj dk"><img alt="AT+NUESTATS. Signal power:-758 Total power:-706 TX power:230 TX time:438 RX time:16193 Cell ID:3535136 ECL:0 SNR:132 EARFC" class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/32/1*xE52R6qPSarptYyVtHBgpw.png?q=20" width="360" height="682"/></div><img alt="AT+NUESTATS. Signal power:-758 Total power:-706 TX power:230 TX time:438 RX time:16193 Cell ID:3535136 ECL:0 SNR:132 EARFC" class="df dg cp t u dh ak dr" width="360" height="682"/><noscript><img alt="AT+NUESTATS. Signal power:-758 Total power:-706 TX power:230 TX time:438 RX time:16193 Cell ID:3535136 ECL:0 SNR:132 EARFC" class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/720/1*xE52R6qPSarptYyVtHBgpw.png" width="360" height="682"/></noscript></div></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a href="https://web.archive.org/web/20191204194117/https://gist.github.com/lupyuen/ef51005c6c965f6a21d496ad24eacc51" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://gist.github.com/lupyuen/ef51005c6c965f6a21d496ad24eacc51</a></figcaption></figure><p id="bf4c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Here’s a valuable tip from Mr Stefan de Lange…</p><blockquote class="jb jc jd"><p id="9c70" class="gh gi ec hh gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hi">ECL is a key parameter to monitor</strong>. It determines the amount of repetitions the module will do. So instead of sending a message once the module might send the message 10, 20 or 30 times to make sure it arrives.</p></blockquote><p id="e985" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The ECL is displayed when we send the <code class="dm ix iy iz ja b">AT+NUESTATS</code> command.</p></div></div></section><hr class="hv dy hw hx hy dv hz ia ib ic id"/><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah dz aj ak"><h1 id="f9e3" class="ie if ec bk bj ig ih ii ij ik il im in io ip iq ir">When Apache Mynewt Idles</h1><p id="265a" class="gh gi ec bk gj b gk is gm it go iu gq iv gs iw gu">Let’s dive deep into Mynewt and understand what happens when our Blue Pill is idle, waiting to poll the temperature sensor or waiting for an NB-IoT command to complete…</p><figure class="gz ha hb hc hd cz"><div class="dl r dd"><div class="jg r"><iframe src="https://web.archive.org/web/20191204194117if_/https://medium.com/media/389081206c858f2438179ef2abc182d1" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a href="https://web.archive.org/web/20191204194117/https://github.com/apache/mynewt-core/blob/master/hw/mcu/stm/stm32_common/src/hal_os_tick.c" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://github.com/apache/mynewt-core/blob/master/hw/mcu/stm/stm32_common/src/hal_os_tick.c</a></figcaption></figure><p id="bca3" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The Arm processor inside our Blue Pill has a built-in <a href="https://web.archive.org/web/20191204194117/http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dai0179b/ar01s02s08.html" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow"><strong class="gj hi">SysTick Timer</strong></a>. It’s used by Mynewt to perform multitasking. In the code above, Mynewt configures the SysTick Timer to generate an interrupt every millisecond.</p><p id="4c91" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">When the millisecond interrupt is triggered, Mynewt checks whether it should continue running the current task, or switch to a higher-priority task. If there are no tasks ready to run (which will most likely be the case for our device), Mynewt still keeps <em class="hh">checking every single millisecond</em>. This is not good for battery life.</p><p id="077c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">What happens when there are no tasks ready to run? Mynewt calls <code class="dm ix iy iz ja b">os_task_idle()</code>, passing the number of ticks that it should stay idle. (1 tick = 1 millisecond)</p><figure class="gz ha hb hc hd cz"><div class="dl r dd"><div class="jg r"><iframe src="https://web.archive.org/web/20191204194117if_/https://medium.com/media/f99eca2ae4897387325d25b90532d3dc" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a href="https://web.archive.org/web/20191204194117/https://github.com/apache/mynewt-core/blob/master/hw/mcu/stm/stm32_common/src/hal_os_tick.c" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://github.com/apache/mynewt-core/blob/master/hw/mcu/stm/stm32_common/src/hal_os_tick.c</a></figcaption></figure><p id="85e2" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Mynewt computes the idle time based on the list of pending tasks. So if the temperature sensor is supposed to be polled every 10 seconds, Mynewt knows that after polling the sensor, it should stay idle for roughly 10,000 ticks before resuming the polling task.</p><p id="709f" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><code class="dm ix iy iz ja b">WFI</code> in the code above is the Arm instruction “<strong class="gj hi">Wait For Interrupt</strong>”. It means that the Arm processor will go into a power-saving quick nap (not Deep Sleep) until an interrupt occurs.</p><p id="e6ad" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">BUT… remember that our <em class="hh">SysTick Interrupt occurs every millisecond</em>… so our Blue Pill doesn’t sleep much!</p><p id="5391" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Here’s proof of that… Watch what happens when we add some debug output to <code class="dm ix iy iz ja b">os_task_idle()</code>...</p></div></div><div class="cz ak"><figure class="gz ha hb hc hd cz ak paragraph-image"><div class="dl r dd dm"><div class="kc r"><div class="df dg cp t u dh ak di dj dk"><img alt="Right now our STM32 Blue Pill is driven by the System Tick timer, ticking 
every millisecond. What happens when we run ticks?" class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/60/1*jrBd8tUBjysw70o-dIKQCA.png?q=20" width="2262" height="1308"/></div><img alt="Right now our STM32 Blue Pill is driven by the System Tick timer, ticking 
every millisecond. What happens when we run ticks?" class="df dg cp t u dh ak dr" width="2262" height="1308"/><noscript><img alt="Right now our STM32 Blue Pill is driven by the System Tick timer, ticking 
every millisecond. What happens when we run ticks?" class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/4524/1*jrBd8tUBjysw70o-dIKQCA.png" width="2262" height="1308"/></noscript></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Proof that Blue Pill wakes up every millisecond</figcaption></figure></div><div class="n p"><div class="ac ae af ag ah dz aj ak"><blockquote class="jb jc jd"><p id="5515" class="gh gi ec hh gj b gk gl gm gn go gp gq gr gs gt gu"><em class="bk">💎</em> <strong class="gj hi">“Heisenberg’s Uncertainty Principle” for Embedded Systems…</strong></p><p id="3f5f" class="gh gi ec hh gj b gk gl gm gn go gp gq gr gs gt gu">Don’t try at home what you see above! It’s NOT a good idea to display debug messages on the console when you’re deep inside the operating system… like in the Task Scheduling code above.</p><p id="35ce" class="gh gi ec hh gj b gk gl gm gn go gp gq gr gs gt gu">How did I do it? My <code class="dm ix iy iz ja b">console_print()</code> functions were specially designed to buffer output messages into RAM (using <code class="dm ix iy iz ja b">mbufs</code>). So no I/O is performed by the code above… Until the application flushes the console output.</p><p id="51a0" class="gh gi ec hh gj b gk gl gm gn go gp gq gr gs gt gu">If this debug code used a normal console I/O call, it would interfere with the <code class="dm ix iy iz ja b">os_task_idle()</code> operation (it might get deadlocked). So when you insert debug code to observe what’s happening deep inside your microcontroller, you might actually affect the outcome.</p><p id="8794" class="gh gi ec hh gj b gk gl gm gn go gp gq gr gs gt gu">Hence some folks call this “<a href="https://web.archive.org/web/20191204194117/https://en.wikipedia.org/wiki/Uncertainty_principle" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow"><em class="bk">Heisenberg’s Uncertainty Principle</em></a>” (like in Quantum Mechanics)… Beware of Heisenberg! :-)</p></blockquote></div></div></section><hr class="hv dy hw hx hy dv hz ia ib ic id"/><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah dz aj ak"><h1 id="7319" class="ie if ec bk bj ig ih ii ij ik il im in io ip iq ir">Going Tickless on Apache Mynewt with Real Time Clock</h1><p id="ab59" class="gh gi ec bk gj b gk is gm it go iu gq iv gs iw gu">Here’s the problem: We would like to sleep longer and conserve power… But the SysTick Timer keeps waking us up every millisecond. Can we do without SysTick? Can we go… <strong class="gj hi">Tickless</strong>? Yes we can!</p><p id="6a53" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Blue Pill and other STM32 microcontrollers have an onboard <strong class="gj hi">Real Time Clock</strong>. Unlike a real wall clock, the Real Time Clock doesn’t tell you the time of the day. But it’s useful for two things…</p><p id="ed21" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">1️⃣ <strong class="gj hi">Counting the ticks</strong> that have elapsed since we powered on our device. It keeps counting even in Deep Sleep!</p><p id="3e7d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">2️⃣ <strong class="gj hi">Triggering an Alarm Interrupt</strong> at a time (in ticks) that we set</p><p id="3962" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Remember that Mynewt calls <code class="dm ix iy iz ja b">os_task_idle(X)</code> when it’s ready to sleep for <code class="dm ix iy iz ja b">X</code> milliseconds. Why don’t we set the Real Time Clock Alarm to wake us up in <code class="dm ix iy iz ja b">X</code> milliseconds?</p><p id="ec96" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">So in the optimised task scheduler for Mynewt, we eliminate SysTick altogether, replaced by the Real Time Clock Alarm. <code class="dm ix iy iz ja b">os_task_idle()</code> now calls <code class="dm ix iy iz ja b">power_sleep()</code>…</p><figure class="gz ha hb hc hd cz"><div class="dl r dd"><div class="jg r"><iframe src="https://web.archive.org/web/20191204194117if_/https://medium.com/media/f2f6dbd07fff98ae248a37ad0bcc49d2" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a href="https://web.archive.org/web/20191204194117/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/src/low_power.c" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/src/low_power.c</a></figcaption></figure><p id="ca30" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">What about <code class="dm ix iy iz ja b">WFI</code>, the Wait For Interrupt instruction that we saw earlier? It still works! Because the Real Time Clock triggers an interrupt (Alarm Interrupt) when the time is up. Here’s how we call <code class="dm ix iy iz ja b">WFI</code> for a quick nap (<strong class="gj hi">Sleep Now Mode</strong>)…</p><figure class="gz ha hb hc hd cz"><div class="dl r dd"><div class="jg r"><iframe src="https://web.archive.org/web/20191204194117if_/https://medium.com/media/e46934f6c404e5e07b3d9766ee84415d" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a href="https://web.archive.org/web/20191204194117/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/src/low_power.c" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/src/low_power.c</a></figcaption></figure><p id="5c95" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The <code class="dm ix iy iz ja b">power_sleep()</code> function calls <code class="dm ix iy iz ja b">target_enter_sleep_mode()</code> and <code class="dm ix iy iz ja b">WFI</code> for a quick nap. When we have finished transmitting our sensor data over NB-IoT, we could actually take a longer nap… this is the <strong class="gj hi">Deep Sleep Standby Mode</strong> we saw earlier… the one that consumes only 3 milliAmperes! (With the power LEDs still lit) We’ll cover Deep Sleep Standby Mode in a while.</p><p id="fbc0" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Zephyr RTOS has a good explanation of <a href="https://web.archive.org/web/20191204194117/https://docs.zephyrproject.org/1.13.0/subsystems/power_management.html#tickless-idle" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">Tickless Task Scheduling here</a></p></div></div></section><hr class="hv dy hw hx hy dv hz ia ib ic id"/><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah dz aj ak"><h1 id="2da0" class="ie if ec bk bj ig ih ii ij ik il im in io ip iq ir">Power Saving Modes on Blue Pill</h1><p id="e8d5" class="gh gi ec bk gj b gk is gm it go iu gq iv gs iw gu">There are <a href="https://web.archive.org/web/20191204194117/https://www.st.com/content/ccc/resource/technical/document/application_note/ff/0a/dc/d2/5e/f5/4b/5a/CD00171691.pdf/files/CD00171691.pdf/jcr:content/translations/en.CD00171691.pdf" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">three power saving modes</a> on Blue Pill…</p><p id="0c62" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">1️⃣ <strong class="gj hi">Sleep Now Mode (10 milliAmperes)</strong>: This is the <code class="dm ix iy iz ja b">WFI</code> (Wait For Interrupt) instruction that’s implemented in the Arm processor. It puts Blue Pill into a light nap that still consumes substantial power. That’s because the Blue Pill peripherals (like the UART port) are still powered on.</p><p id="343c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">2️⃣ <strong class="gj hi">Deep Sleep Stop Mode</strong>: Similar to Sleep Now Mode, except that the peripherals (like UART) are powered down. Consumes less power than Sleep Now Mode but more power than Deep Sleep Standby Mode. On wakeup, Blue Pill resumes execution with the peripherals powered down. <em class="hh">RAM is preserved.</em></p><p id="0078" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">3️⃣ <strong class="gj hi">Deep Sleep Standby Mode (3 milliAmperes, with power LEDs still lit)</strong>: The ultimate low power mode. All peripherals powered down (same as Deep Sleep Stop Mode). BUT on wakeup, <em class="hh">Blue Pill restarts</em> as though it was just powered on. <em class="hh">Everything in RAM is lost.</em></p></div></div><div class="cz"><div class="n p"><div class="hj hk hl hm hn ho ag hp ah hq aj ak"><figure class="gz ha hb hc hd cz hs ht paragraph-image"><div class="db dc dd de ak"><div class="cl cm kd"><div class="dl r dd dm"><div class="ke r"><div class="df dg cp t u dh ak di dj dk"><img alt="Deep Sleep Standby 3 mA. Sleep Now 10 mA. Attach to NB-IoT ⩽ 70 mA. Transmit to NB-IoT ⩽ 400 mA" class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/60/1*31ddqScBeS2JiPje4SL3Rw.png?q=20" width="1648" height="742"/></div><img alt="Deep Sleep Standby 3 mA. Sleep Now 10 mA. Attach to NB-IoT ⩽ 70 mA. Transmit to NB-IoT ⩽ 400 mA" class="df dg cp t u dh ak dr" width="1648" height="742"/><noscript><img alt="Deep Sleep Standby 3 mA. Sleep Now 10 mA. Attach to NB-IoT ⩽ 70 mA. Transmit to NB-IoT ⩽ 400 mA" class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/3296/1*31ddqScBeS2JiPje4SL3Rw.png" width="1648" height="742"/></noscript></div></div></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Sleep Now Mode vs Deep Sleep Standby Mode. From <a href="https://web.archive.org/web/20191204194117/https://docs.google.com/spreadsheets/d/1ygUzKYWTo-BSSvKzL3J6ub3o4-7sVrjMUyvGLdAsHJ0/edit?usp=sharing" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://docs.google.com/spreadsheets/d/1ygUzKYWTo-BSSvKzL3J6ub3o4-7sVrjMUyvGLdAsHJ0/edit?usp=sharing</a></figcaption></figure></div></div></div><div class="n p"><div class="ac ae af ag ah dz aj ak"><p id="db8b" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">This may sound odd… But Deep Sleep <strong class="gj hi">Standby Mode</strong> (the ultimate power saver) is <em class="hh">easier to code</em> than Deep Sleep <strong class="gj hi">Stop Mode</strong>.</p><p id="5370" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">With Stop Mode we need to power on the peripherals ourselves when waking up… And it gets complicated. With Standby Mode, we just pretend that our Blue Pill has just powered on… Except that we can check a flag to distinguish whether it’s a Power On or a Standby Wakeup.</p><p id="7869" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Here’s how we check the flag…</p><figure class="gz ha hb hc hd cz"><div class="dl r dd"><div class="jg r"><iframe src="https://web.archive.org/web/20191204194117if_/https://medium.com/media/c4fa90b397c24fbc820a1bb28612d9f7" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a href="https://web.archive.org/web/20191204194117/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/src/low_power.c" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/src/low_power.c</a></figcaption></figure></div></div></section><hr class="hv dy hw hx hy dv hz ia ib ic id"/><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah dz aj ak"><h1 id="761e" class="ie if ec bk bj ig ih ii ij ik il im in io ip iq ir">Embedded Rust Application For Low Power</h1><p id="ce4a" class="gh gi ec bk gj b gk is gm it go iu gq iv gs iw gu">Remember from our previous tutorial that the IoT Sensor Application was developed in Rust. <em class="hh">Is Rust really suitable for Low Power Devices? Does Rust make our device less power-efficient?</em></p><p id="6e25" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">I’m happy to report that <em class="hh">Rust is just as power-efficient as C!</em> That’s because Rust is compiled into optimised Arm machine code, so there’s no extra execution overhead when our application is written in Rust.</p><p id="2b68" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The Rust application logic was tweaked slightly to make it more power-efficient…</p><figure class="gz ha hb hc hd cz"><div class="dl r dd"><div class="jg r"><iframe src="https://web.archive.org/web/20191204194117if_/https://medium.com/media/8a866a166573c04cd170a7e9cc075ce8" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a href="https://web.archive.org/web/20191204194117/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/rust/app/src/app_sensor.rs" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/rust/app/src/app_sensor.rs</a></figcaption></figure><p id="44e0" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The top half of the function <code class="dm ix iy iz ja b">start_sensor_listener()</code> is exactly the same as before. When our device is powered up, we instruct Mynewt to poll the temperature sensor every 20 seconds. Mynewt passes the sensor data to our function <code class="dm ix iy iz ja b">handle_sensor_data()</code> for transmitting to the server.</p><figure class="gz ha hb hc hd cz"><div class="dl r dd"><div class="jg r"><iframe src="https://web.archive.org/web/20191204194117if_/https://medium.com/media/45a75113ed503da4195dd82fa0e28eb2" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a href="https://web.archive.org/web/20191204194117/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/rust/app/src/app_sensor.rs" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/rust/app/src/app_sensor.rs</a></figcaption></figure><p id="53c9" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The lower half of <code class="dm ix iy iz ja b">start_sensor_listener()</code> introduces a minor twist… When our device wakes up from Deep Sleep Standby Mode, we read the temperature sensor directly, without polling. And we transmit the sensor data the same way, via <code class="dm ix iy iz ja b">handle_sensor_data()</code>.</p><p id="1e33" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">This keeps our device fully occupied during the precious few seconds that our device is awake, until it falls into Deep Sleep.</p><figure class="gz ha hb hc hd cz"><div class="dl r dd"><div class="jg r"><iframe src="https://web.archive.org/web/20191204194117if_/https://medium.com/media/48ac1952de9ab1e018eba6008dd9439c" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a href="https://web.archive.org/web/20191204194117/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/sensor_network/src/sensor_network.c" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/sensor_network/src/sensor_network.c</a></figcaption></figure><p id="3323" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The <strong class="gj hi">Sensor Network Library</strong> (written in C) has been optimised for low power operation as well. During wakeup, the function attaches to the NB-IoT network and doesn’t return until it completes. (Previously we started a background task to attach to the NB-IoT network so that we could run other tasks.)</p><p id="8b91" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">This chart illustrates the power consumed when our Blue Pill polls the onboard temperature sensor vs reading the sensor directly.</p></div></div><div class="cz"><div class="n p"><div class="hj hk hl hm hn ho ag hp ah hq aj ak"><figure class="gz ha hb hc hd cz hs ht paragraph-image"><div class="db dc dd de ak"><div class="cl cm kf"><div class="dl r dd dm"><div class="kg r"><div class="df dg cp t u dh ak di dj dk"><img alt="Polling vs Reading the temperature sensor. Reboot 
NB-IoT Module 30 mA. Mynewt waits 20 seconds
to poll temperature
sensor…" class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/60/1*njv_Nzhx3aEd1Pquar6wTQ.png?q=20" width="1622" height="742"/></div><img alt="Polling vs Reading the temperature sensor. Reboot 
NB-IoT Module 30 mA. Mynewt waits 20 seconds
to poll temperature
sensor…" class="df dg cp t u dh ak dr" width="1622" height="742"/><noscript><img alt="Polling vs Reading the temperature sensor. Reboot 
NB-IoT Module 30 mA. Mynewt waits 20 seconds
to poll temperature
sensor…" class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/3244/1*njv_Nzhx3aEd1Pquar6wTQ.png" width="1622" height="742"/></noscript></div></div></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Polling vs Reading the temperature sensor. From <a href="https://web.archive.org/web/20191204194117/https://docs.google.com/spreadsheets/d/1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo/edit#gid=1194739783" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://docs.google.com/spreadsheets/d/1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo/edit#gid=1194739783</a></figcaption></figure></div></div></div><div class="n p"><div class="ac ae af ag ah dz aj ak"><p id="255c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The code changes are really minor. Mynewt’s Sensor Framework has done an excellent job in managing the access to sensors in a consistent, reusable way, even for Low Power. And Rust makes the code look much cleaner and simpler than C.</p></div></div></section><hr class="hv dy hw hx hy dv hz ia ib ic id"/><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah dz aj ak"><h1 id="7068" class="ie if ec bk bj ig ih ii ij ik il im in io ip iq ir">Measure Power Consumption with RuiDeng DPS 3005 Power Monitor</h1><figure class="gz ha hb hc hd cz cl cm paragraph-image"><div class="db dc dd de ak"><div class="cl cm kh"><div class="dl r dd dm"><div class="ki r"><div class="df dg cp t u dh ak di dj dk"><img alt="RuiDeng DPS 3005 Power Monitor measuring the power consumption of STM32 Blue Pill connected to Quectel BC95-G NB-IoT module" class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/60/1*m8CSh8DRY_wad2-CwEvlrw.jpeg?q=20" width="3264" height="2448"/></div><img alt="RuiDeng DPS 3005 Power Monitor measuring the power consumption of STM32 Blue Pill connected to Quectel BC95-G NB-IoT module" class="df dg cp t u dh ak dr" width="3264" height="2448"/><noscript><img alt="RuiDeng DPS 3005 Power Monitor measuring the power consumption of STM32 Blue Pill connected to Quectel BC95-G NB-IoT module" class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/6528/1*m8CSh8DRY_wad2-CwEvlrw.jpeg" width="3264" height="2448"/></noscript></div></div></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">RuiDeng DPS 3005 Power Monitor measuring the power consumption of STM32 Blue Pill connected to Quectel BC95-G NB-IoT module</figcaption></figure><p id="4453" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Now let’s run our IoT Sensor Device and measure the power consumption with <a href="https://web.archive.org/web/20191204194117/https://www.aliexpress.com/item/32684316119.html" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">RuiDeng DPS 3005 Power Monitor</a>!</p><p id="5b29" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><a class="at cg gv gw gx gy" target="_blank" rel="noopener" href="/web/20191204194117/https://medium.com/@ly.lee/connect-the-nb-iot-hardware-stm32-blue-pill-and-quectel-bc95-g-module-978920c964b1?source=friends_link&amp;sk=3f3e4cf79a40f9969077bd36b441cf98">Follow the instructions here</a> to connect Blue Pill to the NB-IoT module and ST-Link.</p><p id="45f3" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Let’s look at inputs and outputs for the Power Monitor…</p><figure class="gz ha hb hc hd cz dr jp cd jq jr js jt ju ba jv jw jx jy jz ka paragraph-image"><div class="db dc dd de ak"><div class="cl cm kj"><div class="dl r dd dm"><div class="kk r"><div class="df dg cp t u dh ak di dj dk"><img alt="Inputs and Outputs for RuiDeng DPS 3005 Power Monitor" class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/60/1*MThIKdD7WY7F55GCAX9fcg.png?q=20" width="657" height="541"/></div><img alt="Inputs and Outputs for RuiDeng DPS 3005 Power Monitor" class="df dg cp t u dh ak dr" width="657" height="541"/><noscript><img alt="Inputs and Outputs for RuiDeng DPS 3005 Power Monitor" class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/1314/1*MThIKdD7WY7F55GCAX9fcg.png" width="657" height="541"/></noscript></div></div></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Inputs and Outputs for RuiDeng DPS 3005 Power Monitor</figcaption></figure><p id="a660" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hi">Inputs at Left Side (</strong><code class="dm ix iy iz ja b"><strong class="gj hi">IN+, IN-</strong></code><strong class="gj hi">)</strong>: Connect to the DC power supply. I used two 18650 lithium ion 3.7 Volt batteries connected in series. Total 7.2 Volts, sufficient for providing 5 Volts to our Blue Pill and NB-IoT module.</p><p id="4d35" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hi">Outputs at Right Side (</strong><code class="dm ix iy iz ja b"><strong class="gj hi">OUT-, OUT+</strong></code><strong class="gj hi">)</strong>: Connect to the Blue Pill and NB-IoT module. This will be the 5-Volt power source for our Blue Pill and NB-IoT module.</p><p id="5be8" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Here’s how I powered my Power Monitor…</p></div></div><div class="cz"><div class="n p"><div class="hj hk hl hm hn ho ag hp ah hq aj ak"><figure class="gz ha hb hc hd cz hs ht paragraph-image"><div class="db dc dd de ak"><div class="cl cm kl"><div class="dl r dd dm"><div class="km r"><div class="df dg cp t u dh ak di dj dk"><img alt="RuiDeng DPS 3005 Power Monitor powered by two 18650 lithium ion 3.7 Volt batteries" class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/60/1*Ayno3Q8Pt3W0tK9-kWi15A.jpeg?q=20" width="6003" height="2002"/></div><img alt="RuiDeng DPS 3005 Power Monitor powered by two 18650 lithium ion 3.7 Volt batteries" class="df dg cp t u dh ak dr" width="6003" height="2002"/><noscript><img alt="RuiDeng DPS 3005 Power Monitor powered by two 18650 lithium ion 3.7 Volt batteries" class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/12006/1*Ayno3Q8Pt3W0tK9-kWi15A.jpeg" width="6003" height="2002"/></noscript></div></div></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">RuiDeng DPS 3005 Power Monitor powered by two 18650 lithium ion 3.7 Volt batteries</figcaption></figure><figure class="da cz hs ht paragraph-image"><div class="db dc dd de ak"><div class="cl cm kn"><div class="dl r dd dm"><div class="ko r"><div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/60/1*NXF9cW-NQS7kcd8d1huhAQ.png?q=20" width="1800" height="50" role="presentation"/></div><img class="df dg cp t u dh ak dr" width="1800" height="50" role="presentation"/><noscript><img class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/3600/1*NXF9cW-NQS7kcd8d1huhAQ.png" width="1800" height="50" role="presentation"/></noscript></div></div></div></div></figure></div></div></div><div class="n p"><div class="ac ae af ag ah dz aj ak"><blockquote class="kp"><div id="0a63" class="kq kr ks bk ed b kt ku kv kw kx ky gu"><p class="ed b kz la bo">When Flashing Firmware…</p></div></blockquote></div></div><div class="cz"><div class="n p"><div class="hj hk hl hm hn ho ag hp ah hq aj ak"><figure class="lb lc ld le lf cz hs ht paragraph-image"><div class="db dc dd de ak"><div class="cl cm kh"><div class="dl r dd dm"><div class="lg r"><div class="df dg cp t u dh ak di dj dk"><img alt="Blue Pill and NB-IoT Module connected to ST-Link" class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/60/1*fX-gNG2C4Yzv68XmsaLCkw.jpeg?q=20" width="3264" height="2039"/></div><img alt="Blue Pill and NB-IoT Module connected to ST-Link" class="df dg cp t u dh ak dr" width="3264" height="2039"/><noscript><img alt="Blue Pill and NB-IoT Module connected to ST-Link" class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/6528/1*fX-gNG2C4Yzv68XmsaLCkw.jpeg" width="3264" height="2039"/></noscript></div></div></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Blue Pill and NB-IoT Module connected to ST-Link</figcaption></figure></div></div></div><div class="n p"><div class="ac ae af ag ah dz aj ak"><figure class="gz ha hb hc hd cz dr jp cd jq jr js jt ju ba jv lh li lj lk ka"><div class="dl r dd"><div class="jg r"><iframe src="https://web.archive.org/web/20191204194117if_/https://medium.com/media/7f26bad699a432cb593fd612b53a00bd" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/connect-the-nb-iot-hardware-stm32-blue-pill-and-quectel-bc95-g-module-978920c964b1?source=friends_link&amp;sk=3f3e4cf79a40f9969077bd36b441cf98" class="cp t u dh ak" scrolling="auto"></iframe></div></div></figure><p id="73d3" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">When flashing the firmware to Blue Pill, connect ST-Link to Blue Pill and the NB-IoT module as shown.</p><p id="8ed1" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Note that the NB-IoT module is powered by the 5V pin from ST-Link.</p><p id="dc03" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Blue Pill’s 5V pin should be disconnected.</p></div></div><div class="cz"><div class="n p"><div class="hj hk hl hm hn ho ag hp ah hq aj ak"><figure class="gz ha hb hc hd cz hs ht paragraph-image"><div class="db dc dd de ak"><div class="cl cm kn"><div class="dl r dd dm"><div class="ko r"><div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/60/1*NXF9cW-NQS7kcd8d1huhAQ.png?q=20" width="1800" height="50" role="presentation"/></div><img class="df dg cp t u dh ak dr" width="1800" height="50" role="presentation"/><noscript><img class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/3600/1*NXF9cW-NQS7kcd8d1huhAQ.png" width="1800" height="50" role="presentation"/></noscript></div></div></div></div></figure></div></div></div><div class="n p"><div class="ac ae af ag ah dz aj ak"><blockquote class="kp"><div id="6218" class="kq kr ks bk ed b kt ku kv kw kx ky gu"><p class="ed b kz la bo">When Monitoring Power Consumption…</p></div></blockquote></div></div><div class="cz"><div class="n p"><div class="hj hk hl hm hn ho ag hp ah hq aj ak"><figure class="lb lc ld le lf cz hs ht paragraph-image"><div class="db dc dd de ak"><div class="cl cm ll"><div class="dl r dd dm"><div class="lm r"><div class="df dg cp t u dh ak di dj dk"><img alt="Blue Pill and NB-IoT Module connected to RuiDeng DPS 3005 Power Monitor" class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/56/1*IC_-sUHQ3TJwrxuoODbQ_g.jpeg?q=20" width="2322" height="2448"/></div><img alt="Blue Pill and NB-IoT Module connected to RuiDeng DPS 3005 Power Monitor" class="df dg cp t u dh ak dr" width="2322" height="2448"/><noscript><img alt="Blue Pill and NB-IoT Module connected to RuiDeng DPS 3005 Power Monitor" class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/4644/1*IC_-sUHQ3TJwrxuoODbQ_g.jpeg" width="2322" height="2448"/></noscript></div></div></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Blue Pill and NB-IoT Module connected to RuiDeng DPS 3005 Power Monitor</figcaption></figure></div></div></div><div class="n p"><div class="ac ae af ag ah dz aj ak"><figure class="gz ha hb hc hd cz dr jp cd jq jr js jt ju ba jv lh li lj lk ka"><div class="dl r dd"><div class="jg r"><iframe src="https://web.archive.org/web/20191204194117if_/https://medium.com/media/210b5482445e535be2c55bb891c01d82" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90" class="cp t u dh ak" scrolling="auto"></iframe></div></div></figure><p id="cece" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">When monitoring the power consumption, disconnect ST-Link.</p><p id="697c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Connect Blue Pill’s 5V pin to the Power Meter.</p><p id="eae9" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The NB-IoT module should be powered by the Power Meter as well.</p><figure class="gz ha hb hc hd cz dr jp cd jq jr js jt ju ba jv jw jx jy jz ka paragraph-image"><div class="db dc dd de ak"><div class="cl cm kh"><div class="dl r dd dm"><div class="ki r"><div class="df dg cp t u dh ak di dj dk"><img alt="Bluetooth module for DPS 3005 Power Monitor" class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/60/1*gOH-vDaZd-Si811GB9ZLWw.jpeg?q=20" width="3264" height="2448"/></div><img alt="Bluetooth module for DPS 3005 Power Monitor" class="df dg cp t u dh ak dr" width="3264" height="2448"/><noscript><img alt="Bluetooth module for DPS 3005 Power Monitor" class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/6528/1*gOH-vDaZd-Si811GB9ZLWw.jpeg" width="3264" height="2448"/></noscript></div></div></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Bluetooth module for DPS 3005 Power Monitor</figcaption></figure><p id="0487" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Make sure your DPS 3005 Power Monitor is bundled with a <strong class="gj hi">Bluetooth module</strong>.</p><p id="ba98" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The module connects the Power Monitor to your Windows computer wirelessly for recording data power consumption data (at 1 sample per second). Sadly I couldn’t connect from macOS.</p><p id="754a" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">RuiDeng’s software for DPS 3005 did not allow recording of data, so I used the open-source <code class="dm ix iy iz ja b"><a href="https://web.archive.org/web/20191204194117/https://github.com/lambcutlet/DPS5005_pyGUI" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">DPS5005_pyGUI</a></code> data logger.</p><figure class="gz ha hb hc hd cz cl cm paragraph-image"><div class="db dc dd de ak"><div class="cl cm ln"><div class="dl r dd dm"><div class="lo r"><div class="df dg cp t u dh ak di dj dk"><img alt="DPS5005_pyGUI data logger: https://github.com/lambcutlet/DPS5005_pyGUI" class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/60/1*HKSYbzIjdhRMpqG-8NVa6w.png?q=20" width="1854" height="1080"/></div><img alt="DPS5005_pyGUI data logger: https://github.com/lambcutlet/DPS5005_pyGUI" class="df dg cp t u dh ak dr" width="1854" height="1080"/><noscript><img alt="DPS5005_pyGUI data logger: https://github.com/lambcutlet/DPS5005_pyGUI" class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/3708/1*HKSYbzIjdhRMpqG-8NVa6w.png" width="1854" height="1080"/></noscript></div></div></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">DPS5005_pyGUI data logger: <a href="https://web.archive.org/web/20191204194117/https://github.com/lambcutlet/DPS5005_pyGUI" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://github.com/lambcutlet/DPS5005_pyGUI</a></figcaption></figure><p id="4539" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The low power version of Apache Mynewt and the updated Embedded Rust application may be installed <a class="at cg gv gw gx gy" target="_blank" rel="noopener" href="/web/20191204194117/https://medium.com/@ly.lee/install-low-power-apache-mynewt-and-embedded-rust-for-visual-studio-code-on-windows-f889e19c3405?source=friends_link&amp;sk=477db4f218b2d8f93b15a62597089abc">according to these instructions</a>.</p><div class="lp lq lr ls lt lu"><a rel="noopener" href="/web/20191204194117/https://medium.com/@ly.lee/install-low-power-apache-mynewt-and-embedded-rust-for-visual-studio-code-on-windows-f889e19c3405?source=post_page-----cef5a3ecdd90----------------------"><section class="lx cl cm ak ce n ar ly lz ma mb mc md me mf mg mh mi mj mk ml mm"><div class="mn n co p mo mp"><h2 class="bj ig mq bl ec"><div class="di lv fe ff lw fh">Install Low Power Apache Mynewt and Embedded Rust for Visual Studio Code on Windows</div></h2><div class="mr r"><h3 class="bj dy ds bl bo"><div class="di lv fe ff lw fh">Follow these instructions to install Low Power Apache Mynewt + Embedded Rust build and application files for Visual…</div></h3></div><div class="ms r"><h4 class="bj dy fw bl bo"><div class="di lv fe ff lw fh">medium.com</div></h4></div></div><div class="mt r"><div class="mu r mv mw mx mt my mz na"></div></div></section></a></div><p id="ad11" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="hh">Is 1 sample per second sufficient for understanding the power consumption?</em></p><p id="d3b4" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Honestly, no. There are peaks in our power consumption during NB-IoT transmission. The peaks seem to reach 400 milliAmperes… But because the sampling rate is so low, the peaks could possibly be much higher than that.</p></div></div><div class="cz"><div class="n p"><div class="hj hk hl hm hn ho ag hp ah hq aj ak"><figure class="gz ha hb hc hd cz hs ht paragraph-image"><div class="db dc dd de ak"><div class="cl cm je"><div class="dl r dd dm"><div class="jf r"><div class="df dg cp t u dh ak di dj dk"><img alt="Transmit AT+NSOSTF ⩽ 400 mA. Power Down AT+CFUN=0. Deep Sleep 3mA. Wakeup AT+CFUN=1. Attach to NB-IoT AT+CGATT=1 40 mA" class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/60/1*712vnIvAlWuCMgVyxNcBgQ.png?q=20" width="1597" height="719"/></div><img alt="Transmit AT+NSOSTF ⩽ 400 mA. Power Down AT+CFUN=0. Deep Sleep 3mA. Wakeup AT+CFUN=1. Attach to NB-IoT AT+CGATT=1 40 mA" class="df dg cp t u dh ak dr" width="1597" height="719"/><noscript><img alt="Transmit AT+NSOSTF ⩽ 400 mA. Power Down AT+CFUN=0. Deep Sleep 3mA. Wakeup AT+CFUN=1. Attach to NB-IoT AT+CGATT=1 40 mA" class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/3194/1*712vnIvAlWuCMgVyxNcBgQ.png" width="1597" height="719"/></noscript></div></div></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Peaks in NB-IoT Power Consumption. From <a href="https://web.archive.org/web/20191204194117/https://docs.google.com/spreadsheets/d/1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo/edit#gid=1194739783" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://docs.google.com/spreadsheets/d/1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo/edit#gid=1194739783</a></figcaption></figure></div></div></div><div class="n p"><div class="ac ae af ag ah dz aj ak"><p id="a06b" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Nonetheless, we now have a $25 setup that lets us quickly tweak our firmware and check whether the tweaks actually improve power consumption. So the RuiDeng Power Monitor is an affordable way to guide us towards the right direction to reduce power consumption. <em class="hh">When you have finalised the firmware, remember to use the proper equipment to measure the real power consumption!</em></p></div></div></section><hr class="hv dy hw hx hy dv hz ia ib ic id"/><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah dz aj ak"><h1 id="a7b7" class="ie if ec bk bj ig ih ii ij ik il im in io ip iq ir">The Results</h1><p id="ea41" class="gh gi ec bk gj b gk is gm it go iu gq iv gs iw gu">After optimising the power consumption, how much longer did the battery last? A whopping… <em class="hh">26% increase in battery life!</em></p><figure class="gz ha hb hc hd cz cl cm paragraph-image"><div class="db dc dd de ak"><div class="cl cm nb"><div class="dl r dd dm"><div class="nc r"><div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/60/1*vydM0quFbCvvV5762pJHOA.png?q=20" width="957" height="404" role="presentation"/></div><img class="df dg cp t u dh ak dr" width="957" height="404" role="presentation"/><noscript><img class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/1914/1*vydM0quFbCvvV5762pJHOA.png" width="957" height="404" role="presentation"/></noscript></div></div></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Computed battery life for our IoT sensor device. From <a href="https://web.archive.org/web/20191204194117/https://docs.google.com/spreadsheets/d/1QptBX2wn_RC5-oaVPyxynbmKROO5ElfHJyNcqcX0YhA/edit#gid=1065153023" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://docs.google.com/spreadsheets/d/1QptBX2wn_RC5-oaVPyxynbmKROO5ElfHJyNcqcX0YhA/edit#gid=1065153023</a> and <a href="https://web.archive.org/web/20191204194117/https://docs.google.com/spreadsheets/d/1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo/edit#gid=1872735739" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://docs.google.com/spreadsheets/d/1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo/edit#gid=1872735739</a></figcaption></figure><p id="41b9" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">But it’s a good start! Remember that the power LEDs are still lit. And we have achieved flat lines of power usage during Deep Sleep.</p></div></div><div class="cz ak"><figure class="gz ha hb hc hd cz ak paragraph-image"><div class="db dc dd de ak"><div class="dl r dd dm"><div class="hg r"><div class="df dg cp t u dh ak di dj dk"><img alt="Before: Device consumes at least 20 milliAmperes of current. After: Reduced to 3 milliAmperes with Deep Sleep Standby Mode" class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/60/1*r2BOfUOGYrl-ottE9bYI6A.png?q=20" width="3200" height="824"/></div><img alt="Before: Device consumes at least 20 milliAmperes of current. After: Reduced to 3 milliAmperes with Deep Sleep Standby Mode" class="df dg cp t u dh ak dr" width="3200" height="824"/><noscript><img alt="Before: Device consumes at least 20 milliAmperes of current. After: Reduced to 3 milliAmperes with Deep Sleep Standby Mode" class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/6400/1*r2BOfUOGYrl-ottE9bYI6A.png" width="3200" height="824"/></noscript></div></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Power consumed by our IoT sensor device before and after optimisation. From <a href="https://web.archive.org/web/20191204194117/https://docs.google.com/spreadsheets/d/1QptBX2wn_RC5-oaVPyxynbmKROO5ElfHJyNcqcX0YhA/edit?usp=sharing" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://docs.google.com/spreadsheets/d/1QptBX2wn_RC5-oaVPyxynbmKROO5ElfHJyNcqcX0YhA/edit?usp=sharing</a> and <a href="https://web.archive.org/web/20191204194117/https://docs.google.com/spreadsheets/d/1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo/edit?usp=sharing" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://docs.google.com/spreadsheets/d/1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo/edit?usp=sharing</a></figcaption></figure></div><div class="n p"><div class="ac ae af ag ah dz aj ak"><p id="710a" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Right now our Blue Pill wakes up every 1 minute or so… If we could extend the Deep Sleep to 10 minutes or longer, we should get much lower overall power consumption.</p><p id="74da" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Unfortunately I couldn’t get Blue Pill to sleep beyond 1 minute… <em class="hh">Something is still waking it up. </em>Another timer? Or NB-IoT?</p><p id="1063" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">I invite you to reproduce the same setup with the steps I have described… And help me solve the mystery! (Or work around it… See the <em class="hh">“Backup Registers”</em> section below)</p><p id="128a" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">But I hope you now have a deeper appreciation of all the components that make an IoT Sensor truly Low Power… <strong class="gj hi"><em class="hh">the Network (NB-IoT), the Microcontroller (STM32) and the Operating System (Mynewt)!</em></strong></p><p id="132a" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="hh">Many thanks to </em><a href="https://web.archive.org/web/20191204194117/https://www.starhub.com/" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow"><strong class="gj hi"><em class="hh">StarHub</em></strong></a><em class="hh"> for sponsoring the NB-IoT SIM that I used for this article!</em></p><figure class="gz ha hb hc hd cz cl cm paragraph-image"><div class="db dc dd de ak"><div class="cl cm nd"><div class="dl r dd dm"><div class="ne r"><div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/44/1*W7byHWI1Guhx-OkfYST0DQ.jpeg?q=20" width="1654" height="2227" role="presentation"/></div><img class="df dg cp t u dh ak dr" width="1654" height="2227" role="presentation"/><noscript><img class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/3308/1*W7byHWI1Guhx-OkfYST0DQ.jpeg" width="1654" height="2227" role="presentation"/></noscript></div></div></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Final data collection with RuiDeng DPS 3005 Power Monitor connected to STM32 Blue Pill and Quectel BC95-G NB-IoT module. The Bluetooth module for the Power Monitor is in the centre (green board with red LED).</figcaption></figure></div></div></section><hr class="hv dy hw hx hy dv hz ia ib ic id"/><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah dz aj ak"><h1 id="c98d" class="ie if ec bk bj ig ih ii ij ik il im in io ip iq ir">💎 Advanced Topic: Main and Backup Power</h1><figure class="gz ha hb hc hd cz cl cm paragraph-image"><div class="db dc dd de ak"><div class="cl cm nf"><div class="dl r dd dm"><div class="ng r"><div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/60/1*M7LXYsWuXGvY8CKvM9yVtg.png?q=20" width="794" height="682" role="presentation"/></div><img class="df dg cp t u dh ak dr" width="794" height="682" role="presentation"/><noscript><img class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/1588/1*M7LXYsWuXGvY8CKvM9yVtg.png" width="794" height="682" role="presentation"/></noscript></div></div></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From “RM0008 Reference manual for STM32F103xx”: <a href="https://web.archive.org/web/20191204194117/https://www.st.com/content/ccc/resource/technical/document/reference_manual/59/b9/ba/7f/11/af/43/d5/CD00171190.pdf/files/CD00171190.pdf/jcr:content/translations/en.CD00171190.pdf" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://www.st.com/content/ccc/resource/technical/document/reference_manual/59/b9/ba/7f/11/af/43/d5/CD00171190.pdf/files/CD00171190.pdf/jcr:content/translations/en.CD00171190.pdf</a></figcaption></figure><p id="b1b7" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Let’s study the power input for <strong class="gj hi">STM32F103C8T6</strong>, the STM32 microcontroller at the heart of Blue Pill. Most parts of STM32F103C8T6 are powered by the <strong class="gj hi">Main Power </strong>(<code class="dm ix iy iz ja b">VDD</code> in the above diagram).</p><p id="21d1" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">STM32F103C8T6 has a <strong class="gj hi">Backup Domain </strong>(highlighted in red)<strong class="gj hi"> </strong>that may be powered by Main Power <code class="dm ix iy iz ja b">VDD</code> or <strong class="gj hi">Backup Power</strong> <code class="dm ix iy iz ja b">VBAT</code>. The Backup Domain contains the minimum components essential for Deep Sleep, such as the Real Time Clock.</p><p id="11df" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">This means that it’s possible to sustain Blue Pill in Deep Sleep just by supplying a bit of Backup Power to the <code class="dm ix iy iz ja b">VBAT</code> pin, while the rest of Blue Pill (running on Main Power) is powered down.</p><p id="8ef7" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Everything in the Backup Domain continues to operate as long as Backup Power is available. What’s inside the Backup Domain?</p><p id="29cf" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">1️⃣ <strong class="gj hi">Low Speed External (LSE) Oscillator</strong>: This generates the ticks that’s needed by the Real Time Clock to track time accurately during Deep Sleep</p><p id="8b86" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">2️⃣ <strong class="gj hi">Backup Registers (BKP)</strong>: These are ten 16-bit registers that we may use to store 20 bytes of data. The contents of the registers will be preserved across restarts and wakeups, as long as Backup Power is available. We’ll see later how Backup Registers may be used.</p><p id="f469" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">3️⃣ <strong class="gj hi">Backup Domain Control Register (BDCR)</strong>: This register is used to configure the LSE Oscillator and Real Time Clock.</p><p id="7d9a" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">4️⃣ <strong class="gj hi">Real Time Clock (RTC)</strong>: This is needed to count the ticks produced by the LSE Oscillator and track the elapsed time accurately. It also wakes up the microcontroller at the preset alarm time.</p></div></div></section><hr class="hv dy hw hx hy dv hz ia ib ic id"/><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah dz aj ak"><h1 id="823a" class="ie if ec bk bj ig ih ii ij ik il im in io ip iq ir">💎 Advanced Topic: Configure the Real Time Clock</h1><p id="ceea" class="gh gi ec bk gj b gk is gm it go iu gq iv gs iw gu">This section explains how we configured the Real Time Clock on Blue Pill. The <code class="dm ix iy iz ja b">alarm_setup()</code> code looks tricky so we’ll study this step by step.</p><p id="c8b4" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The <code class="dm ix iy iz ja b">alarm_setup()</code> function is called at startup and wakeup by <code class="dm ix iy iz ja b"><a href="https://web.archive.org/web/20191204194117/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/src/hal_os_tick.c" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">__wrap_os_tick_init</a>()</code>, which is the intercepted version of <code class="dm ix iy iz ja b">os_tick_init()</code> that we’ll see in the section<em class="hh"> “Advanced Topic: Patch Mynewt OS Functions”</em> below.</p><figure class="gz ha hb hc hd cz"><div class="dl r dd"><div class="jg r"><iframe src="https://web.archive.org/web/20191204194117if_/https://medium.com/media/c9296e4d6ea7577fcc5b3a7a79c73dc7" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a href="https://web.archive.org/web/20191204194117/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/src/alarm.c" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/src/alarm.c</a></figcaption></figure><p id="3dc1" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Blue Pill has three <strong class="gj hi">Oscillator Clocks</strong>: <strong class="gj hi">HSE, LSE and LSI</strong>. These are primitive clocks, good for producing ticks only. We may select one of these Oscillator Clocks to drive the Real Time Clock and trigger the Deep Sleep wakeup alarm.</p><p id="9bd3" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">1️⃣ <strong class="gj hi">High Speed External (HSE)</strong> is the fastest clock (8 MHz crystal oscillator)… But also needs the most power. HSE uses only Main Power, doesn’t work on Backup Power. So when we sleep and switch to Backup Power, it stops. Not suitable for setting the Deep Sleep alarm.</p><p id="5cd2" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">2️⃣ <strong class="gj hi">Low Speed Internal (LSI) </strong>is a slower clock (~40 kHz RC oscillator) but it also runs on Main Power, not Backup Power. So it’s not suitable for setting the Deep Sleep alarm either.</p><p id="38ca" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">3️⃣ <strong class="gj hi">Low Speed External (LSE)</strong> (32.768 kHz crystal oscillator) is the best choice because it works on Backup Power (assuming that our Blue Pill has a Backup Power source when it goes into Deep Sleep)</p><p id="9028" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">What’s “<strong class="gj hi">Prescaling</strong>”? Something you do on a fish? No, prescaling lets us run the Real Time Clock as a fraction of the HSE / LSE / LSI clock speeds. So when we prescale LSE by 32, we run the Real Time Clock at 1 tick per millisecond. (LSE ticks natively at 32.768 kHz, or 32,768 ticks per second)</p><figure class="gz ha hb hc hd cz"><div class="dl r dd"><div class="jg r"><iframe src="https://web.archive.org/web/20191204194117if_/https://medium.com/media/0413fdb3d8522950b253dd61fed30446" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a href="https://web.archive.org/web/20191204194117/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/src/alarm.c" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/src/alarm.c</a></figcaption></figure><p id="881e" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Real Time Clock may be used in 3 ways to trigger interrupts…</p><p id="955c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">1️⃣ <strong class="gj hi">After a preset number of ticks</strong> (<code class="dm ix iy iz ja b">RTC_SEC</code>). So that the STM32 microcontroller’s Real Time Clock may be used like the Arm processor’s SysTick Timer.</p><p id="ff5b" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">2️⃣ <strong class="gj hi">At a preset alarm time</strong> (<code class="dm ix iy iz ja b">RTC_ALR</code>). We’re using this to wake up from Deep Sleep.</p><p id="e2e7" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">3️⃣ <strong class="gj hi">Upon overflow</strong> (<code class="dm ix iy iz ja b">RTC_OW</code>). The Real Time Clock is a 32-bit counter that counts the number of elapsed ticks from 0 to 4,294,967,295. When the counter overflows, the Real Time Clock triggers this interrupt so that the operating system can do the necessary time adjustments.</p><p id="40eb" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">We’ll be using only the Alarm Interrupt <code class="dm ix iy iz ja b">RTC_ALR</code>. When the alarm goes off, the Arm processor will call our function <code class="dm ix iy iz ja b">rtc_alarm_isr()</code></p><figure class="gz ha hb hc hd cz"><div class="dl r dd"><div class="jg r"><iframe src="https://web.archive.org/web/20191204194117if_/https://medium.com/media/2907fc3439b8e81dfa0843a8c183919a" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a href="https://web.archive.org/web/20191204194117/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/src/alarm.c" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/src/alarm.c</a></figcaption></figure><p id="d6a1" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">At power on we switch on the Real Time Clock and set the counter value to 0 (<code class="dm ix iy iz ja b">rtc_set_counter_val</code>). This is the counter we’ll be using to track the elapsed time (as millisecond ticks) in our application.</p><figure class="gz ha hb hc hd cz"><div class="dl r dd"><div class="jg r"><iframe src="https://web.archive.org/web/20191204194117if_/https://medium.com/media/6bb547aa16f14de7d8e7b44e8193b171" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a href="https://web.archive.org/web/20191204194117/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/src/alarm.c" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/src/alarm.c</a></figcaption></figure><p id="546d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">During wakeup from Deep Sleep we don’t reset the Real Time Clock counter. That way we can track the elapsed time as Blue Pill sleeps. Remember that the Real Time Clock keeps counting the ticks during Deep Sleep (powered by Backup Power).</p><figure class="gz ha hb hc hd cz"><div class="dl r dd"><div class="jg r"><iframe src="https://web.archive.org/web/20191204194117if_/https://medium.com/media/904f4aa88dc6cacb089dab3395753bb3" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a href="https://web.archive.org/web/20191204194117/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/src/alarm.c" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/src/alarm.c</a></figcaption></figure><p id="7675" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">For Deep Sleep Stop Mode: The External Interrupt (EXTI) must be configured so that the Alarm Interrupt will wake us up (<code class="dm ix iy iz ja b">exti_set_trigger</code>). This is not necessary for Deep Sleep Standby Mode.</p><figure class="gz ha hb hc hd cz"><div class="dl r dd"><div class="jg r"><iframe src="https://web.archive.org/web/20191204194117if_/https://medium.com/media/d1b2a607b1c5b41fa61e547096d8a533" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a href="https://web.archive.org/web/20191204194117/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/src/alarm.c" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/src/alarm.c</a></figcaption></figure><p id="e923" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Once we enable the Alarm Interrupt via <code class="dm ix iy iz ja b">rtc_interrupt_enable(RTC_ALR)</code>, the alarm becomes operational. We will call <code class="dm ix iy iz ja b">rtc_set_alarm_time()</code> to set the alarm time (in ticks). When the alarm goes off, our function <code class="dm ix iy iz ja b">rtc_alarm_isr()</code> will be called.</p><p id="3ae2" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Here’s how we set the alarm time before entering Deep Sleep…</p><figure class="gz ha hb hc hd cz"><div class="dl r dd"><div class="jg r"><iframe src="https://web.archive.org/web/20191204194117if_/https://medium.com/media/34ce570b711463736120d29f17f17ff6" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a href="https://web.archive.org/web/20191204194117/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/src/alarm.c" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/src/alarm.c</a></figcaption></figure></div></div><div class="cz ak"><figure class="lb lc ld le lf cz ak paragraph-image"><div class="db dc dd de ak"><div class="dl r dd dm"><div class="nh r"><div class="df dg cp t u dh ak di dj dk"><img alt="Blue Pill has 3 Oscillator Clocks:
 HSE, LSE and LSI. 
 Very primitive clocks, good 
 for tick tocks only. HSE is the fastest" class="cp t u dh ak do dp dq" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/60/1*NOWC3WM-G2GOOL9tillzfQ.png?q=20" width="5435" height="4588"/></div><img alt="Blue Pill has 3 Oscillator Clocks:
 HSE, LSE and LSI. 
 Very primitive clocks, good 
 for tick tocks only. HSE is the fastest" class="df dg cp t u dh ak dr" width="5435" height="4588"/><noscript><img alt="Blue Pill has 3 Oscillator Clocks:
 HSE, LSE and LSI. 
 Very primitive clocks, good 
 for tick tocks only. HSE is the fastest" class="cp t u dh ak" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/max/10870/1*NOWC3WM-G2GOOL9tillzfQ.png" width="5435" height="4588"/></noscript></div></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">HSE, LSE and LSI clocks on STM32 Blue Pill</figcaption></figure></div></section><hr class="hv dy hw hx hy dv hz ia ib ic id"/><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah dz aj ak"><h1 id="d2c0" class="ie if ec bk bj ig ih ii ij ik il im in io ip iq ir">💎 Advanced Topic: Backup Registers</h1><p id="930d" class="gh gi ec bk gj b gk is gm it go iu gq iv gs iw gu">Here’s the problem: Blue Pill wakes up from Deep Sleep Standby Mode with amnesia… It doesn’t know what it was doing before it fell into Deep Sleep, since the RAM has been erased. <em class="hh">How can we make Blue Pill memorise some state information so that it can resume working after waking up? Without writing to Flash ROM?</em></p><p id="0481" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Solution: Use the <strong class="gj hi">STM32 Backup Registers</strong>. Blue Pill’s Backup Registers are ten 16-bit registers that we may use to store 20 bytes of data. The contents of the registers will be preserved across restarts and wakeups,<strong class="gj hi"> as long as there is Backup Power (or Main Power) supplied to Blue Pill</strong>. It works just the Real Time Clock!</p><figure class="gz ha hb hc hd cz"><div class="dl r dd"><div class="jg r"><iframe src="https://web.archive.org/web/20191204194117if_/https://medium.com/media/dfad53cd227e334e11db0178695a51a2" allowfullscreen="" frameborder="0" height="0" width="0" title="backup-register.c" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a href="https://web.archive.org/web/20191204194117/https://github.com/lupyuen/codal-libopencm3/blob/master/stm32/bootloader/stm32f103/backup.c" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/codal-libopencm3/blob/master/stm32/bootloader/stm32f103/backup.c</a></figcaption></figure><p id="2fa6" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">This code was used in my Bootloader (from an earlier article) to remember whether Blue Pill is supposed to restart in Bootloader Mode or Application Mode. Check out the article: <em class="hh">“</em><a class="at cg gv gw gx gy" target="_blank" rel="noopener" href="/web/20191204194117/https://medium.com/@ly.lee/stm32-blue-pill-bootloading-the-webusb-bootloader-63398ef5eb76?source=friends_link&amp;sk=8b43b83310910e64752a61cf630e0b78"><em class="hh">STM32 Blue Pill — Bootloading the WebUSB Bootloader</em></a><em class="hh">”</em></p></div></div></section><hr class="hv dy hw hx hy dv hz ia ib ic id"/><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah dz aj ak"><h1 id="d9e6" class="ie if ec bk bj ig ih ii ij ik il im in io ip iq ir">💎 Advanced Topic: Patch Mynewt OS Functions</h1><p id="a0c9" class="gh gi ec bk gj b gk is gm it go iu gq iv gs iw gu">The low power functions were implemented in a custom library <code class="dm ix iy iz ja b"><a href="https://web.archive.org/web/20191204194117/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/tree/low-power/libs/low_power" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">libs/low_power</a></code>. How did we patch the Mynewt OS functions like <code class="dm ix iy iz ja b">os_task_idle()</code> with our custom library? By using the Linker Wrap directive in our library…</p><figure class="gz ha hb hc hd cz"><div class="dl r dd"><div class="jg r"><iframe src="https://web.archive.org/web/20191204194117if_/https://medium.com/media/a681e4022f8370bf720f608aeb8fbb98" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a href="https://web.archive.org/web/20191204194117/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/pkg.yml" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/pkg.yml</a></figcaption></figure><p id="696a" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">When the GNU Linker collates the compiled object files (<code class="dm ix iy iz ja b">*.o</code>) to create the firmware image, it will look for all calls to <code class="dm ix iy iz ja b">os_tick_idle()</code> and rename them as calls to <code class="dm ix iy iz ja b">__wrap_os_tick_idle()</code>.</p><p id="b887" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Note that GNU Linker will NOT rename the original <code class="dm ix iy iz ja b">os_tick_idle()</code> function defined in Mynewt. Which means that we may implement the <code class="dm ix iy iz ja b">__wrap_os_tick_idle()</code> function ourselves and the callers will happily pretend that it’s really <code class="dm ix iy iz ja b">os_tick_idle()</code>. That’s how we intercept system functions in Mynewt…</p><figure class="gz ha hb hc hd cz"><div class="dl r dd"><div class="jg r"><iframe src="https://web.archive.org/web/20191204194117if_/https://medium.com/media/61196aae914c52aeefa7a8cc935b9555" allowfullscreen="" frameborder="0" height="0" width="0" title="See https://medium.com/@ly.lee/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90" class="cp t u dh ak" scrolling="auto"></iframe></div></div><figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a href="https://web.archive.org/web/20191204194117/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/src/hal_os_tick.c" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/libs/low_power/src/hal_os_tick.c</a></figcaption></figure><p id="0293" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">It’s a nasty way to alter the behaviour of Mynewt (and I don’t condone it). But for exploratory and educational purposes, it’s probably OK.</p><p id="737a" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Note that the firmware size is close to 60 KB. Adding the 4 KB Stub Bootloader we get total 64 KB of Flash ROM used. This is very close to Blue Pill’s 64 KB ROM capacity. When you’re not debugging, uncomment the <code class="dm ix iy iz ja b">-Os</code> option in <code class="dm ix iy iz ja b"><a href="https://web.archive.org/web/20191204194117/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/apps/my_sensor_app/pkg.yml" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">apps/my_sensor_app/pkg.yml</a></code></p><pre class="gz ha hb hc hd jh ji jj"><span id="824d" class="jk if ec bk ja b ds jl jm r jn">#  C compiler flags<br/>pkg.cflags:<br/>    - -DFLOAT_SUPPORT  #  For encoding floats in CoAP messages<br/>#   - -Os              #  Optimise for smallest size</span></pre><p id="1511" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Also the random number generator has been disabled to reduce code size, hence the Device ID is always <code class="dm ix iy iz ja b">0000…</code> To enable it, change <code class="dm ix iy iz ja b">HMAC_PRNG</code> to <code class="dm ix iy iz ja b">1</code> in <code class="dm ix iy iz ja b"><a href="https://web.archive.org/web/20191204194117/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/low-power/targets/bluepill_my_sensor/syscfg.yml" class="at cg gv gw gx gy" target="_blank" rel="noopener nofollow">targets/bluepill_my_sensor/syscfg.yml</a></code></p><pre class="gz ha hb hc hd jh ji jj"><span id="017a" class="jk if ec bk ja b ds jl jm r jn">HMAC_PRNG: 0  # Disable HMAC PRNG pseudorandom number generator</span></pre></div></div></section></div></article><div class="df ct ni s ak nj nk nl" data-test-id="post-sidebar"><div class="n p"><div class="ac ae af ag ah ai aj ak"><div class="nm n co"><div class="ct"><div class="nn no np n"><div class="n o"><div class="nq r dd"><a href="https://web.archive.org/web/20191204194117/https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90&amp;source=post_sidebar-----cef5a3ecdd90---------------------clap_sidebar-" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener"><div class="ba nr ns nt nu nv nw nx ny nz oa"><svg width="29" height="29"><g fill-rule="evenodd"><path d="M13.74 1l.76 2.97.76-2.97zM16.82 4.78l1.84-2.56-1.43-.47zM10.38 2.22l1.84 2.56-.41-3.03zM22.38 22.62a5.11 5.11 0 0 1-3.16 1.61l.49-.45c2.88-2.89 3.45-5.98 1.69-9.21l-1.1-1.94-.96-2.02c-.31-.67-.23-1.18.25-1.55a.84.84 0 0 1 .66-.16c.34.05.66.28.88.6l2.85 5.02c1.18 1.97 1.38 5.12-1.6 8.1M9.1 22.1l-5.02-5.02a1 1 0 0 1 .7-1.7 1 1 0 0 1 .72.3l2.6 2.6a.44.44 0 0 0 .63-.62L6.1 15.04l-1.75-1.75a1 1 0 1 1 1.41-1.41l4.15 4.15a.44.44 0 0 0 .63 0 .44.44 0 0 0 0-.62L6.4 11.26l-1.18-1.18a1 1 0 0 1 0-1.4 1.02 1.02 0 0 1 1.41 0l1.18 1.16L11.96 14a.44.44 0 0 0 .62 0 .44.44 0 0 0 0-.63L8.43 9.22a.99.99 0 0 1-.3-.7.99.99 0 0 1 .3-.7 1 1 0 0 1 1.41 0l7 6.98a.44.44 0 0 0 .7-.5l-1.35-2.85c-.31-.68-.23-1.19.25-1.56a.85.85 0 0 1 .66-.16c.34.06.66.28.88.6L20.63 15c1.57 2.88 1.07 5.54-1.55 8.16a5.62 5.62 0 0 1-5.06 1.65 9.35 9.35 0 0 1-4.93-2.72zM13 6.98l2.56 2.56c-.5.6-.56 1.41-.15 2.28l.26.56-4.25-4.25a.98.98 0 0 1-.12-.45 1 1 0 0 1 .29-.7 1.02 1.02 0 0 1 1.41 0zm8.89 2.06c-.38-.56-.9-.92-1.49-1.01a1.74 1.74 0 0 0-1.34.33c-.38.29-.61.65-.71 1.06a2.1 2.1 0 0 0-1.1-.56 1.78 1.78 0 0 0-.99.13l-2.64-2.64a1.88 1.88 0 0 0-2.65 0 1.86 1.86 0 0 0-.48.85 1.89 1.89 0 0 0-2.67-.01 1.87 1.87 0 0 0-.5.9c-.76-.75-2-.75-2.7-.04a1.88 1.88 0 0 0 0 2.66c-.3.12-.61.29-.87.55a1.88 1.88 0 0 0 0 2.66l.62.62a1.88 1.88 0 0 0-.9 3.16l5.01 5.02c1.6 1.6 3.52 2.64 5.4 2.96a7.16 7.16 0 0 0 1.18.1c1.03 0 2-.25 2.9-.7A5.9 5.9 0 0 0 23 23.24c3.34-3.34 3.08-6.93 1.74-9.17l-2.87-5.04z"></path></g></svg></div></a></div><div class="ob r"><div class="oc"><h4 class="bj dy ds bl bo"><button class="at au av aw ax ay az ba bb bc bd be bf bg bh bi">12 </button></h4></div></div></div></div><div><div class="cf"><a href="https://web.archive.org/web/20191204194117/https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90&amp;source=post_sidebar--------------------------bookmark_sidebar-" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener"><svg width="25" height="25" viewbox="0 0 25 25"><path d="M19 6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14.66h.01c.01.1.05.2.12.28a.5.5 0 0 0 .7.03l5.67-4.12 5.66 4.13a.5.5 0 0 0 .71-.03.5.5 0 0 0 .12-.29H19V6zm-6.84 9.97L7 19.64V6a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v13.64l-5.16-3.67a.49.49 0 0 0-.68 0z" fill-rule="evenodd"></path></svg></a></div></div></div></div></div></div></div><div class="df ct ni s od ex oe of nk og"></div><div><div class="oh cz n co p"><div class="n p"><div class="ac ae af ag ah dz aj ak"><div class="n oi"></div><div class="n o oi"><div class="r"><div class="cf"><h4 class="bj dy fw bl bo"><div><div class="cf"><a href="https://web.archive.org/web/20191204194117/https://creativecommons.org/publicdomain/mark/1.0/" class="at au av aw ax ay az ba bb bc fi bf bg bh bi" target="_blank" rel="noopener nofollow">Public domain.</a></div></div></h4></div><div class="cf"><h4 class="bj dy fw bl bo"><span class="bp" style="margin-left:5px;vertical-align:text-bottom"></span></h4></div></div></div><div class="oj r"><ul class="ba bb"><li class="cf ok ol om"><a href="/web/20191204194117/https://medium.com/tag/programming" class="on oo cg bo r ji op a b fw">Programming</a></li><li class="cf ok ol om"><a href="/web/20191204194117/https://medium.com/tag/rust" class="on oo cg bo r ji op a b fw">Rust</a></li><li class="cf ok ol om"><a href="/web/20191204194117/https://medium.com/tag/stm32" class="on oo cg bo r ji op a b fw">Stm32</a></li><li class="cf ok ol om"><a href="/web/20191204194117/https://medium.com/tag/internet-of-things" class="on oo cg bo r ji op a b fw">Internet of Things</a></li><li class="cf ok ol om"><a href="/web/20191204194117/https://medium.com/tag/nb-iot" class="on oo cg bo r ji op a b fw">Nb Iot</a></li></ul></div><div class="oq n en ab"><div class="n o"><div class="or r dd"><a href="https://web.archive.org/web/20191204194117/https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90&amp;source=post_actions_footer-----cef5a3ecdd90---------------------clap_footer-" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener"><div class="c os ez n o ot dd ou ov ow ox oy oz pa pb pc pd pe pf pg ph"><div class="ba nr ns nt nu nv pi nx o dr ez n p pj u dh cp t ak ny nz oa pk"><svg width="33" height="33" viewbox="0 0 33 33"><path d="M28.86 17.34l-3.64-6.4c-.3-.43-.71-.73-1.16-.8a1.12 1.12 0 0 0-.9.21c-.62.5-.73 1.18-.32 2.06l1.22 2.6 1.4 2.45c2.23 4.09 1.51 8-2.15 11.66a9.6 9.6 0 0 1-.8.71 6.53 6.53 0 0 0 4.3-2.1c3.82-3.82 3.57-7.87 2.05-10.39zm-6.25 11.08c3.35-3.35 4-6.78 1.98-10.47L21.2 12c-.3-.43-.71-.72-1.16-.8a1.12 1.12 0 0 0-.9.22c-.62.49-.74 1.18-.32 2.06l1.72 3.63a.5.5 0 0 1-.81.57l-8.91-8.9a1.33 1.33 0 0 0-1.89 1.88l5.3 5.3a.5.5 0 0 1-.71.7l-5.3-5.3-1.49-1.49c-.5-.5-1.38-.5-1.88 0a1.34 1.34 0 0 0 0 1.89l1.49 1.5 5.3 5.28a.5.5 0 0 1-.36.86.5.5 0 0 1-.36-.15l-5.29-5.29a1.34 1.34 0 0 0-1.88 0 1.34 1.34 0 0 0 0 1.89l2.23 2.23L9.3 21.4a.5.5 0 0 1-.36.85.5.5 0 0 1-.35-.14l-3.32-3.33a1.33 1.33 0 0 0-1.89 0 1.32 1.32 0 0 0-.39.95c0 .35.14.69.4.94l6.39 6.4c3.53 3.53 8.86 5.3 12.82 1.35zM12.73 9.26l5.68 5.68-.49-1.04c-.52-1.1-.43-2.13.22-2.89l-3.3-3.3a1.34 1.34 0 0 0-1.88 0 1.33 1.33 0 0 0-.4.94c0 .22.07.42.17.61zm14.79 19.18a7.46 7.46 0 0 1-6.41 2.31 7.92 7.92 0 0 1-3.67.9c-3.05 0-6.12-1.63-8.36-3.88l-6.4-6.4A2.31 2.31 0 0 1 2 19.72a2.33 2.33 0 0 1 1.92-2.3l-.87-.87a2.34 2.34 0 0 1 0-3.3 2.33 2.33 0 0 1 1.24-.64l-.14-.14a2.34 2.34 0 0 1 0-3.3 2.39 2.39 0 0 1 3.3 0l.14.14a2.33 2.33 0 0 1 3.95-1.24l.09.09c.09-.42.29-.83.62-1.16a2.34 2.34 0 0 1 3.3 0l3.38 3.39a2.17 2.17 0 0 1 1.27-.17c.54.08 1.03.35 1.45.76.1-.55.41-1.03.9-1.42a2.12 2.12 0 0 1 1.67-.4 2.8 2.8 0 0 1 1.85 1.25l3.65 6.43c1.7 2.83 2.03 7.37-2.2 11.6zM13.22.48l-1.92.89 2.37 2.83-.45-3.72zm8.48.88L19.78.5l-.44 3.7 2.36-2.84zM16.5 3.3L15.48 0h2.04L16.5 3.3z" fill-rule="evenodd"></path></svg></div></div></a></div><div class="ob r"><div class="oc"><h4 class="bj dy ds bl ec"><button class="at au av aw ax ay az ba bb bc bd be bf bg bh bi">12 claps</button></h4></div></div></div><div class="n o"><div class="gf r ar"><a href="//web.archive.org/web/20191204194117/https://medium.com/p/cef5a3ecdd90/share/twitter?source=post_actions_footer---------------------------" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" target="_blank" rel="noopener"><svg width="29" height="29" class="q"><path d="M22.05 7.54a4.47 4.47 0 0 0-3.3-1.46 4.53 4.53 0 0 0-4.53 4.53c0 .35.04.7.08 1.05A12.9 12.9 0 0 1 5 6.89a5.1 5.1 0 0 0-.65 2.26c.03 1.6.83 2.99 2.02 3.79a4.3 4.3 0 0 1-2.02-.57v.08a4.55 4.55 0 0 0 3.63 4.44c-.4.08-.8.13-1.21.16l-.81-.08a4.54 4.54 0 0 0 4.2 3.15 9.56 9.56 0 0 1-5.66 1.94l-1.05-.08c2 1.27 4.38 2.02 6.94 2.02 8.3 0 12.86-6.9 12.84-12.85.02-.24 0-.43 0-.65a8.68 8.68 0 0 0 2.26-2.34c-.82.38-1.7.62-2.6.72a4.37 4.37 0 0 0 1.95-2.51c-.84.53-1.81.9-2.83 1.13z"></path></svg></a></div><div class="gf r ar"><a href="//web.archive.org/web/20191204194117/https://medium.com/p/cef5a3ecdd90/share/linkedIn?source=post_actions_footer---------------------------" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" target="_blank" rel="noopener"><svg width="29" height="29" viewbox="0 0 29 29" fill="none" class="q"><path d="M5 6.36C5 5.61 5.63 5 6.4 5h16.2c.77 0 1.4.61 1.4 1.36v16.28c0 .75-.63 1.36-1.4 1.36H6.4c-.77 0-1.4-.6-1.4-1.36V6.36z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M10.76 20.9v-8.57H7.89v8.58h2.87zm-1.44-9.75c1 0 1.63-.65 1.63-1.48-.02-.84-.62-1.48-1.6-1.48-.99 0-1.63.64-1.63 1.48 0 .83.62 1.48 1.59 1.48h.01zM12.35 20.9h2.87v-4.79c0-.25.02-.5.1-.7.2-.5.67-1.04 1.46-1.04 1.04 0 1.46.8 1.46 1.95v4.59h2.87v-4.92c0-2.64-1.42-3.87-3.3-3.87-1.55 0-2.23.86-2.61 1.45h.02v-1.24h-2.87c.04.8 0 8.58 0 8.58z" fill="#fff"></path></svg></a></div><div class="gf r ar"><a href="//web.archive.org/web/20191204194117/https://medium.com/p/cef5a3ecdd90/share/facebook?source=post_actions_footer---------------------------" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" target="_blank" rel="noopener"><svg width="29" height="29" class="q"><path d="M23.2 5H5.8a.8.8 0 0 0-.8.8V23.2c0 .44.35.8.8.8h9.3v-7.13h-2.38V13.9h2.38v-2.38c0-2.45 1.55-3.66 3.74-3.66 1.05 0 1.95.08 2.2.11v2.57h-1.5c-1.2 0-1.48.57-1.48 1.4v1.96h2.97l-.6 2.97h-2.37l.05 7.12h5.1a.8.8 0 0 0 .79-.8V5.8a.8.8 0 0 0-.8-.79"></path></svg></a></div><div class="gf r ar"><div><div class="cf"><a href="https://web.archive.org/web/20191204194117/https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90&amp;source=post_actions_footer--------------------------bookmark_sidebar-" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener"><svg width="25" height="25" viewbox="0 0 25 25"><path d="M19 6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14.66h.01c.01.1.05.2.12.28a.5.5 0 0 0 .7.03l5.67-4.12 5.66 4.13a.5.5 0 0 0 .71-.03.5.5 0 0 0 .12-.29H19V6zm-6.84 9.97L7 19.64V6a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v13.64l-5.16-3.67a.49.49 0 0 0-.68 0z" fill-rule="evenodd"></path></svg></a></div></div></div><div class="cf"><div class="r ar"><button class="at au av aw ax ay az ba bb bc bd be bf bg bh bi"><svg width="25" height="25" viewbox="-480.5 272.5 21 21" class="q"><path d="M-463 284.6c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5zm-7-.9c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5zm-7-.9c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5z"></path></svg></button></div></div></div></div><div class="pl pm pn oj r ab"><div class="po pp r dd"><span class="r pq an pr"><div class="r cp ps pt"><a rel="noopener" href="/web/20191204194117/https://medium.com/@ly.lee?source=follow_footer--------------------------follow_footer-"><div class="dd pu pv"><div class="bs n et o p cp eu ev ew ex ey ct"><svg width="91" height="91" viewbox="0 0 91 91"><path fill-rule="evenodd" clip-rule="evenodd" d="M45.5 1.4c-17.14 0-32 9.95-39.25 24.5L5 25.28C12.47 10.28 27.8 0 45.5 0S78.53 10.29 86 25.28l-1.25.62C77.5 11.35 62.65 1.4 45.5 1.4zM6.25 65.1c7.25 14.55 22.1 24.5 39.25 24.5 17.14 0 32-9.95 39.25-24.5l1.25.62C78.53 80.72 63.2 91 45.5 91S12.47 80.71 5 65.72l1.25-.62z"></path></svg></div><img alt="Lup Yuen Lee 李立源" class="r ez pv pu" src="https://web.archive.org/web/20191204194117im_/https://miro.medium.com/fit/c/160/160/1*KGohS3sQaUnr58gc0BIfoQ.jpeg" width="80" height="80"/></div></a></div><span class="r"><div class="pw r px"><p class="bj dy fw bl bo py pz">Written by</p></div><div class="pw qa n px"><div class="ak n o en"><h2 class="bj ig hw qb ec"><a class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener" href="/web/20191204194117/https://medium.com/@ly.lee?source=follow_footer--------------------------follow_footer-">Lup Yuen Lee 李立源</a></h2><div class="r g"><button class="qc ec q by fl fm fn fo bc bh fp fq fr fs ft fu cb bj b bk bl bm bn cc cd ce cf cg bf">Follow</button></div></div></div></span></span><div class="pw qd r px aq"><div class="qe r"><h4 class="bj dy mq qf bo">Techie and Educator in IoT 物聯網教師</h4></div><div class="ap qg aq"><button class="qc ec q by fl fm fn fo bc bh fp fq fr fs ft fu cb bj b bk bl bm bn cc cd ce cf cg bf">Follow</button></div></div></div></div><div class="qh pm r ab"><a href="https://web.archive.org/web/20191204194117/https://medium.com/p/cef5a3ecdd90/responses/show?source=follow_footer--------------------------follow_footer-" class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener"><span class="ks qi nu"><div class="jh qj cb r dv g"><span class="br">Write the first response</span></div></span></a></div></div></div><div class="qk r ql ab"><div class="n p"><div class="ac ae af ag ah ai aj ak"></div></div></div></div></div><div class="qm r qn qo"><section class="cl cm ak ce r ly lz ma mb mc md me mf mg mh mi mj mk ml mm"><div class="qp qq po n en g"><div class="qr n en"><div class="qs r qt"><div class="qu r"><a href="https://web.archive.org/web/20191204194117/https://medium.com/about?autoplay=1&amp;source=post_page-----cef5a3ecdd90----------------------" class="at au av aw ax ay az ba bb bc qv qw bf bg qx qy" rel="noopener"><h4 class="qz ra rb bj ig bk qf rc rd r">Discover <!-- -->Medium</h4></a></div><span class="bj b bk bl bm bn r re rf">Welcome to a place where words matter. On <!-- -->Medium<!-- -->, smart voices and original ideas take center stage - with no ads in sight.<!-- --> <a href="https://web.archive.org/web/20191204194117/https://medium.com/about?autoplay=1&amp;source=post_page-----cef5a3ecdd90----------------------" class="at au av aw ax ay az ba bb bc bf bg qx qy rg" rel="noopener">Watch</a></span></div><div class="qs r qt"><div class="rh r"><a href="https://web.archive.org/web/20191204194117/https://medium.com/topics?source=post_page-----cef5a3ecdd90----------------------" class="at au av aw ax ay az ba bb bc qv qw bf bg qx qy" rel="noopener"><h4 class="qz ra rb bj ig bk qf rc rd r">Make <!-- -->Medium<!-- --> yours</h4></a></div><span class="bj b bk bl bm bn r re rf">Follow all the topics you care about, and we’ll deliver the best stories for you to your homepage and inbox.<!-- --> <a href="https://web.archive.org/web/20191204194117/https://medium.com/topics?source=post_page-----cef5a3ecdd90----------------------" class="at au av aw ax ay az ba bb bc bf bg qx qy rg" rel="noopener">Explore</a></span></div><div class="qs r qt"><div class="qu r"><a href="https://web.archive.org/web/20191204194117/https://medium.com/membership?source=post_page-----cef5a3ecdd90----------------------" class="at au av aw ax ay az ba bb bc qv qw bf bg qx qy" rel="noopener"><h4 class="qz ra rb bj ig bk qf rc rd r">Become a member</h4></a></div><span class="bj b bk bl bm bn r re rf">Get unlimited access to the best stories on <!-- -->Medium<!-- --> — and support writers while you’re at it. Just $5/month.<!-- --> <a href="https://web.archive.org/web/20191204194117/https://medium.com/membership?source=post_page-----cef5a3ecdd90----------------------" class="at au av aw ax ay az ba bb bc bf bg qx qy rg" rel="noopener">Upgrade</a></span></div></div></div><div class="n o en"><a class="at au av aw ax ay az ba bb bc qv qw bf bg qx qy" rel="noopener" href="/web/20191204194117/https://medium.com/?source=post_page-----cef5a3ecdd90----------------------"><svg height="22" width="112" viewbox="0 0 111.5 22" class="ra"><path d="M56.3 19.5c0 .4 0 .5.3.7l1.5 1.4v.1h-6.5V19c-.7 1.8-2.4 3-4.3 3-3.3 0-5.8-2.6-5.8-7.5 0-4.5 2.6-7.6 6.3-7.6 1.6-.1 3.1.8 3.8 2.4V3.2c0-.3-.1-.6-.3-.7l-1.4-1.4V1l6.5-.8v19.3zm-4.8-.8V9.5c-.5-.6-1.2-.9-1.9-.9-1.6 0-3.1 1.4-3.1 5.7 0 4 1.3 5.4 3 5.4.8.1 1.6-.3 2-1zm9.1 3.1V9.4c0-.3-.1-.6-.3-.7l-1.4-1.5v-.1h6.5v12.5c0 .4 0 .5.3.7l1.4 1.4v.1h-6.5zm-.2-19.2C60.4 1.2 61.5 0 63 0c1.4 0 2.6 1.2 2.6 2.6S64.4 5.3 63 5.3a2.6 2.6 0 0 1-2.6-2.7zm22.5 16.9c0 .4 0 .5.3.7l1.5 1.4v.1h-6.5v-3.2c-.6 2-2.4 3.4-4.5 3.4-2.9 0-4.4-2.1-4.4-6.2 0-1.9 0-4.1.1-6.5 0-.3-.1-.5-.3-.7L67.7 7v.1H74v8c0 2.6.4 4.4 2 4.4.9-.1 1.7-.6 2.1-1.3V9.5c0-.3-.1-.6-.3-.7l-1.4-1.5v-.2h6.5v12.4zm22 2.3c0-.5.1-6.5.1-7.9 0-2.6-.4-4.5-2.2-4.5-.9 0-1.8.5-2.3 1.3.2.8.3 1.7.3 2.5 0 1.8-.1 4.2-.1 6.5 0 .3.1.5.3.7l1.5 1.4v.1H96c0-.4.1-6.5.1-7.9 0-2.7-.4-4.5-2.2-4.5-.9 0-1.7.5-2.2 1.3v9c0 .4 0 .5.3.7l1.4 1.4v.1h-6.5V9.5c0-.3-.1-.6-.3-.7l-1.4-1.5v-.2h6.5v3.1a4.6 4.6 0 0 1 4.6-3.4c2.2 0 3.6 1.2 4.2 3.5.7-2.1 2.7-3.6 4.9-3.5 2.9 0 4.5 2.2 4.5 6.2 0 1.9-.1 4.2-.1 6.5-.1.3.1.6.3.7l1.4 1.4v.1h-6.6zm-81.4-2l1.9 1.9v.1h-9.8v-.1l2-1.9c.2-.2.3-.4.3-.7V7.3c0-.5 0-1.2.1-1.8L11.4 22h-.1L4.5 6.8c-.1-.4-.2-.4-.3-.6v10c-.1.7 0 1.3.3 1.9l2.7 3.6v.1H0v-.1L2.7 18c.3-.6.4-1.3.3-1.9v-11c0-.5-.1-1.1-.5-1.5L.7 1.1V1h7l5.8 12.9L18.6 1h6.8v.1l-1.9 2.2c-.2.2-.3.5-.3.7v15.2c0 .2.1.5.3.6zm7.6-5.9c0 3.8 1.9 5.3 4.2 5.3 1.9.1 3.6-1 4.4-2.7h.1c-.8 3.7-3.1 5.5-6.5 5.5-3.7 0-7.2-2.2-7.2-7.4 0-5.5 3.5-7.6 7.3-7.6 3.1 0 6.4 1.5 6.4 6.2v.8h-8.7zm0-.8h4.3v-.8c0-3.9-.8-4.9-2-4.9-1.4.1-2.3 1.6-2.3 5.7z"></path></svg></a><span class="bj b bk bl bm bn r re rf"><div class="ri rj n en rk an"><a href="https://web.archive.org/web/20191204194117/https://medium.com/about?autoplay=1&amp;source=post_page-----cef5a3ecdd90----------------------" class="at au av aw ax ay az ba bb bc fi bf bg qx qy" rel="noopener">About</a><a href="https://web.archive.org/web/20191204194117/https://help.medium.com/?source=post_page-----cef5a3ecdd90----------------------" class="at au av aw ax ay az ba bb bc fi bf bg qx qy" rel="noopener">Help</a><a class="at au av aw ax ay az ba bb bc fi bf bg qx qy" rel="noopener" href="/web/20191204194117/https://medium.com/policy/9db0094a1e0f?source=post_page-----cef5a3ecdd90----------------------">Legal</a></div></span></div></section></div></div></div><script src="https://web.archive.org/web/20191204194117js_/https://cdn.optimizely.com/js/16180790160.js"></script><script>window.__BUILD_ID__ = "development"</script><script>window.__GRAPHQL_URI__ = "https://web.archive.org/web/20191204194117/https://medium.com/_/graphql"</script><script>window.__PRELOADED_STATE__ = {"config":{"nodeEnv":"production","version":"master-20191204-185604-55b0ab8728","productName":"Medium","publicUrl":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fcdn-client.medium.com\u002Flite","authDomain":"medium.com","authGoogleClientId":"216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com","favicon":"production","glyphUrl":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fglyph.medium.com","branchKey":"key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm","lightStep":{"name":"lite-web","host":"collector-medium.lightstep.com","token":"ce5be895bef60919541332990ac9fef2","appVersion":"master-20191204-185604-55b0ab8728"},"algolia":{"appId":"MQ57UUUQZ2","apiKeySearch":"394474ced050e3911ae2249ecc774921","indexPrefix":"medium_","host":"-dsn.algolia.net"},"recaptchaKey":"6Lfc37IUAAAAAKGGtC6rLS13R1Hrw_BqADfS1LRk","sentry":{"dsn":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002F589e367c28ca47b195ce200d1507d18b@sentry.io\u002F1423575","environment":"production"},"isAmp":false,"googleAnalyticsCode":"UA-24232453-2","signInWallCustomDomainCollectionIds":["3a8144eabfe3","336d898217ee","61061eb0c96b","138adf9c44c","819cc2aaeee0"],"mediumOwnedAndOperatedCollectionIds":["544c7006046e","bcc38c8f6edf","444d13b52878","8d6b8a439e32","92d2092dc598","1285ba81cada","cb8577c9149e","8ccfed20cbb2","ae2a65f35510","3f6ecf56618","7b6769f2748b","fc8964313712","ef8e90590e66","191186aaafa0","d944778ce714","bdc4052bbdba","88d9857e584e"],"tierOneDomains":["medium.com","thebolditalic.com","arcdigital.media","towardsdatascience.com","uxdesign.cc","codeburst.io","psiloveyou.xyz","writingcooperative.com","entrepreneurshandbook.co","prototypr.io","betterhumans.coach.me","theascent.pub"]},"debug":{"requestId":"a0a23c30-6bda-40d2-82ba-847b434a63df","originalSpanCarrier":{"ot-tracer-spanid":"1ccedd1862894332","ot-tracer-traceid":"1fd4e69c5b945a17","ot-tracer-sampled":"true"}},"session":{"user":{"id":"lo_6MTQCV0WJCBJ"},"xsrf":""},"stats":{"itemCount":0,"sending":false,"timeout":null,"backup":{}},"navigation":{"showBranchBanner":null,"hasRenderedBranchBanner":null,"hideGoogleOneTap":false,"hideAlternateUser":false,"branchData":{"loaded":false},"shareKey":"e232e68dc7c91dd4397e96d7dbde543a","referrerSource":"friends_link","currentLocation":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90","host":"medium.com","hostname":"medium.com","referrer":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fmedium.com\u002Ftag\u002Frust","susiModal":{"step":null,"operation":"register","reportEventInfo":{"eventName":"","data":{}}}},"client":{"isBot":false,"isEu":false,"isNativeMedium":false,"isCustomDomain":false},"multiVote":{"clapsPerPost":{}},"metadata":{"faviconImageId":null}}</script><script>window.__APOLLO_STATE__ = {"ROOT_QUERY":{"viewer":null,"meterPost({\"postId\":\"cef5a3ecdd90\",\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}})":{"type":"id","generated":false,"id":"MeteringInfo:singleton","typename":"MeteringInfo"},"postResult({\"id\":\"cef5a3ecdd90\"})":{"type":"id","generated":false,"id":"Post:cef5a3ecdd90","typename":"Post"},"variantFlags":[{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.0","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.1","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.2","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.3","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.4","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.5","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.6","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.7","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.8","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.9","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.10","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.11","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.12","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.13","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.14","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.15","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.16","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.17","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.18","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.19","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.20","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.21","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.22","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.23","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.24","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.25","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.26","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.27","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.28","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.29","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.30","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.31","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.32","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.33","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.34","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.35","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.36","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.37","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.38","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.39","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.40","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.41","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.42","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.43","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.44","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.45","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.46","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.47","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.48","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.49","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.50","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.51","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.52","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.53","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.54","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.55","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.56","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.57","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.58","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.59","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.60","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.61","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.62","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.63","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.64","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.65","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.66","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.67","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.68","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.69","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.70","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.71","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.72","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.73","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.74","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.75","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.76","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.77","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.78","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.79","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.80","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.81","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.82","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.83","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.84","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.85","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.86","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.87","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.88","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.89","typename":"VariantFlag"},{"type":"id","generated":true,"id":"ROOT_QUERY.variantFlags.90","typename":"VariantFlag"}]},"MeteringInfo:singleton":{"__typename":"MeteringInfo","postIds":{"type":"json","json":[]},"maxUnlockCount":3,"unlocksRemaining":3},"Post:cef5a3ecdd90":{"__typename":"Post","visibility":"PUBLIC","latestPublishedVersion":"d1e993b9483f","collection":null,"id":"cef5a3ecdd90","creator":{"type":"id","generated":false,"id":"User:1da08193a324","typename":"User"},"isLocked":false,"lockedSource":"LOCKED_POST_SOURCE_NONE","sequence":null,"mediumUrl":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90","canonicalUrl":"","content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}})":{"type":"id","generated":true,"id":"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}})","typename":"PostContent"},"firstPublishedAt":1567167935187,"isPublished":true,"layerCake":0,"primaryTopic":null,"title":"Low Power NB-IoT on STM32 Blue Pill with Apache Mynewt and Embedded Rust","isLimitedState":false,"pendingCollection":null,"shareKey":null,"statusForCollection":null,"readingTime":15.943396226415095,"readingList":"READING_LIST_NONE","license":"PUBLIC_DOMAIN","allowResponses":true,"tags":[{"type":"id","generated":false,"id":"Tag:programming","typename":"Tag"},{"type":"id","generated":false,"id":"Tag:rust","typename":"Tag"},{"type":"id","generated":false,"id":"Tag:stm32","typename":"Tag"},{"type":"id","generated":false,"id":"Tag:internet-of-things","typename":"Tag"},{"type":"id","generated":false,"id":"Tag:nb-iot","typename":"Tag"}],"viewerClapCount":0,"clapCount":12,"voterCount":8,"recommenders":[],"responsesCount":0,"collaborators":[],"translationSourcePost":null,"newsletterId":"","inResponseToPostResult":null,"inResponseToMediaResource":null,"curationEligibleAt":1567167933418,"audioVersionUrl":"","seoTitle":"","socialTitle":"","socialDek":"","metaDescription":"How much power do Quectel NB-IoT modules consume? Let’s find out with the RuiDeng DPS 3005","latestPublishedAt":1571377542236,"wordCount":3695,"previewContent":{"type":"id","generated":true,"id":"$Post:cef5a3ecdd90.previewContent","typename":"PreviewContent"},"previewImage":{"type":"id","generated":false,"id":"ImageMetadata:1*kEsNkF1AtQAE8J5ggHDH8w.png","typename":"ImageMetadata"},"updatedAt":1571377542626,"topics":[],"seoDescription":"","isSuspended":false},"User:1da08193a324":{"id":"1da08193a324","__typename":"User","isSuspended":false,"allowNotes":true,"name":"Lup Yuen Lee 李立源","isFollowing":false,"username":"ly.lee","bio":"Techie and Educator in IoT 物聯網教師","imageId":"1*KGohS3sQaUnr58gc0BIfoQ.jpeg","mediumMemberAt":1571194811000,"isBlocking":false,"isPartnerProgramEnrolled":false,"twitterScreenName":"MisterTechBlog"},"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}})":{"isLockedPreviewOnly":false,"validatedShareKey":"e232e68dc7c91dd4397e96d7dbde543a","__typename":"PostContent","bodyModel":{"type":"id","generated":true,"id":"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel","typename":"RichText"}},"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.0":{"name":"8b2b","startIndex":0,"textLayout":"FLOW","imageLayout":"NONE","backgroundImage":null,"videoLayout":"NO_VIDEO","backgroundVideo":null,"__typename":"Section"},"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.1":{"name":"73d4","startIndex":21,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.2":{"name":"9abe","startIndex":41,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.3":{"name":"d332","startIndex":58,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.4":{"name":"88a7","startIndex":70,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.5":{"name":"129d","startIndex":80,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.6":{"name":"4a25","startIndex":94,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.7":{"name":"5de7","startIndex":129,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.8":{"name":"ea9d","startIndex":140,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.9":{"name":"e84e","startIndex":150,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.10":{"name":"c8b6","startIndex":176,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.11":{"name":"a638","startIndex":181,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null,"__typename":"Section"},"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel":{"sections":[{"type":"id","generated":true,"id":"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.0","typename":"Section"},{"type":"id","generated":true,"id":"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.1","typename":"Section"},{"type":"id","generated":true,"id":"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.2","typename":"Section"},{"type":"id","generated":true,"id":"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.3","typename":"Section"},{"type":"id","generated":true,"id":"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.4","typename":"Section"},{"type":"id","generated":true,"id":"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.5","typename":"Section"},{"type":"id","generated":true,"id":"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.6","typename":"Section"},{"type":"id","generated":true,"id":"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.7","typename":"Section"},{"type":"id","generated":true,"id":"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.8","typename":"Section"},{"type":"id","generated":true,"id":"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.9","typename":"Section"},{"type":"id","generated":true,"id":"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.10","typename":"Section"},{"type":"id","generated":true,"id":"$Post:cef5a3ecdd90.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"e232e68dc7c91dd4397e96d7dbde543a\",\"source\":\"friends_link\"}}).bodyModel.sections.11","typename":"Section"}],"paragraphs":[{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_0","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_1","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_2","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_3","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_4","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_5","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_6","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_7","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_8","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_9","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_10","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_11","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_12","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_13","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_14","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_15","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_16","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_17","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_18","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_19","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_20","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_21","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_22","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_23","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_24","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_25","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_26","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_27","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_28","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_29","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_30","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_31","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_32","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_33","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_34","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_35","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_36","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_37","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_38","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_39","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_40","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_41","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_42","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_43","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_44","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_45","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_46","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_47","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_48","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_49","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_50","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_51","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_52","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_53","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_54","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_55","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_56","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_57","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_58","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_59","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_60","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_61","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_62","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_63","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_64","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_65","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_66","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_67","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_68","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_69","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_70","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_71","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_72","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_73","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_74","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_75","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_76","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_77","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_78","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_79","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_80","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_81","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_82","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_83","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_84","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_85","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_86","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_87","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_88","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_89","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_90","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_91","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_92","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_93","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_94","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_95","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_96","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_97","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_98","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_99","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_100","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_101","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_102","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_103","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_104","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_105","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_106","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_107","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_108","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_109","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_110","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_111","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_112","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_113","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_114","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_115","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_116","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_117","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_118","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_119","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_120","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_121","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_122","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_123","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_124","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_125","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_126","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_127","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_128","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_129","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_130","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_131","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_132","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_133","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_134","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_135","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_136","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_137","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_138","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_139","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_140","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_141","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_142","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_143","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_144","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_145","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_146","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_147","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_148","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_149","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_150","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_151","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_152","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_153","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_154","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_155","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_156","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_157","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_158","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_159","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_160","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_161","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_162","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_163","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_164","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_165","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_166","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_167","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_168","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_169","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_170","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_171","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_172","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_173","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_174","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_175","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_176","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_177","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_178","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_179","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_180","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_181","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_182","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_183","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_184","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_185","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_186","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_187","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_188","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_189","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_190","typename":"Paragraph"},{"type":"id","generated":false,"id":"Paragraph:d1e993b9483f_191","typename":"Paragraph"}],"__typename":"RichText"},"Paragraph:d1e993b9483f_0":{"id":"d1e993b9483f_0","name":"8f10","type":"IMG","href":null,"layout":"FULL_WIDTH","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*kEsNkF1AtQAE8J5ggHDH8w.png","typename":"ImageMetadata"},"text":"RuiDeng DPS 3005 Power Monitor measuring the power consumption of STM32 Blue Pill connected to Quectel BC95-G NB-IoT module","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*kEsNkF1AtQAE8J5ggHDH8w.png":{"id":"1*kEsNkF1AtQAE8J5ggHDH8w.png","originalHeight":1952,"originalWidth":3264,"focusPercentX":null,"focusPercentY":null,"alt":null,"__typename":"ImageMetadata"},"Paragraph:d1e993b9483f_1":{"id":"d1e993b9483f_1","name":"1bb6","type":"H3","href":null,"layout":null,"metadata":null,"text":"Low Power NB-IoT on STM32 Blue Pill with Apache Mynewt and Embedded Rust","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_2":{"id":"d1e993b9483f_2","name":"9328","type":"P","href":null,"layout":null,"metadata":null,"text":"In this article we’ll learn to optimise the power consumption of the NB-IoT Sensor Application in the previous tutorial from this jagged power-hungry mess…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_2.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_2.markups.0":{"type":"A","start":69,"end":119,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Frust-rocks-nb-iot-stm32-blue-pill-with-quectel-bc95-g-on-apache-mynewt-ef62a7e28f7e?source=friends_link&sk=aaa21371f68a07c543066b6b89a760f0","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_3":{"id":"d1e993b9483f_3","name":"3faa","type":"IMG","href":null,"layout":"FULL_WIDTH","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*1t_LDe0SVfohlSUBPfY42A.png","typename":"ImageMetadata"},"text":"Power consumed by our IoT sensor device before optimisation. From https:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1QptBX2wn_RC5-oaVPyxynbmKROO5ElfHJyNcqcX0YhA\u002Fedit?usp=sharing","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_3.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*1t_LDe0SVfohlSUBPfY42A.png":{"id":"1*1t_LDe0SVfohlSUBPfY42A.png","originalHeight":371,"originalWidth":1637,"focusPercentX":null,"focusPercentY":null,"alt":null,"__typename":"ImageMetadata"},"Paragraph:d1e993b9483f_3.markups.0":{"type":"A","start":66,"end":166,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1QptBX2wn_RC5-oaVPyxynbmKROO5ElfHJyNcqcX0YhA\u002Fedit?usp=sharing","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_4":{"id":"d1e993b9483f_4","name":"2b80","type":"P","href":null,"layout":null,"metadata":null,"text":"To these well-disciplined bars…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_5":{"id":"d1e993b9483f_5","name":"1c4f","type":"IMG","href":null,"layout":"FULL_WIDTH","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*EdofQd-ZJegbGWRqgSrrRg.png","typename":"ImageMetadata"},"text":"Power consumed by our IoT sensor device after optimisation. From https:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo\u002Fedit?usp=sharing","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_5.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*EdofQd-ZJegbGWRqgSrrRg.png":{"id":"1*EdofQd-ZJegbGWRqgSrrRg.png","originalHeight":371,"originalWidth":1634,"focusPercentX":null,"focusPercentY":null,"alt":null,"__typename":"ImageMetadata"},"Paragraph:d1e993b9483f_5.markups.0":{"type":"A","start":65,"end":165,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo\u002Fedit?usp=sharing","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_6":{"id":"d1e993b9483f_6","name":"e50d","type":"P","href":null,"layout":null,"metadata":null,"text":"It’s a simple application (coded in Embedded Rust) that polls Blue Pill’s internal temperature sensor and transmits the sensor data to a server over NB-IoT.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_7":{"id":"d1e993b9483f_7","name":"8c29","type":"P","href":null,"layout":null,"metadata":null,"text":"The power optimisation (recorded with a $25 RuiDeng DPS 3005 Power Monitor) becomes more apparent when we compare the charts side by side…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_7.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_7.markups.0":{"type":"A","start":44,"end":74,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fwww.aliexpress.com\u002Fitem\u002F32684316119.html","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_8":{"id":"d1e993b9483f_8","name":"4a2a","type":"IMG","href":null,"layout":"FULL_WIDTH","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*r2BOfUOGYrl-ottE9bYI6A.png","typename":"ImageMetadata"},"text":"Power consumed by our IoT sensor device before and after optimisation. From https:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1QptBX2wn_RC5-oaVPyxynbmKROO5ElfHJyNcqcX0YhA\u002Fedit?usp=sharing and https:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo\u002Fedit?usp=sharing","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_8.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_8.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*r2BOfUOGYrl-ottE9bYI6A.png":{"id":"1*r2BOfUOGYrl-ottE9bYI6A.png","originalHeight":824,"originalWidth":3200,"focusPercentX":null,"focusPercentY":null,"alt":"Before: Device consumes at least 20 milliAmperes of current. After: Reduced to 3 milliAmperes with Deep Sleep Standby Mode","__typename":"ImageMetadata"},"Paragraph:d1e993b9483f_8.markups.0":{"type":"A","start":76,"end":176,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1QptBX2wn_RC5-oaVPyxynbmKROO5ElfHJyNcqcX0YhA\u002Fedit?usp=sharing","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_8.markups.1":{"type":"A","start":181,"end":281,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo\u002Fedit?usp=sharing","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_9":{"id":"d1e993b9483f_9","name":"49c3","type":"P","href":null,"layout":null,"metadata":null,"text":"From the charts above we can see the secret to long battery life is this…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_10":{"id":"d1e993b9483f_10","name":"9c97","type":"P","href":null,"layout":null,"metadata":null,"text":"Stay in Deep Sleep for as long as possible!","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_10.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_10.markups.0":{"type":"EM","start":0,"end":43,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_11":{"id":"d1e993b9483f_11","name":"7f4c","type":"P","href":null,"layout":null,"metadata":null,"text":"Our sensor device doesn’t need to transmit sensor data every second. When it sleeps for a minute or more between transmissions, the battery life is dramatically increased.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_12":{"id":"d1e993b9483f_12","name":"2eef","type":"P","href":null,"layout":null,"metadata":null,"text":"However we need to be sure that our NB-IoT module won’t become totally disconnected from the network as Blue Pill sleeps. We have the solution for that.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_13":{"id":"d1e993b9483f_13","name":"2091","type":"P","href":null,"layout":null,"metadata":null,"text":"Can we go below 3 milliAmperes?","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_13.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_13.markups.0":{"type":"EM","start":0,"end":31,"href":"","anchorType":"LINK","userId":"","linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_14":{"id":"d1e993b9483f_14","name":"2774","type":"P","href":null,"layout":null,"metadata":null,"text":"Yes we can! Scrutinise the photo at the top of the article… Notice that TWO power LEDs are still lit: Power LED for Blue Pill and Power LED for the NB-IoT breakout board.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_15":{"id":"d1e993b9483f_15","name":"1c6e","type":"P","href":null,"layout":null,"metadata":null,"text":"The two LEDs are always lit, even during Deep Sleep. If we desolder the two LEDs, the current consumed will surely drop way below 3 milliAmperes. My colleague Upton Lai has previously desoldered the Blue Pill Power LED and recorded 10 microAmperes of power consumption in Deep Sleep! (Without NB-IoT)","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_15.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_15.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_15.markups.0":{"type":"A","start":184,"end":218,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fwww.linkedin.com\u002Ffeed\u002Fupdate\u002Furn:li:activity:6473079182715863040\u002F","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_15.markups.1":{"type":"STRONG","start":232,"end":247,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_16":{"id":"d1e993b9483f_16","name":"cfd3","type":"P","href":null,"layout":null,"metadata":null,"text":"But for now we’ll keep the LEDs… My intent is to let you recreate this experiment easily using off-the-shelf hardware. So that you can follow me and discover for yourself the right way to conserve power.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_17":{"id":"d1e993b9483f_17","name":"25bf","type":"P","href":null,"layout":null,"metadata":null,"text":"There’s something odd about the Current values in the charts…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_17.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_17.markups.0":{"type":"EM","start":0,"end":61,"href":"","anchorType":"LINK","userId":"","linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_18":{"id":"d1e993b9483f_18","name":"173c","type":"P","href":null,"layout":null,"metadata":null,"text":"Yes the charts look different from High School Physics because I rendered the charts (in Google Sheets) using a Logarithmic Scale.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_18.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_18.markups.0":{"type":"STRONG","start":112,"end":129,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_19":{"id":"d1e993b9483f_19","name":"5562","type":"P","href":null,"layout":null,"metadata":null,"text":"This makes the chart look more scenic and poetic like a rolling hill… instead of a desolate landscape with steep mountains and treacherous crevices. And I assure you that no values have been altered. (Just check the Google Sheets)","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_20":{"id":"d1e993b9483f_20","name":"b306","type":"IMG","href":null,"layout":"OUTSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*i9uoKxnFd6S84RWOlDBQSw.png","typename":"ImageMetadata"},"text":"Logarithmic Scale vs Normal Scale. From https:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo\u002Fedit?usp=sharing","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_20.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*i9uoKxnFd6S84RWOlDBQSw.png":{"id":"1*i9uoKxnFd6S84RWOlDBQSw.png","originalHeight":709,"originalWidth":1563,"focusPercentX":null,"focusPercentY":null,"alt":"Log vs Logless","__typename":"ImageMetadata"},"Paragraph:d1e993b9483f_20.markups.0":{"type":"A","start":40,"end":140,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo\u002Fedit?usp=sharing","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_21":{"id":"d1e993b9483f_21","name":"f913","type":"H3","href":null,"layout":null,"metadata":null,"text":"Quectel NB-IoT Power Consumption","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_22":{"id":"d1e993b9483f_22","name":"1439","type":"P","href":null,"layout":null,"metadata":null,"text":"It’s important to power down the NB-IoT module when we have transmitted the data: AT+CFUN=0","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_22.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_22.markups.0":{"type":"CODE","start":82,"end":91,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_23":{"id":"d1e993b9483f_23","name":"9a0e","type":"P","href":null,"layout":null,"metadata":null,"text":"According to the documentation for the above command in “Quectel BC95-G & BC68 AT Commands Manual”…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_23.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_23.markups.0":{"type":"EM","start":56,"end":99,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_24":{"id":"d1e993b9483f_24","name":"b54d","type":"BQ","href":null,"layout":null,"metadata":null,"text":"Deep sleep mode will be entered when the system is quiescent, but only if it has been enabled by the network.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_25":{"id":"d1e993b9483f_25","name":"aac0","type":"IMG","href":null,"layout":"OUTSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*712vnIvAlWuCMgVyxNcBgQ.png","typename":"ImageMetadata"},"text":"Optimised NB-IoT Power Consumption. From https:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo\u002Fedit#gid=1194739783","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_25.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*712vnIvAlWuCMgVyxNcBgQ.png":{"id":"1*712vnIvAlWuCMgVyxNcBgQ.png","originalHeight":719,"originalWidth":1597,"focusPercentX":null,"focusPercentY":null,"alt":"Transmit AT+NSOSTF ⩽ 400 mA. Power Down AT+CFUN=0. Deep Sleep 3mA. Wakeup AT+CFUN=1. Attach to NB-IoT AT+CGATT=1 40 mA","__typename":"ImageMetadata"},"Paragraph:d1e993b9483f_25.markups.0":{"type":"A","start":41,"end":144,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo\u002Fedit#gid=1194739783","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_26":{"id":"d1e993b9483f_26","name":"7d91","type":"P","href":null,"layout":null,"metadata":null,"text":"Instead of keeping our device always connected to NB-IoT, we would have to reattach to the NB-IoT network (AT+CGATT=1) every time we wake up. Attaching to the NB-IoT network may take a few seconds, consuming 40 milliAmperes throughout.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_26.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_26.markups.0":{"type":"CODE","start":107,"end":117,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_27":{"id":"d1e993b9483f_27","name":"e387","type":"P","href":null,"layout":null,"metadata":null,"text":"(Mr Stefan de Lange kindly pointed out that we could attach to the NB-IoT network at power on instead of wakeup. We’ll explore that in a future article. Thanks Stefan!)","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_27.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_27.markups.0":{"type":"EM","start":0,"end":168,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_28":{"id":"d1e993b9483f_28","name":"841a","type":"P","href":null,"layout":null,"metadata":null,"text":"The actual NB-IoT transmission takes a split second, reaching peaks of about 400 milliAmperes.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_29":{"id":"d1e993b9483f_29","name":"4c43","type":"P","href":null,"layout":null,"metadata":null,"text":"Here’s the log from my optimised Blue Pill, chronicling the events after Deep Sleep Wakeup…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_30":{"id":"d1e993b9483f_30","name":"35db","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"Blue Pill Log from https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flogs\u002Fstandalone-node-standby.log","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_30.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:d1e993b9483f_30.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:d1e993b9483f_30.markups.0":{"type":"A","start":19,"end":121,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flogs\u002Fstandalone-node-standby.log","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:ddac5c0e051ffd66b7c07543e789de8b":{"id":"ddac5c0e051ffd66b7c07543e789de8b","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90","__typename":"MediaResource"},"$Paragraph:d1e993b9483f_30.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:ddac5c0e051ffd66b7c07543e789de8b","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:d1e993b9483f_31":{"id":"d1e993b9483f_31","name":"80e1","type":"P","href":null,"layout":null,"metadata":null,"text":"Note that we used the NSOSTF command instead of NSOST to send a UDP packet with flags. In my previous article we used…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_31.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_31.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_31.markups.0":{"type":"CODE","start":22,"end":28,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_31.markups.1":{"type":"CODE","start":48,"end":53,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_32":{"id":"d1e993b9483f_32","name":"544b","type":"PRE","href":null,"layout":null,"metadata":null,"text":"AT+NSOST=1,104.199.85.211,5683,174,(data)…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_33":{"id":"d1e993b9483f_33","name":"8f7e","type":"P","href":null,"layout":null,"metadata":null,"text":"Now we use…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_34":{"id":"d1e993b9483f_34","name":"4efc","type":"PRE","href":null,"layout":null,"metadata":null,"text":"AT+NSOSTF=1,104.199.85.211,5683,0x200,174,(data)…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_34.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_34.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_34.markups.0":{"type":"STRONG","start":3,"end":9,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_34.markups.1":{"type":"STRONG","start":32,"end":37,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_35":{"id":"d1e993b9483f_35","name":"6819","type":"P","href":null,"layout":null,"metadata":null,"text":"The extra parameter 0x200 is the “Early Release” flag… It tells the NB-IoT network that we are not expecting any response messages. So we can safely go to sleep and save power.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_35.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_35.markups.0":{"type":"CODE","start":20,"end":25,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_36":{"id":"d1e993b9483f_36","name":"b6cf","type":"P","href":null,"layout":null,"metadata":null,"text":"The “Early Release” flag was recommended by Mr Henk Vergonet at T-Mobile Netherlands","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_36.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_36.markups.0":{"type":"A","start":64,"end":84,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fforum.iot.t-mobile.nl\u002Ftopic\u002F278\u002Fhow-much-battery-lifetime-can-we-expect-with-a-sara-n200-module-on-our-iot-network\u002F2","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_37":{"id":"d1e993b9483f_37","name":"e183","type":"IMG","href":null,"layout":"OUTSET_LEFT","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*xE52R6qPSarptYyVtHBgpw.png","typename":"ImageMetadata"},"text":"From https:\u002F\u002Fgist.github.com\u002Flupyuen\u002Fef51005c6c965f6a21d496ad24eacc51","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_37.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*xE52R6qPSarptYyVtHBgpw.png":{"id":"1*xE52R6qPSarptYyVtHBgpw.png","originalHeight":682,"originalWidth":360,"focusPercentX":null,"focusPercentY":null,"alt":"AT+NUESTATS. Signal power:-758 Total power:-706 TX power:230 TX time:438 RX time:16193 Cell ID:3535136 ECL:0 SNR:132 EARFC","__typename":"ImageMetadata"},"Paragraph:d1e993b9483f_37.markups.0":{"type":"A","start":5,"end":69,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgist.github.com\u002Flupyuen\u002Fef51005c6c965f6a21d496ad24eacc51","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_38":{"id":"d1e993b9483f_38","name":"bf4c","type":"P","href":null,"layout":null,"metadata":null,"text":"Here’s a valuable tip from Mr Stefan de Lange…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_39":{"id":"d1e993b9483f_39","name":"9c70","type":"BQ","href":null,"layout":null,"metadata":null,"text":"ECL is a key parameter to monitor. It determines the amount of repetitions the module will do. So instead of sending a message once the module might send the message 10, 20 or 30 times to make sure it arrives.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_39.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_39.markups.0":{"type":"STRONG","start":0,"end":33,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_40":{"id":"d1e993b9483f_40","name":"e985","type":"P","href":null,"layout":null,"metadata":null,"text":"The ECL is displayed when we send the AT+NUESTATS command.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_40.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_40.markups.0":{"type":"CODE","start":38,"end":49,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_41":{"id":"d1e993b9483f_41","name":"f9e3","type":"H3","href":null,"layout":null,"metadata":null,"text":"When Apache Mynewt Idles","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_42":{"id":"d1e993b9483f_42","name":"265a","type":"P","href":null,"layout":null,"metadata":null,"text":"Let’s dive deep into Mynewt and understand what happens when our Blue Pill is idle, waiting to poll the temperature sensor or waiting for an NB-IoT command to complete…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_43":{"id":"d1e993b9483f_43","name":"cc10","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Fapache\u002Fmynewt-core\u002Fblob\u002Fmaster\u002Fhw\u002Fmcu\u002Fstm\u002Fstm32_common\u002Fsrc\u002Fhal_os_tick.c","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_43.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:d1e993b9483f_43.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:d1e993b9483f_43.markups.0":{"type":"A","start":5,"end":96,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Fapache\u002Fmynewt-core\u002Fblob\u002Fmaster\u002Fhw\u002Fmcu\u002Fstm\u002Fstm32_common\u002Fsrc\u002Fhal_os_tick.c","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:389081206c858f2438179ef2abc182d1":{"id":"389081206c858f2438179ef2abc182d1","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90","__typename":"MediaResource"},"$Paragraph:d1e993b9483f_43.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:389081206c858f2438179ef2abc182d1","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:d1e993b9483f_44":{"id":"d1e993b9483f_44","name":"bca3","type":"P","href":null,"layout":null,"metadata":null,"text":"The Arm processor inside our Blue Pill has a built-in SysTick Timer. It’s used by Mynewt to perform multitasking. In the code above, Mynewt configures the SysTick Timer to generate an interrupt every millisecond.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_44.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_44.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_44.markups.0":{"type":"A","start":54,"end":67,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttp:\u002F\u002Finfocenter.arm.com\u002Fhelp\u002Findex.jsp?topic=\u002Fcom.arm.doc.dai0179b\u002Far01s02s08.html","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_44.markups.1":{"type":"STRONG","start":54,"end":67,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_45":{"id":"d1e993b9483f_45","name":"4c91","type":"P","href":null,"layout":null,"metadata":null,"text":"When the millisecond interrupt is triggered, Mynewt checks whether it should continue running the current task, or switch to a higher-priority task. If there are no tasks ready to run (which will most likely be the case for our device), Mynewt still keeps checking every single millisecond. This is not good for battery life.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_45.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_45.markups.0":{"type":"EM","start":256,"end":289,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_46":{"id":"d1e993b9483f_46","name":"077c","type":"P","href":null,"layout":null,"metadata":null,"text":"What happens when there are no tasks ready to run? Mynewt calls os_task_idle(), passing the number of ticks that it should stay idle. (1 tick = 1 millisecond)","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_46.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_46.markups.0":{"type":"CODE","start":64,"end":78,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_47":{"id":"d1e993b9483f_47","name":"4e30","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Fapache\u002Fmynewt-core\u002Fblob\u002Fmaster\u002Fhw\u002Fmcu\u002Fstm\u002Fstm32_common\u002Fsrc\u002Fhal_os_tick.c","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_47.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:d1e993b9483f_47.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:d1e993b9483f_47.markups.0":{"type":"A","start":5,"end":96,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Fapache\u002Fmynewt-core\u002Fblob\u002Fmaster\u002Fhw\u002Fmcu\u002Fstm\u002Fstm32_common\u002Fsrc\u002Fhal_os_tick.c","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:f99eca2ae4897387325d25b90532d3dc":{"id":"f99eca2ae4897387325d25b90532d3dc","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90","__typename":"MediaResource"},"$Paragraph:d1e993b9483f_47.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:f99eca2ae4897387325d25b90532d3dc","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:d1e993b9483f_48":{"id":"d1e993b9483f_48","name":"85e2","type":"P","href":null,"layout":null,"metadata":null,"text":"Mynewt computes the idle time based on the list of pending tasks. So if the temperature sensor is supposed to be polled every 10 seconds, Mynewt knows that after polling the sensor, it should stay idle for roughly 10,000 ticks before resuming the polling task.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_49":{"id":"d1e993b9483f_49","name":"709f","type":"P","href":null,"layout":null,"metadata":null,"text":"WFI in the code above is the Arm instruction “Wait For Interrupt”. It means that the Arm processor will go into a power-saving quick nap (not Deep Sleep) until an interrupt occurs.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_49.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_49.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_49.markups.0":{"type":"CODE","start":0,"end":3,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_49.markups.1":{"type":"STRONG","start":46,"end":64,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_50":{"id":"d1e993b9483f_50","name":"e6ad","type":"P","href":null,"layout":null,"metadata":null,"text":"BUT… remember that our SysTick Interrupt occurs every millisecond… so our Blue Pill doesn’t sleep much!","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_50.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_50.markups.0":{"type":"EM","start":23,"end":65,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_51":{"id":"d1e993b9483f_51","name":"5391","type":"P","href":null,"layout":null,"metadata":null,"text":"Here’s proof of that… Watch what happens when we add some debug output to os_task_idle()...","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_51.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_51.markups.0":{"type":"CODE","start":74,"end":88,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_52":{"id":"d1e993b9483f_52","name":"9743","type":"IMG","href":null,"layout":"FULL_WIDTH","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*jrBd8tUBjysw70o-dIKQCA.png","typename":"ImageMetadata"},"text":"Proof that Blue Pill wakes up every millisecond","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*jrBd8tUBjysw70o-dIKQCA.png":{"id":"1*jrBd8tUBjysw70o-dIKQCA.png","originalHeight":1308,"originalWidth":2262,"focusPercentX":null,"focusPercentY":null,"alt":"Right now our STM32 Blue Pill is driven by the System Tick timer, ticking \nevery millisecond. What happens when we run ticks?","__typename":"ImageMetadata"},"Paragraph:d1e993b9483f_53":{"id":"d1e993b9483f_53","name":"5515","type":"BQ","href":null,"layout":null,"metadata":null,"text":"💎 “Heisenberg’s Uncertainty Principle” for Embedded Systems…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_53.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_53.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_53.markups.0":{"type":"STRONG","start":3,"end":61,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_53.markups.1":{"type":"EM","start":0,"end":2,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_54":{"id":"d1e993b9483f_54","name":"3f5f","type":"BQ","href":null,"layout":null,"metadata":null,"text":"Don’t try at home what you see above! It’s NOT a good idea to display debug messages on the console when you’re deep inside the operating system… like in the Task Scheduling code above.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_55":{"id":"d1e993b9483f_55","name":"35ce","type":"BQ","href":null,"layout":null,"metadata":null,"text":"How did I do it? My console_print() functions were specially designed to buffer output messages into RAM (using mbufs). So no I\u002FO is performed by the code above… Until the application flushes the console output.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_55.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_55.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_55.markups.0":{"type":"CODE","start":20,"end":35,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_55.markups.1":{"type":"CODE","start":112,"end":117,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_56":{"id":"d1e993b9483f_56","name":"51a0","type":"BQ","href":null,"layout":null,"metadata":null,"text":"If this debug code used a normal console I\u002FO call, it would interfere with the os_task_idle() operation (it might get deadlocked). So when you insert debug code to observe what’s happening deep inside your microcontroller, you might actually affect the outcome.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_56.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_56.markups.0":{"type":"CODE","start":79,"end":93,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_57":{"id":"d1e993b9483f_57","name":"8794","type":"BQ","href":null,"layout":null,"metadata":null,"text":"Hence some folks call this “Heisenberg’s Uncertainty Principle” (like in Quantum Mechanics)… Beware of Heisenberg! :-)","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_57.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_57.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_57.markups.0":{"type":"A","start":28,"end":62,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FUncertainty_principle","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_57.markups.1":{"type":"EM","start":28,"end":62,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_58":{"id":"d1e993b9483f_58","name":"7319","type":"H3","href":null,"layout":null,"metadata":null,"text":"Going Tickless on Apache Mynewt with Real Time Clock","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_59":{"id":"d1e993b9483f_59","name":"ab59","type":"P","href":null,"layout":null,"metadata":null,"text":"Here’s the problem: We would like to sleep longer and conserve power… But the SysTick Timer keeps waking us up every millisecond. Can we do without SysTick? Can we go… Tickless? Yes we can!","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_59.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_59.markups.0":{"type":"STRONG","start":168,"end":176,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_60":{"id":"d1e993b9483f_60","name":"6a53","type":"P","href":null,"layout":null,"metadata":null,"text":"Blue Pill and other STM32 microcontrollers have an onboard Real Time Clock. Unlike a real wall clock, the Real Time Clock doesn’t tell you the time of the day. But it’s useful for two things…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_60.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_60.markups.0":{"type":"STRONG","start":59,"end":74,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_61":{"id":"d1e993b9483f_61","name":"ed21","type":"P","href":null,"layout":null,"metadata":null,"text":"1️⃣ Counting the ticks that have elapsed since we powered on our device. It keeps counting even in Deep Sleep!","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_61.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_61.markups.0":{"type":"STRONG","start":4,"end":22,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_62":{"id":"d1e993b9483f_62","name":"3e7d","type":"P","href":null,"layout":null,"metadata":null,"text":"2️⃣ Triggering an Alarm Interrupt at a time (in ticks) that we set","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_62.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_62.markups.0":{"type":"STRONG","start":4,"end":33,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_63":{"id":"d1e993b9483f_63","name":"3962","type":"P","href":null,"layout":null,"metadata":null,"text":"Remember that Mynewt calls os_task_idle(X) when it’s ready to sleep for X milliseconds. Why don’t we set the Real Time Clock Alarm to wake us up in X milliseconds?","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_63.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_63.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_63.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_63.markups.0":{"type":"CODE","start":27,"end":42,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_63.markups.1":{"type":"CODE","start":72,"end":73,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_63.markups.2":{"type":"CODE","start":148,"end":149,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_64":{"id":"d1e993b9483f_64","name":"ec96","type":"P","href":null,"layout":null,"metadata":null,"text":"So in the optimised task scheduler for Mynewt, we eliminate SysTick altogether, replaced by the Real Time Clock Alarm. os_task_idle() now calls power_sleep()…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_64.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_64.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_64.markups.0":{"type":"CODE","start":119,"end":133,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_64.markups.1":{"type":"CODE","start":144,"end":157,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_65":{"id":"d1e993b9483f_65","name":"d3c6","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fsrc\u002Flow_power.c","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_65.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:d1e993b9483f_65.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:d1e993b9483f_65.markups.0":{"type":"A","start":5,"end":105,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fsrc\u002Flow_power.c","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:f2f6dbd07fff98ae248a37ad0bcc49d2":{"id":"f2f6dbd07fff98ae248a37ad0bcc49d2","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90","__typename":"MediaResource"},"$Paragraph:d1e993b9483f_65.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:f2f6dbd07fff98ae248a37ad0bcc49d2","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:d1e993b9483f_66":{"id":"d1e993b9483f_66","name":"ca30","type":"P","href":null,"layout":null,"metadata":null,"text":"What about WFI, the Wait For Interrupt instruction that we saw earlier? It still works! Because the Real Time Clock triggers an interrupt (Alarm Interrupt) when the time is up. Here’s how we call WFI for a quick nap (Sleep Now Mode)…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_66.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_66.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_66.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_66.markups.0":{"type":"CODE","start":11,"end":14,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_66.markups.1":{"type":"CODE","start":196,"end":199,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_66.markups.2":{"type":"STRONG","start":217,"end":231,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_67":{"id":"d1e993b9483f_67","name":"a6a3","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fsrc\u002Flow_power.c","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_67.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:d1e993b9483f_67.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:d1e993b9483f_67.markups.0":{"type":"A","start":5,"end":105,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fsrc\u002Flow_power.c","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:e46934f6c404e5e07b3d9766ee84415d":{"id":"e46934f6c404e5e07b3d9766ee84415d","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90","__typename":"MediaResource"},"$Paragraph:d1e993b9483f_67.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:e46934f6c404e5e07b3d9766ee84415d","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:d1e993b9483f_68":{"id":"d1e993b9483f_68","name":"5c95","type":"P","href":null,"layout":null,"metadata":null,"text":"The power_sleep() function calls target_enter_sleep_mode() and WFI for a quick nap. When we have finished transmitting our sensor data over NB-IoT, we could actually take a longer nap… this is the Deep Sleep Standby Mode we saw earlier… the one that consumes only 3 milliAmperes! (With the power LEDs still lit) We’ll cover Deep Sleep Standby Mode in a while.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_68.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_68.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_68.markups.2","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_68.markups.3","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_68.markups.0":{"type":"CODE","start":4,"end":17,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_68.markups.1":{"type":"CODE","start":33,"end":58,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_68.markups.2":{"type":"CODE","start":63,"end":66,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_68.markups.3":{"type":"STRONG","start":197,"end":220,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_69":{"id":"d1e993b9483f_69","name":"fbc0","type":"P","href":null,"layout":null,"metadata":null,"text":"Zephyr RTOS has a good explanation of Tickless Task Scheduling here","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_69.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_69.markups.0":{"type":"A","start":38,"end":67,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fdocs.zephyrproject.org\u002F1.13.0\u002Fsubsystems\u002Fpower_management.html#tickless-idle","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_70":{"id":"d1e993b9483f_70","name":"2da0","type":"H3","href":null,"layout":null,"metadata":null,"text":"Power Saving Modes on Blue Pill","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_71":{"id":"d1e993b9483f_71","name":"e8d5","type":"P","href":null,"layout":null,"metadata":null,"text":"There are three power saving modes on Blue Pill…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_71.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_71.markups.0":{"type":"A","start":10,"end":34,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fwww.st.com\u002Fcontent\u002Fccc\u002Fresource\u002Ftechnical\u002Fdocument\u002Fapplication_note\u002Fff\u002F0a\u002Fdc\u002Fd2\u002F5e\u002Ff5\u002F4b\u002F5a\u002FCD00171691.pdf\u002Ffiles\u002FCD00171691.pdf\u002Fjcr:content\u002Ftranslations\u002Fen.CD00171691.pdf","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_72":{"id":"d1e993b9483f_72","name":"0c62","type":"P","href":null,"layout":null,"metadata":null,"text":"1️⃣ Sleep Now Mode (10 milliAmperes): This is the WFI (Wait For Interrupt) instruction that’s implemented in the Arm processor. It puts Blue Pill into a light nap that still consumes substantial power. That’s because the Blue Pill peripherals (like the UART port) are still powered on.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_72.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_72.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_72.markups.0":{"type":"CODE","start":50,"end":53,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_72.markups.1":{"type":"STRONG","start":4,"end":36,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_73":{"id":"d1e993b9483f_73","name":"343c","type":"P","href":null,"layout":null,"metadata":null,"text":"2️⃣ Deep Sleep Stop Mode: Similar to Sleep Now Mode, except that the peripherals (like UART) are powered down. Consumes less power than Sleep Now Mode but more power than Deep Sleep Standby Mode. On wakeup, Blue Pill resumes execution with the peripherals powered down. RAM is preserved.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_73.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_73.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_73.markups.0":{"type":"STRONG","start":4,"end":24,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_73.markups.1":{"type":"EM","start":270,"end":287,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_74":{"id":"d1e993b9483f_74","name":"0078","type":"P","href":null,"layout":null,"metadata":null,"text":"3️⃣ Deep Sleep Standby Mode (3 milliAmperes, with power LEDs still lit): The ultimate low power mode. All peripherals powered down (same as Deep Sleep Stop Mode). BUT on wakeup, Blue Pill restarts as though it was just powered on. Everything in RAM is lost.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_74.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_74.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_74.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_74.markups.0":{"type":"STRONG","start":4,"end":71,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_74.markups.1":{"type":"EM","start":178,"end":196,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_74.markups.2":{"type":"EM","start":231,"end":257,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_75":{"id":"d1e993b9483f_75","name":"8ad3","type":"IMG","href":null,"layout":"OUTSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*31ddqScBeS2JiPje4SL3Rw.png","typename":"ImageMetadata"},"text":"Sleep Now Mode vs Deep Sleep Standby Mode. From https:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1ygUzKYWTo-BSSvKzL3J6ub3o4-7sVrjMUyvGLdAsHJ0\u002Fedit?usp=sharing","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_75.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*31ddqScBeS2JiPje4SL3Rw.png":{"id":"1*31ddqScBeS2JiPje4SL3Rw.png","originalHeight":742,"originalWidth":1648,"focusPercentX":null,"focusPercentY":null,"alt":"Deep Sleep Standby 3 mA. Sleep Now 10 mA. Attach to NB-IoT ⩽ 70 mA. Transmit to NB-IoT ⩽ 400 mA","__typename":"ImageMetadata"},"Paragraph:d1e993b9483f_75.markups.0":{"type":"A","start":48,"end":148,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1ygUzKYWTo-BSSvKzL3J6ub3o4-7sVrjMUyvGLdAsHJ0\u002Fedit?usp=sharing","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_76":{"id":"d1e993b9483f_76","name":"db8b","type":"P","href":null,"layout":null,"metadata":null,"text":"This may sound odd… But Deep Sleep Standby Mode (the ultimate power saver) is easier to code than Deep Sleep Stop Mode.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_76.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_76.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_76.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_76.markups.0":{"type":"STRONG","start":35,"end":47,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_76.markups.1":{"type":"STRONG","start":109,"end":118,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_76.markups.2":{"type":"EM","start":78,"end":92,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_77":{"id":"d1e993b9483f_77","name":"5370","type":"P","href":null,"layout":null,"metadata":null,"text":"With Stop Mode we need to power on the peripherals ourselves when waking up… And it gets complicated. With Standby Mode, we just pretend that our Blue Pill has just powered on… Except that we can check a flag to distinguish whether it’s a Power On or a Standby Wakeup.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_78":{"id":"d1e993b9483f_78","name":"7869","type":"P","href":null,"layout":null,"metadata":null,"text":"Here’s how we check the flag…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_79":{"id":"d1e993b9483f_79","name":"430b","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fsrc\u002Flow_power.c","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_79.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:d1e993b9483f_79.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:d1e993b9483f_79.markups.0":{"type":"A","start":5,"end":105,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fsrc\u002Flow_power.c","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:c4fa90b397c24fbc820a1bb28612d9f7":{"id":"c4fa90b397c24fbc820a1bb28612d9f7","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90","__typename":"MediaResource"},"$Paragraph:d1e993b9483f_79.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:c4fa90b397c24fbc820a1bb28612d9f7","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:d1e993b9483f_80":{"id":"d1e993b9483f_80","name":"761e","type":"H3","href":null,"layout":null,"metadata":null,"text":"Embedded Rust Application For Low Power","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_81":{"id":"d1e993b9483f_81","name":"ce4a","type":"P","href":null,"layout":null,"metadata":null,"text":"Remember from our previous tutorial that the IoT Sensor Application was developed in Rust. Is Rust really suitable for Low Power Devices? Does Rust make our device less power-efficient?","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_81.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_81.markups.0":{"type":"EM","start":91,"end":185,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_82":{"id":"d1e993b9483f_82","name":"6e25","type":"P","href":null,"layout":null,"metadata":null,"text":"I’m happy to report that Rust is just as power-efficient as C! That’s because Rust is compiled into optimised Arm machine code, so there’s no extra execution overhead when our application is written in Rust.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_82.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_82.markups.0":{"type":"EM","start":25,"end":62,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_83":{"id":"d1e993b9483f_83","name":"2b68","type":"P","href":null,"layout":null,"metadata":null,"text":"The Rust application logic was tweaked slightly to make it more power-efficient…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_84":{"id":"d1e993b9483f_84","name":"558a","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Frust\u002Fapp\u002Fsrc\u002Fapp_sensor.rs","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_84.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:d1e993b9483f_84.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:d1e993b9483f_84.markups.0":{"type":"A","start":5,"end":101,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Frust\u002Fapp\u002Fsrc\u002Fapp_sensor.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:8a866a166573c04cd170a7e9cc075ce8":{"id":"8a866a166573c04cd170a7e9cc075ce8","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90","__typename":"MediaResource"},"$Paragraph:d1e993b9483f_84.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:8a866a166573c04cd170a7e9cc075ce8","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:d1e993b9483f_85":{"id":"d1e993b9483f_85","name":"44e0","type":"P","href":null,"layout":null,"metadata":null,"text":"The top half of the function start_sensor_listener() is exactly the same as before. When our device is powered up, we instruct Mynewt to poll the temperature sensor every 20 seconds. Mynewt passes the sensor data to our function handle_sensor_data() for transmitting to the server.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_85.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_85.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_85.markups.0":{"type":"CODE","start":29,"end":52,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_85.markups.1":{"type":"CODE","start":229,"end":249,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_86":{"id":"d1e993b9483f_86","name":"a0dc","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Frust\u002Fapp\u002Fsrc\u002Fapp_sensor.rs","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_86.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:d1e993b9483f_86.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:d1e993b9483f_86.markups.0":{"type":"A","start":5,"end":101,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Frust\u002Fapp\u002Fsrc\u002Fapp_sensor.rs","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:45a75113ed503da4195dd82fa0e28eb2":{"id":"45a75113ed503da4195dd82fa0e28eb2","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90","__typename":"MediaResource"},"$Paragraph:d1e993b9483f_86.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:45a75113ed503da4195dd82fa0e28eb2","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:d1e993b9483f_87":{"id":"d1e993b9483f_87","name":"53c9","type":"P","href":null,"layout":null,"metadata":null,"text":"The lower half of start_sensor_listener() introduces a minor twist… When our device wakes up from Deep Sleep Standby Mode, we read the temperature sensor directly, without polling. And we transmit the sensor data the same way, via handle_sensor_data().","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_87.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_87.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_87.markups.0":{"type":"CODE","start":18,"end":41,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_87.markups.1":{"type":"CODE","start":231,"end":251,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_88":{"id":"d1e993b9483f_88","name":"1e33","type":"P","href":null,"layout":null,"metadata":null,"text":"This keeps our device fully occupied during the precious few seconds that our device is awake, until it falls into Deep Sleep.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_89":{"id":"d1e993b9483f_89","name":"3f34","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Fsensor_network\u002Fsrc\u002Fsensor_network.c","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_89.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:d1e993b9483f_89.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:d1e993b9483f_89.markups.0":{"type":"A","start":5,"end":115,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Fsensor_network\u002Fsrc\u002Fsensor_network.c","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:48ac1952de9ab1e018eba6008dd9439c":{"id":"48ac1952de9ab1e018eba6008dd9439c","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90","__typename":"MediaResource"},"$Paragraph:d1e993b9483f_89.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:48ac1952de9ab1e018eba6008dd9439c","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:d1e993b9483f_90":{"id":"d1e993b9483f_90","name":"3323","type":"P","href":null,"layout":null,"metadata":null,"text":"The Sensor Network Library (written in C) has been optimised for low power operation as well. During wakeup, the function attaches to the NB-IoT network and doesn’t return until it completes. (Previously we started a background task to attach to the NB-IoT network so that we could run other tasks.)","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_90.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_90.markups.0":{"type":"STRONG","start":4,"end":26,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_91":{"id":"d1e993b9483f_91","name":"8b91","type":"P","href":null,"layout":null,"metadata":null,"text":"This chart illustrates the power consumed when our Blue Pill polls the onboard temperature sensor vs reading the sensor directly.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_92":{"id":"d1e993b9483f_92","name":"b30d","type":"IMG","href":null,"layout":"OUTSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*njv_Nzhx3aEd1Pquar6wTQ.png","typename":"ImageMetadata"},"text":"Polling vs Reading the temperature sensor. From https:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo\u002Fedit#gid=1194739783","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_92.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*njv_Nzhx3aEd1Pquar6wTQ.png":{"id":"1*njv_Nzhx3aEd1Pquar6wTQ.png","originalHeight":742,"originalWidth":1622,"focusPercentX":null,"focusPercentY":null,"alt":"Polling vs Reading the temperature sensor. Reboot \nNB-IoT Module 30 mA. Mynewt waits 20 seconds\nto poll temperature\nsensor…","__typename":"ImageMetadata"},"Paragraph:d1e993b9483f_92.markups.0":{"type":"A","start":48,"end":151,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo\u002Fedit#gid=1194739783","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_93":{"id":"d1e993b9483f_93","name":"255c","type":"P","href":null,"layout":null,"metadata":null,"text":"The code changes are really minor. Mynewt’s Sensor Framework has done an excellent job in managing the access to sensors in a consistent, reusable way, even for Low Power. And Rust makes the code look much cleaner and simpler than C.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_94":{"id":"d1e993b9483f_94","name":"7068","type":"H3","href":null,"layout":null,"metadata":null,"text":"Measure Power Consumption with RuiDeng DPS 3005 Power Monitor","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_95":{"id":"d1e993b9483f_95","name":"662a","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*m8CSh8DRY_wad2-CwEvlrw.jpeg","typename":"ImageMetadata"},"text":"RuiDeng DPS 3005 Power Monitor measuring the power consumption of STM32 Blue Pill connected to Quectel BC95-G NB-IoT module","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*m8CSh8DRY_wad2-CwEvlrw.jpeg":{"id":"1*m8CSh8DRY_wad2-CwEvlrw.jpeg","originalHeight":2448,"originalWidth":3264,"focusPercentX":null,"focusPercentY":null,"alt":"RuiDeng DPS 3005 Power Monitor measuring the power consumption of STM32 Blue Pill connected to Quectel BC95-G NB-IoT module","__typename":"ImageMetadata"},"Paragraph:d1e993b9483f_96":{"id":"d1e993b9483f_96","name":"4453","type":"P","href":null,"layout":null,"metadata":null,"text":"Now let’s run our IoT Sensor Device and measure the power consumption with RuiDeng DPS 3005 Power Monitor!","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_96.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_96.markups.0":{"type":"A","start":75,"end":105,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fwww.aliexpress.com\u002Fitem\u002F32684316119.html","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_97":{"id":"d1e993b9483f_97","name":"5b29","type":"P","href":null,"layout":null,"metadata":null,"text":"Follow the instructions here to connect Blue Pill to the NB-IoT module and ST-Link.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_97.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_97.markups.0":{"type":"A","start":0,"end":28,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fconnect-the-nb-iot-hardware-stm32-blue-pill-and-quectel-bc95-g-module-978920c964b1?source=friends_link&sk=3f3e4cf79a40f9969077bd36b441cf98","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_98":{"id":"d1e993b9483f_98","name":"45f3","type":"P","href":null,"layout":null,"metadata":null,"text":"Let’s look at inputs and outputs for the Power Monitor…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_99":{"id":"d1e993b9483f_99","name":"725f","type":"IMG","href":null,"layout":"OUTSET_LEFT","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*MThIKdD7WY7F55GCAX9fcg.png","typename":"ImageMetadata"},"text":"Inputs and Outputs for RuiDeng DPS 3005 Power Monitor","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*MThIKdD7WY7F55GCAX9fcg.png":{"id":"1*MThIKdD7WY7F55GCAX9fcg.png","originalHeight":541,"originalWidth":657,"focusPercentX":null,"focusPercentY":null,"alt":"Inputs and Outputs for RuiDeng DPS 3005 Power Monitor","__typename":"ImageMetadata"},"Paragraph:d1e993b9483f_100":{"id":"d1e993b9483f_100","name":"a660","type":"P","href":null,"layout":null,"metadata":null,"text":"Inputs at Left Side (IN+, IN-): Connect to the DC power supply. I used two 18650 lithium ion 3.7 Volt batteries connected in series. Total 7.2 Volts, sufficient for providing 5 Volts to our Blue Pill and NB-IoT module.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_100.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_100.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_100.markups.0":{"type":"CODE","start":21,"end":29,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_100.markups.1":{"type":"STRONG","start":0,"end":30,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_101":{"id":"d1e993b9483f_101","name":"4d35","type":"P","href":null,"layout":null,"metadata":null,"text":"Outputs at Right Side (OUT-, OUT+): Connect to the Blue Pill and NB-IoT module. This will be the 5-Volt power source for our Blue Pill and NB-IoT module.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_101.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_101.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_101.markups.0":{"type":"CODE","start":23,"end":33,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_101.markups.1":{"type":"STRONG","start":0,"end":34,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_102":{"id":"d1e993b9483f_102","name":"5be8","type":"P","href":null,"layout":null,"metadata":null,"text":"Here’s how I powered my Power Monitor…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_103":{"id":"d1e993b9483f_103","name":"6498","type":"IMG","href":null,"layout":"OUTSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*Ayno3Q8Pt3W0tK9-kWi15A.jpeg","typename":"ImageMetadata"},"text":"RuiDeng DPS 3005 Power Monitor powered by two 18650 lithium ion 3.7 Volt batteries","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*Ayno3Q8Pt3W0tK9-kWi15A.jpeg":{"id":"1*Ayno3Q8Pt3W0tK9-kWi15A.jpeg","originalHeight":2002,"originalWidth":6003,"focusPercentX":null,"focusPercentY":null,"alt":"RuiDeng DPS 3005 Power Monitor powered by two 18650 lithium ion 3.7 Volt batteries","__typename":"ImageMetadata"},"Paragraph:d1e993b9483f_104":{"id":"d1e993b9483f_104","name":"bbe4","type":"IMG","href":null,"layout":"OUTSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*NXF9cW-NQS7kcd8d1huhAQ.png","typename":"ImageMetadata"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*NXF9cW-NQS7kcd8d1huhAQ.png":{"id":"1*NXF9cW-NQS7kcd8d1huhAQ.png","originalHeight":50,"originalWidth":1800,"focusPercentX":null,"focusPercentY":null,"alt":null,"__typename":"ImageMetadata"},"Paragraph:d1e993b9483f_105":{"id":"d1e993b9483f_105","name":"0a63","type":"PQ","href":null,"layout":null,"metadata":null,"text":"When Flashing Firmware…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_106":{"id":"d1e993b9483f_106","name":"f295","type":"IMG","href":null,"layout":"OUTSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*fX-gNG2C4Yzv68XmsaLCkw.jpeg","typename":"ImageMetadata"},"text":"Blue Pill and NB-IoT Module connected to ST-Link","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*fX-gNG2C4Yzv68XmsaLCkw.jpeg":{"id":"1*fX-gNG2C4Yzv68XmsaLCkw.jpeg","originalHeight":2039,"originalWidth":3264,"focusPercentX":null,"focusPercentY":null,"alt":"Blue Pill and NB-IoT Module connected to ST-Link","__typename":"ImageMetadata"},"Paragraph:d1e993b9483f_107":{"id":"d1e993b9483f_107","name":"40b4","type":"IFRAME","href":null,"layout":"OUTSET_LEFT","metadata":null,"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:d1e993b9483f_107.iframe","typename":"Iframe"},"mixtapeMetadata":null},"MediaResource:7f26bad699a432cb593fd612b53a00bd":{"id":"7f26bad699a432cb593fd612b53a00bd","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fconnect-the-nb-iot-hardware-stm32-blue-pill-and-quectel-bc95-g-module-978920c964b1?source=friends_link&sk=3f3e4cf79a40f9969077bd36b441cf98","__typename":"MediaResource"},"$Paragraph:d1e993b9483f_107.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:7f26bad699a432cb593fd612b53a00bd","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:d1e993b9483f_108":{"id":"d1e993b9483f_108","name":"73d3","type":"P","href":null,"layout":null,"metadata":null,"text":"When flashing the firmware to Blue Pill, connect ST-Link to Blue Pill and the NB-IoT module as shown.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_109":{"id":"d1e993b9483f_109","name":"8ed1","type":"P","href":null,"layout":null,"metadata":null,"text":"Note that the NB-IoT module is powered by the 5V pin from ST-Link.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_110":{"id":"d1e993b9483f_110","name":"dc03","type":"P","href":null,"layout":null,"metadata":null,"text":"Blue Pill’s 5V pin should be disconnected.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_111":{"id":"d1e993b9483f_111","name":"0179","type":"IMG","href":null,"layout":"OUTSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*NXF9cW-NQS7kcd8d1huhAQ.png","typename":"ImageMetadata"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_112":{"id":"d1e993b9483f_112","name":"6218","type":"PQ","href":null,"layout":null,"metadata":null,"text":"When Monitoring Power Consumption…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_113":{"id":"d1e993b9483f_113","name":"9236","type":"IMG","href":null,"layout":"OUTSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*IC_-sUHQ3TJwrxuoODbQ_g.jpeg","typename":"ImageMetadata"},"text":"Blue Pill and NB-IoT Module connected to RuiDeng DPS 3005 Power Monitor","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*IC_-sUHQ3TJwrxuoODbQ_g.jpeg":{"id":"1*IC_-sUHQ3TJwrxuoODbQ_g.jpeg","originalHeight":2448,"originalWidth":2322,"focusPercentX":null,"focusPercentY":null,"alt":"Blue Pill and NB-IoT Module connected to RuiDeng DPS 3005 Power Monitor","__typename":"ImageMetadata"},"Paragraph:d1e993b9483f_114":{"id":"d1e993b9483f_114","name":"51fa","type":"IFRAME","href":null,"layout":"OUTSET_LEFT","metadata":null,"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:d1e993b9483f_114.iframe","typename":"Iframe"},"mixtapeMetadata":null},"MediaResource:210b5482445e535be2c55bb891c01d82":{"id":"210b5482445e535be2c55bb891c01d82","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90","__typename":"MediaResource"},"$Paragraph:d1e993b9483f_114.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:210b5482445e535be2c55bb891c01d82","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:d1e993b9483f_115":{"id":"d1e993b9483f_115","name":"cece","type":"P","href":null,"layout":null,"metadata":null,"text":"When monitoring the power consumption, disconnect ST-Link.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_116":{"id":"d1e993b9483f_116","name":"697c","type":"P","href":null,"layout":null,"metadata":null,"text":"Connect Blue Pill’s 5V pin to the Power Meter.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_117":{"id":"d1e993b9483f_117","name":"eae9","type":"P","href":null,"layout":null,"metadata":null,"text":"The NB-IoT module should be powered by the Power Meter as well.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_118":{"id":"d1e993b9483f_118","name":"dd09","type":"IMG","href":null,"layout":"OUTSET_LEFT","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*gOH-vDaZd-Si811GB9ZLWw.jpeg","typename":"ImageMetadata"},"text":"Bluetooth module for DPS 3005 Power Monitor","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*gOH-vDaZd-Si811GB9ZLWw.jpeg":{"id":"1*gOH-vDaZd-Si811GB9ZLWw.jpeg","originalHeight":2448,"originalWidth":3264,"focusPercentX":null,"focusPercentY":null,"alt":"Bluetooth module for DPS 3005 Power Monitor","__typename":"ImageMetadata"},"Paragraph:d1e993b9483f_119":{"id":"d1e993b9483f_119","name":"0487","type":"P","href":null,"layout":null,"metadata":null,"text":"Make sure your DPS 3005 Power Monitor is bundled with a Bluetooth module.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_119.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_119.markups.0":{"type":"STRONG","start":56,"end":72,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_120":{"id":"d1e993b9483f_120","name":"ba98","type":"P","href":null,"layout":null,"metadata":null,"text":"The module connects the Power Monitor to your Windows computer wirelessly for recording data power consumption data (at 1 sample per second). Sadly I couldn’t connect from macOS.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_121":{"id":"d1e993b9483f_121","name":"754a","type":"P","href":null,"layout":null,"metadata":null,"text":"RuiDeng’s software for DPS 3005 did not allow recording of data, so I used the open-source DPS5005_pyGUI data logger.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_121.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_121.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_121.markups.0":{"type":"CODE","start":91,"end":104,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_121.markups.1":{"type":"A","start":91,"end":104,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Flambcutlet\u002FDPS5005_pyGUI","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_122":{"id":"d1e993b9483f_122","name":"a57e","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*HKSYbzIjdhRMpqG-8NVa6w.png","typename":"ImageMetadata"},"text":"DPS5005_pyGUI data logger: https:\u002F\u002Fgithub.com\u002Flambcutlet\u002FDPS5005_pyGUI","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_122.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*HKSYbzIjdhRMpqG-8NVa6w.png":{"id":"1*HKSYbzIjdhRMpqG-8NVa6w.png","originalHeight":1080,"originalWidth":1854,"focusPercentX":null,"focusPercentY":null,"alt":"DPS5005_pyGUI data logger: https:\u002F\u002Fgithub.com\u002Flambcutlet\u002FDPS5005_pyGUI","__typename":"ImageMetadata"},"Paragraph:d1e993b9483f_122.markups.0":{"type":"A","start":27,"end":70,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Flambcutlet\u002FDPS5005_pyGUI","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_123":{"id":"d1e993b9483f_123","name":"4539","type":"P","href":null,"layout":null,"metadata":null,"text":"The low power version of Apache Mynewt and the updated Embedded Rust application may be installed according to these instructions.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_123.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_123.markups.0":{"type":"A","start":98,"end":129,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Finstall-low-power-apache-mynewt-and-embedded-rust-for-visual-studio-code-on-windows-f889e19c3405?source=friends_link&sk=477db4f218b2d8f93b15a62597089abc","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_124":{"id":"d1e993b9483f_124","name":"6cb6","type":"MIXTAPE_EMBED","href":null,"layout":null,"metadata":null,"text":"Install Low Power Apache Mynewt and Embedded Rust for Visual Studio Code on Windows\nFollow these instructions to install Low Power Apache Mynewt + Embedded Rust build and application files for Visual…medium.com","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_124.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_124.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_124.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":{"type":"id","generated":true,"id":"$Paragraph:d1e993b9483f_124.mixtapeMetadata","typename":"MixtapeMetadata"}},"Paragraph:d1e993b9483f_124.markups.0":{"type":"A","start":0,"end":210,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Finstall-low-power-apache-mynewt-and-embedded-rust-for-visual-studio-code-on-windows-f889e19c3405","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_124.markups.1":{"type":"STRONG","start":0,"end":83,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_124.markups.2":{"type":"EM","start":84,"end":200,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"$Paragraph:d1e993b9483f_124.mixtapeMetadata":{"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Finstall-low-power-apache-mynewt-and-embedded-rust-for-visual-studio-code-on-windows-f889e19c3405","thumbnailImageId":"1*XcYoOVYrHL-Dv8-MsRkLLw.png","mediaResourceId":"1*XcYoOVYrHL-Dv8-MsRkLLw.png","__typename":"MixtapeMetadata"},"Paragraph:d1e993b9483f_125":{"id":"d1e993b9483f_125","name":"ad11","type":"P","href":null,"layout":null,"metadata":null,"text":"Is 1 sample per second sufficient for understanding the power consumption?","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_125.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_125.markups.0":{"type":"EM","start":0,"end":74,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_126":{"id":"d1e993b9483f_126","name":"d3b4","type":"P","href":null,"layout":null,"metadata":null,"text":"Honestly, no. There are peaks in our power consumption during NB-IoT transmission. The peaks seem to reach 400 milliAmperes… But because the sampling rate is so low, the peaks could possibly be much higher than that.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_127":{"id":"d1e993b9483f_127","name":"5f4a","type":"IMG","href":null,"layout":"OUTSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*712vnIvAlWuCMgVyxNcBgQ.png","typename":"ImageMetadata"},"text":"Peaks in NB-IoT Power Consumption. From https:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo\u002Fedit#gid=1194739783","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_127.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_127.markups.0":{"type":"A","start":40,"end":143,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo\u002Fedit#gid=1194739783","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_128":{"id":"d1e993b9483f_128","name":"a06b","type":"P","href":null,"layout":null,"metadata":null,"text":"Nonetheless, we now have a $25 setup that lets us quickly tweak our firmware and check whether the tweaks actually improve power consumption. So the RuiDeng Power Monitor is an affordable way to guide us towards the right direction to reduce power consumption. When you have finalised the firmware, remember to use the proper equipment to measure the real power consumption!","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_128.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_128.markups.0":{"type":"EM","start":261,"end":374,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_129":{"id":"d1e993b9483f_129","name":"a7b7","type":"H3","href":null,"layout":null,"metadata":null,"text":"The Results","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_130":{"id":"d1e993b9483f_130","name":"ea41","type":"P","href":null,"layout":null,"metadata":null,"text":"After optimising the power consumption, how much longer did the battery last? A whopping… 26% increase in battery life!","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_130.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_130.markups.0":{"type":"EM","start":90,"end":119,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_131":{"id":"d1e993b9483f_131","name":"0290","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*vydM0quFbCvvV5762pJHOA.png","typename":"ImageMetadata"},"text":"Computed battery life for our IoT sensor device. From https:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1QptBX2wn_RC5-oaVPyxynbmKROO5ElfHJyNcqcX0YhA\u002Fedit#gid=1065153023 and https:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo\u002Fedit#gid=1872735739","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_131.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_131.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*vydM0quFbCvvV5762pJHOA.png":{"id":"1*vydM0quFbCvvV5762pJHOA.png","originalHeight":404,"originalWidth":957,"focusPercentX":null,"focusPercentY":null,"alt":null,"__typename":"ImageMetadata"},"Paragraph:d1e993b9483f_131.markups.0":{"type":"A","start":54,"end":157,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1QptBX2wn_RC5-oaVPyxynbmKROO5ElfHJyNcqcX0YhA\u002Fedit#gid=1065153023","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_131.markups.1":{"type":"A","start":162,"end":265,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo\u002Fedit#gid=1872735739","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_132":{"id":"d1e993b9483f_132","name":"41b9","type":"P","href":null,"layout":null,"metadata":null,"text":"But it’s a good start! Remember that the power LEDs are still lit. And we have achieved flat lines of power usage during Deep Sleep.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_133":{"id":"d1e993b9483f_133","name":"2ee3","type":"IMG","href":null,"layout":"FULL_WIDTH","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*r2BOfUOGYrl-ottE9bYI6A.png","typename":"ImageMetadata"},"text":"Power consumed by our IoT sensor device before and after optimisation. From https:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1QptBX2wn_RC5-oaVPyxynbmKROO5ElfHJyNcqcX0YhA\u002Fedit?usp=sharing and https:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo\u002Fedit?usp=sharing","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_133.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_133.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_133.markups.0":{"type":"A","start":76,"end":176,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1QptBX2wn_RC5-oaVPyxynbmKROO5ElfHJyNcqcX0YhA\u002Fedit?usp=sharing","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_133.markups.1":{"type":"A","start":181,"end":281,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fdocs.google.com\u002Fspreadsheets\u002Fd\u002F1Rb6HXaHBaSAM3KW1aWOTyXjpJDiOCEWZAwpA-nufGKo\u002Fedit?usp=sharing","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_134":{"id":"d1e993b9483f_134","name":"710a","type":"P","href":null,"layout":null,"metadata":null,"text":"Right now our Blue Pill wakes up every 1 minute or so… If we could extend the Deep Sleep to 10 minutes or longer, we should get much lower overall power consumption.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_135":{"id":"d1e993b9483f_135","name":"74da","type":"P","href":null,"layout":null,"metadata":null,"text":"Unfortunately I couldn’t get Blue Pill to sleep beyond 1 minute… Something is still waking it up. Another timer? Or NB-IoT?","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_135.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_135.markups.0":{"type":"EM","start":65,"end":98,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_136":{"id":"d1e993b9483f_136","name":"1063","type":"P","href":null,"layout":null,"metadata":null,"text":"I invite you to reproduce the same setup with the steps I have described… And help me solve the mystery! (Or work around it… See the “Backup Registers” section below)","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_136.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_136.markups.0":{"type":"EM","start":133,"end":151,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_137":{"id":"d1e993b9483f_137","name":"128a","type":"P","href":null,"layout":null,"metadata":null,"text":"But I hope you now have a deeper appreciation of all the components that make an IoT Sensor truly Low Power… the Network (NB-IoT), the Microcontroller (STM32) and the Operating System (Mynewt)!","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_137.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_137.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_137.markups.0":{"type":"STRONG","start":109,"end":193,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_137.markups.1":{"type":"EM","start":109,"end":193,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_138":{"id":"d1e993b9483f_138","name":"132a","type":"P","href":null,"layout":null,"metadata":null,"text":"Many thanks to StarHub for sponsoring the NB-IoT SIM that I used for this article!","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_138.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_138.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_138.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_138.markups.0":{"type":"A","start":15,"end":22,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fwww.starhub.com","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_138.markups.1":{"type":"STRONG","start":15,"end":22,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_138.markups.2":{"type":"EM","start":0,"end":82,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_139":{"id":"d1e993b9483f_139","name":"4704","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*W7byHWI1Guhx-OkfYST0DQ.jpeg","typename":"ImageMetadata"},"text":"Final data collection with RuiDeng DPS 3005 Power Monitor connected to STM32 Blue Pill and Quectel BC95-G NB-IoT module. The Bluetooth module for the Power Monitor is in the centre (green board with red LED).","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*W7byHWI1Guhx-OkfYST0DQ.jpeg":{"id":"1*W7byHWI1Guhx-OkfYST0DQ.jpeg","originalHeight":2227,"originalWidth":1654,"focusPercentX":null,"focusPercentY":null,"alt":null,"__typename":"ImageMetadata"},"Paragraph:d1e993b9483f_140":{"id":"d1e993b9483f_140","name":"c98d","type":"H3","href":null,"layout":null,"metadata":null,"text":"💎 Advanced Topic: Main and Backup Power","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_141":{"id":"d1e993b9483f_141","name":"ad2b","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*M7LXYsWuXGvY8CKvM9yVtg.png","typename":"ImageMetadata"},"text":"From “RM0008 Reference manual for STM32F103xx”: https:\u002F\u002Fwww.st.com\u002Fcontent\u002Fccc\u002Fresource\u002Ftechnical\u002Fdocument\u002Freference_manual\u002F59\u002Fb9\u002Fba\u002F7f\u002F11\u002Faf\u002F43\u002Fd5\u002FCD00171190.pdf\u002Ffiles\u002FCD00171190.pdf\u002Fjcr:content\u002Ftranslations\u002Fen.CD00171190.pdf","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_141.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*M7LXYsWuXGvY8CKvM9yVtg.png":{"id":"1*M7LXYsWuXGvY8CKvM9yVtg.png","originalHeight":682,"originalWidth":794,"focusPercentX":null,"focusPercentY":null,"alt":null,"__typename":"ImageMetadata"},"Paragraph:d1e993b9483f_141.markups.0":{"type":"A","start":48,"end":226,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fwww.st.com\u002Fcontent\u002Fccc\u002Fresource\u002Ftechnical\u002Fdocument\u002Freference_manual\u002F59\u002Fb9\u002Fba\u002F7f\u002F11\u002Faf\u002F43\u002Fd5\u002FCD00171190.pdf\u002Ffiles\u002FCD00171190.pdf\u002Fjcr:content\u002Ftranslations\u002Fen.CD00171190.pdf","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_142":{"id":"d1e993b9483f_142","name":"b1b7","type":"P","href":null,"layout":null,"metadata":null,"text":"Let’s study the power input for STM32F103C8T6, the STM32 microcontroller at the heart of Blue Pill. Most parts of STM32F103C8T6 are powered by the Main Power (VDD in the above diagram).","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_142.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_142.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_142.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_142.markups.0":{"type":"CODE","start":159,"end":162,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_142.markups.1":{"type":"STRONG","start":32,"end":45,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_142.markups.2":{"type":"STRONG","start":147,"end":158,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_143":{"id":"d1e993b9483f_143","name":"21d1","type":"P","href":null,"layout":null,"metadata":null,"text":"STM32F103C8T6 has a Backup Domain (highlighted in red) that may be powered by Main Power VDD or Backup Power VBAT. The Backup Domain contains the minimum components essential for Deep Sleep, such as the Real Time Clock.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_143.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_143.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_143.markups.2","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_143.markups.3","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_143.markups.4","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_143.markups.0":{"type":"CODE","start":89,"end":92,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_143.markups.1":{"type":"CODE","start":109,"end":113,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_143.markups.2":{"type":"STRONG","start":20,"end":34,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_143.markups.3":{"type":"STRONG","start":54,"end":55,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_143.markups.4":{"type":"STRONG","start":96,"end":108,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_144":{"id":"d1e993b9483f_144","name":"11df","type":"P","href":null,"layout":null,"metadata":null,"text":"This means that it’s possible to sustain Blue Pill in Deep Sleep just by supplying a bit of Backup Power to the VBAT pin, while the rest of Blue Pill (running on Main Power) is powered down.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_144.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_144.markups.0":{"type":"CODE","start":112,"end":116,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_145":{"id":"d1e993b9483f_145","name":"8ef7","type":"P","href":null,"layout":null,"metadata":null,"text":"Everything in the Backup Domain continues to operate as long as Backup Power is available. What’s inside the Backup Domain?","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_146":{"id":"d1e993b9483f_146","name":"29cf","type":"P","href":null,"layout":null,"metadata":null,"text":"1️⃣ Low Speed External (LSE) Oscillator: This generates the ticks that’s needed by the Real Time Clock to track time accurately during Deep Sleep","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_146.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_146.markups.0":{"type":"STRONG","start":4,"end":39,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_147":{"id":"d1e993b9483f_147","name":"8b86","type":"P","href":null,"layout":null,"metadata":null,"text":"2️⃣ Backup Registers (BKP): These are ten 16-bit registers that we may use to store 20 bytes of data. The contents of the registers will be preserved across restarts and wakeups, as long as Backup Power is available. We’ll see later how Backup Registers may be used.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_147.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_147.markups.0":{"type":"STRONG","start":4,"end":26,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_148":{"id":"d1e993b9483f_148","name":"f469","type":"P","href":null,"layout":null,"metadata":null,"text":"3️⃣ Backup Domain Control Register (BDCR): This register is used to configure the LSE Oscillator and Real Time Clock.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_148.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_148.markups.0":{"type":"STRONG","start":4,"end":41,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_149":{"id":"d1e993b9483f_149","name":"7d9a","type":"P","href":null,"layout":null,"metadata":null,"text":"4️⃣ Real Time Clock (RTC): This is needed to count the ticks produced by the LSE Oscillator and track the elapsed time accurately. It also wakes up the microcontroller at the preset alarm time.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_149.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_149.markups.0":{"type":"STRONG","start":4,"end":25,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_150":{"id":"d1e993b9483f_150","name":"823a","type":"H3","href":null,"layout":null,"metadata":null,"text":"💎 Advanced Topic: Configure the Real Time Clock","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_151":{"id":"d1e993b9483f_151","name":"ceea","type":"P","href":null,"layout":null,"metadata":null,"text":"This section explains how we configured the Real Time Clock on Blue Pill. The alarm_setup() code looks tricky so we’ll study this step by step.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_151.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_151.markups.0":{"type":"CODE","start":78,"end":91,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_152":{"id":"d1e993b9483f_152","name":"c8b4","type":"P","href":null,"layout":null,"metadata":null,"text":"The alarm_setup() function is called at startup and wakeup by __wrap_os_tick_init(), which is the intercepted version of os_tick_init() that we’ll see in the section “Advanced Topic: Patch Mynewt OS Functions” below.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_152.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_152.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_152.markups.2","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_152.markups.3","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_152.markups.4","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_152.markups.0":{"type":"CODE","start":4,"end":17,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_152.markups.1":{"type":"CODE","start":62,"end":83,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_152.markups.2":{"type":"CODE","start":121,"end":135,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_152.markups.3":{"type":"A","start":62,"end":81,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fsrc\u002Fhal_os_tick.c","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_152.markups.4":{"type":"EM","start":165,"end":209,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_153":{"id":"d1e993b9483f_153","name":"5d77","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fsrc\u002Falarm.c","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_153.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:d1e993b9483f_153.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:d1e993b9483f_153.markups.0":{"type":"A","start":5,"end":101,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fsrc\u002Falarm.c","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:c9296e4d6ea7577fcc5b3a7a79c73dc7":{"id":"c9296e4d6ea7577fcc5b3a7a79c73dc7","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90","__typename":"MediaResource"},"$Paragraph:d1e993b9483f_153.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:c9296e4d6ea7577fcc5b3a7a79c73dc7","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:d1e993b9483f_154":{"id":"d1e993b9483f_154","name":"3dc1","type":"P","href":null,"layout":null,"metadata":null,"text":"Blue Pill has three Oscillator Clocks: HSE, LSE and LSI. These are primitive clocks, good for producing ticks only. We may select one of these Oscillator Clocks to drive the Real Time Clock and trigger the Deep Sleep wakeup alarm.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_154.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_154.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_154.markups.0":{"type":"STRONG","start":20,"end":37,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_154.markups.1":{"type":"STRONG","start":39,"end":55,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_155":{"id":"d1e993b9483f_155","name":"9bd3","type":"P","href":null,"layout":null,"metadata":null,"text":"1️⃣ High Speed External (HSE) is the fastest clock (8 MHz crystal oscillator)… But also needs the most power. HSE uses only Main Power, doesn’t work on Backup Power. So when we sleep and switch to Backup Power, it stops. Not suitable for setting the Deep Sleep alarm.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_155.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_155.markups.0":{"type":"STRONG","start":4,"end":29,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_156":{"id":"d1e993b9483f_156","name":"5cd2","type":"P","href":null,"layout":null,"metadata":null,"text":"2️⃣ Low Speed Internal (LSI) is a slower clock (~40 kHz RC oscillator) but it also runs on Main Power, not Backup Power. So it’s not suitable for setting the Deep Sleep alarm either.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_156.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_156.markups.0":{"type":"STRONG","start":4,"end":29,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_157":{"id":"d1e993b9483f_157","name":"38ca","type":"P","href":null,"layout":null,"metadata":null,"text":"3️⃣ Low Speed External (LSE) (32.768 kHz crystal oscillator) is the best choice because it works on Backup Power (assuming that our Blue Pill has a Backup Power source when it goes into Deep Sleep)","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_157.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_157.markups.0":{"type":"STRONG","start":4,"end":28,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_158":{"id":"d1e993b9483f_158","name":"9028","type":"P","href":null,"layout":null,"metadata":null,"text":"What’s “Prescaling”? Something you do on a fish? No, prescaling lets us run the Real Time Clock as a fraction of the HSE \u002F LSE \u002F LSI clock speeds. So when we prescale LSE by 32, we run the Real Time Clock at 1 tick per millisecond. (LSE ticks natively at 32.768 kHz, or 32,768 ticks per second)","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_158.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_158.markups.0":{"type":"STRONG","start":8,"end":18,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_159":{"id":"d1e993b9483f_159","name":"f27a","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fsrc\u002Falarm.c","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_159.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:d1e993b9483f_159.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:d1e993b9483f_159.markups.0":{"type":"A","start":5,"end":101,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fsrc\u002Falarm.c","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:0413fdb3d8522950b253dd61fed30446":{"id":"0413fdb3d8522950b253dd61fed30446","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90","__typename":"MediaResource"},"$Paragraph:d1e993b9483f_159.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:0413fdb3d8522950b253dd61fed30446","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:d1e993b9483f_160":{"id":"d1e993b9483f_160","name":"881e","type":"P","href":null,"layout":null,"metadata":null,"text":"Real Time Clock may be used in 3 ways to trigger interrupts…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_161":{"id":"d1e993b9483f_161","name":"955c","type":"P","href":null,"layout":null,"metadata":null,"text":"1️⃣ After a preset number of ticks (RTC_SEC). So that the STM32 microcontroller’s Real Time Clock may be used like the Arm processor’s SysTick Timer.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_161.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_161.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_161.markups.0":{"type":"CODE","start":36,"end":43,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_161.markups.1":{"type":"STRONG","start":4,"end":34,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_162":{"id":"d1e993b9483f_162","name":"ff5b","type":"P","href":null,"layout":null,"metadata":null,"text":"2️⃣ At a preset alarm time (RTC_ALR). We’re using this to wake up from Deep Sleep.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_162.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_162.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_162.markups.0":{"type":"CODE","start":28,"end":35,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_162.markups.1":{"type":"STRONG","start":4,"end":26,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_163":{"id":"d1e993b9483f_163","name":"e2e7","type":"P","href":null,"layout":null,"metadata":null,"text":"3️⃣ Upon overflow (RTC_OW). The Real Time Clock is a 32-bit counter that counts the number of elapsed ticks from 0 to 4,294,967,295. When the counter overflows, the Real Time Clock triggers this interrupt so that the operating system can do the necessary time adjustments.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_163.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_163.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_163.markups.0":{"type":"CODE","start":19,"end":25,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_163.markups.1":{"type":"STRONG","start":4,"end":17,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_164":{"id":"d1e993b9483f_164","name":"40eb","type":"P","href":null,"layout":null,"metadata":null,"text":"We’ll be using only the Alarm Interrupt RTC_ALR. When the alarm goes off, the Arm processor will call our function rtc_alarm_isr()","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_164.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_164.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_164.markups.0":{"type":"CODE","start":40,"end":47,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_164.markups.1":{"type":"CODE","start":115,"end":130,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_165":{"id":"d1e993b9483f_165","name":"c75d","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fsrc\u002Falarm.c","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_165.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:d1e993b9483f_165.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:d1e993b9483f_165.markups.0":{"type":"A","start":5,"end":101,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fsrc\u002Falarm.c","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:2907fc3439b8e81dfa0843a8c183919a":{"id":"2907fc3439b8e81dfa0843a8c183919a","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90","__typename":"MediaResource"},"$Paragraph:d1e993b9483f_165.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:2907fc3439b8e81dfa0843a8c183919a","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:d1e993b9483f_166":{"id":"d1e993b9483f_166","name":"d6a1","type":"P","href":null,"layout":null,"metadata":null,"text":"At power on we switch on the Real Time Clock and set the counter value to 0 (rtc_set_counter_val). This is the counter we’ll be using to track the elapsed time (as millisecond ticks) in our application.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_166.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_166.markups.0":{"type":"CODE","start":77,"end":96,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_167":{"id":"d1e993b9483f_167","name":"ee6f","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fsrc\u002Falarm.c","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_167.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:d1e993b9483f_167.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:d1e993b9483f_167.markups.0":{"type":"A","start":5,"end":101,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fsrc\u002Falarm.c","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:6bb547aa16f14de7d8e7b44e8193b171":{"id":"6bb547aa16f14de7d8e7b44e8193b171","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90","__typename":"MediaResource"},"$Paragraph:d1e993b9483f_167.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:6bb547aa16f14de7d8e7b44e8193b171","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:d1e993b9483f_168":{"id":"d1e993b9483f_168","name":"546d","type":"P","href":null,"layout":null,"metadata":null,"text":"During wakeup from Deep Sleep we don’t reset the Real Time Clock counter. That way we can track the elapsed time as Blue Pill sleeps. Remember that the Real Time Clock keeps counting the ticks during Deep Sleep (powered by Backup Power).","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_169":{"id":"d1e993b9483f_169","name":"d20f","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fsrc\u002Falarm.c","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_169.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:d1e993b9483f_169.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:d1e993b9483f_169.markups.0":{"type":"A","start":5,"end":101,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fsrc\u002Falarm.c","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:904f4aa88dc6cacb089dab3395753bb3":{"id":"904f4aa88dc6cacb089dab3395753bb3","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90","__typename":"MediaResource"},"$Paragraph:d1e993b9483f_169.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:904f4aa88dc6cacb089dab3395753bb3","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:d1e993b9483f_170":{"id":"d1e993b9483f_170","name":"7675","type":"P","href":null,"layout":null,"metadata":null,"text":"For Deep Sleep Stop Mode: The External Interrupt (EXTI) must be configured so that the Alarm Interrupt will wake us up (exti_set_trigger). This is not necessary for Deep Sleep Standby Mode.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_170.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_170.markups.0":{"type":"CODE","start":120,"end":136,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_171":{"id":"d1e993b9483f_171","name":"9079","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fsrc\u002Falarm.c","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_171.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:d1e993b9483f_171.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:d1e993b9483f_171.markups.0":{"type":"A","start":5,"end":101,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fsrc\u002Falarm.c","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:d1b2a607b1c5b41fa61e547096d8a533":{"id":"d1b2a607b1c5b41fa61e547096d8a533","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90","__typename":"MediaResource"},"$Paragraph:d1e993b9483f_171.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:d1b2a607b1c5b41fa61e547096d8a533","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:d1e993b9483f_172":{"id":"d1e993b9483f_172","name":"e923","type":"P","href":null,"layout":null,"metadata":null,"text":"Once we enable the Alarm Interrupt via rtc_interrupt_enable(RTC_ALR), the alarm becomes operational. We will call rtc_set_alarm_time() to set the alarm time (in ticks). When the alarm goes off, our function rtc_alarm_isr() will be called.","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_172.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_172.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_172.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_172.markups.0":{"type":"CODE","start":39,"end":68,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_172.markups.1":{"type":"CODE","start":114,"end":134,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_172.markups.2":{"type":"CODE","start":207,"end":222,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_173":{"id":"d1e993b9483f_173","name":"3ae2","type":"P","href":null,"layout":null,"metadata":null,"text":"Here’s how we set the alarm time before entering Deep Sleep…","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_174":{"id":"d1e993b9483f_174","name":"f55e","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fsrc\u002Falarm.c","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_174.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:d1e993b9483f_174.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:d1e993b9483f_174.markups.0":{"type":"A","start":5,"end":101,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fsrc\u002Falarm.c","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:34ce570b711463736120d29f17f17ff6":{"id":"34ce570b711463736120d29f17f17ff6","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90","__typename":"MediaResource"},"$Paragraph:d1e993b9483f_174.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:34ce570b711463736120d29f17f17ff6","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:d1e993b9483f_175":{"id":"d1e993b9483f_175","name":"1cbd","type":"IMG","href":null,"layout":"FULL_WIDTH","metadata":{"type":"id","generated":false,"id":"ImageMetadata:1*NOWC3WM-G2GOOL9tillzfQ.png","typename":"ImageMetadata"},"text":"HSE, LSE and LSI clocks on STM32 Blue Pill","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*NOWC3WM-G2GOOL9tillzfQ.png":{"id":"1*NOWC3WM-G2GOOL9tillzfQ.png","originalHeight":4588,"originalWidth":5435,"focusPercentX":null,"focusPercentY":null,"alt":"Blue Pill has 3 Oscillator Clocks:\n HSE, LSE and LSI. \n Very primitive clocks, good \n for tick tocks only. HSE is the fastest","__typename":"ImageMetadata"},"Paragraph:d1e993b9483f_176":{"id":"d1e993b9483f_176","name":"d2c0","type":"H3","href":null,"layout":null,"metadata":null,"text":"💎 Advanced Topic: Backup Registers","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_177":{"id":"d1e993b9483f_177","name":"930d","type":"P","href":null,"layout":null,"metadata":null,"text":"Here’s the problem: Blue Pill wakes up from Deep Sleep Standby Mode with amnesia… It doesn’t know what it was doing before it fell into Deep Sleep, since the RAM has been erased. How can we make Blue Pill memorise some state information so that it can resume working after waking up? Without writing to Flash ROM?","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_177.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_177.markups.0":{"type":"EM","start":179,"end":313,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_178":{"id":"d1e993b9483f_178","name":"0481","type":"P","href":null,"layout":null,"metadata":null,"text":"Solution: Use the STM32 Backup Registers. Blue Pill’s Backup Registers are ten 16-bit registers that we may use to store 20 bytes of data. The contents of the registers will be preserved across restarts and wakeups, as long as there is Backup Power (or Main Power) supplied to Blue Pill. It works just the Real Time Clock!","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_178.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_178.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_178.markups.0":{"type":"STRONG","start":18,"end":40,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_178.markups.1":{"type":"STRONG","start":215,"end":286,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_179":{"id":"d1e993b9483f_179","name":"01a5","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fcodal-libopencm3\u002Fblob\u002Fmaster\u002Fstm32\u002Fbootloader\u002Fstm32f103\u002Fbackup.c","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_179.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:d1e993b9483f_179.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:d1e993b9483f_179.markups.0":{"type":"A","start":5,"end":96,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fcodal-libopencm3\u002Fblob\u002Fmaster\u002Fstm32\u002Fbootloader\u002Fstm32f103\u002Fbackup.c","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:dfad53cd227e334e11db0178695a51a2":{"id":"dfad53cd227e334e11db0178695a51a2","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"backup-register.c","__typename":"MediaResource"},"$Paragraph:d1e993b9483f_179.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:dfad53cd227e334e11db0178695a51a2","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:d1e993b9483f_180":{"id":"d1e993b9483f_180","name":"2fa6","type":"P","href":null,"layout":null,"metadata":null,"text":"This code was used in my Bootloader (from an earlier article) to remember whether Blue Pill is supposed to restart in Bootloader Mode or Application Mode. Check out the article: “STM32 Blue Pill — Bootloading the WebUSB Bootloader”","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_180.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_180.markups.1","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_180.markups.0":{"type":"A","start":179,"end":230,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fstm32-blue-pill-bootloading-the-webusb-bootloader-63398ef5eb76?source=friends_link&sk=8b43b83310910e64752a61cf630e0b78","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_180.markups.1":{"type":"EM","start":178,"end":231,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_181":{"id":"d1e993b9483f_181","name":"d9e6","type":"H3","href":null,"layout":null,"metadata":null,"text":"💎 Advanced Topic: Patch Mynewt OS Functions","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_182":{"id":"d1e993b9483f_182","name":"a0c9","type":"P","href":null,"layout":null,"metadata":null,"text":"The low power functions were implemented in a custom library libs\u002Flow_power. How did we patch the Mynewt OS functions like os_task_idle() with our custom library? By using the Linker Wrap directive in our library…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_182.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_182.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_182.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_182.markups.0":{"type":"CODE","start":61,"end":75,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_182.markups.1":{"type":"CODE","start":123,"end":137,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_182.markups.2":{"type":"A","start":61,"end":75,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Ftree\u002Flow-power\u002Flibs\u002Flow_power","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_183":{"id":"d1e993b9483f_183","name":"75e1","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fpkg.yml","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_183.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:d1e993b9483f_183.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:d1e993b9483f_183.markups.0":{"type":"A","start":5,"end":97,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fpkg.yml","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:a681e4022f8370bf720f608aeb8fbb98":{"id":"a681e4022f8370bf720f608aeb8fbb98","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90","__typename":"MediaResource"},"$Paragraph:d1e993b9483f_183.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:a681e4022f8370bf720f608aeb8fbb98","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:d1e993b9483f_184":{"id":"d1e993b9483f_184","name":"696a","type":"P","href":null,"layout":null,"metadata":null,"text":"When the GNU Linker collates the compiled object files (*.o) to create the firmware image, it will look for all calls to os_tick_idle() and rename them as calls to __wrap_os_tick_idle().","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_184.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_184.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_184.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_184.markups.0":{"type":"CODE","start":56,"end":59,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_184.markups.1":{"type":"CODE","start":121,"end":135,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_184.markups.2":{"type":"CODE","start":164,"end":185,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_185":{"id":"d1e993b9483f_185","name":"b887","type":"P","href":null,"layout":null,"metadata":null,"text":"Note that GNU Linker will NOT rename the original os_tick_idle() function defined in Mynewt. Which means that we may implement the __wrap_os_tick_idle() function ourselves and the callers will happily pretend that it’s really os_tick_idle(). That’s how we intercept system functions in Mynewt…","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_185.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_185.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_185.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_185.markups.0":{"type":"CODE","start":50,"end":64,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_185.markups.1":{"type":"CODE","start":131,"end":152,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_185.markups.2":{"type":"CODE","start":226,"end":240,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_186":{"id":"d1e993b9483f_186","name":"f3b8","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fsrc\u002Fhal_os_tick.c","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_186.markups.0","typename":"Markup"}],"__typename":"Paragraph","iframe":{"type":"id","generated":true,"id":"$Paragraph:d1e993b9483f_186.iframe","typename":"Iframe"},"mixtapeMetadata":null},"Paragraph:d1e993b9483f_186.markups.0":{"type":"A","start":5,"end":107,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Flibs\u002Flow_power\u002Fsrc\u002Fhal_os_tick.c","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"MediaResource:61196aae914c52aeefa7a8cc935b9555":{"id":"61196aae914c52aeefa7a8cc935b9555","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"See https:\u002F\u002Fmedium.com\u002F@ly.lee\u002Flow-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust-cef5a3ecdd90","__typename":"MediaResource"},"$Paragraph:d1e993b9483f_186.iframe":{"mediaResource":{"type":"id","generated":false,"id":"MediaResource:61196aae914c52aeefa7a8cc935b9555","typename":"MediaResource"},"__typename":"Iframe"},"Paragraph:d1e993b9483f_187":{"id":"d1e993b9483f_187","name":"0293","type":"P","href":null,"layout":null,"metadata":null,"text":"It’s a nasty way to alter the behaviour of Mynewt (and I don’t condone it). But for exploratory and educational purposes, it’s probably OK.","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_188":{"id":"d1e993b9483f_188","name":"737a","type":"P","href":null,"layout":null,"metadata":null,"text":"Note that the firmware size is close to 60 KB. Adding the 4 KB Stub Bootloader we get total 64 KB of Flash ROM used. This is very close to Blue Pill’s 64 KB ROM capacity. When you’re not debugging, uncomment the -Os option in apps\u002Fmy_sensor_app\u002Fpkg.yml","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_188.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_188.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_188.markups.2","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_188.markups.0":{"type":"CODE","start":212,"end":215,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_188.markups.1":{"type":"CODE","start":226,"end":252,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_188.markups.2":{"type":"A","start":226,"end":252,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Fapps\u002Fmy_sensor_app\u002Fpkg.yml","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_189":{"id":"d1e993b9483f_189","name":"824d","type":"PRE","href":null,"layout":null,"metadata":null,"text":"#  C compiler flags\npkg.cflags:\n    - -DFLOAT_SUPPORT  #  For encoding floats in CoAP messages\n#   - -Os              #  Optimise for smallest size","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_190":{"id":"d1e993b9483f_190","name":"1511","type":"P","href":null,"layout":null,"metadata":null,"text":"Also the random number generator has been disabled to reduce code size, hence the Device ID is always 0000… To enable it, change HMAC_PRNG to 1 in targets\u002Fbluepill_my_sensor\u002Fsyscfg.yml","hasDropCap":null,"dropCapImage":null,"markups":[{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_190.markups.0","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_190.markups.1","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_190.markups.2","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_190.markups.3","typename":"Markup"},{"type":"id","generated":true,"id":"Paragraph:d1e993b9483f_190.markups.4","typename":"Markup"}],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Paragraph:d1e993b9483f_190.markups.0":{"type":"CODE","start":102,"end":107,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_190.markups.1":{"type":"CODE","start":129,"end":138,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_190.markups.2":{"type":"CODE","start":142,"end":143,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_190.markups.3":{"type":"CODE","start":147,"end":184,"href":null,"anchorType":null,"userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_190.markups.4":{"type":"A","start":147,"end":184,"href":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194117\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fstm32bluepill-mynewt-sensor\u002Fblob\u002Flow-power\u002Ftargets\u002Fbluepill_my_sensor\u002Fsyscfg.yml","anchorType":"LINK","userId":null,"linkMetadata":null,"__typename":"Markup"},"Paragraph:d1e993b9483f_191":{"id":"d1e993b9483f_191","name":"017a","type":"PRE","href":null,"layout":null,"metadata":null,"text":"HMAC_PRNG: 0  # Disable HMAC PRNG pseudorandom number generator","hasDropCap":null,"dropCapImage":null,"markups":[],"__typename":"Paragraph","iframe":null,"mixtapeMetadata":null},"Tag:programming":{"id":"programming","displayTitle":"Programming","__typename":"Tag"},"Tag:rust":{"id":"rust","displayTitle":"Rust","__typename":"Tag"},"Tag:stm32":{"id":"stm32","displayTitle":"Stm32","__typename":"Tag"},"Tag:internet-of-things":{"id":"internet-of-things","displayTitle":"Internet of Things","__typename":"Tag"},"Tag:nb-iot":{"id":"nb-iot","displayTitle":"Nb Iot","__typename":"Tag"},"$Post:cef5a3ecdd90.previewContent":{"subtitle":"How much power do Quectel NB-IoT modules consume? Let’s find out with the RuiDeng DPS 3005","__typename":"PreviewContent"},"ROOT_QUERY.variantFlags.0":{"name":"allow_access","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.0.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.0.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.1":{"name":"allow_signup","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.1.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.1.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.2":{"name":"allow_test_auth","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.2.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.2.valueType":{"__typename":"VariantFlagString","value":"disallow"},"ROOT_QUERY.variantFlags.3":{"name":"available_annual_plan","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.3.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.3.valueType":{"__typename":"VariantFlagString","value":"2c754bcc2995"},"ROOT_QUERY.variantFlags.4":{"name":"available_monthly_plan","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.4.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.4.valueType":{"__typename":"VariantFlagString","value":"60e220181034"},"ROOT_QUERY.variantFlags.5":{"name":"browsable_stream_config_bucket","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.5.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.5.valueType":{"__typename":"VariantFlagString","value":"curated-topics"},"ROOT_QUERY.variantFlags.6":{"name":"disable_gosocial_followers_that_you_follow","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.6.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.6.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.7":{"name":"disable_ios_resume_reading_toast","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.7.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.7.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.8":{"name":"disable_mobile_featured_chunk","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.8.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.8.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.9":{"name":"disable_post_recommended_from_friends_provider","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.9.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.9.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.10":{"name":"enable_annual_renewal_reminder_email","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.10.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.10.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.11":{"name":"enable_app_flirty_thirty","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.11.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.11.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.12":{"name":"enable_automated_mission_control_triggers","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.12.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.12.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.13":{"name":"enable_branch_io","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.13.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.13.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.14":{"name":"enable_branding","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.14.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.14.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.15":{"name":"enable_branding_fonts","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.15.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.15.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.16":{"name":"enable_dedicated_series_tab_api_ios","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.16.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.16.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.17":{"name":"enable_different_grid","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.17.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.17.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.18":{"name":"enable_disregard_trunc_state_for_footer","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.18.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.18.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.19":{"name":"enable_edit_alt_text","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.19.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.19.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.20":{"name":"enable_email_sign_in_captcha","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.20.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.20.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.21":{"name":"enable_embedding_based_diversification","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.21.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.21.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.22":{"name":"enable_filter_by_resend_rules","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.22.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.22.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.23":{"name":"enable_first_name_on_blocker_banner","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.23.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.23.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.24":{"name":"enable_first_name_on_paywall","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.24.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.24.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.25":{"name":"enable_gift_membership_ended_email","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.25.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.25.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.26":{"name":"enable_google_one_tap","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.26.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.26.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.27":{"name":"enable_inline_search_lite","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.27.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.27.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.28":{"name":"enable_inline_search_popover_lite","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.28.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.28.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.29":{"name":"enable_ios_post_stats","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.29.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.29.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.30":{"name":"enable_janky_spam_rules","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.30.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.30.valueType":{"__typename":"VariantFlagString","value":"users,posts"},"ROOT_QUERY.variantFlags.31":{"name":"enable_kafka_events","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.31.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.31.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.32":{"name":"enable_lite_notifications","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.32.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.32.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.33":{"name":"enable_lite_post","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.33.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.33.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.34":{"name":"enable_lite_post_cd","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.34.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.34.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.35":{"name":"enable_lite_post_highlights","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.35.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.35.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.36":{"name":"enable_lite_post_highlights_view_only","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.36.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.36.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.37":{"name":"enable_lite_profile","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.37.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.37.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.38":{"name":"enable_lite_pub_header_menu","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.38.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.38.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.39":{"name":"enable_lite_read_next","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.39.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.39.valueType":{"__typename":"VariantFlagString","value":"sidebar"},"ROOT_QUERY.variantFlags.40":{"name":"enable_lite_stories","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.40.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.40.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.41":{"name":"enable_lite_topics","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.41.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.41.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.42":{"name":"enable_lite_unread_notification_count_mutation","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.42.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.42.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.43":{"name":"enable_lo_homepage","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.43.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.43.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.44":{"name":"enable_lo_scroll_away_metabar","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.44.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.44.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.45":{"name":"enable_logged_out_homepage_signup","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.45.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.45.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.46":{"name":"enable_marketing_emails","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.46.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.46.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.47":{"name":"enable_media_resource_try_catch","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.47.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.47.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.48":{"name":"enable_membership_remove_section_a","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.48.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.48.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.49":{"name":"enable_membership_thank_you_email","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.49.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.49.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.50":{"name":"enable_more_branch_data","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.50.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.50.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.51":{"name":"enable_multi_day_pub_digests","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.51.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.51.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.52":{"name":"enable_new_collaborative_filtering_data","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.52.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.52.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.53":{"name":"enable_new_gdpr_partner_export","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.53.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.53.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.54":{"name":"enable_new_partner_dashboard","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.54.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.54.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.55":{"name":"enable_new_partner_program_updates","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.55.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.55.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.56":{"name":"enable_new_pub_fonts","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.56.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.56.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.57":{"name":"enable_new_pub_modules","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.57.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.57.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.58":{"name":"enable_new_suspended_page","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.58.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.58.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.59":{"name":"enable_new_three_dot_menu","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.59.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.59.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.60":{"name":"enable_no_cache_control","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.60.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.60.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.61":{"name":"enable_optimizely","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.61.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.61.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.62":{"name":"enable_parsely","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.62.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.62.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.63":{"name":"enable_patronus_on_kubernetes","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.63.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.63.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.64":{"name":"enable_popularity_feature_exp_retrain","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.64.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.64.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.65":{"name":"enable_post_import","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.65.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.65.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.66":{"name":"enable_post_settings_screen","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.66.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.66.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.67":{"name":"enable_primary_topic_for_mobile","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.67.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.67.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.68":{"name":"enable_pub_digest_send_after_pub_follow","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.68.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.68.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.69":{"name":"enable_rtr_channel","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.69.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.69.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.70":{"name":"enable_save_to_medium","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.70.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.70.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.71":{"name":"enable_sign_up_with_email","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.71.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.71.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.72":{"name":"enable_stripe_express_initial_expansion_copy","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.72.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.72.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.73":{"name":"enable_stripe_express_rest_of_world_copy","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.73.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.73.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.74":{"name":"enable_susi_font_changes","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.74.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.74.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.75":{"name":"enable_tick_landing_page","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.75.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.75.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.76":{"name":"enable_tipalti_onboarding","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.76.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.76.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.77":{"name":"enable_topic_lifecycle_email","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.77.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.77.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.78":{"name":"enable_tribute_landing_page","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.78.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.78.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.79":{"name":"enable_trumpland_landing_page","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.79.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.79.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.80":{"name":"glyph_font_set","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.80.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.80.valueType":{"__typename":"VariantFlagString","value":"m2"},"ROOT_QUERY.variantFlags.81":{"name":"google_sign_in_android","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.81.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.81.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.82":{"name":"is_not_medium_subscriber","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.82.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.82.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.83":{"name":"new_transition_page","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.83.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.83.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.84":{"name":"pub_sidebar","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.84.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.84.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.85":{"name":"rank_model","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.85.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.85.valueType":{"__typename":"VariantFlagString","value":"default"},"ROOT_QUERY.variantFlags.86":{"name":"redis_read_write_splitting","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.86.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.86.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.87":{"name":"share_post_linkedin","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.87.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.87.valueType":{"__typename":"VariantFlagBoolean","value":true},"ROOT_QUERY.variantFlags.88":{"name":"signin_services","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.88.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.88.valueType":{"__typename":"VariantFlagString","value":"twitter,facebook,google,email,google-fastidv,google-one-tap"},"ROOT_QUERY.variantFlags.89":{"name":"signup_services","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.89.valueType","typename":"VariantFlagString"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.89.valueType":{"__typename":"VariantFlagString","value":"twitter,facebook,google,email,google-fastidv,google-one-tap"},"ROOT_QUERY.variantFlags.90":{"name":"use_new_admin_topic_backend","valueType":{"type":"id","generated":true,"id":"$ROOT_QUERY.variantFlags.90.valueType","typename":"VariantFlagBoolean"},"__typename":"VariantFlag"},"$ROOT_QUERY.variantFlags.90.valueType":{"__typename":"VariantFlagBoolean","value":true}}</script><script src="https://web.archive.org/web/20191204194117js_/https://cdn-client.medium.com/lite/static/js/manifest.1a56bbb8.js"></script><script src="https://web.archive.org/web/20191204194117js_/https://cdn-client.medium.com/lite/static/js/vendors~main.9c8dc7d0.chunk.js"></script><script src="https://web.archive.org/web/20191204194117js_/https://cdn-client.medium.com/lite/static/js/main.c5c932e3.chunk.js"></script><script src="https://web.archive.org/web/20191204194117js_/https://cdn-client.medium.com/lite/static/js/vendors~screen.collection.packageBuilder~screen.landingpages.pres45~screen.landingpages.tribute~scre~3e410f11.faa5af01.chunk.js"></script>
<script src="https://web.archive.org/web/20191204194117js_/https://cdn-client.medium.com/lite/static/js/screen.collection.packageBuilder~screen.landingpages.pres45~screen.landingpages.tribute~screen.post~~73c4bb05.82cfb8d6.chunk.js"></script>
<script src="https://web.archive.org/web/20191204194117js_/https://cdn-client.medium.com/lite/static/js/screen.post~screen.post.amp~screen.post.series~screen.profile~screen.sequence.library~screen.sequenc~036c6b37.3e471c5d.chunk.js"></script>
<script src="https://web.archive.org/web/20191204194117js_/https://cdn-client.medium.com/lite/static/js/screen.collection.packageBuilder~screen.landingpages.pres45~screen.landingpages.tick~screen.landingp~ed90ee39.3c8733a8.chunk.js"></script>
<script src="https://web.archive.org/web/20191204194117js_/https://cdn-client.medium.com/lite/static/js/screen.post.1aa42b57.chunk.js"></script><script>window.main();</script></body></html><!--
     FILE ARCHIVED ON 19:41:17 Dec 04, 2019 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 23:13:43 Feb 22, 2021.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  exclusion.robots: 0.378
  LoadShardBlock: 300.664 (3)
  PetaboxLoader3.resolve: 210.656
  RedisCDXSource: 11.309
  PetaboxLoader3.datanode: 171.345 (4)
  CDXLines.iter: 31.052 (3)
  captures_list: 348.182
  exclusion.robots.policy: 0.362
  esindex: 0.011
  load_resource: 237.74
-->