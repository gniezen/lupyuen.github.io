<!doctype html>
<html lang="en">

<head>
    <script defer src="https://cdn.optimizely.com/js/16180790160.js"></script>
    <title data-rh="true">Install Apache Mynewt and Embedded Rust for STM32 L476 and Visual Studio Code on Windows | by
        Lup Yuen Lee 李立源 | Medium</title>
    <meta data-rh="true" charset="utf-8" />
    <meta data-rh="true" name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1" />
    <meta data-rh="true" name="theme-color" content="#000000" />
    <meta data-rh="true" name="twitter:app:name:iphone" content="Medium" />
    <meta data-rh="true" name="twitter:app:id:iphone" content="828256236" />
    <meta data-rh="true" property="al:ios:app_name" content="Medium" />
    <meta data-rh="true" property="al:ios:app_store_id" content="828256236" />
    <meta data-rh="true" property="al:android:package" content="com.medium.reader" />
    <meta data-rh="true" property="fb:app_id" content="542599432471018" />
    <meta data-rh="true" property="og:site_name" content="Medium" />
    <meta data-rh="true" property="og:type" content="article" />
    <meta data-rh="true" property="article:published_time" content="2019-09-22T12:36:38.502Z" />
    <meta data-rh="true" name="title"
        content="Install Apache Mynewt and Embedded Rust for STM32 L476 and Visual Studio Code on Windows | by Lup Yuen Lee 李立源 | Medium" />
    <meta data-rh="true" property="og:title"
        content="Install Apache Mynewt and Embedded Rust for STM32 L476 and Visual Studio Code on Windows" />
    <meta data-rh="true" property="twitter:title"
        content="Install Apache Mynewt and Embedded Rust for STM32 L476 and Visual Studio Code on Windows" />
    <meta data-rh="true" name="twitter:site" content="@Medium" />
    <meta data-rh="true" name="twitter:app:url:iphone" content="medium://p/9ed40e065cf4" />
    <meta data-rh="true" property="al:android:url" content="medium://p/9ed40e065cf4" />
    <meta data-rh="true" property="al:ios:url" content="medium://p/9ed40e065cf4" />
    <meta data-rh="true" property="al:android:app_name" content="Medium" />
    <meta data-rh="true" name="description"
        content="Follow these instructions to install Apache Mynewt + Embedded Rust build and application files for STM32 L476 and Visual Studio Code on Windows for the article “Build an NB-IoT GPS Tracker on STM32…" />
    <meta data-rh="true" property="og:description"
        content="Follow these instructions to install Apache Mynewt + Embedded Rust build and application files for STM32 L476 and Visual Studio Code on…" />
    <meta data-rh="true" property="twitter:description"
        content="Follow these instructions to install Apache Mynewt + Embedded Rust build and application files for STM32 L476 and Visual Studio Code on…" />
    <meta data-rh="true" property="og:url"
        content="https://medium.com/@ly.lee/install-apache-mynewt-and-embedded-rust-for-stm32-l476-and-visual-studio-code-on-windows-9ed40e065cf4" />
    <meta data-rh="true" property="al:web:url"
        content="https://medium.com/@ly.lee/install-apache-mynewt-and-embedded-rust-for-stm32-l476-and-visual-studio-code-on-windows-9ed40e065cf4" />
    <meta data-rh="true" property="og:image" content="https://miro.medium.com/max/1200/1*8coa47moi8FXMsQgh0ZY4g.jpeg" />
    <meta data-rh="true" name="twitter:image:src"
        content="https://miro.medium.com/max/1200/1*8coa47moi8FXMsQgh0ZY4g.jpeg" />
    <meta data-rh="true" name="twitter:card" content="summary_large_image" />
    <meta data-rh="true" property="article:author" content="https://medium.com/@ly.lee" />
    <meta data-rh="true" name="twitter:creator" content="@MisterTechBlog" />
    <meta data-rh="true" name="author" content="Lup Yuen Lee 李立源" />
    <meta data-rh="true" name="robots" content="index,follow,max-image-preview:large" />
    <meta data-rh="true" name="referrer" content="unsafe-url" />
    <meta data-rh="true" name="twitter:label1" value="Reading time" />
    <meta data-rh="true" name="twitter:data1" value="6 min read" />

    <!-- Begin scripts/rustdoc-header.html: Header for Custom Markdown files processed by rustdoc, like chip8.md -->
<link rel="alternate" type="application/rss+xml" title="RSS Feed for lupyuen" href="/rss.xml" />
<link rel="stylesheet" type="text/css" href="../normalize.css">
<link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle">

<link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle">
<link rel="stylesheet" type="text/css" href="../prism.css">
<script src="../storage.js"></script><noscript>
<link rel="stylesheet" href="../noscript.css"></noscript>
<link rel="shortcut icon" href="../favicon.ico">
<style type="text/css">
    #crate-search {
        background-image: url("../down-arrow.svg");
    }
    a {
        color: #77d;
    }
</style>
<!-- End scripts/rustdoc-header.html -->

</head>

<body>
    <div id="root">
        <div class="a b c">
            <div class="s">
                <article>
                    <section class="ft fu fv fw w fx fd s"></section><span class="s"></span>
                    <div>
                        <div class="by fl fy fz ga ce"></div>
                        <section class="dj gb gc de gd">
                            <div class="ge">
                                <div class="n p">
                                    <div class="gf gg gh gi gj gk am gl an gm ap w">
                                        <figure class="go gp gq gr gs ge gt gu paragraph-image">

                
                                            <p><img src="https://lupyuen.github.io/images/legacy/r1.jpeg" /></p>


                                          
                                            <figcaption class="hk hl fx fv fw hm hn av b aw ax ay">NB-IoT GPS Tracker
                                                running on the Ghostyu NB-EK-L476 Developer Kit with STM32L476RCT6
                                                microcontroller, Quectel L70-R GPS module and Quectel BC95 NB-IoT
                                                module. Photo taken during the field test at Berlayer Creek Boardwalk in
                                                Singapore.</figcaption>
                                        </figure>
                                    </div>
                                </div>
                            </div>
                            <div class="n p">
                                <div class="aj ak al am an ho ap w">
                                    <div class="">
                                        <h1 id="0182"
                                            class="hp dh hq av cw hr hs ht hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il el">
                                            Install Apache Mynewt and Embedded Rust for STM32 L476 and Visual Studio
                                            Code on Windows</h1>
                                        <div class="ct">
                                            <div class="n cg im in io">
                                                <div class="o n">
                                                    <div><a rel="noopener"
                                                            href="/@ly.lee?source=post_page-----9ed40e065cf4--------------------------------">
                                                            <div class="ah ip iq">
                                                                <div class="ba n ar o p by ir is cb cc cd ce"></div><img alt="Lup Yuen Lee 李立源"
                                                                    class="s cf iq ip"
                                                                    src="https://miro.medium.com/fit/c/56/56/1*72qLH3RF4S4q2AcxlnIdSw.jpeg"
                                                                    width="28" height="28" />
                                                            </div>
                                                        </a></div>
                                                    <div class="dp w n cq">
                                                        <div class="n">
                                                            <div style="flex:1"><span class="av b aw ax el"><a class=""
                                                                        rel="noopener"
                                                                        href="/@ly.lee?source=post_page-----9ed40e065cf4--------------------------------">
                                                                        <p class="av b aw ax az">Lup Yuen Lee 李立源</p>
                                                                    </a></span></div>
                                                        </div><span class="av b aw ax ay"><a class="" rel="noopener"
                                                                href="/@ly.lee/install-apache-mynewt-and-embedded-rust-for-stm32-l476-and-visual-studio-code-on-windows-9ed40e065cf4?source=post_page-----9ed40e065cf4--------------------------------">
                                                                <p class="av b aw ax ay"><span class="it"></span>Sep 22,
                                                                    2019<span class="iu">·</span>6 min read</p>
                                                            </a></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <p id="cea3"
                                        class="jj jk hq jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc dj el">
                                        Follow these instructions to install Apache Mynewt + Embedded Rust build and
                                        application files for STM32 L476 and Visual Studio Code on Windows for the
                                        article <em class="kd">“</em><a class="bq ke" rel="noopener"
                                            href="/@ly.lee/build-an-nb-iot-gps-tracker-on-stm32-l476-with-apache-mynewt-and-embedded-rust-8c095a925546?source=friends_link&amp;sk=f3e802795d4fd7d569f0d67679e8c9e6"><em
                                                class="kd">Build an NB-IoT GPS Tracker on STM32 L476 with Apache Mynewt
                                                and Embedded Rust</em></a><em class="kd">”</em></p>
                                    <h1 id="acd3"
                                        class="kf kg hq av kh ki kj jn kk kl km jq kn ko kp kq kr ks kt ku kv kw kx ky kz la el">
                                        Install Rust</h1>
                                    <p id="c5d5"
                                        class="jj jk hq jl b jm lb jn jo jp lc jq jr js ld jt ju jv le jw jx jy lf jz ka kc dj el">
                                        1️⃣ Click here to install <strong class="jl cw">Build Tools For Visual Studio
                                            2019</strong>:<br /><code
                                            class="he lg lh li lj b"><a href="https://visualstudio.microsoft.com/downloads/#build-tools-for-visual-studio-2019" class="bq ke" rel="noopener nofollow">https://visualstudio.microsoft.com/downloads/#build-tools-for-visual-studio-2019</a></code>
                                    </p>
                                    <figure class="ll lm ln lo lp ge fv fw paragraph-image">
                
                                        <p><img src="https://lupyuen.github.io/images/legacy/r2.png" /></p>

                                    
                                    </figure>
                                    <p id="be88"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        2️⃣ Click the <code class="he lg lh li lj b">Individual Components</code> tab
                                    </p>
                                    <p id="54e7"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        Select the following components:</p>
                                    <ol class="">
                                        <li id="3528"
                                            class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc lw lx ly el">
                                            <code class="he lg lh li lj b">Windows 10 SDK (10.0.18362.0)</code></li>
                                        <li id="d511"
                                            class="jj jk hq jl b jm lz jn jo jp ma jq jr js mb jt ju jv mc jw jx jy md jz ka kc lw lx ly el">
                                            <code class="he lg lh li lj b">C++ CMake Tools for Windows</code></li>
                                        <li id="fe64"
                                            class="jj jk hq jl b jm lz jn jo jp ma jq jr js mb jt ju jv mc jw jx jy md jz ka kc lw lx ly el">
                                            (This should be automatically selected) <code
                                                class="he lg lh li lj b">MSVC v142 — VS 2019 C++ x64/x86 Build Tools</code>
                                        </li>
                                    </ol>
                                    <p id="6001"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        3️⃣ Install <code class="he lg lh li lj b">rustup</code> according to the
                                        instructions here:<br /><code
                                            class="he lg lh li lj b"><a href="https://rustup.rs" class="bq ke" rel="noopener nofollow">https://rustup.rs</a></code>
                                    </p>
                                    <p id="b5c6"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        Click the link provided to download <code
                                            class="he lg lh li lj b">rustup‑init.exe</code></p>
                                    <p id="59e6"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        Launch the downloaded file <code class="he lg lh li lj b">rustup‑init.exe</code>
                                    </p>
                                    <p id="9b61"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        If you see the message “<code
                                            class="he lg lh li lj b">Windows Defender SmartScreen prevented an unrecognised app from starting</code>”…
                                    </p>
                                    <p id="5910"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        Cli<span id="rmm">c</span>k <code class="he lg lh li lj b">More Info</code></p>
                                    <p id="669a"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        Click <code class="he lg lh li lj b">Run Anyway</code></p>
                                    <p id="b628"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        4️⃣ At the <code class="he lg lh li lj b">Welcome to Rust!</code> prompt, press
                                        Enter to select the default option:<br /><code
                                            class="he lg lh li lj b">1) Proceed with installation (default)</code></p>
                                    <p id="f14f"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        5️⃣ Open the Windows Command Prompt. Enter into the command prompt:</p>
                                    <pre
                                        class="ll lm ln lo lp me mf mg"><span id="0e46" class="el mh kg hq lj b dk mi mj s mk">rustup default nightly<br/>rustup update<br/>rustup target add thumbv7m-none-eabi<br/>rustup target add thumbv7em-none-eabihf<br/>rustc -V</span></pre>
                                    <p id="cbad"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        The reported version of rustc should be 1.38.0 or later:</p>
                                    <p id="8482"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        <code
                                            class="he lg lh li lj b">rustc 1.38.0-nightly (435236b88 2019–08–01)</code>
                                    </p>
                                    <h1 id="6a41"
                                        class="kf kg hq av kh ki kj jn kk kl km jq kn ko kp kq kr ks kt ku kv kw kx ky kz la el">
                                        Install Source Files and Build The Firmware</h1>
                                    <p id="5ed6"
                                        class="jj jk hq jl b jm lb jn jo jp lc jq jr js ld jt ju jv le jw jx jy lf jz ka kc dj el">
                                        1️⃣ Download the <code
                                            class="he lg lh li lj b">stm32bluepill-mynewt-sensor.7z</code> file attached
                                        below…<br /><code
                                            class="he lg lh li lj b"><a href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/releases/tag/v9.0.0" class="bq ke" rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/releases/tag/v9.0.0</a></code>
                                    </p>
                                    <p id="7387"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        Expand the <code class="he lg lh li lj b">.7z</code> file with 7zip…<br /><code
                                            class="he lg lh li lj b"><a href="https://www.7-zip.org/download.html" class="bq ke" rel="noopener nofollow">https://www.7-zip.org/download.html</a></code>
                                    </p>
                                    <p id="d7b6"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        2️⃣ Install Arm Cross-Compiler and Linker for Windows from Arm Developer
                                        Website…<br /><code
                                            class="he lg lh li lj b"><a href="https://developer.arm.com/-/media/Files/downloads/gnu-rm/8-2019q3/RC1.1/gcc-arm-none-eabi-8-2019-q3-update-win32-sha1.exe?revision=fcadabed-d946-49dc-8f78-0732d2f43773?product=GNU%20Arm%20Embedded%20Toolchain,32-bit,,Windows,8-2019-q3-update" class="bq ke" rel="noopener nofollow">https://developer.arm.com/-/media/Files/downloads/gnu-rm/8-2019q3/RC1.1/gcc-arm-none-eabi-8-2019-q3-update-win32-sha1.exe?revision=fcadabed-d946-49dc-8f78-0732d2f43773?product=GNU%20Arm%20Embedded%20Toolchain,32-bit,,Windows,8-2019-q3-update</a></code>
                                    </p>
                                    <p id="a951"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        Select this option at the last install step:<br /><code
                                            class="he lg lh li lj b">&quot;Add path to environment variable&quot;</code>
                                    </p>
                                    <p id="8abf"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        3️⃣ Download the ST-Link USB driver from ST-Link Driver Website (email
                                        registration required)…<br /><code
                                            class="he lg lh li lj b"><a href="https://www.st.com/en/development-tools/stsw-link009.html" class="bq ke" rel="noopener nofollow">https://www.st.com/en/development-tools/stsw-link009.html</a></code>
                                    </p>
                                    <p id="a090"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        Click <code class="he lg lh li lj b">Get Software</code><br />Unzip the
                                        downloaded file. Double-click the driver installer:<br /><code
                                            class="he lg lh li lj b">dpinst_amd64.exe</code></p>
                                    <p id="134a"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        4️⃣ Install Windows Studio Code:<br /><code
                                            class="he lg lh li lj b"><a href="https://code.visualstudio.com/" class="bq ke" rel="noopener nofollow">https://code.visualstudio.com/</a></code>
                                    </p>
                                    <p id="c108"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        Launch Visual Studio Code</p>
                                    <p id="bef9"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        Install the extension “<code
                                            class="he lg lh li lj b">Cortex-Debug</code>”…<br /><code
                                            class="he lg lh li lj b"><a href="https://marketplace.visualstudio.com/items?itemName=marus25.cortex-debug" class="bq ke" rel="noopener nofollow">https://marketplace.visualstudio.com/items?itemName=marus25.cortex-debug</a></code>
                                    </p>
                                    <p id="2ea2"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        5️⃣ Click <code class="he lg lh li lj b">File → Open Folder</code><br />Select
                                        the downloaded folder <code
                                            class="he lg lh li lj b">stm32bluepill-mynewt-sensor</code></p>
                                    <figure class="ll lm ln lo lp ge fv fw paragraph-image">
                
                                        <p><img src="https://lupyuen.github.io/images/legacy/r3.png" /></p>

                                       
                                    </figure>
                                    <p id="7b13"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        When prompted to open the workspace, click <code
                                            class="he lg lh li lj b">Open Workspace</code></p>
                                    <p id="fba7"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        6️⃣ <strong class="jl cw"><em class="kd">If you have a Quectel NB-IoT
                                                module…</em></strong></p>
                                    <p id="a37a"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        Open the following file and configure the program settings:<br /><code
                                            class="he lg lh li lj b"><a href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/l476/targets/stm32l4_my_sensor/syscfg.yml" class="bq ke" rel="noopener nofollow">targets/stm32l4_my_sensor/syscfg.yml</a></code>
                                    </p>
                                    <p id="c55c"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        Change the NB-IoT band setting <code class="he lg lh li lj b">NBIOT_BAND</code>.
                                        Check with your NB-IoT operator for the band to use. The other settings are
                                        documented below.</p>
                                    <figure class="ll lm ln lo lp ge fv fw paragraph-image">
                

                
                                        <p><img src="https://lupyuen.github.io/images/legacy2/h0.png" /></p>

                                   
                                    </figure>
                                    <p id="7444"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        7️⃣ Click <code
                                            class="he lg lh li lj b">Terminal → Run Task → [1] Build Bootloader</code><br />This
                                        builds the bootloader, which starts the Apache Mynewt operating system upon
                                        startup. If it shows errors, compare with <a
                                            href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/l476/logs/build-bootloader.log"
                                            class="bq ke" rel="noopener nofollow">this build log</a>.</p>
                                    <p id="4893"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        Click <code
                                            class="he lg lh li lj b">Terminal → Run Task → [2] Build Application</code><br />This
                                        builds the firmware containing our Rust program. Compare with <a
                                            href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/l476/logs/build-application.log"
                                            class="bq ke" rel="noopener nofollow">this build log</a>.</p>
                                    <p id="a359"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        When our Rust program has been successfully compiled as STM32 ROM firmware, we
                                        should see this…</p>
                                    <figure class="ll lm ln lo lp ge fv fw paragraph-image">
                
                                        <p><img src="https://lupyuen.github.io/images/legacy/r4.png" /></p>

                                    
                                    </figure>
                                    <p id="fb99"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        If you see the message <code
                                            class="he lg lh li lj b">Undefined reference to main</code>, rebuild the
                                        application by clicking <code
                                            class="he lg lh li lj b">Terminal → Run Task → [2] Build Application</code>
                                    </p>
                                    <p id="8c72"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        Click <code
                                            class="he lg lh li lj b">Terminal → Run Task → [3] Image Application</code><br />This
                                        creates the flash image from the firmware. Compare with <a
                                            href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/l476/logs/image.log"
                                            class="bq ke" rel="noopener nofollow">this image log</a>.</p>
                                    <p id="9351"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        If any source files or configuration files are changed, rebuild the application
                                        by clicking <code
                                            class="he lg lh li lj b">Terminal → Run Task → [2] Build Application</code>
                                    </p>
                                    <h1 id="8871"
                                        class="kf kg hq av kh ki kj jn kk kl km jq kn ko kp kq kr ks kt ku kv kw kx ky kz la el">
                                        Flash The Firmware</h1>
                                    <p id="8bcd"
                                        class="jj jk hq jl b jm lb jn jo jp lc jq jr js ld jt ju jv le jw jx jy lf jz ka kc dj el">
                                        The next step is to flash the firmware into ROM. We’ll need to connect the STM32
                                        L476 board to the USB port of our computer via an <a
                                            href="https://www.aliexpress.com/wholesale?catId=0&amp;initiative_id=SB_20180924134644&amp;SearchText=st-link+v2&amp;switch_new_app=y"
                                            class="bq ke" rel="noopener nofollow">ST-Link V2 adapter</a>.</p>
                                    <p id="dee2"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        1️⃣ Check that the STM32 L476 board is connected to ST-Link… And that the
                                        ST-Link is connected to your computer’s USB port.</p>
                                    <p id="b3c2"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        2️⃣ Click <code
                                            class="he lg lh li lj b">Terminal → Run Task → [4] Load Bootloader</code>
                                    </p>
                                    <p id="a933"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        This flashes the bootloader, to start the Apache Mynewt operating system upon
                                        startup. If it shows errors, compare with <a
                                            href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/l476/logs/load-bootloader.log"
                                            class="bq ke" rel="noopener nofollow">this flash log</a>.</p>
                                    <p id="4a5f"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        3️⃣ Click <code
                                            class="he lg lh li lj b">Terminal → Run Task → [5] Load Application</code>
                                    </p>
                                    <p id="6784"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        This flashes the application firmware. If it shows errors, compare with <a
                                            href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/l476/logs/load-application.log"
                                            class="bq ke" rel="noopener nofollow">this flash log</a>.</p>
                                </div>
                            </div>
                        </section>
                        <div class="n p ct mr ms mt" role="separator"><span class="mu cf ef mv mw mx"></span><span
                                class="mu cf ef mv mw mx"></span><span class="mu cf ef mv mw"></span></div>
                        <section class="dj gb gc de gd">
                            <div class="n p">
                                <div class="aj ak al am an ho ap w">
                                    <h1 id="bb03"
                                        class="kf kg hq av kh ki my jn kk kl mz jq kn ko na kq kr ks nb ku kv kw nc ky kz la el">
                                        Run The Program</h1>
                                    <p id="aaf6"
                                        class="jj jk hq jl b jm lb jn jo jp lc jq jr js ld jt ju jv le jw jx jy lf jz ka kc dj el">
                                        1️⃣ Click <code class="he lg lh li lj b">Debug → Start Debugging</code></p>
                                    <figure
                                        class="ll lm ln lo lp ge ne nf fc ng nh ni nj nk bg mt nl nm nn no dy paragraph-image"> 

                                        <p><img src="https://lupyuen.github.io/images/legacy/r5.png" /></p>


                                    </figure>
                                    <p id="05eb"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        2️⃣ Click <code class="he lg lh li lj b">View → Output</code></p>
                                    <p id="5ec5"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        Select <code class="he lg lh li lj b">Adapter Output</code> to see the Console
                                        Log of debug messages generated by our program</p>
                                    <figure class="ll lm ln lo lp ge fv fw paragraph-image">
                
                                        <p><img src="https://lupyuen.github.io/images/legacy/a0.png" /></p>

                           
                                    </figure>
                                    <figure class="hk ge ne nf fc ng nh ni nj nk bg mt nl nm nn no dy paragraph-image">
                
                                        <p><img src="https://lupyuen.github.io/images/legacy/r6.png" /></p>

                                    
                                    </figure>
                                    <p id="91cc"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        3️⃣ The debugger pauses at the line with <code
                                            class="he lg lh li lj b">LoopCopyDataInit</code></p>
                                    <p id="2598"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        Click <code class="he lg lh li lj b">Continue</code> or press <code
                                            class="he lg lh li lj b">F5</code></p>
                                    <figure class="ll lm ln lo lp ge fv fw paragraph-image">
                
                                        <p><img src="https://lupyuen.github.io/images/legacy/a0.png" /></p>

                                     
                                    </figure>
                                    <figure class="hk ge ne nf fc ng nh ni nj nk bg mt nl nm nn no dy paragraph-image">
                
                                        <p><img src="https://lupyuen.github.io/images/legacy/r7.png" /></p>

                                      
                                    </figure>
                                    <p id="cc81"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        4️⃣ The debugger pauses next at the <code class="he lg lh li lj b">main()</code>
                                        function.</p>
                                    <p id="1590"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        Click <code class="he lg lh li lj b">Continue</code> or press <code
                                            class="he lg lh li lj b">F5</code></p>
                                    <figure class="ll lm ln lo lp ge fv fw paragraph-image">
                
                                        <p><img src="https://lupyuen.github.io/images/legacy/a0.png" /></p>

                                     
                                    </figure>
                                    <p id="fb4b"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        <a href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/l476/logs/standalone-node.log"
                                            class="bq ke" rel="noopener nofollow">The Console Log should look like
                                            this</a>.</p>
                                </div>
                            </div>
                        </section>
                        <div class="n p ct mr ms mt" role="separator"><span class="mu cf ef mv mw mx"></span><span
                                class="mu cf ef mv mw mx"></span><span class="mu cf ef mv mw"></span></div>
                        <section class="dj gb gc de gd">
                            <div class="n p">
                                <div class="aj ak al am an ho ap w">
                                    <h1 id="e9cb"
                                        class="kf kg hq av kh ki my jn kk kl mz jq kn ko na kq kr ks nb ku kv kw nc ky kz la el">
                                        Rust Source Files</h1>
                                    <figure
                                        class="ll lm ln lo lp ge ne nf fc ng nh ni nj nk bg mt nl nm nn no dy paragraph-image">
                                                        
                                        <p><img src="https://lupyuen.github.io/images/legacy/r8.png" /></p>


                                    
                                    </figure>
                                    <p id="4aed"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        The Rust source files are located in the <code
                                            class="he lg lh li lj b">rust</code> folder…</p>
                                    <p id="f8ba"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        <code class="he lg lh li lj b">rust/app</code>: Rust application that polls the
                                        internal temperature and GPS sensors and transmits the sensor data over NB-IoT
                                    </p>
                                    <p id="52b9"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        <code class="he lg lh li lj b">rust/visual</code>: Sample <a class="bq ke"
                                            rel="noopener"
                                            href="/@ly.lee/visual-embedded-rust-programming-with-visual-studio-code-1bc1262e398c">Visual
                                            Embedded Rust</a> program. Not used in this tutorial.</p>
                                    <p id="2610"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        <code class="he lg lh li lj b">rust/mynewt</code>: Rust Safe Wrappers for Mynewt
                                        OS and libraries</p>
                                    <p id="7acc"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        <code class="he lg lh li lj b">rust/macros</code>: Rust Procedural Macros for
                                        generating Safe Wrappers and other utility macros like <code
                                            class="he lg lh li lj b">strn!()</code></p>
                                    <figure class="ll lm ln lo lp ge fv fw paragraph-image">

                
                                        <p><img src="https://lupyuen.github.io/images/legacy2/h0.png" /></p>

                                  
                                    </figure>
                                    <h1 id="173f"
                                        class="kf kg hq av kh ki kj jn kk kl km jq kn ko kp kq kr ks kt ku kv kw kx ky kz la el">
                                        Optional: Install Rust Language Server</h1>
                                    <p id="c97b"
                                        class="jj jk hq jl b jm lb jn jo jp lc jq jr js ld jt ju jv le jw jx jy lf jz ka kc dj el">
                                        To get full Rust Language Support for editing Rust source files in Visual Studio
                                        Code, you may install <a href="https://github.com/rust-lang/rls-vscode"
                                            class="bq ke" rel="noopener nofollow"><strong class="jl cw">Rust Language
                                                Server</strong></a>…</p>
                                    <p id="c103"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        1️⃣ In Visual Studio Code, browse to a Rust file like <code
                                            class="he lg lh li lj b">rust/app/src/lib.rs</code></p>
                                    <figure
                                        class="ll lm ln lo lp ge ne nf fc ng nh ni nj nk bg mt nl nm nn no dy paragraph-image">    

                                        <p><img src="https://lupyuen.github.io/images/legacy/r9.png" /></p>


                                     
                                    </figure>
                                    <p id="20bd"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        2️⃣ When prompted to install RLS, click <code
                                            class="he lg lh li lj b">Yes</code></p>
                                    <figure class="ll lm ln lo lp ge fv fw paragraph-image">

                
                                        <p><img src="https://lupyuen.github.io/images/legacy2/h0.png" /></p>

                              
                                    </figure>
                                    <figure class="hk ge ne nf fc ng nh ni nj nk bg mt nl nm nn no dy paragraph-image">
                
                                        <p><img src="https://lupyuen.github.io/images/legacy/r10.png" /></p>

                                 
                                    </figure>
                                    <p id="1da9"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        3️⃣ Good Luck! Sometimes the RLS installation fails with this message because we
                                        are using the nightly build…</p>
                                    <figure class="ll lm ln lo lp ge fv fw paragraph-image">

                
                                        <p><img src="https://lupyuen.github.io/images/legacy2/h0.png" /></p>

                                      
                                    </figure>
                                    <h1 id="5af2"
                                        class="kf kg hq av kh ki kj jn kk kl km jq kn ko kp kq kr ks kt ku kv kw kx ky kz la el">
                                        Optional: Program Settings</h1>
                                    <p id="e758"
                                        class="jj jk hq jl b jm lb jn jo jp lc jq jr js ld jt ju jv le jw jx jy lf jz ka kc dj el">
                                        The program settings may be found in the file <code
                                            class="he lg lh li lj b"><a href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/l476/targets/stm32l4_my_sensor/syscfg.yml" class="bq ke" rel="noopener nofollow">targets/stm32l4_my_sensor/syscfg.yml</a></code>
                                    </p>
                                    <figure class="ll lm ln lo lp ge ne nf fc ng nh ni nj nk bg mt oc od oe of dy">
                                        
                                        <p><script src="https://gist.github.com/lupyuen/b5a8b097532a3d083c2119a5fbf40303.js"></script></p>
                      
                                        <figcaption class="hk hl fx fv fw hm hn av b aw ax ay">Program Settings. From <a
                                                href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/l476/targets/stm32l4_my_sensor/syscfg.yml"
                                                class="bq ke"
                                                rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/l476/targets/stm32l4_my_sensor/syscfg.yml</a>
                                        </figcaption>
                                    </figure>
                                    <p id="1b69"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        <code class="he lg lh li lj b">COAP_HOST, COAP_PORT</code>: The program will
                                        send CoAP messages to this IP address and port number, which defaults to the
                                        CoAP server at thethings.io.</p>
                                    <p id="02ff"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        Keep the default settings if you wish to view your sensor data at <code
                                            class="he lg lh li lj b">blue-pill-geolocate.appspot.com</code>.</p>
                                    <p id="342c"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        Change the setting to use your own CoAP server instead of thethings.io</p>
                                    <p id="7ebb"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        <code class="he lg lh li lj b">COAP_URI</code>: The CoAP message will be
                                        delivered to this URI at the CoAP server (which defaults to thethings.io).</p>
                                    <p id="bc0a"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        Keep the default settings if you wish to view your sensor data at <code
                                            class="he lg lh li lj b">blue-pill-geolocate.appspot.com</code>.</p>
                                    <p id="bfa4"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        For thethings.io, the last part <code class="he lg lh li lj b">IVRi…</code> is
                                        the Thing Token. If you wish to send sensor data to your own Thing at
                                        thethings.io, replace the last part of the URI with your Thing Token.</p>
                                    <p id="4ea0"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        For the purpose of NB-IoT Education, I’ll allow you to transmit sensor data to
                                        the Thing Token <code class="he lg lh li lj b">IVRi…</code> from my personal,
                                        paid thethings.io account. Which will forward the sensor data to <code
                                            class="he lg lh li lj b">blue-pill-geolocate.appspot.com</code> for viewing.
                                    </p>
                                    <p id="30aa"
                                        class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc dj el">
                                        <code class="he lg lh li lj b">NBIOT_BAND</code>: The program connects to this
                                        <a href="http://www.techplayon.com/nb-iot-frequency-bands-as-per-3gpp-rel-13-14-and-15/"
                                            class="bq ke" rel="noopener nofollow">NB-IoT Frequency Band</a>. The
                                        Frequency Band depends on your country and your NB-IoT network operator. Check
                                        with your NB-IoT network operator for the Frequency Band to use.</p>
                                    <figure class="ll lm ln lo lp ge fv fw paragraph-image">
                
                                        <p><img src="https://lupyuen.github.io/images/legacy/r11.png" /></p>

                                     
                                        <figcaption class="hk hl fx fv fw hm hn av b aw ax ay">NB-IoT Frequency Bands
                                            for Singapore. From <a
                                                href="https://www.imda.gov.sg/-/media/imda/files/regulation-licensing-and-consultations/frameworks-and-policies/spectrum-management-and-coordination/spectrummgmthb.pdf"
                                                class="bq ke"
                                                rel="noopener nofollow">https://www.imda.gov.sg/-/media/imda/files/regulation-licensing-and-consultations/frameworks-and-policies/spectrum-management-and-coordination/spectrummgmthb.pdf</a>
                                        </figcaption>
                                    </figure>
                                    <figure class="ll lm ln lo lp ge fv fw paragraph-image">
                
                                        <p><img src="https://lupyuen.github.io/images/legacy/r12.png" /></p>

                                   
                                        <figcaption class="hk hl fx fv fw hm hn av b aw ax ay">NB-IoT Frequency Bands
                                            for Singapore. From <a
                                                href="https://www.imda.gov.sg/-/media/imda/files/regulation-licensing-and-consultations/ict-standards/telecommunication-standards/radio-comms/imda-ts-iot.pdf"
                                                class="bq ke"
                                                rel="noopener nofollow">https://www.imda.gov.sg/-/media/imda/files/regulation-licensing-and-consultations/ict-standards/telecommunication-standards/radio-comms/imda-ts-iot.pdf</a>
                                        </figcaption>
                                    </figure>
                                </div>
                            </div>
                        </section>
                        <div class="n p ct mr ms mt" role="separator"><span class="mu cf ef mv mw mx"></span><span
                                class="mu cf ef mv mw mx"></span><span class="mu cf ef mv mw"></span></div>
                        <section class="dj gb gc de gd">
                            <div class="n p">
                                <div class="aj ak al am an ho ap w">
                                    <h1 id="c1bb"
                                        class="kf kg hq av kh ki my jn kk kl mz jq kn ko na kq kr ks nb ku kv kw nc ky kz la el">
                                        References</h1>
                                    <p id="ebcf"
                                        class="jj jk hq jl b jm lb jn jo jp lc jq jr js ld jt ju jv le jw jx jy lf jz ka kc dj el">
                                        The following files may be useful for reference…</p>
                                    <ul class="">
                                        <li id="6b03"
                                            class="jj jk hq jl b jm lr jn jo jp ls jq jr js lt jt ju jv lu jw jx jy lv jz ka kc ol lx ly el">
                                            <a href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/l476/logs/libapp-demangle.S"
                                                class="bq ke" rel="noopener nofollow">Disassembly of the Rust
                                                Application build</a></li>
                                        <li id="b065"
                                            class="jj jk hq jl b jm lz jn jo jp ma jq jr js mb jt ju jv mc jw jx jy md jz ka kc ol lx ly el">
                                            <a href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/l476/logs/rustlib-demangle.S"
                                                class="bq ke" rel="noopener nofollow">Disassembly of the Rust Crates</a>
                                        </li>
                                        <li id="3008"
                                            class="jj jk hq jl b jm lz jn jo jp ma jq jr js mb jt ju jv mc jw jx jy md jz ka kc ol lx ly el">
                                            <a href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/l476/logs/my_sensor_app.elf.lst"
                                                class="bq ke" rel="noopener nofollow">Disassembly of the firmware</a>
                                        </li>
                                        <li id="d59d"
                                            class="jj jk hq jl b jm lz jn jo jp ma jq jr js mb jt ju jv mc jw jx jy md jz ka kc ol lx ly el">
                                            <a href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/l476/logs/my_sensor_app.elf.map"
                                                class="bq ke" rel="noopener nofollow">Memory map of the firmware</a>
                                        </li>
                                        <li id="ea50"
                                            class="jj jk hq jl b jm lz jn jo jp ma jq jr js mb jt ju jv mc jw jx jy md jz ka kc ol lx ly el">
                                            <a href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/l476/logs/boot_stub.elf.lst"
                                                class="bq ke" rel="noopener nofollow">Disassembly of the bootloader</a>
                                        </li>
                                        <li id="d551"
                                            class="jj jk hq jl b jm lz jn jo jp ma jq jr js mb jt ju jv mc jw jx jy md jz ka kc ol lx ly el">
                                            <a href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/l476/logs/boot_stub.elf.map"
                                                class="bq ke" rel="noopener nofollow">Memory map of the bootloader</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </section>
                    </div>
                </article>
            </div>
        </div>
    </div>
</body>

</html>