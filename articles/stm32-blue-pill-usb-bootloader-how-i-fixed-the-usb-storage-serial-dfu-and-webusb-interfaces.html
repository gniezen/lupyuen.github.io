<!doctype html>
<html lang="en">

<head>
  <script src="//archive.org/includes/analytics.js?v=cf34f82" type="text/javascript"></script>
  <script
    type="text/javascript">window.addEventListener('DOMContentLoaded', function () { var v = archive_analytics.values; v.service = 'wb'; v.server_name = 'wwwb-app200.us.archive.org'; v.server_ms = 442; archive_analytics.send_pageview({}); });</script>
  <script type="text/javascript" src="/_static/js/playback.bundle.js?v=bQvHU8mx" charset="utf-8"></script>
  <script type="text/javascript" src="/_static/js/wombat.js?v=cRqOKCOw" charset="utf-8"></script>
  <script type="text/javascript">
    __wm.init("https://web.archive.org/web");
    __wm.wombat("https://medium.com/@ly.lee/stm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c?source=friends_link&sk=70a29cd31425ec4d03144bce14a1c922", "20191204194248", "https://web.archive.org/", "web", "/_static/",
      "1575488568");
  </script>
  <link rel="stylesheet" type="text/css" href="/_static/css/banner-styles.css?v=bsmaklHF" />
  <link rel="stylesheet" type="text/css" href="/_static/css/iconochive.css?v=qtvMKcIJ" />
  <!-- End Wayback Rewrite JS Include -->
  <script>!function (c, f) { var t, o, i, e = [], r = { passive: !0, capture: !0 }, n = new Date, a = "pointerup", u = "pointercancel"; function p(n, e) { t || (t = e, o = n, i = new Date, w(f), s()) } function s() { 0 <= o && o < i - n && (e.forEach(function (n) { n(o, t) }), e = []) } function l(n) { if (n.cancelable) { var e = (1e12 < n.timeStamp ? new Date : performance.now()) - n.timeStamp; "pointerdown" == n.type ? function (n, e) { function t() { p(n, e), i() } function o() { i() } function i() { f(a, t, r), f(u, o, r) } c(a, t, r), c(u, o, r) }(e, n) : p(e, n) } } function w(e) { ["click", "mousedown", "keydown", "touchstart", "pointerdown"].forEach(function (n) { e(n, l, r) }) } w(c), self.perfMetrics = self.perfMetrics || {}, self.perfMetrics.onFirstInputDelay = function (n) { e.push(n), s() } }(addEventListener, removeEventListener)</script>
  <title data-rh="true">STM32 Blue Pill USB Bootloader — How I fixed the USB Storage, Serial, DFU and WebUSB interfaces
  </title>
  <meta data-rh="true" charset="utf-8" />
  <meta data-rh="true" name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1" />
  <meta data-rh="true" name="theme-color" content="#000000" />
  <meta data-rh="true" name="twitter:app:name:iphone" content="Medium" />
  <meta data-rh="true" name="twitter:app:id:iphone" content="828256236" />
  <meta data-rh="true" property="al:ios:app_name" content="Medium" />
  <meta data-rh="true" property="al:ios:app_store_id" content="828256236" />
  <meta data-rh="true" property="al:android:package" content="com.medium.reader" />
  <meta data-rh="true" property="fb:app_id" content="542599432471018" />
  <meta data-rh="true" property="og:site_name" content="Medium" />
  <meta data-rh="true" property="og:type" content="article" />
  <meta data-rh="true" property="article:published_time" content="2019-04-03T22:49:55.131Z" />
  <meta data-rh="true" name="title"
    content="STM32 Blue Pill USB Bootloader — How I fixed the USB Storage, Serial, DFU and WebUSB interfaces" />
  <meta data-rh="true" property="og:title"
    content="STM32 Blue Pill USB Bootloader —  How I fixed the USB Storage, Serial, DFU and WebUSB interfaces" />
  <meta data-rh="true" property="twitter:title"
    content="STM32 Blue Pill USB Bootloader —  How I fixed the USB Storage, Serial, DFU and WebUSB interfaces" />
  <meta data-rh="true" name="twitter:site" content="@Medium" />
  <meta data-rh="true" name="twitter:app:url:iphone" content="medium://p/36d7fe245b5c" />
  <meta data-rh="true" property="al:android:url" content="medium://p/36d7fe245b5c" />
  <meta data-rh="true" property="al:ios:url" content="medium://p/36d7fe245b5c" />
  <meta data-rh="true" property="al:android:app_name" content="Medium" />
  <meta data-rh="true" name="description"
    content="Building a complex composite USB device with libopencm3 that works on Windows, Mac and Linux" />
  <meta data-rh="true" property="og:description"
    content="Building a complex composite USB device with libopencm3 that works on Windows, Mac and Linux" />
  <meta data-rh="true" property="twitter:description"
    content="Building a complex composite USB device with libopencm3 that works on Windows, Mac and Linux" />
  <meta data-rh="true" property="og:url"
    content="https://web.archive.org/web/20191204194248/https://medium.com/@ly.lee/stm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c" />
  <meta data-rh="true" property="al:web:url"
    content="https://medium.com/@ly.lee/stm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c" />
  <meta data-rh="true" property="og:image"
    content="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/1200/1*fjfoda1Ovwdahy09TwUkqA.png" />
  <meta data-rh="true" name="twitter:image:src"
    content="https://miro.medium.com/max/1200/1*fjfoda1Ovwdahy09TwUkqA.png" />
  <meta data-rh="true" name="twitter:card" content="summary_large_image" />
  <meta data-rh="true" property="article:author" content="https://medium.com/@ly.lee" />
  <meta data-rh="true" name="twitter:creator" content="@MisterTechBlog" />
  <meta data-rh="true" name="author" content="Lup Yuen Lee 李立源" />
  <meta data-rh="true" name="robots" content="index,follow" />
  <meta data-rh="true" name="referrer" content="unsafe-url" />
  <meta data-rh="true" name="twitter:label1" value="Reading time" />
  <meta data-rh="true" name="twitter:data1" value="14 min read" />
  <meta data-rh="true" name="parsely-post-id" content="36d7fe245b5c" />
  <link data-rh="true" rel="publisher" href="https://plus.google.com/103654360130207659246" />
  <link data-rh="true" rel="search" type="application/opensearchdescription+xml" title="Medium"
    href="/web/20191204194248/https://medium.com/osd.xml" />
  <link data-rh="true" rel="apple-touch-icon" sizes="152x152"
    href="https://web.archive.org/web/20191204194248im_/https://cdn-images-1.medium.com/fit/c/152/152/1*8I-HPL0bfoIzGied-dzOvA.png" />
  <link data-rh="true" rel="apple-touch-icon" sizes="120x120"
    href="https://web.archive.org/web/20191204194248im_/https://cdn-images-1.medium.com/fit/c/120/120/1*8I-HPL0bfoIzGied-dzOvA.png" />
  <link data-rh="true" rel="apple-touch-icon" sizes="76x76"
    href="https://web.archive.org/web/20191204194248im_/https://cdn-images-1.medium.com/fit/c/76/76/1*8I-HPL0bfoIzGied-dzOvA.png" />
  <link data-rh="true" rel="apple-touch-icon" sizes="60x60"
    href="https://web.archive.org/web/20191204194248im_/https://cdn-images-1.medium.com/fit/c/60/60/1*8I-HPL0bfoIzGied-dzOvA.png" />
  <link data-rh="true" rel="mask-icon"
    href="https://web.archive.org/web/20191204194248im_/https://cdn-static-1.medium.com/_/fp/icons/monogram-mask.KPLCSFEZviQN0jQ7veN2RQ.svg"
    color="#171717" />
  <link data-rh="true" rel="icon"
    href="https://web.archive.org/web/20191204194248im_/https://cdn-static-1.medium.com/_/fp/icons/favicon-rebrand-medium.3Y6xpZ-0FSdWDnPM3hSBIA.ico" />
  <link data-rh="true" id="glyph_link" rel="stylesheet" type="text/css"
    href="https://web.archive.org/web/20191204194248cs_/https://glyph.medium.com/css/e/sr/latin/e/ssr/latin/e/ssb/latin/m2.css" />
  <link data-rh="true" rel="author" href="https://medium.com/@ly.lee" />
  <link data-rh="true" rel="canonical"
    href="https://web.archive.org/web/20191204194248/https://medium.com/@ly.lee/stm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c" />
  <link data-rh="true" rel="alternate"
    href="https://web.archive.org/web/20191204194248/android-app://com.medium.reader/https/medium.com/p/36d7fe245b5c" />
  <script data-rh="true"
    type="application/ld+json">{"@context":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttp:\u002F\u002Fschema.org","@type":"NewsArticle","image":["https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fmiro.medium.com\u002Fmax\u002F1200\u002F1*fjfoda1Ovwdahy09TwUkqA.png"],"url":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fstm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c","dateCreated":"2018-12-17T19:25:02.825Z","datePublished":"2018-12-17T19:25:02.825Z","dateModified":"2019-04-03T22:49:55.131Z","headline":"STM32 Blue Pill USB Bootloader —  How I fixed the USB Storage, Serial, DFU and WebUSB interfaces","name":"STM32 Blue Pill USB Bootloader —  How I fixed the USB Storage, Serial, DFU and WebUSB interfaces","description":"Building a complex composite USB device with libopencm3 that works on Windows, Mac and Linux","identifier":"36d7fe245b5c","keywords":["Lite:true","Tag:USB","Tag:Stm32","Tag:Programming","Tag:Embedded Systems","Elevated:false","LockedPostSource:LOCKED_POST_SOURCE_NONE","LayerCake:4"],"author":{"@type":"Person","name":"Lup Yuen Lee 李立源","url":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee"},"creator":["Lup Yuen Lee 李立源"],"publisher":{"@type":"Organization","name":"Medium","url":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fmedium.com\u002F","logo":{"@type":"ImageObject","width":308,"height":60,"url":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fmiro.medium.com\u002Fmax\u002F616\u002F1*OMF3fSqH8t4xBJ9-6oZDZw.png"}},"mainEntityOfPage":"https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fstm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c"}</script>
  <script data-rh="true">(function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
          (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
          m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
      })(window, document, 'script', 'https://web.archive.org/web/20191204194248/https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-24232453-2', 'auto');
    ga('send', 'pageview');</script>
  <link rel="preload" href="https://web.archive.org/web/20191204194248/https://cdn.optimizely.com/js/16180790160.js"
    as="script">
  <style type="text/css" data-fela-rehydration="474" data-fela-type="STATIC">
    html {
      box-sizing: border-box
    }

    *,
    *:before,
    *:after {
      box-sizing: inherit
    }

    body {
      margin: 0;
      padding: 0;
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
      color: rgba(0, 0, 0, 0.8);
      position: relative;
      min-height: 100vh
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    dl,
    dd,
    ol,
    ul,
    menu,
    figure,
    blockquote,
    p,
    pre,
    form {
      margin: 0
    }

    menu,
    ol,
    ul {
      padding: 0;
      list-style: none;
      list-style-image: none
    }

    main {
      display: block
    }

    a {
      color: inherit;
      text-decoration: none
    }

    a,
    button,
    input {
      -webkit-tap-highlight-color: transparent
    }

    img,
    svg {
      vertical-align: middle
    }

    button {
      background: transparent;
      overflow: visible
    }

    button,
    input,
    optgroup,
    select,
    textarea {
      margin: 0
    }
  </style>
  <style type="text/css" data-fela-rehydration="474" data-fela-type="KEYFRAME">
    @-webkit-keyframes k1 {
      0% {
        transform: scale(1);
        opacity: 1
      }

      70% {
        transform: scale(1.4);
        opacity: 0
      }

      100% {
        opacity: 0
      }
    }

    @-moz-keyframes k1 {
      0% {
        transform: scale(1);
        opacity: 1
      }

      70% {
        transform: scale(1.4);
        opacity: 0
      }

      100% {
        opacity: 0
      }
    }

    @keyframes k1 {
      0% {
        transform: scale(1);
        opacity: 1
      }

      70% {
        transform: scale(1.4);
        opacity: 0
      }

      100% {
        opacity: 0
      }
    }
  </style>
  <style type="text/css" data-fela-rehydration="474" data-fela-type="RULE">
    .a {
      font-family: medium-content-sans-serif-font, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif
    }

    .b {
      font-weight: 400
    }

    .c {
      background-color: rgba(255, 255, 255, 1)
    }

    .l {
      height: 100vh
    }

    .m {
      width: 100vw
    }

    .n {
      display: flex
    }

    .o {
      align-items: center
    }

    .p {
      justify-content: center
    }

    .q {
      fill: rgba(0, 0, 0, 0.84)
    }

    .r {
      display: block
    }

    .s {
      position: fixed
    }

    .t {
      top: 0
    }

    .u {
      left: 0
    }

    .v {
      right: 0
    }

    .w {
      z-index: 500
    }

    .x {
      box-shadow: 0 4px 12px 0 rgba(0, 0, 0, 0.05)
    }

    .ai {
      max-width: 1192px
    }

    .aj {
      min-width: 0
    }

    .ak {
      width: 100%
    }

    .al {
      height: 65px
    }

    .ao {
      flex: 1 0 auto
    }

    .ap {
      display: none
    }

    .ar {
      flex: 0 0 auto
    }

    .as {
      visibility: hidden
    }

    .at {
      color: inherit
    }

    .au {
      fill: inherit
    }

    .av {
      font-size: inherit
    }

    .aw {
      border: inherit
    }

    .ax {
      font-family: inherit
    }

    .ay {
      letter-spacing: inherit
    }

    .az {
      font-weight: inherit
    }

    .ba {
      padding: 0
    }

    .bb {
      margin: 0
    }

    .bc:hover {
      cursor: pointer
    }

    .bd:hover {
      color: rgba(0, 0, 0, 0.9)
    }

    .be:hover {
      fill: rgba(0, 0, 0, 0.9)
    }

    .bf:focus {
      outline: none
    }

    .bg:disabled {
      cursor: default
    }

    .bh:disabled {
      color: rgba(0, 0, 0, 0.54)
    }

    .bi:disabled {
      fill: rgba(0, 0, 0, 0.54)
    }

    .bj {
      font-family: medium-content-sans-serif-font, "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", Geneva, Arial, sans-serif
    }

    .bk {
      font-style: normal
    }

    .bl {
      line-height: 20px
    }

    .bm {
      font-size: 15.8px
    }

    .bn {
      letter-spacing: 0px
    }

    .bo {
      color: rgba(0, 0, 0, 0.54)
    }

    .bp {
      fill: rgba(0, 0, 0, 0.54)
    }

    .bq {
      margin-left: 16px
    }

    .br {
      color: rgba(2, 158, 116, 1)
    }

    .bs {
      fill: rgba(3, 168, 124, 1)
    }

    .bt:hover {
      color: rgba(1, 143, 105, 1)
    }

    .bu:hover {
      fill: rgba(2, 158, 116, 1)
    }

    .bv:disabled {
      color: rgba(3, 168, 124, 0.5)
    }

    .bw:disabled {
      fill: rgba(3, 168, 124, 0.5)
    }

    .bx {
      padding: 8px 16px
    }

    .by {
      background: 0
    }

    .bz {
      border-color: rgba(3, 168, 124, 1)
    }

    .ca:hover {
      border-color: rgba(2, 158, 116, 1)
    }

    .cb {
      border-radius: 4px
    }

    .cc {
      border-width: 1px
    }

    .cd {
      border-style: solid
    }

    .ce {
      box-sizing: border-box
    }

    .cf {
      display: inline-block
    }

    .cg {
      text-decoration: none
    }

    .ch {
      margin-bottom: 0px
    }

    .cj {
      padding-left: 24px
    }

    .ck {
      padding-right: 24px
    }

    .cl {
      margin-left: auto
    }

    .cm {
      margin-right: auto
    }

    .cn {
      max-width: 728px
    }

    .co {
      flex-direction: column
    }

    .cp {
      position: absolute
    }

    .cq {
      top: calc(100vh + 100px)
    }

    .cr {
      bottom: calc(100vh + 100px)
    }

    .cs {
      width: 10px
    }

    .ct {
      pointer-events: none
    }

    .cu {
      word-break: break-word
    }

    .cv {
      word-wrap: break-word
    }

    .cw:after {
      display: block
    }

    .cx:after {
      content: ""
    }

    .cy:after {
      clear: both
    }

    .cz {
      clear: both
    }

    .da {
      margin-top: 0px
    }

    .db {
      opacity: 0
    }

    .dc {
      transition: opacity 100ms 400ms
    }

    .dd {
      height: 100%
    }

    .de {
      overflow: hidden
    }

    .df {
      will-change: transform
    }

    .dg {
      transform: translateZ(0)
    }

    .dh {
      margin: auto
    }

    .di {
      position: relative
    }

    .dj {
      background-color: rgba(0, 0, 0, 0.05)
    }

    .dk {
      padding-bottom: 56.25%
    }

    .dl {
      filter: blur(20px)
    }

    .dm {
      transform: scale(1.1)
    }

    .dn {
      visibility: visible
    }

    .do {
      background: rgba(255, 255, 255, 1)
    }

    .dp {
      font-size: 16px
    }

    .dq {
      line-height: 1.4
    }

    .dr {
      margin-top: 10px
    }

    .ds {
      text-align: center
    }

    .dv {
      font-weight: 300
    }

    .dw {
      max-width: 680px
    }

    .dx {
      line-height: 1.23
    }

    .dy {
      letter-spacing: 0
    }

    .dz {
      color: rgba(0, 0, 0, 0.84)
    }

    .ea {
      font-family: medium-content-title-font, Georgia, Cambria, "Times New Roman", Times, serif
    }

    .eb {
      font-size: 40px
    }

    .eh {
      margin-bottom: -0.27em
    }

    .ei {
      line-height: 48px
    }

    .ej {
      margin-top: 32px
    }

    .ek {
      justify-content: space-between
    }

    .eo {
      width: 48px
    }

    .ep {
      height: 48px
    }

    .eq {
      flex-direction: row
    }

    .er {
      width: calc(100% + 25px)
    }

    .es {
      height: calc(100% + 25px)
    }

    .et {
      top: 50%
    }

    .eu {
      left: 50%
    }

    .ev {
      transform: translateX(-50%) translateY(-50%)
    }

    .ew {
      border-radius: 50%
    }

    .ex {
      margin-left: 12px
    }

    .ey {
      margin-bottom: 2px
    }

    .fa {
      max-height: 20px
    }

    .fb {
      text-overflow: ellipsis
    }

    .fc {
      display: -webkit-box
    }

    .fd {
      -webkit-line-clamp: 1
    }

    .fe {
      -webkit-box-orient: vertical
    }

    .ff:hover {
      text-decoration: underline
    }

    .fg {
      margin-left: 8px
    }

    .fh {
      padding: 0px 8px
    }

    .fi {
      border-color: rgba(0, 0, 0, 0.54)
    }

    .fj:hover {
      color: rgba(0, 0, 0, 0.97)
    }

    .fk:hover {
      fill: rgba(0, 0, 0, 0.97)
    }

    .fl:hover {
      border-color: rgba(0, 0, 0, 0.84)
    }

    .fm:disabled {
      fill: rgba(0, 0, 0, 0.76)
    }

    .fn:disabled {
      border-color: rgba(0, 0, 0, 0.2)
    }

    .fo:disabled {
      cursor: inherit
    }

    .fp:disabled:hover {
      color: rgba(0, 0, 0, 0.54)
    }

    .fq:disabled:hover {
      fill: rgba(0, 0, 0, 0.76)
    }

    .fr:disabled:hover {
      border-color: rgba(0, 0, 0, 0.2)
    }

    .fs {
      line-height: 18px
    }

    .ft {
      font-size: 15px
    }

    .fu {
      align-items: flex-end
    }

    .gc {
      padding-right: 8px
    }

    .gd {
      margin-right: -6px
    }

    .ge {
      line-height: 1.58
    }

    .gf {
      letter-spacing: -0.004em
    }

    .gg {
      font-family: medium-content-serif-font, Georgia, Cambria, "Times New Roman", Times, serif
    }

    .gr {
      margin-bottom: -0.46em
    }

    .gs {
      background-repeat: repeat-x
    }

    .gt {
      background-image: linear-gradient(to right, rgba(0, 0, 0, 0.84) 100%, rgba(0, 0, 0, 0.84) 0);
      background-image: url('data:image/svg+xml;utf8,<svg preserveAspectRatio="none" viewBox="0 0 1 1" xmlns="http://www.w3.org/2000/svg"><line x1="0" y1="0" x2="1" y2="1" stroke="rgba(0, 0, 0, 0.84)" /></svg>')
    }

    .gu {
      background-size: 1px 1px
    }

    .gv {
      background-position: 0 1.05em;
      background-position: 0 calc(1em + 1px)
    }

    .hb {
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1), inset 0 0 0 1px rgba(0, 0, 0, 0.1)
    }

    .hc {
      max-height: 40px
    }

    .hd {
      -webkit-line-clamp: 2
    }

    .he {
      padding: 0px
    }

    .hu {
      padding: 16px 20px
    }

    .hv {
      flex: 1 1 auto
    }

    .hx {
      font-weight: 600
    }

    .hy {
      font-size: 18px
    }

    .hz {
      margin-top: 8px
    }

    .ia {
      margin-top: 12px
    }

    .ib {
      width: 160px
    }

    .ic {
      background-image: url(https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/320/0*6Yh4um9qbSlQjW3d)
    }

    .id {
      background-origin: border-box
    }

    .ie {
      background-size: cover
    }

    .if {
      height: 167px
    }

    .ig {
      background-position: 50% 50%
    }

    .ih {
      max-width: 100%
    }

    .ii {
      box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.1)
    }

    .ij {
      font-family: medium-content-slab-serif-font, Georgia, Cambria, "Times New Roman", Times, serif
    }

    .ik {
      font-size: 28px
    }

    .il {
      border: none
    }

    .im {
      margin-top: 30px
    }

    .in:before {
      content: "..."
    }

    .io:before {
      letter-spacing: 0.6em
    }

    .ip:before {
      text-indent: 0.6em
    }

    .iq:before {
      font-style: italic
    }

    .ir:before {
      line-height: 1.4
    }

    .is {
      line-height: 1.12
    }

    .it {
      letter-spacing: -0.022em
    }

    .je {
      margin-bottom: -0.28em
    }

    .jk {
      background-image: url(https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/320/0*dzqLBS1jPrWWixzq)
    }

    .jl {
      background-image: url(https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/320/0*D1A20q3EzpBI8gq9)
    }

    .jm {
      max-width: 400px
    }

    .js {
      padding-bottom: 126.25%
    }

    .jy {
      background-image: url(https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/320/0*NoY4wyKCio5_awGy)
    }

    .jz {
      background-image: url(https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/320/0*QjfIWiNSUFsBds1T)
    }

    .ka {
      max-width: 719px
    }

    .kb {
      transition: transform 300ms cubic-bezier(0.2, 0, 0.2, 1)
    }

    .kc {
      cursor: zoom-in
    }

    .kd {
      z-index: auto
    }

    .ke {
      padding-bottom: 83.1710709318498%
    }

    .kf {
      max-width: 1095px
    }

    .kg {
      border-width: 2px
    }

    .kh {
      border-color: rgba(255, 255, 255, 1)
    }

    .ki {
      float: left
    }

    .kj {
      margin-left: -150px
    }

    .kk {
      margin-right: 30px
    }

    .kl {
      width: 75%
    }

    .km {
      padding-bottom: 10px
    }

    .kr {
      margin-bottom: 16px
    }

    .ks {
      padding-bottom: 82.92237442922374%
    }

    .kt {
      font-weight: 700
    }

    .ku {
      padding: 2px 4px
    }

    .kv {
      font-size: 75%
    }

    .kw>strong {
      font-family: inherit
    }

    .kx {
      font-family: Menlo, Monaco, "Courier New", Courier, monospace
    }

    .ky {
      background-image: url(https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/320/0*6X3oVR8okP5lcm5g)
    }

    .kz {
      font-style: italic
    }

    .la {
      padding-bottom: NaN%
    }

    .lb {
      max-width: 1539px
    }

    .lc {
      padding-bottom: 45.159194282001295%
    }

    .ld {
      max-width: 602px
    }

    .le {
      padding-bottom: 128.0730897009967%
    }

    .lf {
      list-style-type: decimal
    }

    .lg {
      margin-left: 30px
    }

    .lh {
      padding-left: 0px
    }

    .ln {
      background-image: url(https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/320/0*q0g3Cp3d612i0I_9)
    }

    .lo {
      max-width: 444px
    }

    .lp {
      padding-bottom: 103.15315315315316%
    }

    .lu {
      max-width: 619px
    }

    .lv {
      padding-bottom: 84.32956381260097%
    }

    .me {
      max-width: 1756px
    }

    .mf {
      padding-bottom: 5px
    }

    .mg {
      padding-top: 5px
    }

    .mh {
      padding-bottom: 50.79726651480638%
    }

    .mi {
      max-width: 976px
    }

    .mj {
      padding-bottom: 35.55327868852459%
    }

    .mk {
      max-width: 1814px
    }

    .ml {
      padding-bottom: 77.2877618522602%
    }

    .mm {
      background-image: url(https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/320/0*cLJuFgEzC52GDiLZ)
    }

    .mn {
      background-image: url(https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/320/0*ciCUynsO_72Hln8T)
    }

    .mo {
      padding-bottom: 75%
    }

    .mp {
      padding: 20px
    }

    .mq {
      background: rgba(0, 0, 0, 0.05)
    }

    .mr {
      overflow-x: auto
    }

    .ms {
      line-height: 1.18
    }

    .mt {
      margin-top: -0.09em
    }

    .mu {
      margin-bottom: -0.09em
    }

    .mv {
      white-space: pre-wrap
    }

    .mw {
      background-image: url(https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/320/0*cpjS37X9wxUR57gU)
    }

    .mx {
      background-image: url(https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/320/0*Dd6E5t1_EsHL75-Q)
    }

    .my {
      background-image: url(https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/320/0*bIiUwE42Y-dj1Dm6)
    }

    .mz {
      background-image: url(https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/320/0*6LQgyN9PhP2Nwh6-)
    }

    .na {
      background-image: url(https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/320/0*TZITb2iGt0sGOHvB)
    }

    .nb {
      background-image: url(https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/320/1*0P7BkmUox48Rak_cta48QA.png)
    }

    .nc {
      background-image: url(https://web.archive.org/web/20191204194248im_/https://miro.medium.com/freeze/max/320/1*0EWymp7F8ROU0pUX-vyC7A.gif)
    }

    .nd {
      will-change: opacity
    }

    .ne {
      top: calc(65px + 54px + 40px)
    }

    .nh {
      width: 131px
    }

    .ni {
      padding-top: 28px
    }

    .nj {
      margin-bottom: 19px
    }

    .nk {
      margin-left: -5px
    }

    .nl {
      margin-right: 5px
    }

    .nm {
      outline: 0
    }

    .nn {
      border: 0
    }

    .no {
      user-select: none
    }

    .np {
      cursor: pointer
    }

    .nq>svg {
      pointer-events: none
    }

    .nr:active {
      border-style: none
    }

    .ns {
      -webkit-user-select: none
    }

    .nt {
      fill: rgba(0, 0, 0, 0.76)
    }

    .nu:focus {
      fill: rgba(0, 0, 0, 0.54)
    }

    .nv:hover {
      fill: rgba(0, 0, 0, 0.54)
    }

    .nw {
      margin-top: 5px
    }

    .nx button {
      text-align: left
    }

    .ny {
      width: 188px
    }

    .nz {
      transform: translateX(406px)
    }

    .oa {
      top: calc(65px + 54px + 14px)
    }

    .oc {
      margin-top: 40px
    }

    .od {
      flex-wrap: wrap
    }

    .oe {
      margin-top: 25px
    }

    .of {
      list-style-type: none
    }

    .og {
      margin-right: 8px
    }

    .oh {
      margin-bottom: 8px
    }

    .oi {
      border-radius: 3px
    }

    .oj {
      padding: 5px 10px
    }

    .ok {
      line-height: 22px
    }

    .ol {
      margin-top: 15px
    }

    .om {
      margin-right: 16px
    }

    .on {
      border: 1px solid rgba(0, 0, 0, 0.1)
    }

    .oo {
      height: 60px
    }

    .op {
      width: 60px
    }

    .pc:hover {
      border-color: rgba(0, 0, 0, 0.54)
    }

    .pd:active {
      border-style: solid
    }

    .pe {
      z-index: 2
    }

    .pg {
      padding-top: 32px
    }

    .ph {
      border-top: 1px solid rgba(0, 0, 0, 0.1)
    }

    .pi {
      margin-bottom: 25px
    }

    .pj {
      margin-bottom: 32px
    }

    .pk {
      min-height: 80px
    }

    .pp {
      width: 80px
    }

    .pq {
      height: 80px
    }

    .pr {
      padding-left: 102px
    }

    .pt {
      text-transform: uppercase
    }

    .pu {
      letter-spacing: 0.05em
    }

    .pv {
      margin-bottom: 6px
    }

    .pw {
      line-height: 36px
    }

    .px {
      padding: 4px 12px
    }

    .py {
      max-width: 555px
    }

    .pz {
      max-width: 450px
    }

    .qa {
      line-height: 24px
    }

    .qc {
      padding-top: 25px
    }

    .qd {
      color: rgba(0, 0, 0, 0.76)
    }

    .qe {
      opacity: 1
    }

    .qf {
      border: 1px solid rgba(3, 168, 124, 1)
    }

    .qg {
      margin-top: 64px
    }

    .qh {
      background-color: rgba(0, 0, 0, 0.02)
    }

    .qi {
      padding: 60px 0
    }

    .qj {
      background-color: rgba(0, 0, 0, 0.9)
    }

    .ql {
      padding-bottom: 48px
    }

    .qm {
      border-bottom: 1px solid rgba(255, 255, 255, 0.54)
    }

    .qn {
      margin: 0 -12px
    }

    .qo {
      margin: 0 12px
    }

    .qp {
      flex: 1 1 0
    }

    .qq {
      padding-bottom: 12px
    }

    .qr:hover {
      color: rgba(255, 255, 255, 0.99)
    }

    .qs:hover {
      fill: rgba(255, 255, 255, 0.99)
    }

    .qt:disabled {
      color: rgba(255, 255, 255, 0.7)
    }

    .qu:disabled {
      fill: rgba(255, 255, 255, 0.7)
    }

    .qv {
      color: rgba(255, 255, 255, 0.98)
    }

    .qw {
      fill: rgba(255, 255, 255, 0.98)
    }

    .qx {
      text-align: inherit
    }

    .qy {
      font-size: 21.6px
    }

    .qz {
      letter-spacing: -0.32px
    }

    .ra {
      color: rgba(255, 255, 255, 0.7)
    }

    .rb {
      fill: rgba(255, 255, 255, 0.7)
    }

    .rc {
      text-decoration: underline
    }

    .rd {
      padding-bottom: 8px
    }

    .re {
      padding-top: 8px
    }

    .rf {
      width: 200px
    }
  </style>
  <style type="text/css" data-fela-rehydration="474" data-fela-type="RULE" media="all and (min-width: 1080px)">
    .d {
      display: none
    }

    .ah {
      margin: 0 64px
    }

    .eg {
      margin-top: 0.78em
    }

    .gb {
      margin-left: 30px
    }

    .gp {
      font-size: 21px
    }

    .gq {
      margin-top: 2em
    }

    .ha {
      margin-top: 32px
    }

    .hr {
      padding-left: 64px
    }

    .hs {
      padding-right: 64px
    }

    .ht {
      max-width: 1320px
    }

    .jc {
      font-size: 34px
    }

    .jd {
      margin-top: 1.25em
    }

    .jj {
      margin-top: 0.86em
    }

    .jr {
      margin-top: 56px
    }

    .jx {
      margin-top: 1.95em
    }

    .lm {
      margin-top: 1.05em
    }

    .md {
      max-width: 1192px
    }
  </style>
  <style type="text/css" data-fela-rehydration="474" data-fela-type="RULE" media="all and (max-width: 1079.98px)">
    .e {
      display: none
    }

    .dt {
      margin-left: auto
    }

    .du {
      text-align: center
    }

    .ga {
      margin-left: 30px
    }

    .ho {
      padding-left: 64px
    }

    .hp {
      padding-right: 64px
    }

    .hq {
      max-width: 1080px
    }

    .kn {
      float: none
    }

    .ko {
      margin-left: 0
    }

    .kp {
      margin-right: 0
    }

    .kq {
      width: 100%
    }
  </style>
  <style type="text/css" data-fela-rehydration="474" data-fela-type="RULE" media="all and (max-width: 903.98px)">
    .f {
      display: none
    }

    .fz {
      margin-left: 30px
    }

    .hl {
      padding-left: 48px
    }

    .hm {
      padding-right: 48px
    }

    .hn {
      max-width: 904px
    }

    .lq {
      float: none
    }

    .lr {
      margin-left: 0
    }

    .ls {
      margin-right: 0
    }

    .lt {
      width: 100%
    }
  </style>
  <style type="text/css" data-fela-rehydration="474" data-fela-type="RULE" media="all and (max-width: 727.98px)">
    .g {
      display: none
    }

    .am {
      height: 56px
    }

    .an {
      display: flex
    }

    .aq {
      display: block
    }

    .ci {
      margin-bottom: 0px
    }

    .em {
      margin-top: 32px
    }

    .en {
      flex-direction: column-reverse
    }

    .fx {
      margin-bottom: 30px
    }

    .fy {
      margin-left: 0px
    }

    .hi {
      padding-left: 24px
    }

    .hj {
      padding-right: 24px
    }

    .hk {
      max-width: 728px
    }

    .hw {
      padding: 10px 12px 10px
    }

    .pl {
      margin-bottom: 24px
    }

    .pm {
      align-items: center
    }

    .pn {
      width: 102px
    }

    .po {
      position: relative
    }

    .ps {
      padding-left: 0
    }

    .qb {
      margin-top: 24px
    }

    .qk {
      padding: 32px 0
    }

    .rg {
      width: 140px
    }
  </style>
  <style type="text/css" data-fela-rehydration="474" data-fela-type="RULE" media="all and (max-width: 551.98px)">
    .h {
      display: none
    }

    .ac {
      margin: 0 24px
    }

    .ec {
      margin-top: 0.39em
    }

    .el {
      margin-top: 32px
    }

    .ez {
      margin-bottom: 0px
    }

    .fv {
      margin-bottom: 30px
    }

    .fw {
      margin-left: 0px
    }

    .gh {
      font-size: 18px
    }

    .gi {
      margin-top: 1.56em
    }

    .gw {
      margin-top: 24px
    }

    .hf {
      padding-left: 24px
    }

    .hg {
      padding-right: 24px
    }

    .hh {
      max-width: 552px
    }

    .iu {
      font-size: 30px
    }

    .iv {
      margin-top: 0.93em
    }

    .jf {
      margin-top: 0.67em
    }

    .jn {
      margin-top: 40px
    }

    .jt {
      margin-top: 1.2em
    }

    .li {
      margin-top: 1.34em
    }

    .lw {
      margin: 0
    }

    .lx {
      max-width: 100%
    }
  </style>
  <style type="text/css" data-fela-rehydration="474" data-fela-type="RULE"
    media="all and (min-width: 904px) and (max-width: 1079.98px)">
    .i {
      display: none
    }

    .ag {
      margin: 0 64px
    }

    .ef {
      margin-top: 0.78em
    }

    .gn {
      font-size: 21px
    }

    .go {
      margin-top: 2em
    }

    .gz {
      margin-top: 32px
    }

    .ja {
      font-size: 34px
    }

    .jb {
      margin-top: 1.25em
    }

    .ji {
      margin-top: 0.86em
    }

    .jq {
      margin-top: 56px
    }

    .jw {
      margin-top: 1.95em
    }

    .ll {
      margin-top: 1.05em
    }

    .mc {
      max-width: 1192px
    }
  </style>
  <style type="text/css" data-fela-rehydration="474" data-fela-type="RULE"
    media="all and (min-width: 728px) and (max-width: 903.98px)">
    .j {
      display: none
    }

    .af {
      margin: 0 48px
    }

    .ee {
      margin-top: 0.78em
    }

    .gl {
      font-size: 21px
    }

    .gm {
      margin-top: 2em
    }

    .gy {
      margin-top: 32px
    }

    .iy {
      font-size: 34px
    }

    .iz {
      margin-top: 1.25em
    }

    .jh {
      margin-top: 0.86em
    }

    .jp {
      margin-top: 56px
    }

    .jv {
      margin-top: 1.95em
    }

    .lk {
      margin-top: 1.05em
    }

    .ma {
      margin: 0
    }

    .mb {
      max-width: 100%
    }
  </style>
  <style type="text/css" data-fela-rehydration="474" data-fela-type="RULE"
    media="all and (min-width: 552px) and (max-width: 727.98px)">
    .k {
      display: none
    }

    .ae {
      margin: 0 24px
    }

    .ed {
      margin-top: 0.39em
    }

    .gj {
      font-size: 18px
    }

    .gk {
      margin-top: 1.56em
    }

    .gx {
      margin-top: 24px
    }

    .iw {
      font-size: 30px
    }

    .ix {
      margin-top: 0.93em
    }

    .jg {
      margin-top: 0.67em
    }

    .jo {
      margin-top: 40px
    }

    .ju {
      margin-top: 1.2em
    }

    .lj {
      margin-top: 1.34em
    }

    .ly {
      margin: 0
    }

    .lz {
      max-width: 100%
    }
  </style>
  <style type="text/css" data-fela-rehydration="474" data-fela-type="RULE" media="print">
    .ab {
      display: none
    }
  </style>
  <style type="text/css" data-fela-rehydration="474" data-fela-type="RULE"
    media="(prefers-reduced-motion: no-preference)">
    .y {
      transition: transform 300ms ease
    }

    .z {
      will-change: transform
    }

    .nf {
      transition: opacity 200ms
    }

    .oq {
      transition: border-color 150ms ease
    }

    .or::before {
      background:
        radial-gradient(circle, rgba(0, 0, 0, 0.84) 60%, transparent 70%)
    }

    .os::before {
      border-radius: 50%
    }

    .ot::before {
      content: ""
    }

    .ou::before {
      display: block
    }

    .ov::before {
      z-index: 0
    }

    .ow::before {
      left: 0
    }

    .ox::before {
      height: 100%
    }

    .oy::before {
      position: absolute
    }

    .oz::before {
      top: 0
    }

    .pa::before {
      width: 100%
    }

    .pb:hover::before {
      animation: k1 2000ms infinite cubic-bezier(.1, .12, .25, 1)
    }

    .pf {
      transition: fill 200ms ease
    }
  </style>
  <style type="text/css" data-fela-rehydration="474" data-fela-type="RULE" media="all and (max-width: 1198px)">
    .ng {
      display: none
    }
  </style>
  <style type="text/css" data-fela-rehydration="474" data-fela-type="RULE" media="all and (max-width: 1230px)">
    .ob {
      display: none
    }
  </style>
</head>

<body>
  <!-- BEGIN WAYBACK TOOLBAR INSERT -->
  <style type="text/css">
    body {
      margin-top: 0 !important;
      padding-top: 0 !important;
      /*min-width:800px !important;*/
    }
  </style>
  <script>__wm.rw(0);</script>
  <div id="wm-ipp-base" lang="en" style="display:none;direction:ltr;">
    <div id="wm-ipp" style="position:fixed;left:0;top:0;right:0;">
      <div id="wm-ipp-inside">
        <div style="position:relative;">
          <div id="wm-logo" style="float:left;width:110px;padding-top:12px;">
            <a href="/web/" title="Wayback Machine home page"><img
                src="/_static/images/toolbar/wayback-toolbar-logo-200.png"
                srcset="/_static/images/toolbar/wayback-toolbar-logo-100.png, /_static/images/toolbar/wayback-toolbar-logo-150.png 1.5x, /_static/images/toolbar/wayback-toolbar-logo-200.png 2x"
                alt="Wayback Machine" style="width:100px" border="0" /></a>
          </div>
          <div class="r" style="float:right;">
            <div id="wm-btns" style="text-align:right;height:25px;">
              <div id="wm-save-snapshot-success">success</div>
              <div id="wm-save-snapshot-fail">fail</div>
              <a id="wm-save-snapshot-open" href="#" title="Share via My Web Archive">
                <span class="iconochive-web"></span>
              </a>
              <a href="https://archive.org/account/login.php" title="Sign In" id="wm-sign-in">
                <span class="iconochive-person"></span>
              </a>
              <span id="wm-save-snapshot-in-progress" class="iconochive-web"></span>
              <a href="http://faq.web.archive.org/" title="Get some help using the Wayback Machine"
                style="top:-6px;"><span class="iconochive-question"
                  style="color:rgb(87,186,244);font-size:160%;"></span></a>
              <a id="wm-tb-close" href="#close" onclick="__wm.h(event);return false;" style="top:-2px;"
                title="Close the toolbar"><span class="iconochive-remove-circle"
                  style="color:#888888;font-size:240%;"></span></a>
            </div>
            <div id="wm-share">
              <a href="/web/20191204194248/http://web.archive.org/screenshot/https://medium.com/@ly.lee/stm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c?source=friends_link&sk=70a29cd31425ec4d03144bce14a1c922"
                id="wm-screenshot" title="screenshot">
                <span class="wm-icon-screen-shot"></span>
              </a>
              <a id="wm-share-facebook" href="#"
                data-url="https://web.archive.org/web/20191204194248/https://medium.com/@ly.lee/stm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c?source=friends_link&amp;sk=70a29cd31425ec4d03144bce14a1c922"
                title="Share on Facebook" style="margin-right:5px;" target="_blank"><span class="iconochive-facebook"
                  style="color:#3b5998;font-size:160%;"></span></a>
              <a id="wm-share-twitter" href="#"
                data-url="https://web.archive.org/web/20191204194248/https://medium.com/@ly.lee/stm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c?source=friends_link&amp;sk=70a29cd31425ec4d03144bce14a1c922"
                title="Share on Twitter" style="margin-right:5px;" target="_blank"><span class="iconochive-twitter"
                  style="color:#1dcaff;font-size:160%;"></span></a>
            </div>
          </div>
          <table class="c" style="">
            <tbody>
              <tr>
                <td class="u" colspan="2">
                  <form target="_top" method="get" action="/web/submit" name="wmtb" id="wmtb"><input type="text"
                      name="url" id="wmtbURL"
                      value="https://medium.com/@ly.lee/stm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c?source=friends_link&sk=70a29cd31425ec4d03144bce14a1c922"
                      onfocus="this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input
                      type="hidden" name="date" value="20191204194248" /><input type="submit" value="Go" /></form>
                </td>
                <td class="n" rowspan="2" style="width:110px;">
                  <table>
                    <tbody>
                      <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
                      <tr class="m">
                        <td class="b" nowrap="nowrap">Nov</td>
                        <td class="c" id="displayMonthEl" title="You are here: 19:42:48 Dec 04, 2019">DEC</td>
                        <td class="f" nowrap="nowrap">Jan</td>
                      </tr>
                      <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
                      <tr class="d">
                        <td class="b" nowrap="nowrap"><img src="/_static/images/toolbar/wm_tb_prv_off.png"
                            alt="Previous capture" width="14" height="16" border="0" /></td>
                        <td class="c" id="displayDayEl" style="width:34px;font-size:24px;white-space:nowrap;"
                          title="You are here: 19:42:48 Dec 04, 2019">04</td>
                        <td class="f" nowrap="nowrap"><img src="/_static/images/toolbar/wm_tb_nxt_off.png"
                            alt="Next capture" width="14" height="16" border="0" /></td>
                      </tr>
                      <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
                      <tr class="y">
                        <td class="b" nowrap="nowrap">2018</td>
                        <td class="c" id="displayYearEl" title="You are here: 19:42:48 Dec 04, 2019">2019</td>
                        <td class="f" nowrap="nowrap">2020</td>
                      </tr>
                    </tbody>
                  </table>
                </td>
              </tr>
              <tr>
                <td class="s">
                  <div id="wm-nav-captures">
                    <a class="t"
                      href="/web/20191204194248*/https://medium.com/@ly.lee/stm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c?source=friends_link&sk=70a29cd31425ec4d03144bce14a1c922"
                      title="See a list of every capture for this URL">1 capture</a>
                    <div class="r" title="Timespan for captures of this URL">04 Dec 2019</div>
                  </div>
                </td>
                <td class="k">
                  <a href="" id="wm-graph-anchor">
                    <div id="wm-ipp-sparkline" title="Explore captures for this URL" style="position: relative">
                      <canvas id="wm-sparkline-canvas" width="650" height="27" border="0"></canvas>
                    </div>
                  </a>
                </td>
              </tr>
            </tbody>
          </table>
          <div style="position:absolute;bottom:0;right:2px;text-align:right;">
            <a id="wm-expand" class="wm-btn wm-closed" href="#expand" onclick="__wm.ex(event);return false;"><span
                id="wm-expand-icon" class="iconochive-down-solid"></span> <span style="font-size:80%">About this
                capture</span></a>
          </div>
        </div>
        <div id="wm-capinfo" style="border-top:1px solid #777;display:none; overflow: hidden">
          <div id="wm-capinfo-collected-by">
            <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center">COLLECTED BY</div>
            <div style="padding:3px;position:relative" id="wm-collected-by-content">
              <div style="display:inline-block;vertical-align:top;width:50%;">
                <span class="c-logo"
                  style="background-image:url(https://archive.org/services/img/ArchiveIt-Partner-1028);"></span>
                Organization: <a style="color:#33f;" href="https://archive.org/details/ArchiveIt-Partner-1028"
                  target="_new"><span class="wm-title">Mark Graham&#39;s Archive-IT Collections</span></a>
                <div style="max-height:75px;overflow:hidden;position:relative;">
                  <div
                    style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);">
                  </div>
                  This is a set of web collections curated by Mark Graham using the <a
                    href="http://archive-it.org">Archive-IT</a> service of the <a href="http//archive.org">Internet
                    Archive.</a>
                  <br>
                  <br>
                  They include web captures of the ISKME.org website as well as captures from sites hosted by IGC.org.
                  <br>
                  <br>
                  <br><br>
                  These web captures are available to the general public.
                  <br>
                  <br>
                  For more information about this collection please feel free to contact Mark via <a
                    href="mailto:mark@archive.org?Subject=Question%20about%20you%20Archive-IT%20Collection"
                    target="_top">Send Mail</a>
                </div>
              </div>
              <div style="display:inline-block;vertical-align:top;width:49%;">
                <span class="c-logo"
                  style="background-image:url(https://archive.org/services/img/ArchiveIt-Collection-8332)"></span>
                <div>Collection: <a style="color:#33f;" href="https://archive.org/details/ArchiveIt-Collection-8332"
                    target="_new"><span class="wm-title">General Crawls</span></a></div>
                <div style="max-height:75px;overflow:hidden;position:relative;">
                  <div
                    style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);">
                  </div>
                  Archive-It Partner 1028: Mark Graham - Collection 8332: General Crawls
                </div>
              </div>
            </div>
          </div>
          <div id="wm-capinfo-timestamps">
            <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center"
              title="Timestamps for the elements of this page">TIMESTAMPS</div>
            <div>
              <div id="wm-capresources" style="margin:0 5px 5px 5px;max-height:250px;overflow-y:scroll !important">
              </div>
              <div id="wm-capresources-loading" style="text-align:left;margin:0 20px 5px 5px;display:none"><img
                  src="/_static/images/loading.gif" alt="loading" /></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="donato" style="position:relative;width:100%;">
    <div id="donato-base">
      <iframe id="donato-if"
        src="https://archive.org/includes/donate.php?as_page=1&amp;platform=wb&amp;referer=https%3A//web.archive.org/web/20191204194248/https%3A//medium.com/%2540ly.lee/stm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c%3Fsource%3Dfriends_link%26sk%3D70a29cd31425ec4d03144bce14a1c922"
        scrolling="no" frameborder="0" style="width:100%; height:100%">
      </iframe>
    </div>
  </div>
  <script type="text/javascript">
    __wm.bt(650, 27, 25, 2, "web", "https://medium.com/@ly.lee/stm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c?source=friends_link&sk=70a29cd31425ec4d03144bce14a1c922", "20191204194248", 1996, "/_static/", ["/_static/css/banner-styles.css?v=bsmaklHF", "/_static/css/iconochive.css?v=qtvMKcIJ"]);
    __wm.rw(1);
  </script>
  <!-- END WAYBACK TOOLBAR INSERT -->
  <div id="root">
    <div class="a b c">
      <div class="d e f g h i j k"></div>
      <script>document.domain = document.domain;</script>
      <script>window.PARSELY = window.PARSELY || { autotrack: false }</script>
      <nav class="r s t u v c w x y z ab">
        <div class="branch-journeys-top">
          <div class="n p">
            <div class="ac ae af ag ah ai aj ak">
              <div class="al n o am an">
                <div class="r ao w">
                  <div class="n o"><a aria-label="Homepage" rel="noopener"
                      href="/web/20191204194248/https://medium.com/?source=post_page-----36d7fe245b5c----------------------">
                      <div class="ap g"><svg height="22" width="112" viewbox="0 0 111.5 22" class="q">
                          <path
                            d="M56.3 19.5c0 .4 0 .5.3.7l1.5 1.4v.1h-6.5V19c-.7 1.8-2.4 3-4.3 3-3.3 0-5.8-2.6-5.8-7.5 0-4.5 2.6-7.6 6.3-7.6 1.6-.1 3.1.8 3.8 2.4V3.2c0-.3-.1-.6-.3-.7l-1.4-1.4V1l6.5-.8v19.3zm-4.8-.8V9.5c-.5-.6-1.2-.9-1.9-.9-1.6 0-3.1 1.4-3.1 5.7 0 4 1.3 5.4 3 5.4.8.1 1.6-.3 2-1zm9.1 3.1V9.4c0-.3-.1-.6-.3-.7l-1.4-1.5v-.1h6.5v12.5c0 .4 0 .5.3.7l1.4 1.4v.1h-6.5zm-.2-19.2C60.4 1.2 61.5 0 63 0c1.4 0 2.6 1.2 2.6 2.6S64.4 5.3 63 5.3a2.6 2.6 0 0 1-2.6-2.7zm22.5 16.9c0 .4 0 .5.3.7l1.5 1.4v.1h-6.5v-3.2c-.6 2-2.4 3.4-4.5 3.4-2.9 0-4.4-2.1-4.4-6.2 0-1.9 0-4.1.1-6.5 0-.3-.1-.5-.3-.7L67.7 7v.1H74v8c0 2.6.4 4.4 2 4.4.9-.1 1.7-.6 2.1-1.3V9.5c0-.3-.1-.6-.3-.7l-1.4-1.5v-.2h6.5v12.4zm22 2.3c0-.5.1-6.5.1-7.9 0-2.6-.4-4.5-2.2-4.5-.9 0-1.8.5-2.3 1.3.2.8.3 1.7.3 2.5 0 1.8-.1 4.2-.1 6.5 0 .3.1.5.3.7l1.5 1.4v.1H96c0-.4.1-6.5.1-7.9 0-2.7-.4-4.5-2.2-4.5-.9 0-1.7.5-2.2 1.3v9c0 .4 0 .5.3.7l1.4 1.4v.1h-6.5V9.5c0-.3-.1-.6-.3-.7l-1.4-1.5v-.2h6.5v3.1a4.6 4.6 0 0 1 4.6-3.4c2.2 0 3.6 1.2 4.2 3.5.7-2.1 2.7-3.6 4.9-3.5 2.9 0 4.5 2.2 4.5 6.2 0 1.9-.1 4.2-.1 6.5-.1.3.1.6.3.7l1.4 1.4v.1h-6.6zm-81.4-2l1.9 1.9v.1h-9.8v-.1l2-1.9c.2-.2.3-.4.3-.7V7.3c0-.5 0-1.2.1-1.8L11.4 22h-.1L4.5 6.8c-.1-.4-.2-.4-.3-.6v10c-.1.7 0 1.3.3 1.9l2.7 3.6v.1H0v-.1L2.7 18c.3-.6.4-1.3.3-1.9v-11c0-.5-.1-1.1-.5-1.5L.7 1.1V1h7l5.8 12.9L18.6 1h6.8v.1l-1.9 2.2c-.2.2-.3.5-.3.7v15.2c0 .2.1.5.3.6zm7.6-5.9c0 3.8 1.9 5.3 4.2 5.3 1.9.1 3.6-1 4.4-2.7h.1c-.8 3.7-3.1 5.5-6.5 5.5-3.7 0-7.2-2.2-7.2-7.4 0-5.5 3.5-7.6 7.3-7.6 3.1 0 6.4 1.5 6.4 6.2v.8h-8.7zm0-.8h4.3v-.8c0-3.9-.8-4.9-2-4.9-1.4.1-2.3 1.6-2.3 5.7z">
                          </path>
                        </svg></div>
                      <div class="r aq"><svg width="35" height="35" viewbox="5 5 35 35" class="q">
                          <path
                            d="M5 40V5h35v35H5zm8.56-12.63c0 .56-.03.69-.32 1.03L10.8 31.4v.4h6.97v-.4L15.3 28.4c-.29-.34-.34-.5-.34-1.03v-8.95l6.13 13.36h.71l5.26-13.36v10.64c0 .3 0 .35-.19.53l-1.85 1.8v.4h9.2v-.4l-1.83-1.8c-.18-.18-.2-.24-.2-.53V15.94c0-.3.02-.35.2-.53l1.82-1.8v-.4h-6.47l-4.62 11.55-5.2-11.54h-6.8v.4l2.15 2.63c.24.3.29.37.29.77v10.35z">
                          </path>
                        </svg></div>
                    </a></div>
                </div>
                <div class="r ar w">
                  <div class="n o">
                    <div class="n g">
                      <div class="as" id="lo-post-page-navbar-upsell-button">
                        <div><a
                            href="https://web.archive.org/web/20191204194248/https://medium.com/membership?source=upgrade_membership---nav_full------------------------"
                            class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener"><span
                              class="bj b bk bl bm bn r bo bp">Become a member</span></a></div>
                      </div>
                      <div class="as" id="lo-post-page-navbar-sign-in-link">
                        <div class="bq r"><span class="bj b bk bl bm bn r bo bp"><a
                              href="https://web.archive.org/web/20191204194248/https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Fstm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c&amp;source=post_page-----36d7fe245b5c---------------------nav_reg-"
                              class="br bs av aw ax ay az ba bb bc bt bu bf bg bv bw" rel="noopener">Sign in</a></span>
                        </div>
                      </div>
                    </div>
                    <div class="as" id="lo-post-page-navbar-get-started-button">
                      <div class="bq r"><button
                          class="bx by br bs bz bt bu ca bc cb bj b bk bl bm bn cc cd ce cf cg bf">Get started</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div class="ch al r ci am"></div>
      <article>
        <section class="cj ck cl cm ak cn ce n co"></section><span class="r"></span>
        <div>
          <div class="cp u cq cr cs ct"></div>
          <section class="cu cv cw cx cy">
            <div class="cz ak">
              <figure class="da cz ak paragraph-image">
                <div class="dh r di dj">
                  <div class="dk r">
                    <div class="db dc cp t u dd ak de df dg"><img class="cp t u dd ak dl dm dn"
                        src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/60/1*fjfoda1Ovwdahy09TwUkqA.png?q=20"
                        width="1920" height="1080" role="presentation" /></div><img class="db dc cp t u dd ak do"
                      width="1920" height="1080" role="presentation" /><noscript><img class="cp t u dd ak"
                        src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/3840/1*fjfoda1Ovwdahy09TwUkqA.png"
                        width="1920" height="1080" role="presentation" /></noscript>
                  </div>
                </div>
                <figcaption class="bo dp dq dr ds cn cl cm dt du bj dv">Blue Pill Bootloader connected to Windows
                </figcaption>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah dw aj ak">
                <div>
                  <div id="e9ca" class="dx dy dz bk ea b eb ec ed ee ef eg eh">
                    <h1 class="ea b eb ei dz">STM32 Blue Pill USB Bootloader — How I fixed the USB Storage, Serial, DFU
                      and WebUSB interfaces</h1>
                  </div>
                  <div class="ej">
                    <div class="n ek el em en">
                      <div class="o n">
                        <div><a rel="noopener"
                            href="/web/20191204194248/https://medium.com/@ly.lee?source=post_page-----36d7fe245b5c----------------------">
                            <div class="di eo ep">
                              <div class="bs n eq o p cp er es et eu ev ct"><svg width="57" height="57"
                                  viewbox="0 0 57 57">
                                  <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M28.5 1.2A27.45 27.45 0 0 0 4.06 15.82L3 15.27A28.65 28.65 0 0 1 28.5 0C39.64 0 49.29 6.2 54 15.27l-1.06.55A27.45 27.45 0 0 0 28.5 1.2zM4.06 41.18A27.45 27.45 0 0 0 28.5 55.8a27.45 27.45 0 0 0 24.44-14.62l1.06.55A28.65 28.65 0 0 1 28.5 57 28.65 28.65 0 0 1 3 41.73l1.06-.55z">
                                  </path>
                                </svg></div><img alt="Lup Yuen Lee 李立源" class="r ew ep eo"
                                src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/fit/c/96/96/1*KGohS3sQaUnr58gc0BIfoQ.jpeg"
                                width="48" height="48" />
                            </div>
                          </a></div>
                        <div class="ex ak r">
                          <div class="n">
                            <div style="flex:1"><span class="bj b bk bl bm bn r dz q">
                                <div class="ey n o ez"><span class="bj dv dp bl de fa fb fc fd fe dz"><a
                                      class="at au av aw ax ay az ba bb bc ff bf bg bh bi" rel="noopener"
                                      href="/web/20191204194248/https://medium.com/@ly.lee?source=post_page-----36d7fe245b5c----------------------">Lup
                                      Yuen Lee 李立源</a></span>
                                  <div class="fg r ar h"><button
                                      class="fh dz q by fi fj fk fl bc bh fm fn fo fp fq fr cb bj b bk fs ft bn cc cd ce cf cg bf">Follow</button>
                                  </div>
                                </div>
                              </span></div>
                          </div><span class="bj b bk bl bm bn r bo bp"><span class="bj dv dp bl de fa fb fc fd fe bo">
                              <div><a class="at au av aw ax ay az ba bb bc ff bf bg bh bi" rel="noopener"
                                  href="/web/20191204194248/https://medium.com/@ly.lee/stm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c?source=post_page-----36d7fe245b5c----------------------">Dec
                                  17, 2018</a> <!-- -->·
                                <!-- -->
                                <!-- -->14
                                <!-- --> min read
                              </div>
                            </span></span>
                        </div>
                      </div>
                      <div class="n fu fv fw fx fy fz ga gb ab">
                        <div class="n o">
                          <div class="gc r ar"><a
                              href="//web.archive.org/web/20191204194248/https://medium.com/p/36d7fe245b5c/share/twitter?source=post_actions_header---------------------------"
                              class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" target="_blank"
                              rel="noopener"><svg width="29" height="29" class="q">
                                <path
                                  d="M22.05 7.54a4.47 4.47 0 0 0-3.3-1.46 4.53 4.53 0 0 0-4.53 4.53c0 .35.04.7.08 1.05A12.9 12.9 0 0 1 5 6.89a5.1 5.1 0 0 0-.65 2.26c.03 1.6.83 2.99 2.02 3.79a4.3 4.3 0 0 1-2.02-.57v.08a4.55 4.55 0 0 0 3.63 4.44c-.4.08-.8.13-1.21.16l-.81-.08a4.54 4.54 0 0 0 4.2 3.15 9.56 9.56 0 0 1-5.66 1.94l-1.05-.08c2 1.27 4.38 2.02 6.94 2.02 8.3 0 12.86-6.9 12.84-12.85.02-.24 0-.43 0-.65a8.68 8.68 0 0 0 2.26-2.34c-.82.38-1.7.62-2.6.72a4.37 4.37 0 0 0 1.95-2.51c-.84.53-1.81.9-2.83 1.13z">
                                </path>
                              </svg></a></div>
                          <div class="gc r ar"><a
                              href="//web.archive.org/web/20191204194248/https://medium.com/p/36d7fe245b5c/share/linkedIn?source=post_actions_header---------------------------"
                              class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" target="_blank"
                              rel="noopener"><svg width="29" height="29" viewbox="0 0 29 29" fill="none" class="q">
                                <path
                                  d="M5 6.36C5 5.61 5.63 5 6.4 5h16.2c.77 0 1.4.61 1.4 1.36v16.28c0 .75-.63 1.36-1.4 1.36H6.4c-.77 0-1.4-.6-1.4-1.36V6.36z">
                                </path>
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                  d="M10.76 20.9v-8.57H7.89v8.58h2.87zm-1.44-9.75c1 0 1.63-.65 1.63-1.48-.02-.84-.62-1.48-1.6-1.48-.99 0-1.63.64-1.63 1.48 0 .83.62 1.48 1.59 1.48h.01zM12.35 20.9h2.87v-4.79c0-.25.02-.5.1-.7.2-.5.67-1.04 1.46-1.04 1.04 0 1.46.8 1.46 1.95v4.59h2.87v-4.92c0-2.64-1.42-3.87-3.3-3.87-1.55 0-2.23.86-2.61 1.45h.02v-1.24h-2.87c.04.8 0 8.58 0 8.58z"
                                  fill="#fff"></path>
                              </svg></a></div>
                          <div class="gc r ar"><a
                              href="//web.archive.org/web/20191204194248/https://medium.com/p/36d7fe245b5c/share/facebook?source=post_actions_header---------------------------"
                              class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" target="_blank"
                              rel="noopener"><svg width="29" height="29" class="q">
                                <path
                                  d="M23.2 5H5.8a.8.8 0 0 0-.8.8V23.2c0 .44.35.8.8.8h9.3v-7.13h-2.38V13.9h2.38v-2.38c0-2.45 1.55-3.66 3.74-3.66 1.05 0 1.95.08 2.2.11v2.57h-1.5c-1.2 0-1.48.57-1.48 1.4v1.96h2.97l-.6 2.97h-2.37l.05 7.12h5.1a.8.8 0 0 0 .79-.8V5.8a.8.8 0 0 0-.8-.79">
                                </path>
                              </svg></a></div>
                          <div class="gd r ao">
                            <div>
                              <div class="cf"><a
                                  href="https://web.archive.org/web/20191204194248/https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Fstm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c&amp;source=post_actions_header--------------------------bookmark_sidebar-"
                                  class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener"><svg width="25"
                                    height="25" viewbox="0 0 25 25">
                                    <path
                                      d="M19 6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14.66h.01c.01.1.05.2.12.28a.5.5 0 0 0 .7.03l5.67-4.12 5.66 4.13a.5.5 0 0 0 .71-.03.5.5 0 0 0 .12-.29H19V6zm-6.84 9.97L7 19.64V6a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v13.64l-5.16-3.67a.49.49 0 0 0-.68 0z"
                                      fill-rule="evenodd"></path>
                                  </svg></a></div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <p id="e317" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">The <a
                    href="https://web.archive.org/web/20191204194248/http://wiki.stm32duino.com/index.php?title=Blue_Pill"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">STM32 Blue Pill</a> is a
                  remarkable microcontroller for US$ 2. I proved it by running the USB Storage, USB Serial, USB DFU
                  (Direct Firmware Upgrade) and WebUSB interfaces all on the same Blue Pill concurrently, without any
                  additional hardware!</p>
                <p id="5552" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">Why did I do this? I was building
                  a <a class="at cg gs gt gu gv" target="_blank" rel="noopener"
                    href="/web/20191204194248/https://medium.com/@ly.lee/work-in-progress-stm32-blue-pill-visual-programming-with-makecode-codal-and-libopencm3-422d308f252e">USB
                    Bootloader for the MakeCode visual programming tool</a> that’s web-browser based and requires all
                  these interfaces. I ran into lots of difficulty making all these interfaces coexist, almost giving up,
                  thinking it’s a Blue Pill hardware limitation… But it turned out to be a software problem.</p>
                <p id="faa5" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">This article documents all the
                  fixes I have made to create a working Blue Pill bootloader that has been tested on Windows, Mac and
                  Linux. If you’re creating a USB device based on STM32 microcontrollers, this article might help you
                  learn about the complex world of USB protocols. The complete source code is here…</p>
                <div class="gw gx gy gz ha hb"><a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader?source=post_page-----36d7fe245b5c----------------------"
                    rel="noopener nofollow">
                    <section class="he cl cm ak ce n ar hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht">
                      <div class="hu n co p hv hw">
                        <h2 class="bj hx hy bl dz">
                          <div class="de hc fb fc hd fe">lupyuen/bluepill-bootloader</div>
                        </h2>
                        <div class="hz r">
                          <h3 class="bj dv dp bl bo">
                            <div class="de hc fb fc hd fe">MakeCode UF2 bootloader for STM32 Blue Pill. Contribute to
                              lupyuen/bluepill-bootloader development by creating an…</div>
                          </h3>
                        </div>
                        <div class="ia r">
                          <h4 class="bj dv ft bl bo">
                            <div class="de hc fb fc hd fe">github.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ib r">
                        <div class="ic r id ie if ib ig ih ii"></div>
                      </div>
                    </section>
                  </a></div>
              </div>
            </div>
          </section>
          <hr class="ij dv ik il im ds in io ip iq ir" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dw aj ak">
                <h1 id="b0d5" class="is it dz bk bj hx iu iv iw ix iy iz ja jb jc jd je">Capture USB Data with Wireshark
                </h1>
                <p id="1861" class="ge gf dz bk gg b gh jf gj jg gl jh gn ji gp jj gr">I highly recommend installing <a
                    href="https://web.archive.org/web/20191204194248/https://www.wireshark.org/"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">Wireshark</a> to capture and view
                  USB data. After installing Wireshark (be sure to select USBPcap or usbmon when prompted during
                  installation), check this article for further instructions (Windows and Linux)…</p>
                <div class="gw gx gy gz ha hb"><a
                    href="https://web.archive.org/web/20191204194248/https://wiki.wireshark.org/CaptureSetup/USB?source=post_page-----36d7fe245b5c----------------------"
                    rel="noopener nofollow">
                    <section class="he cl cm ak ce n ar hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht">
                      <div class="hu n co p hv hw">
                        <h2 class="bj hx hy bl dz">
                          <div class="de hc fb fc hd fe">CaptureSetup/USB - The Wireshark Wiki</div>
                        </h2>
                        <div class="hz r">
                          <h3 class="bj dv dp bl bo">
                            <div class="de hc fb fc hd fe">The USB bus will add additional overhead, so the raw USB
                              traffic will have higher volume than the network traffic, even…</div>
                          </h3>
                        </div>
                        <div class="ia r">
                          <h4 class="bj dv ft bl bo">
                            <div class="de hc fb fc hd fe">wiki.wireshark.org</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ib r">
                        <div class="jk r id ie if ib ig ih ii"></div>
                      </div>
                    </section>
                  </a></div>
                <p id="b506" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">For Mac check this article…</p>
                <div class="gw gx gy gz ha hb"><a
                    href="https://web.archive.org/web/20191204194248/https://aud-ios.com/2017/10/22/usb-monitoring-with-wireshark/?source=post_page-----36d7fe245b5c----------------------"
                    rel="noopener nofollow">
                    <section class="he cl cm ak ce n ar hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht">
                      <div class="hu n co p hv hw">
                        <h2 class="bj hx hy bl dz">
                          <div class="de hc fb fc hd fe">macOS - How to: USB Monitoring with WireShark</div>
                        </h2>
                        <div class="hz r">
                          <h3 class="bj dv dp bl bo">
                            <div class="de hc fb fc hd fe">As developers know, the utility tool to debug and monitor USB
                              Traffic hasn&#x27;t been available for quite a while. However…</div>
                          </h3>
                        </div>
                        <div class="ia r">
                          <h4 class="bj dv ft bl bo">
                            <div class="de hc fb fc hd fe">aud-ios.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ib r">
                        <div class="jl r id ie if ib ig ih ii"></div>
                      </div>
                    </section>
                  </a></div>
                <p id="5689" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">Once you have Wireshark
                  installed, you may download and view <a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/tree/master/logs"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">the USB logs that I have
                    captured</a> while connecting our Blue Pill bootloader to Windows, Mac and Ubuntu.</p>
              </div>
            </div>
          </section>
          <hr class="ij dv ik il im ds in io ip iq ir" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dw aj ak">
                <figure class="jn jo jp jq jr cz cl cm paragraph-image">
                  <div class="cl cm jm">
                    <div class="dh r di dj">
                      <div class="js r">
                        <div class="db dc cp t u dd ak de df dg"><img class="cp t u dd ak dl dm dn"
                            src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/48/1*oPbLTojzzwFwT3LYDa-xEw.png?q=20"
                            width="400" height="505" role="presentation" /></div><img class="db dc cp t u dd ak do"
                          width="400" height="505" role="presentation" /><noscript><img class="cp t u dd ak"
                            src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/800/1*oPbLTojzzwFwT3LYDa-xEw.png"
                            width="400" height="505" role="presentation" /></noscript>
                      </div>
                    </div>
                  </div>
                  <figcaption class="bo dp dq dr ds cn cl cm dt du bj dv">Common sight during my USB development…
                    “Drivers not installed” due to USB descriptor errors or USB request processing errors</figcaption>
                </figure>
                <h1 id="62ce" class="is it dz bk bj hx iu jt iw ju iy jv ja jw jc jx je">The Original Bootloader</h1>
                <p id="3134" class="ge gf dz bk gg b gh jf gj jg gl jh gn ji gp jj gr">I started with this bootloader
                  code by Michał Moskal and Devan Lai…</p>
                <div class="gw gx gy gz ha hb"><a
                    href="https://web.archive.org/web/20191204194248/https://github.com/mmoskal/uf2-stm32f103?source=post_page-----36d7fe245b5c----------------------"
                    rel="noopener nofollow">
                    <section class="he cl cm ak ce n ar hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht">
                      <div class="hu n co p hv hw">
                        <h2 class="bj hx hy bl dz">
                          <div class="de hc fb fc hd fe">mmoskal/uf2-stm32f103</div>
                        </h2>
                        <div class="hz r">
                          <h3 class="bj dv dp bl bo">
                            <div class="de hc fb fc hd fe">UF2 bootloader for STM32 boards. Contribute to
                              mmoskal/uf2-stm32f103 development by creating an account on GitHub.</div>
                          </h3>
                        </div>
                        <div class="ia r">
                          <h4 class="bj dv ft bl bo">
                            <div class="de hc fb fc hd fe">github.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ib r">
                        <div class="jy r id ie if ib ig ih ii"></div>
                      </div>
                    </section>
                  </a></div>
                <p id="97a9" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">It’s based on the <a
                    href="https://web.archive.org/web/20191204194248/http://libopencm3.org/docs/latest/stm32f1/html/modules.html"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">open-source libopencm3 library</a>
                  for STM32. It didn’t build with the latest version of libopencm3 on Visual Studio Code with the
                  PlatformIO extension, so I applied some patches from here…</p>
                <div class="gw gx gy gz ha hb"><a
                    href="https://web.archive.org/web/20191204194248/https://github.com/trezor/trezor-mcu?source=post_page-----36d7fe245b5c----------------------"
                    rel="noopener nofollow">
                    <section class="he cl cm ak ce n ar hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht">
                      <div class="hu n co p hv hw">
                        <h2 class="bj hx hy bl dz">
                          <div class="de hc fb fc hd fe">trezor/trezor-mcu</div>
                        </h2>
                        <div class="hz r">
                          <h3 class="bj dv dp bl bo">
                            <div class="de hc fb fc hd fe">lock: Sources for TREZOR firmware. Contribute to
                              trezor/trezor-mcu development by creating an account on GitHub.</div>
                          </h3>
                        </div>
                        <div class="ia r">
                          <h4 class="bj dv ft bl bo">
                            <div class="de hc fb fc hd fe">github.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ib r">
                        <div class="jz r id ie if ib ig ih ii"></div>
                      </div>
                    </section>
                  </a></div>
                <p id="5d60" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">The patches fixed the build to
                  support WebUSB, USB 2.1 and Windows USB (more about this later). After <a class="at cg gs gt gu gv"
                    target="_blank" rel="noopener"
                    href="/web/20191204194248/https://medium.com/coinmonks/connect-stm32-blue-pill-to-sigfox-28c6f91bddc1?source=friends_link&amp;sk=d0f0d9f40e36badadfb04dc4c0846775">flashing
                    the Blue Pill with the ST Link V2 and PlatformIO</a>, I soon ran into interesting problems…</p>
              </div>
            </div>
          </section>
          <hr class="ij dv ik il im ds in io ip iq ir" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dw aj ak">
                <figure class="jn jo jp jq jr cz cl cm paragraph-image">
                  <div class="kb kc di kd ak">
                    <div class="cl cm ka">
                      <div class="dh r di dj">
                        <div class="ke r">
                          <div class="db dc cp t u dd ak de df dg"><img class="cp t u dd ak dl dm dn"
                              src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/60/1*6GIcdEMCbtXb346Bt9S7JQ.png?q=20"
                              width="719" height="598" role="presentation" /></div><img class="db dc cp t u dd ak do"
                            width="719" height="598" role="presentation" /><noscript><img class="cp t u dd ak"
                              src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/1438/1*6GIcdEMCbtXb346Bt9S7JQ.png"
                              width="719" height="598" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                  <figcaption class="bo dp dq dr ds cn cl cm dt du bj dv">USB Mass Storage Class (MSC) request to fetch
                    the maximum logical unit number (i.e. drive number). From the Wireshark log <a
                      href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/logs/usb-windows.pcapng.gz"
                      class="at cg gs gt gu gv" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/bluepill-bootloader/blob/master/logs/usb-windows.pcapng.gz</a>
                  </figcaption>
                </figure>
                <h1 id="2619" class="is it dz bk bj hx iu jt iw ju iy jv ja jw jc jx je">USB Storage</h1>
                <p id="353c" class="ge gf dz bk gg b gh jf gj jg gl jh gn ji gp jj gr">The fixed code for supporting USB
                  storage is in <a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/msc.c"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">msc.c</a>.</p>
                <figure class="jn jo jp jq jr cz do kg cd kh ki kj kk kl ba km kn ko kp kq kr paragraph-image">
                  <div class="kb kc di kd ak">
                    <div class="cl cm kf">
                      <div class="dh r di dj">
                        <div class="ks r">
                          <div class="db dc cp t u dd ak de df dg"><img class="cp t u dd ak dl dm dn"
                              src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/60/1*KG-fnIeqEsgZ8LJv9dckpA.png?q=20"
                              width="1095" height="908" role="presentation" /></div><img class="db dc cp t u dd ak do"
                            width="1095" height="908" role="presentation" /><noscript><img class="cp t u dd ak"
                              src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/2190/1*KG-fnIeqEsgZ8LJv9dckpA.png"
                              width="1095" height="908" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                  <figcaption class="bo dp dq dr ds cn cl cm dt du bj dv">Blue Pill appears on Windows as a USB Mass
                    Storage Device. At the lower left are the files emulated by Blue Pill (done by ghostfat.c)
                  </figcaption>
                </figure>
                <p id="b519" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">To implement USB storage in any
                  USB device, we need to implement the <a
                    href="https://web.archive.org/web/20191204194248/https://usb.org/sites/default/files/usbmassbulk_10.pdf"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow"><strong class="gg kt">USB Mass
                      Storage Class (MSC)</strong> specs</a>. So that we can connect the Blue Pill to a computer and it
                  will appear as a USB drive. Within the specs, we’ll see that it actually uses the (very old!) SCSI
                  protocol for reading and writing to the USB drive, and also for fetching the storage details. The
                  Wireshark screen above shows a simple USB MSC command.</p>
                <p id="f7b0" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">Thankfully we don’t need to
                  implement the SCSI protocol ourselves. libopencm3 handles it for us, according to <a
                    href="https://web.archive.org/web/20191204194248/https://github.com/libopencm3/libopencm3-examples/blob/master/examples/stm32/f4/stm32f4-discovery/usb_msc/msc.c"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">this sample code</a>… just call
                  <code class="dj ku kv kw kx b">usb_msc_init()</code> and libopencm3 does everything automagically.
                  However the USB MSC implementation <code class="dj ku kv kw kx b">usb_msc_init()</code> in libopencm3
                  is missing some features, so I copied the libopencm3 source file and patched myself…</p>
                <p id="7080" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr"><strong class="gg kt">1️⃣
                    libopencm3 doesn’t implement the </strong><code
                    class="dj ku kv kw kx b"><strong class="gg kt">SCSI_READ_FORMAT_CAPACITIES</strong></code><strong
                    class="gg kt"> and </strong><code
                    class="dj ku kv kw kx b"><strong class="gg kt">SCSI_PREVENT_ALLOW_MEDIUM_REMOVAL</strong></code><strong
                    class="gg kt"> SCSI commands</strong></p>
                <p id="e501" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr"><code
                    class="dj ku kv kw kx b">SCSI_READ_FORMAT_CAPACITIES</code> is important because Windows will send
                  this command to query the storage size. Without it, our USB bootloader won’t work with Windows. I
                  found the implementation here..</p>
                <div class="gw gx gy gz ha hb"><a
                    href="https://web.archive.org/web/20191204194248/https://habr.com/company/thirdpin/blog/304924/?source=post_page-----36d7fe245b5c----------------------"
                    rel="noopener nofollow">
                    <section class="he cl cm ak ce n ar hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht">
                      <div class="hu n co p hv hw">
                        <h2 class="bj hx hy bl dz">
                          <div class="de hc fb fc hd fe">USB mass storage device и libopencm3</div>
                        </h2>
                        <div class="hz r">
                          <h3 class="bj dv dp bl bo">
                            <div class="de hc fb fc hd fe">Моя работа связана с программированием микроконтроллеров, в
                              частности STM32. Долгое время для работы с периферией я…</div>
                          </h3>
                        </div>
                        <div class="ia r">
                          <h4 class="bj dv ft bl bo">
                            <div class="de hc fb fc hd fe">habr.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ib r">
                        <div class="ky r id ie if ib ig ih ii"></div>
                      </div>
                    </section>
                  </a></div>
                <p id="65dd" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">And patched it <a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/msc.c#L551-L572"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">in my code here</a>. Note that the
                  <code
                    class="dj ku kv kw kx b"><a href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/msc.c#L568" class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">bytes_to_write</a></code><a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/msc.c#L568"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow"> setting in the article is
                    incorrect</a>. I have also applied a <a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/msc.c#L723-L739"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">patch for MSC request handling</a>
                  that’s mentioned in the article.</p>
                <p id="aa3e" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">According my logs, Windows is
                  also sending the command <code class="dj ku kv kw kx b">SCSI_PREVENT_ALLOW_MEDIUM_REMOVAL</code>. I
                  cooked up a <a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/msc.c#L624-L632"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">dummy implementation here</a>.</p>
                <p id="1891" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">2️⃣ <strong
                    class="gg kt">libopencm3 doesn’t implement </strong><code
                    class="dj ku kv kw kx b"><strong class="gg kt">SCSI_INQUIRY</strong></code><strong class="gg kt">
                    completely</strong></p>
                <p id="9467" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">This bug took me a while to track
                  down. When I logged the USB requests from Windows, I noticed that Windows kept sending the <code
                    class="dj ku kv kw kx b"><a href="https://web.archive.org/web/20191204194248/http://www.usbmadesimple.co.uk/ums_4.htm" class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">SET_ADDRESS</a></code>
                  USB request to Blue Pill every minute. Windows was telling Blue Pill, <em class="kz">“use USB address
                    5 now… switch to address 6 now… switch back to address 5 now…”</em></p>
                <figure class="jn jo jp jq jr cz">
                  
                  <p><script src="https://gist.github.com/lupyuen/2f05e5a1875c279023bf92c952683e49.js"></script></p>


                  <figcaption class="bo dp dq dr ds cn cl cm dt du bj dv">Windows sending SET_ADDRESS 5… 6… 5… 6…
                  </figcaption>
                </figure>
                <p id="e9dc" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">I soon discovered that’s a sign
                  that Windows is resetting our Blue Pill because it didn’t like the response to one of the previous
                  commands. I traced it to the <code class="dj ku kv kw kx b">SCSI_INQUIRY</code> command, which missed
                  out some important bits,<a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/msc.c#L438-L549"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow"> and I patched my version
                    here</a>. (Yes I had to dig through the tedious SCSI specs.)</p>
                <p id="4074" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">3️⃣ <strong
                    class="gg kt">libopencm3 doesn’t play nice with with multiple USB interfaces</strong></p>
                <p id="0abf" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">The official documentation for
                  <code class="dj ku kv kw kx b">usb_msc_init()</code> says cryptically, <a
                    href="https://web.archive.org/web/20191204194248/http://libopencm3.org/docs/latest/stm32f1/html/group__usb__msc.html#ga5e6959c3ac6ff4efab4fd3b59353f497"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow"><em class="kz">“Currently you can
                      only have this profile active.”</em></a> I found out the hard way that it doesn’t coexist well
                  with other USB interfaces (e.g. USB Serial). Instead of rejecting unrecognised USB requests with an
                  error (<code class="dj ku kv kw kx b">USBD_REQ_NOTSUPP</code>), I fixed the code to <a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/msc.c#L887"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">hand off the unknown request to
                    the next USB interface</a> (<code class="dj ku kv kw kx b">USBD_REQ_NEXT_CALLBACK</code>).</p>
                <figure class="jn jo jp jq jr cz do kg cd kh ki kj kk kl ba km kn ko kp kq kr paragraph-image">
                  <div class="kb kc di kd ak">
                    <div class="cl cm lb">
                      <div class="dh r di dj">
                        <div class="lc r">
                          <div class="db dc cp t u dd ak de df dg"><img class="cp t u dd ak dl dm dn"
                              src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/60/1*hF2n5xeSEOsDNP_Heymgbg.png?q=20"
                              width="1539" height="695" role="presentation" /></div><img class="db dc cp t u dd ak do"
                            width="1539" height="695" role="presentation" /><noscript><img class="cp t u dd ak"
                              src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/3078/1*hF2n5xeSEOsDNP_Heymgbg.png"
                              width="1539" height="695" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                  <figcaption class="bo dp dq dr ds cn cl cm dt du bj dv">ghostfat.c emulates a 4 MB flash drive and
                    exposes the 3 files above</figcaption>
                </figure>
                <p id="e6fe" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">For our bootloader, we expect
                  MakeCode users to copy <a
                    href="https://web.archive.org/web/20191204194248/https://github.com/Microsoft/uf2"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">UF2 files</a> in order to flash
                  the Blue Pill ROM. So in the USB storage code <a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/usb_conf.c#L395-L403"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">we register the callbacks</a>
                  <code class="dj ku kv kw kx b">read_block(), write_block()</code> (<a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/ghostfat.c"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">defined in </a><code
                    class="dj ku kv kw kx b"><a href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/ghostfat.c" class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">ghostfat.c</a></code>)
                  that will flash each 512-byte block of the UF2 file into ROM.</p>
                <p id="9e5a" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">By handling the <code
                    class="dj ku kv kw kx b">read_block(), write_block()</code> callbacks, <a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/ghostfat.c"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">the code in </a><code
                    class="dj ku kv kw kx b"><a href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/ghostfat.c" class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">ghostfat.c</a></code>
                  emulates a 4 MB flash drive formatted with the FAT filesystem (sector size 512). The Blue Pill
                  hardware doesn’t actually have 4 MB of storage. When we copy a UF2 file into the drive for flashing,
                  <code class="dj ku kv kw kx b">ghostfat.c</code> will read in 1 sector (512 bytes) from the computer,
                  write the 512 bytes into flash memory, and repeat until the entire UF2 file is processed.</p>
                <p id="c3ae" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr"><a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/msc.c.old"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">Check this file</a> for a RAM Disk
                  implementation of the FAT filesystem.</p>
              </div>
            </div>
          </section>
          <hr class="ij dv ik il im ds in io ip iq ir" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dw aj ak">
                <h1 id="ebb8" class="is it dz bk bj hx iu iv iw ix iy iz ja jb jc jd je">USB Serial</h1>
                <p id="814c" class="ge gf dz bk gg b gh jf gj jg gl jh gn ji gp jj gr">The code for handling USB Serial
                  interface is in <a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/cdc.c"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">cdc.c</a>. This is based on the <a
                    href="https://web.archive.org/web/20191204194248/https://github.com/Apress/Beg-STM32-Devel-FreeRTOS-libopencm3-GCC/blob/master/rtos/usbcdcdemo/usbcdc.c"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">sample code here</a>.</p>
                <figure class="jn jo jp jq jr cz do kg cd kh ki kj kk kl ba km kn ko kp kq kr paragraph-image">
                  <div class="kb kc di kd ak">
                    <div class="cl cm ld">
                      <div class="dh r di dj">
                        <div class="le r">
                          <div class="db dc cp t u dd ak de df dg"><img class="cp t u dd ak dl dm dn"
                              src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/46/1*UA6gHiWDenc0WOmYtQmL-A.png?q=20"
                              width="602" height="771" role="presentation" /></div><img class="db dc cp t u dd ak do"
                            width="602" height="771" role="presentation" /><noscript><img class="cp t u dd ak"
                              src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/1204/1*UA6gHiWDenc0WOmYtQmL-A.png"
                              width="602" height="771" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                  <figcaption class="bo dp dq dr ds cn cl cm dt du bj dv">Blue Pill appears as a USB Serial Device on
                    COM3. We may use putty to connect to COM3 and Blue Pill will echo everything that we type
                  </figcaption>
                </figure>
                <p id="aead" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">When you connect the Blue Pill to
                  your computer, the bootloader code exposes a USB serial port to the computer, which is useful for
                  debugging Blue Pill programs. For completeness <a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/cdc.c"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">I added the implementation of
                  </a><code class="dj ku kv kw kx b">USB_CDC_REQ_GET_LINE_CODING</code> just to satisfy Windows when it
                  asks for the serial port parameters (e.g. 9600 bps, 1 stop bit, 8 data bits).</p>
                <p id="6ef3" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">USB Serial is more complex than
                  USB Storage because we need to implement not one but two interfaces from the <a
                    href="https://web.archive.org/web/20191204194248/https://en.wikipedia.org/wiki/USB_communications_device_class"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow"><strong class="gg kt">USB
                      Communications Device Class (CDC)</strong></a><strong class="gg kt"> </strong>spec:</p>
                <ol class="">
                  <li id="541c" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr lf lg lh"><strong
                      class="gg kt">Data Model</strong> for sending and receiving data over the serial port</li>
                  <li id="1a60" class="ge gf dz bk gg b gh li gj lj gl lk gn ll gp lm gr lf lg lh"><strong
                      class="gg kt">Abstract Control Model (ACM)</strong> for getting and setting the serial connection
                    parameters, like 9600 bps, 1 stop bit, 8 data bits. <code
                      class="dj ku kv kw kx b">USB_CDC_REQ_GET_LINE_CODING</code> is part of the ACM interface. <a
                      href="https://web.archive.org/web/20191204194248/https://cscott.net/usb_dev/data/devclass/usbcdc11.pdf"
                      class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">More details here</a>.</li>
                </ol>
                <p id="fd80" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">We are stacking up multiple
                  interfaces — USB MSC (for storage) and USB CDC (for serial comms). And within USB CDC interface we are
                  stacking up the CDC Data and CDC ACM sub-interfaces.</p>
                <p id="ee2f" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">How does USB support this
                  stacking? With a USB Composite Device and multiple USB Descriptors.</p>
                <div class="gw gx gy gz ha hb"><a
                    href="https://web.archive.org/web/20191204194248/https://www.linkedin.com/feed/update/urn:li:activity:6479715878161223680?source=post_page-----36d7fe245b5c----------------------"
                    rel="noopener nofollow">
                    <section class="he cl cm ak ce n ar hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht">
                      <div class="hu n co p hv hw">
                        <h2 class="bj hx hy bl dz">
                          <div class="de hc fb fc hd fe">Lup Yuen Lee on LinkedIn: &quot;Supercomplicated USB
                            Descriptors for #STM32 Blue Pill UF2 Bootloader…</div>
                        </h2>
                        <div class="hz r">
                          <h3 class="bj dv dp bl bo">
                            <div class="de hc fb fc hd fe">December 15, 2018: Lup Yuen Lee posted images on LinkedIn
                            </div>
                          </h3>
                        </div>
                        <div class="ia r">
                          <h4 class="bj dv ft bl bo">
                            <div class="de hc fb fc hd fe">www.linkedin.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ib r">
                        <div class="ln r id ie if ib ig ih ii"></div>
                      </div>
                    </section>
                  </a></div>
              </div>
            </div>
          </section>
          <hr class="ij dv ik il im ds in io ip iq ir" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dw aj ak">
                <h1 id="339b" class="is it dz bk bj hx iu iv iw ix iy iz ja jb jc jd je">USB Descriptors</h1>
                <p id="2c5e" class="ge gf dz bk gg b gh jf gj jg gl jh gn ji gp jj gr">The Blue Pill Bootloader is a
                  <strong class="gg kt">USB Composite Device</strong>, meaning that it supports <strong
                    class="gg kt">multiple USB interfaces</strong> (storage, serial, DFU). When we connect the Blue Pill
                  to a computer, Windows (or Mac or Linux) will query the Blue Pill for the USB interfaces that it
                  supports. In the USB world, <a
                    href="https://web.archive.org/web/20191204194248/https://docs.microsoft.com/en-us/windows-hardware/drivers/usbcon/standard-usb-descriptors"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">everything is defined through
                    “Descriptors”.</a> Descriptors are very important for getting our Blue Pill to function as a proper
                  USB device under Windows, Mac AND Linux. So pay attention…</p>
                <figure class="jn jo jp jq jr cz cl cm paragraph-image">
                  <div class="kb kc di kd ak">
                    <div class="cl cm lo">
                      <div class="dh r di dj">
                        <div class="lp r">
                          <div class="db dc cp t u dd ak de df dg"><img class="cp t u dd ak dl dm dn"
                              src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/58/0*12MBGX-VO0gqSVnW.png?q=20"
                              width="444" height="458" role="presentation" /></div><img class="db dc cp t u dd ak do"
                            width="444" height="458" role="presentation" /><noscript><img class="cp t u dd ak"
                              src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/888/0*12MBGX-VO0gqSVnW.png"
                              width="444" height="458" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                  <figcaption class="bo dp dq dr ds cn cl cm dt du bj dv">Hierarchy of USB Descriptors. From <a
                      href="https://web.archive.org/web/20191204194248/https://docs.microsoft.com/en-us/windows-hardware/drivers/usbcon/standard-usb-descriptors"
                      class="at cg gs gt gu gv" target="_blank"
                      rel="noopener nofollow">https://docs.microsoft.com/en-us/windows-hardware/drivers/usbcon/standard-usb-descriptors</a>
                  </figcaption>
                </figure>
                <p id="872f" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">Our Blue Pill USB Descriptors <a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/usb_conf.c#L51-L336"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">are defined here</a>. As shown in
                  the diagram above, the USB Descriptors are defined in a hierarchy…</p>
                <figure class="jn jo jp jq jr cz do kg cd kh ki kj kk kl ba km lq lr ls lt kr">
                  <div class="dh r di">
                    <div class="la r"><iframe
                        src="https://web.archive.org/web/20191204194248if_/https://medium.com/media/1b80eb94276d5660c75c300a75f3129b"
                        allowfullscreen="" frameborder="0" height="0" width="0" title="usb-device.c"
                        class="cp t u dd ak" scrolling="auto"></iframe></div>
                  </div>
                  <figcaption class="bo dp dq dr ds cn cl cm dt du bj dv">USB Device Descriptor</figcaption>
                </figure>
                <p id="14fc" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr"><strong class="gg kt">1️⃣ Device
                    Descriptor</strong>: At the top level we define the USB Device.</p>
                <p id="be99" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">The Device Descriptor includes
                  the USB Vendor ID and Product ID (the official designation of the device), plus the manufacturer and
                  product names (defined as String Descriptors, explained below).</p>
                <figure class="jn jo jp jq jr cz do kg cd kh ki kj kk kl ba km lq lr ls lt kr">
                  <div class="dh r di">
                    <div class="la r"><iframe
                        src="https://web.archive.org/web/20191204194248if_/https://medium.com/media/cd3f7d00cb03baa919e9d9c47ed0edbe"
                        allowfullscreen="" frameborder="0" height="0" width="0" title="usb-configuration.c"
                        class="cp t u dd ak" scrolling="auto"></iframe></div>
                  </div>
                  <figcaption class="bo dp dq dr ds cn cl cm dt du bj dv">USB Configuration Descriptor</figcaption>
                </figure>
                <p id="e025" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">2️⃣ <strong
                    class="gg kt">Configuration Descriptor</strong>: At the next level we define the device
                  configuration, which includes the list of interfaces and the expected power to be supplied to the
                  device.</p>
                <figure class="jn jo jp jq jr cz do kg cd kh ki kj kk kl ba km lq lr ls lt kr">
                  <div class="dh r di">
                    <div class="la r"><iframe
                        src="https://web.archive.org/web/20191204194248if_/https://medium.com/media/11f4e3391f124fe6bd87638c61801e33"
                        allowfullscreen="" frameborder="0" height="0" width="0" title="usb-interface.c"
                        class="cp t u dd ak" scrolling="auto"></iframe></div>
                  </div>
                  <figcaption class="bo dp dq dr ds cn cl cm dt du bj dv">USB Interface Descriptor for USB Storage (MSC)
                    interface</figcaption>
                </figure>
                <p id="08e0" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">3️⃣ <strong
                    class="gg kt">Interface Descriptor</strong>: Defines the interfaces implemented by the device, like
                  MSC for USB Storage and CDC for USB Serial.</p>
                <p id="4727" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">Each interface includes a list of
                  USB endpoints (usually 0, 1 or 2 endpoints).</p>
                <figure class="jn jo jp jq jr cz do kg cd kh ki kj kk kl ba km lq lr ls lt kr">
                  <div class="dh r di">
                    <div class="la r"><iframe
                        src="https://web.archive.org/web/20191204194248if_/https://medium.com/media/02f6a2b8f9952d17b445bf465bd7b381"
                        allowfullscreen="" frameborder="0" height="0" width="0" title="usb-endpoint.c"
                        class="cp t u dd ak" scrolling="auto"></iframe></div>
                  </div>
                  <figcaption class="bo dp dq dr ds cn cl cm dt du bj dv">USB Endpoint Descriptors for USB Storage (MSC)
                    interface</figcaption>
                </figure>
                <p id="d8dc" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">4️⃣ <strong
                    class="gg kt">Endpoint Descriptor</strong>: What’s a USB endpoint? It works like a TCP socket. When
                  our Windows / Mac / Linux computer wishes to send a storage or serial request to the Blue Pill, the
                  computer needs to send the request to a USB endpoint (or address) for the USB interface (storage or
                  serial).</p>
                <p id="5c64" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">OUT endpoints are used by the
                  computer to send data to our Blue Pill. OUT endpoints are numbered <code
                    class="dj ku kv kw kx b">0x01, 0x02, … 0x0F</code>.</p>
                <p id="e516" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">IN endpoints are used by the Blue
                  Pill to send data to the computer. IN endpoints are numbered <code
                    class="dj ku kv kw kx b">0x81, 0x82, … 0x8F</code>.</p>
                <p id="d9e4" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">Endpoints <code
                    class="dj ku kv kw kx b">0x00</code> and <code class="dj ku kv kw kx b">0x80</code> are reserved for
                  USB device control messages. They are used by the computer to fetch the Blue Pill’s USB descriptors
                  and to control the Blue Pill.</p>
                <figure class="jn jo jp jq jr cz do kg cd kh ki kj kk kl ba km lq lr ls lt kr">
                  <div class="dh r di">
                    <div class="la r"><iframe
                        src="https://web.archive.org/web/20191204194248if_/https://medium.com/media/6ad4cb5f33eaaf161c0e137b9847dd88"
                        allowfullscreen="" frameborder="0" height="0" width="0" title="usb-interface-assoc.c"
                        class="cp t u dd ak" scrolling="auto"></iframe></div>
                  </div>
                  <figcaption class="bo dp dq dr ds cn cl cm dt du bj dv">USB Interface Association Descriptor for USB
                    Serial (CDC) interface</figcaption>
                </figure>
                <p id="1b5d" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">5️⃣ <strong
                    class="gg kt">Interface Association Descriptor</strong>: Remember that the USB Serial CDC interface
                  requires two sub-interfaces — CDC ACM and CDC Data?</p>
                <p id="ed4b" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">To do this we need to define the
                  parent interface for CDC and define ACM and Data as the child interfaces. The parent interface is
                  defined using the Interface Association Descriptor.</p>
                <p id="20e4" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">Check out the sample code, which
                  defines <code class="dj ku kv kw kx b">cdc_iface_assoc</code> as the parent Interface Association
                  Descriptor, and <code class="dj ku kv kw kx b">comm_iface, data_iface</code> as the child interfaces.
                </p>
                <p id="6ee3" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">How did I discover this obscure
                  descriptor? By using Wireshark to capture the USB traffic from BBC micro:bit! The micro:bit runs a UF2
                  Bootloader that’s as complex as ours, so it’s a good reference for our Blue Pill bootloader.</p>
                <figure class="jn jo jp jq jr cz do kg cd kh ki kj kk kl ba km lq lr ls lt kr">
                  <div class="dh r di">
                    <div class="la r"><iframe
                        src="https://web.archive.org/web/20191204194248if_/https://medium.com/media/c50500b9b344d8e89846b805af0cf93b"
                        allowfullscreen="" frameborder="0" height="0" width="0" title="usb-string.c"
                        class="cp t u dd ak" scrolling="auto"></iframe></div>
                  </div>
                  <figcaption class="bo dp dq dr ds cn cl cm dt du bj dv">USB String Descriptor</figcaption>
                </figure>
                <p id="b06a" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">6️⃣ <strong class="gg kt">String
                    Descriptor</strong>: The last descriptor defines all the text strings referenced by the other
                  descriptors, like the interface names. Each string is assigned a running sequence number 1, 2, 3, …
                </p>
                <figure class="jn jo jp jq jr cz do kg cd kh ki kj kk kl ba km kn ko kp kq kr paragraph-image">
                  <div class="kb kc di kd ak">
                    <div class="cl cm lu">
                      <div class="dh r di dj">
                        <div class="lv r">
                          <div class="db dc cp t u dd ak de df dg"><img class="cp t u dd ak dl dm dn"
                              src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/60/1*EDMD5Q8sFnKDNxzeZAQjKg.png?q=20"
                              width="619" height="522" role="presentation" /></div><img class="db dc cp t u dd ak do"
                            width="619" height="522" role="presentation" /><noscript><img class="cp t u dd ak"
                              src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/1238/1*EDMD5Q8sFnKDNxzeZAQjKg.png"
                              width="619" height="522" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                  <figcaption class="bo dp dq dr ds cn cl cm dt du bj dv">String Descriptor 0 returns the supported
                    Language ID (0x0409). From the Wireshark log <a
                      href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/logs/usb-windows.pcapng.gz"
                      class="at cg gs gt gu gv" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/bluepill-bootloader/blob/master/logs/usb-windows.pcapng.gz</a>
                  </figcaption>
                </figure>
                <p id="edbe" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">In the Wireshark capture logs we
                  may see the computer requesting for String Descriptor with index 0.</p>
                <p id="8c07" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">This is actually a request for
                  the Language ID that our device supports. By default the Blue Pill returns <code
                    class="dj ku kv kw kx b">0x0409</code>, the Language ID for US English.</p>
                <p id="4a8c" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">The above USB descriptors are
                  standard and we don’t need to write any code to handle the descriptor processing — libopencm3 handles
                  the requests for all these descriptors automagically.</p>
              </div>
            </div>
            <div class="cz">
              <div class="n p">
                <div class="lw lx ly lz ma mb ag mc ah md aj ak">
                  <figure class="jn jo jp jq jr cz mf mg paragraph-image">
                    <div class="kb kc di kd ak">
                      <div class="cl cm me">
                        <div class="dh r di dj">
                          <div class="mh r">
                            <div class="db dc cp t u dd ak de df dg"><img class="cp t u dd ak dl dm dn"
                                src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/60/1*5GAoWCMuQ8VMP4p5jfAC4g.png?q=20"
                                width="1756" height="892" role="presentation" /></div><img class="db dc cp t u dd ak do"
                              width="1756" height="892" role="presentation" /><noscript><img class="cp t u dd ak"
                                src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/3512/1*5GAoWCMuQ8VMP4p5jfAC4g.png"
                                width="1756" height="892" role="presentation" /></noscript>
                          </div>
                        </div>
                      </div>
                    </div>
                    <figcaption class="bo dp dq dr ds cn cl cm dt du bj dv">Long list of USB Descriptors used by our
                      Blue Pill bootloader. From <a
                        href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/usb_conf.c"
                        class="at cg gs gt gu gv" target="_blank"
                        rel="noopener nofollow">https://github.com/lupyuen/bluepill-bootloader/blob/master/src/usb_conf.c</a>
                    </figcaption>
                  </figure>
                </div>
              </div>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah dw aj ak">
                <p id="9845" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">The complete list of USB
                  descriptors for our Blue Pill bootloader is rather long, and it’s amazing that they all work for
                  Windows, Mac AND Linux! It’s unlikely that you’ll work on something this complex, but if you’re stuck,
                  do what I did… use Wireshark to sniff out another device that works!</p>
                <h1 id="15b1" class="is it dz bk bj hx iu jt iw ju iy jv ja jw jc jx je">USB 2.1 Descriptors</h1>
                <p id="4b7a" class="ge gf dz bk gg b gh jf gj jg gl jh gn ji gp jj gr">Ready for more USB descriptors?
                  Here’s a long and powerful one— the <strong class="gg kt">Binary Device Object Store (BOS)
                    Descriptor.</strong> The BOS Descriptor allows us to define USB descriptors that for non-standard
                  platforms, like Windows.</p>
                <p id="817c" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">Remember that we defined in the
                  USB Device Descriptor that we support USB 2.1 instead of the usual USB 2.0? <strong class="gg kt">USB
                    2.1 devices are required to support BOS Descriptors</strong>, which are not implemented in
                  libopencm3, so we have to <a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/usb21_standard.c#L61-L87"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">handle them in
                    usb21_standard.c</a>.</p>
                <p id="adb7" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">Why did we choose to implement
                  USB 2.1 and BOS Descriptors? So that we could implement WebUSB and USB DFU (we’ll meet them later).
                  The two BOS Descriptors we have <a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/webusb.c"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">implemented in webusb.c</a> are…
                </p>
                <figure class="jn jo jp jq jr cz do kg cd kh ki kj kk kl ba km lq lr ls lt kr">
                  <div class="dh r di">
                    <div class="la r"><iframe
                        src="https://web.archive.org/web/20191204194248if_/https://medium.com/media/5eff58ddcaef3b7c7b8ef1ca02c631b9"
                        allowfullscreen="" frameborder="0" height="0" width="0" title="webusb-bos.c"
                        class="cp t u dd ak" scrolling="auto"></iframe></div>
                  </div>
                </figure>
                <p id="6ec6" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">1️⃣ <strong class="gg kt">WebUSB
                    Descriptor</strong>: Here we declare that our Blue Pill bootloader supports the WebUSB standard,
                  implemented by Google Chrome web browsers.</p>
                <p id="cf25" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">When the Chrome browser detects
                  that our device supports WebUSB, it will send our device a USB request to fetch the landing page URL
                  for our device.</p>
                <figure class="jn jo jp jq jr cz cl cm paragraph-image">
                  <div class="kb kc di kd ak">
                    <div class="cl cm mi">
                      <div class="dh r di dj">
                        <div class="mj r">
                          <div class="db dc cp t u dd ak de df dg"><img class="cp t u dd ak dl dm dn"
                              src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/60/1*bXb6nabe53yN9EX-K9P5TA.png?q=20"
                              width="976" height="347" role="presentation" /></div><img class="db dc cp t u dd ak do"
                            width="976" height="347" role="presentation" /><noscript><img class="cp t u dd ak"
                              src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/1952/1*bXb6nabe53yN9EX-K9P5TA.png"
                              width="976" height="347" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                  <figcaption class="bo dp dq dr ds cn cl cm dt du bj dv">On macOS, the landing page URL is displayed as
                    a Chrome notification. On Windows the notification seems to be disabled.</figcaption>
                </figure>
                <p id="5139" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">This WebUSB request is <a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/webusb.c#L74-L118"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">implemented in webusb.c</a> since
                  it’s not a standard USB request handled by libopencm3. Chrome transmits the vendor code <code
                    class="dj ku kv kw kx b">0x22</code> in the request so that we know the request is from Chrome
                  WebUSB.</p>
                <figure class="jn jo jp jq jr cz do kg cd kh ki kj kk kl ba km lq lr ls lt kr">
                  <div class="dh r di">
                    <div class="la r"><iframe
                        src="https://web.archive.org/web/20191204194248if_/https://medium.com/media/93b52df9345a64c126abf08a4d1344cc"
                        allowfullscreen="" frameborder="0" height="0" width="0" title="msos-bos.c" class="cp t u dd ak"
                        scrolling="auto"></iframe></div>
                  </div>
                </figure>
                <p id="8ffb" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">2️⃣ <strong
                    class="gg kt">Microsoft OS 2.0 Descriptor</strong>: This defines a set of descriptors specific to
                  Windows that we’ll cover in the next section.</p>
                <p id="e77a" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">Windows will send our device a
                  USB request to fetch the set of Windows-specific descriptors.</p>
                <p id="46fe" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">This Windows descriptor request
                  is <a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/winusb.c#L159-L185"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">implemented in winusb.c</a> since
                  it’s not a standard USB request handled by libopencm3. Windows transmits the vendor code <code
                    class="dj ku kv kw kx b">0x21</code> in the request so that we know the request is from Windows.</p>
                <figure class="jn jo jp jq jr cz do kg cd kh ki kj kk kl ba km kn ko kp kq kr paragraph-image">
                  <div class="kb kc di kd ak">
                    <div class="cl cm mk">
                      <div class="dh r di dj">
                        <div class="ml r">
                          <div class="db dc cp t u dd ak de df dg"><img class="cp t u dd ak dl dm dn"
                              src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/60/1*n5_A43SFau7JB29cmykQmg.png?q=20"
                              width="1814" height="1402" role="presentation" /></div><img class="db dc cp t u dd ak do"
                            width="1814" height="1402" role="presentation" /><noscript><img class="cp t u dd ak"
                              src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/3628/1*n5_A43SFau7JB29cmykQmg.png"
                              width="1814" height="1402" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                  <figcaption class="bo dp dq dr ds cn cl cm dt du bj dv">Windows requesting the BOS Descriptor from
                    Blue Pill. From the Wireshark log <a
                      href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/logs/usb-windows.pcapng.gz"
                      class="at cg gs gt gu gv" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/bluepill-bootloader/blob/master/logs/usb-windows.pcapng.gz</a>
                  </figcaption>
                </figure>
                <p id="e432" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">The Microsoft OS 2.0 Descriptor
                  implementation is not part of the original bootloader source code. I added this code as a replacement
                  for the older Microsoft OS 1.0 Descriptor implementation. The older implementation is <a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/winusb.c#L186-L213"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">still in winusb.c</a>.</p>
                <p id="3ea5" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">For details of the BOS Descriptor
                  format, see the official <a
                    href="https://web.archive.org/web/20191204194248/https://www.usb.org/document-library/usb-32-specification-released-september-22-2017-and-ecns"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">USB 3.2 Specification</a><strong
                    class="gg kt">, </strong>Section 9.6.2 “Binary Device Object Store (BOS)”. If you’re looking for the
                  official USB 2.1 Specs… Don’t! Technically USB 2.1 doesn’t exist as a standard.</p>
                <p id="2fec" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">BOS is actually part of the USB
                  3.0 specs, but our Blue Pill bootloader doesn’t implement the entire USB 3.0 specs. The industry has
                  adopted the name “USB 2.1” to refer to a USB 2.0 device that supports BOS. Which fits our purpose
                  perfectly.</p>
              </div>
            </div>
          </section>
          <hr class="ij dv ik il im ds in io ip iq ir" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dw aj ak">
                <div class="jn jo jp jq jr hb"><a
                    href="https://web.archive.org/web/20191204194248/https://msdn.microsoft.com/en-us/library/windows/hardware/dn385747.aspx?source=post_page-----36d7fe245b5c----------------------"
                    rel="noopener nofollow">
                    <section class="he cl cm ak ce n ar hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht">
                      <div class="hu n co p hv hw">
                        <h2 class="bj hx hy bl dz">
                          <div class="de hc fb fc hd fe">Microsoft OS 2.0 Descriptors Specification</div>
                        </h2>
                        <div class="hz r">
                          <h3 class="bj dv dp bl bo">
                            <div class="de hc fb fc hd fe">(a) “Your Implementation” means Your: (i) firmware and/or
                              hardware that implements the OS Descriptor set described in…</div>
                          </h3>
                        </div>
                        <div class="ia r">
                          <h4 class="bj dv ft bl bo">
                            <div class="de hc fb fc hd fe">msdn.microsoft.com</div>
                          </h4>
                        </div>
                      </div>
                    </section>
                  </a></div>
                <h1 id="eb4a" class="is it dz bk bj hx iu jt iw ju iy jv ja jw jc jx je">Windows USB Descriptors</h1>
                <p id="437c" class="ge gf dz bk gg b gh jf gj jg gl jh gn ji gp jj gr">Because of the BOS Descriptor,
                  Windows will query our Blue Pill bootloader for the Microsoft OS 2.0 Descriptors documented above. The
                  long list of Windows descriptors for Blue Pill is <a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/winusb.c#L33-L91"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">defined in winusb.c</a> (obtained
                  <a href="https://web.archive.org/web/20191204194248/https://github.com/intel/zephyr.js/blob/master/src/zjs_webusb.c"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">from here</a>). We’ll look at two
                  interesting descriptors…</p>
                <figure class="jn jo jp jq jr cz do kg cd kh ki kj kk kl ba km lq lr ls lt kr">
                  <div class="dh r di">
                    <div class="la r"><iframe
                        src="https://web.archive.org/web/20191204194248if_/https://medium.com/media/bf71431157301245a58f7e7d71cf318e"
                        allowfullscreen="" frameborder="0" height="0" width="0" title="msos-compatible-id.c"
                        class="cp t u dd ak" scrolling="auto"></iframe></div>
                  </div>
                  <figcaption class="bo dp dq dr ds cn cl cm dt du bj dv">Compatible ID Descriptor</figcaption>
                </figure>
                <figure class="da cz do kg cd kh ki kj kk kl ba km lq lr ls lt kr">
                  <div class="dh r di">
                    <div class="la r"><iframe
                        src="https://web.archive.org/web/20191204194248if_/https://medium.com/media/61d9c66dbc4296748ead3e5488786aab"
                        allowfullscreen="" frameborder="0" height="0" width="0" title="msos-property.c"
                        class="cp t u dd ak" scrolling="auto"></iframe></div>
                  </div>
                  <figcaption class="bo dp dq dr ds cn cl cm dt du bj dv">Registry Property Descriptor</figcaption>
                </figure>
                <p id="d533" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">1️⃣ <strong
                    class="gg kt">Compatible ID Descriptor</strong>: This declares to Windows that the first USB
                  interface (DFU) of our Blue Pill bootloader is compatible with WinUSB.</p>
                <p id="58f8" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">Windows will then use the
                  standard <code class="dj ku kv kw kx b">WinUSB.sys</code> driver for the DFU interface.</p>
                <p id="8db4" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">2️⃣ <strong
                    class="gg kt">Registry Property Descriptor</strong>: This declares to Windows that it should create
                  a Windows registry setting named <code class="dj ku kv kw kx b">DeviceInterfaceGUIDs</code> with value
                  <code class="dj ku kv kw kx b">{9D32F82C-1FB2–4486–8501-B6145B5BA336}</code></p>
                <p id="1846" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">Creating this registry setting is
                  mandatory when using the WinUSB driver for a USB interface.</p>
                <p id="d413" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr"><strong class="gg kt">Why use
                    WinUSB for the DFU interface?</strong></p>
                <p id="87f5" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">The <a
                    href="https://web.archive.org/web/20191204194248/https://www.st.com/content/ccc/resource/technical/document/application_note/6a/17/92/02/58/98/45/0c/CD00264379.pdf/files/CD00264379.pdf/jcr:content/translations/en.CD00264379.pdf"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">STM32 DFU</a> USB Interface <a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/dfu.c"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">implemented in dfu.c</a> is meant
                  to allow us to flash the Blue Pill through the Chrome browser, without the installation of any
                  drivers. The WinUSB driver is preloaded with Windows, so it doesn’t need any installation.</p>
                <p id="8468" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">WinUSB exposes a low-level data
                  transfer interface that WebUSB applications may call to <a
                    href="https://web.archive.org/web/20191204194248/https://developer.mozilla.org/en-US/docs/Web/API/USBDevice/controlTransferOut"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">transfer data to the DFU
                    interface</a>. So WinUSB is the right Windows USB driver for supporting the DFU interface. For more
                  details, check this article…</p>
                <div class="gw gx gy gz ha hb"><a
                    href="https://web.archive.org/web/20191204194248/https://docs.microsoft.com/en-us/windows-hardware/drivers/usbcon/automatic-installation-of-winusb?source=post_page-----36d7fe245b5c----------------------"
                    rel="noopener nofollow">
                    <section class="he cl cm ak ce n ar hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht">
                      <div class="hu n co p hv hw">
                        <h2 class="bj hx hy bl dz">
                          <div class="de hc fb fc hd fe">WinUSB Device - Windows drivers</div>
                        </h2>
                        <div class="hz r">
                          <h3 class="bj dv dp bl bo">
                            <div class="de hc fb fc hd fe">In this topic, you will learn about how a WinUSB device is
                              recognized in Windows 8. The information in this topic…</div>
                          </h3>
                        </div>
                        <div class="ia r">
                          <h4 class="bj dv ft bl bo">
                            <div class="de hc fb fc hd fe">docs.microsoft.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ib r">
                        <div class="mm r id ie if ib ig ih ii"></div>
                      </div>
                    </section>
                  </a></div>
                <p id="1cfa" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">When you’re changing the Blue
                  Pill bootloader code and testing it, make sure you run <code class="dj ku kv kw kx b">regedit</code>
                  and delete the Windows registry key <code
                    class="dj ku kv kw kx b">HLKM\SYSTEM\CurrentControlSet\Control\UsbFlags\vvvvpppprrrrr</code><em
                    class="kz"> </em>where <code class="dj ku kv kw kx b">vvvv</code> is the vendor ID, <code
                    class="dj ku kv kw kx b">pppp</code> is the product ID and <code
                    class="dj ku kv kw kx b">rrrrr</code> is the device revision number. If the key exists, Windows will
                  skip the querying of descriptors from the Blue Pill bootloader, and use the old descriptors values
                  instead. This is mentioned here…</p>
                <div class="gw gx gy gz ha hb"><a
                    href="https://web.archive.org/web/20191204194248/https://docs.microsoft.com/en-us/windows-hardware/drivers/usbcon/microsoft-defined-usb-descriptors?source=post_page-----36d7fe245b5c----------------------"
                    rel="noopener nofollow">
                    <section class="he cl cm ak ce n ar hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht">
                      <div class="hu n co p hv hw">
                        <h2 class="bj hx hy bl dz">
                          <div class="de hc fb fc hd fe">Microsoft OS Descriptors for USB Devices - Windows drivers
                          </div>
                        </h2>
                        <div class="hz r">
                          <h3 class="bj dv dp bl bo">
                            <div class="de hc fb fc hd fe">Microsoft provides a set of proprietary device classes and
                              USB descriptors, which are called Microsoft OS Descriptors…</div>
                          </h3>
                        </div>
                        <div class="ia r">
                          <h4 class="bj dv ft bl bo">
                            <div class="de hc fb fc hd fe">docs.microsoft.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ib r">
                        <div class="mn r id ie if ib ig ih ii"></div>
                      </div>
                    </section>
                  </a></div>
              </div>
            </div>
          </section>
          <hr class="ij dv ik il im ds in io ip iq ir" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dw aj ak">
                <div class="jn jo jp jq jr hb"><a
                    href="https://web.archive.org/web/20191204194248/https://devanlai.github.io/webdfu/dfu-util/?source=post_page-----36d7fe245b5c----------------------"
                    rel="noopener nofollow">
                    <section class="he cl cm ak ce n ar hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht">
                      <div class="hu n co p hv hw">
                        <h2 class="bj hx hy bl dz">
                          <div class="de hc fb fc hd fe">WebUSB DFU</div>
                        </h2>
                        <div class="hz r">
                          <h3 class="bj dv dp bl bo">
                            <div class="de hc fb fc hd fe">Your device has multiple DFU interfaces. Select one from the
                              list below:</div>
                          </h3>
                        </div>
                        <div class="ia r">
                          <h4 class="bj dv ft bl bo">
                            <div class="de hc fb fc hd fe">devanlai.github.io</div>
                          </h4>
                        </div>
                      </div>
                    </section>
                  </a></div>
                <h1 id="1171" class="is it dz bk bj hx iu jt iw ju iy jv ja jw jc jx je">WebUSB</h1>
                <p id="a0c3" class="ge gf dz bk gg b gh jf gj jg gl jh gn ji gp jj gr">Now that WebUSB and WinUSB have
                  been configured for our Blue Pill’s DFU interface, click the link above to test them. We should be
                  able to communicate with the Blue Pill bootloader through the Chrome browser and prepare to flash the
                  ROM (set the Transfer Size to 256 bytes) with the <a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/firmware.bin"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">firmware.bin file</a>. (But don’t
                  run the flash command yet because the bootloader has exceeded the 16K limit and will clash with the
                  flashed firmware.)</p>
              </div>
            </div>
            <div class="cz">
              <div class="n p">
                <div class="lw lx ly lz ma mb ag mc ah md aj ak">
                  <figure class="jn jo jp jq jr cz">
                    <div class="dh r di">
                      <div class="mo r"><iframe
                          src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FsrSTTt1fTeI%3Ffeature%3Doembed&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DsrSTTt1fTeI&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2FsrSTTt1fTeI%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube"
                          allowfullscreen="" frameborder="0" height="480" width="640"
                          title="STM32 Blue Pill Bootloader with WebUSB DFU" class="cp t u dd ak"
                          scrolling="auto"></iframe></div>
                    </div>
                  </figure>
                </div>
              </div>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah dw aj ak">
                <p id="a9ee" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">To experiment with WebUSB, open a
                  Chrome console and enter this…</p>
                <pre
                  class="jn jo jp jq jr mp mq mr"><span id="261f" class="ms it dz bk kx b dp mt mu r mv">await navigator.usb.requestDevice({ filters: [] })</span></pre>
                <p id="6315" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">This lets us browse the Blue Pill
                  bootloader descriptors through the JavaScript console in Chrome. If we sniff the USB data with
                  Wireshark while this is running, we’ll see that the Chrome browser actually sends its own queries to
                  refetch the USB descriptors.</p>
              </div>
            </div>
            <div class="cz">
              <div class="n p">
                <div class="lw lx ly lz ma mb ag mc ah md aj ak">
                  <figure class="jn jo jp jq jr cz">
                    <div class="dh r di">
                      <div class="mo r"><iframe
                          src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FJbwl7g-jMIw%3Ffeature%3Doembed&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DJbwl7g-jMIw&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2FJbwl7g-jMIw%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube"
                          allowfullscreen="" frameborder="0" height="480" width="640"
                          title="STM32 Blue Pill Bootloader with WebUSB" class="cp t u dd ak" scrolling="auto"></iframe>
                      </div>
                    </div>
                  </figure>
                </div>
              </div>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah dw aj ak">
                <p id="ae89" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">I have tested the Blue Pill
                  bootloader’s WebUSB support on Chrome for <strong class="gg kt">Windows, Mac and Ubuntu</strong>
                  (requires root privilege). To troubleshoot the WebUSB interface, use the <strong class="gg kt">Chrome
                    Device Log</strong>:</p>
                <pre
                  class="jn jo jp jq jr mp mq mr"><span id="d16d" class="ms it dz bk kx b dp mt mu r mv">chrome://device-log/</span></pre>
                <p id="2de7" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">For details of the WebUSB
                  JavaScript API, refer to these docs…</p>
                <div class="gw gx gy gz ha hb"><a
                    href="https://web.archive.org/web/20191204194248/https://developer.mozilla.org/en-US/docs/Web/API/USB?source=post_page-----36d7fe245b5c----------------------"
                    rel="noopener nofollow">
                    <section class="he cl cm ak ce n ar hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht">
                      <div class="hu n co p hv hw">
                        <h2 class="bj hx hy bl dz">
                          <div class="de hc fb fc hd fe">USB</div>
                        </h2>
                        <div class="hz r">
                          <h3 class="bj dv dp bl bo">
                            <div class="de hc fb fc hd fe">The USB interface of the WebUSB API provides attributes and
                              methods for finding and connecting USB devices from a web…</div>
                          </h3>
                        </div>
                        <div class="ia r">
                          <h4 class="bj dv ft bl bo">
                            <div class="de hc fb fc hd fe">developer.mozilla.org</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ib r">
                        <div class="mw r id ie if ib ig ih ii"></div>
                      </div>
                    </section>
                  </a></div>
                <div class="gw gx gy gz ha hb"><a
                    href="https://web.archive.org/web/20191204194248/https://developer.mozilla.org/en-US/docs/Web/API/USBDevice?source=post_page-----36d7fe245b5c----------------------"
                    rel="noopener nofollow">
                    <section class="he cl cm ak ce n ar hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht">
                      <div class="hu n co p hv hw">
                        <h2 class="bj hx hy bl dz">
                          <div class="de hc fb fc hd fe">USBDevice</div>
                        </h2>
                        <div class="hz r">
                          <h3 class="bj dv dp bl bo">
                            <div class="de hc fb fc hd fe">The USBDevice interface of the the WebUSB API provides access
                              to metadata about a paired USB device and methods for…</div>
                          </h3>
                        </div>
                        <div class="ia r">
                          <h4 class="bj dv ft bl bo">
                            <div class="de hc fb fc hd fe">developer.mozilla.org</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ib r">
                        <div class="mx r id ie if ib ig ih ii"></div>
                      </div>
                    </section>
                  </a></div>
              </div>
            </div>
          </section>
          <hr class="ij dv ik il im ds in io ip iq ir" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dw aj ak">
                <div class="jn jo jp jq jr hb"><a
                    href="https://web.archive.org/web/20191204194248/https://www.linkedin.com/feed/update/urn:li:activity:6479571365698605056?source=post_page-----36d7fe245b5c----------------------"
                    rel="noopener nofollow">
                    <section class="he cl cm ak ce n ar hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht">
                      <div class="hu n co p hv hw">
                        <h2 class="bj hx hy bl dz">
                          <div class="de hc fb fc hd fe">Lup Yuen Lee on LinkedIn: &quot;Quiz for #libopencm3 hackers...
                            What&#x27;s wrong with this sample code…</div>
                        </h2>
                        <div class="hz r">
                          <h3 class="bj dv dp bl bo">
                            <div class="de hc fb fc hd fe">December 15, 2018: Lup Yuen Lee posted images on LinkedIn
                            </div>
                          </h3>
                        </div>
                        <div class="ia r">
                          <h4 class="bj dv ft bl bo">
                            <div class="de hc fb fc hd fe">www.linkedin.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ib r">
                        <div class="my r id ie if ib ig ih ii"></div>
                      </div>
                    </section>
                  </a></div>
                <h1 id="e170" class="is it dz bk bj hx iu jt iw ju iy jv ja jw jc jx je">USB Callbacks</h1>
                <p id="267c" class="ge gf dz bk gg b gh jf gj jg gl jh gn ji gp jj gr">The sample USB programs for
                  libopencm3 look like this…</p>
                <figure class="jn jo jp jq jr cz">
                
                  <p><script src="https://gist.github.com/lupyuen/aa2a674563793789f5bb25165a4bdf5276aaa.js"></script></p>


                  <figcaption class="bo dp dq dr ds cn cl cm dt du bj dv">Sample USB code from <a
                      href="https://web.archive.org/web/20191204194248/https://github.com/libopencm3/libopencm3-examples/blob/master/examples/stm32/f3/stm32f3-discovery/usb_cdcacm/cdcacm.c"
                      class="at cg gs gt gu gv" target="_blank"
                      rel="noopener nofollow">https://github.com/libopencm3/libopencm3-examples/blob/master/examples/stm32/f3/stm32f3-discovery/usb_cdcacm/cdcacm.c</a>
                  </figcaption>
                </figure>
                <p id="b377" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">There are 2 functions used to
                  register callbacks in USB programs…</p>
                <ol class="">
                  <li id="c30f" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr lf lg lh"><code
                      class="dj ku kv kw kx b">usbd_register_set_config_callback()</code>: This registers a callback
                    function that is called when the USB device has set its configuration.</li>
                  <li id="a34d" class="ge gf dz bk gg b gh li gj lj gl lk gn ll gp lm gr lf lg lh"><code
                      class="dj ku kv kw kx b">usbd_register_control_callback()</code>: This registers a callback
                    function that is called when the USB device receives a request on the control channel.</li>
                </ol>
                <p id="b7b2" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">Each of these functions support
                  up to maximum of 4 callbacks. Since our Blue Pill bootloader has 4 USB interfaces + BOS Interface +
                  WinUSB + WebUSB, we would have exceeded the limit. So I wrote <a
                    href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/usb_conf.c#L407-L532"
                    class="at cg gs gt gu gv" target="_blank" rel="noopener nofollow">my own code to aggregate the
                    callbacks</a>, supporting up to 10 callbacks.</p>
                <p id="0794" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">To use the aggregated callbacks,
                  we change the code as follows…</p>
                <ol class="">
                  <li id="e3ad" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr lf lg lh">Change<em class="kz">
                    </em><code class="dj ku kv kw kx b"><em class="kz">usbd_register_set_config_callback</em></code>
                    <br />to <strong class="gg kt">aggregate_register_config_callback</strong></li>
                  <li id="21c1" class="ge gf dz bk gg b gh li gj lj gl lk gn ll gp lm gr lf lg lh">Change <code
                      class="dj ku kv kw kx b"><em class="kz">usbd_register_control_callback</em></code><em class="kz">
                      <br /></em>to<strong class="gg kt"> aggregate_register_callback</strong></li>
                </ol>
                <p id="1276" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">We should always check the status
                  of the callback registration like this…</p>
                <figure class="jn jo jp jq jr cz">
              
                  <p><script src="https://gist.github.com/lupyuen/7bf824d65ad4c065f41fa96352fdcdae.js"></script></p>


                  <figcaption class="bo dp dq dr ds cn cl cm dt du bj dv">Aggregating USB callbacks, from <a
                      href="https://web.archive.org/web/20191204194248/https://github.com/lupyuen/bluepill-bootloader/blob/master/src/cdc.c"
                      class="at cg gs gt gu gv" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/bluepill-bootloader/blob/master/src/cdc.c</a>
                  </figcaption>
                </figure>
              </div>
            </div>
          </section>
          <hr class="ij dv ik il im ds in io ip iq ir" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dw aj ak">
                <div class="jn jo jp jq jr hb"><a
                    href="https://web.archive.org/web/20191204194248/https://www.linkedin.com/feed/update/urn:li:activity:6480260050907693056?source=post_page-----36d7fe245b5c----------------------"
                    rel="noopener nofollow">
                    <section class="he cl cm ak ce n ar hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht">
                      <div class="hu n co p hv hw">
                        <h2 class="bj hx hy bl dz">
                          <div class="de hc fb fc hd fe">Lup Yuen Lee on LinkedIn: &quot;#STM32 Blue Pill Bootloader now
                            runs great... Supports USB Storage, USB…</div>
                        </h2>
                        <div class="hz r">
                          <h3 class="bj dv dp bl bo">
                            <div class="de hc fb fc hd fe">December 17, 2018: Lup Yuen Lee posted images on LinkedIn
                            </div>
                          </h3>
                        </div>
                        <div class="ia r">
                          <h4 class="bj dv ft bl bo">
                            <div class="de hc fb fc hd fe">www.linkedin.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ib r">
                        <div class="mz r id ie if ib ig ih ii"></div>
                      </div>
                    </section>
                  </a></div>
                <h1 id="6c25" class="is it dz bk bj hx iu jt iw ju iy jv ja jw jc jx je">Finally It Works!</h1>
                <p id="405c" class="ge gf dz bk gg b gh jf gj jg gl jh gn ji gp jj gr">This version of the Blue Pill
                  Bootloader worked successfully on Windows, Mac and Linux after lots of experimenting. It’s my first
                  time working on USB firmware and I wished there were more articles explaining what’s really happening
                  in the USB realm. I hope this article, source code and captured USB logs will get you started on USB
                  firmware programming a lot faster.</p>
              </div>
            </div>
            <div class="cz ak">
              <figure class="jn jo jp jq jr cz ak paragraph-image">
                <div class="dh r di dj">
                  <div class="dk r">
                    <div class="db dc cp t u dd ak de df dg"><img class="cp t u dd ak dl dm dn"
                        src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/60/1*fjfoda1Ovwdahy09TwUkqA.png?q=20"
                        width="1920" height="1080" role="presentation" /></div><img class="db dc cp t u dd ak do"
                      width="1920" height="1080" role="presentation" /><noscript><img class="cp t u dd ak"
                        src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/max/3840/1*fjfoda1Ovwdahy09TwUkqA.png"
                        width="1920" height="1080" role="presentation" /></noscript>
                  </div>
                </div>
              </figure>
            </div>
          </section>
          <hr class="ij dv ik il im ds in io ip iq ir" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dw aj ak">
                <div class="jn jo jp jq jr hb"><a
                    href="https://web.archive.org/web/20191204194248/https://www.linkedin.com/feed/update/urn:li:activity:6481124238043504640?source=post_page-----36d7fe245b5c----------------------"
                    rel="noopener nofollow">
                    <section class="he cl cm ak ce n ar hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht">
                      <div class="hu n co p hv hw">
                        <h2 class="bj hx hy bl dz">
                          <div class="de hc fb fc hd fe">Lup Yuen Lee on LinkedIn: &quot;#STM32 Blue Pill Bootloader now
                            supports ROM flashing via Chrome…</div>
                        </h2>
                        <div class="hz r">
                          <h3 class="bj dv dp bl bo">
                            <div class="de hc fb fc hd fe">December 19, 2018: Lup Yuen Lee posted on LinkedIn</div>
                          </h3>
                        </div>
                        <div class="ia r">
                          <h4 class="bj dv ft bl bo">
                            <div class="de hc fb fc hd fe">www.linkedin.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ib r">
                        <div class="na r id ie if ib ig ih ii"></div>
                      </div>
                    </section>
                  </a></div>
                <h1 id="171d" class="is it dz bk bj hx iu jt iw ju iy jv ja jw jc jx je">And the work goes on…</h1>
                <p id="771d" class="ge gf dz bk gg b gh jf gj jg gl jh gn ji gp jj gr">I have started working on a new
                  branch that supports WebUSB flashing using MakeCode’s HF2 protocol. Check out my updates here…</p>
                <div class="gw gx gy gz ha hb"><a rel="noopener"
                    href="/web/20191204194248/https://medium.com/@ly.lee/stm32-blue-pill-dissecting-the-webusb-bootloader-for-makecode-b7f1a1508e89?source=post_page-----36d7fe245b5c----------------------">
                    <section class="he cl cm ak ce n ar hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht">
                      <div class="hu n co p hv hw">
                        <h2 class="bj hx hy bl dz">
                          <div class="de hc fb fc hd fe">STM32 Blue Pill — Dissecting the WebUSB Bootloader for MakeCode
                          </div>
                        </h2>
                        <div class="hz r">
                          <h3 class="bj dv dp bl bo">
                            <div class="de hc fb fc hd fe">How the MakeCode Bootloader for Blue Pill implements flashing
                              over WebUSB</div>
                          </h3>
                        </div>
                        <div class="ia r">
                          <h4 class="bj dv ft bl bo">
                            <div class="de hc fb fc hd fe">medium.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ib r">
                        <div class="nb r id ie if ib ig ih ii"></div>
                      </div>
                    </section>
                  </a></div>
                <p id="c3ce" class="ge gf dz bk gg b gh gi gj gk gl gm gn go gp gq gr">Is it possible to upgrade the
                  Bootloader through another Bootloader? Yes we can! Check this article…</p>
                <div class="gw gx gy gz ha hb"><a rel="noopener"
                    href="/web/20191204194248/https://medium.com/@ly.lee/stm32-blue-pill-bootloading-the-webusb-bootloader-63398ef5eb76?source=post_page-----36d7fe245b5c----------------------">
                    <section class="he cl cm ak ce n ar hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht">
                      <div class="hu n co p hv hw">
                        <h2 class="bj hx hy bl dz">
                          <div class="de hc fb fc hd fe">STM32 Blue Pill — Bootloading the WebUSB Bootloader</div>
                        </h2>
                        <div class="hz r">
                          <h3 class="bj dv dp bl bo">
                            <div class="de hc fb fc hd fe">How does the WebUSB Bootloader upgrade itself? With a special
                              Baseloader</div>
                          </h3>
                        </div>
                        <div class="ia r">
                          <h4 class="bj dv ft bl bo">
                            <div class="de hc fb fc hd fe">medium.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ib r">
                        <div class="nc r id ie if ib ig ih ii"></div>
                      </div>
                    </section>
                  </a></div>
              </div>
            </div>
            <div class="cz ak">
              <figure class="jn jo jp jq jr cz">
                <div class="dh r di">
                  <div class="mo r"><iframe
                      src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2Ff3inYvl6j4E%3Ffeature%3Doembed&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3Df3inYvl6j4E&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2Ff3inYvl6j4E%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube"
                      allowfullscreen="" frameborder="0" height="480" width="640"
                      title="STM32 Blue Pill and MakeCode flashing with HF2 over WebUSB" class="cp t u dd ak"
                      scrolling="auto"></iframe></div>
                </div>
              </figure>
            </div>
          </section>
        </div>
      </article>
      <div class="db ct nd s ak ne nf ng" data-test-id="post-sidebar">
        <div class="n p">
          <div class="ac ae af ag ah ai aj ak">
            <div class="nh n co">
              <div class="ct">
                <div class="ni nj nk n">
                  <div class="n o">
                    <div class="nl r di"><a
                        href="https://web.archive.org/web/20191204194248/https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Fstm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c&amp;source=post_sidebar-----36d7fe245b5c---------------------clap_sidebar-"
                        class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener">
                        <div class="ba nm nn no np nq nr ns nt nu nv"><svg width="29" height="29">
                            <g fill-rule="evenodd">
                              <path
                                d="M13.74 1l.76 2.97.76-2.97zM16.82 4.78l1.84-2.56-1.43-.47zM10.38 2.22l1.84 2.56-.41-3.03zM22.38 22.62a5.11 5.11 0 0 1-3.16 1.61l.49-.45c2.88-2.89 3.45-5.98 1.69-9.21l-1.1-1.94-.96-2.02c-.31-.67-.23-1.18.25-1.55a.84.84 0 0 1 .66-.16c.34.05.66.28.88.6l2.85 5.02c1.18 1.97 1.38 5.12-1.6 8.1M9.1 22.1l-5.02-5.02a1 1 0 0 1 .7-1.7 1 1 0 0 1 .72.3l2.6 2.6a.44.44 0 0 0 .63-.62L6.1 15.04l-1.75-1.75a1 1 0 1 1 1.41-1.41l4.15 4.15a.44.44 0 0 0 .63 0 .44.44 0 0 0 0-.62L6.4 11.26l-1.18-1.18a1 1 0 0 1 0-1.4 1.02 1.02 0 0 1 1.41 0l1.18 1.16L11.96 14a.44.44 0 0 0 .62 0 .44.44 0 0 0 0-.63L8.43 9.22a.99.99 0 0 1-.3-.7.99.99 0 0 1 .3-.7 1 1 0 0 1 1.41 0l7 6.98a.44.44 0 0 0 .7-.5l-1.35-2.85c-.31-.68-.23-1.19.25-1.56a.85.85 0 0 1 .66-.16c.34.06.66.28.88.6L20.63 15c1.57 2.88 1.07 5.54-1.55 8.16a5.62 5.62 0 0 1-5.06 1.65 9.35 9.35 0 0 1-4.93-2.72zM13 6.98l2.56 2.56c-.5.6-.56 1.41-.15 2.28l.26.56-4.25-4.25a.98.98 0 0 1-.12-.45 1 1 0 0 1 .29-.7 1.02 1.02 0 0 1 1.41 0zm8.89 2.06c-.38-.56-.9-.92-1.49-1.01a1.74 1.74 0 0 0-1.34.33c-.38.29-.61.65-.71 1.06a2.1 2.1 0 0 0-1.1-.56 1.78 1.78 0 0 0-.99.13l-2.64-2.64a1.88 1.88 0 0 0-2.65 0 1.86 1.86 0 0 0-.48.85 1.89 1.89 0 0 0-2.67-.01 1.87 1.87 0 0 0-.5.9c-.76-.75-2-.75-2.7-.04a1.88 1.88 0 0 0 0 2.66c-.3.12-.61.29-.87.55a1.88 1.88 0 0 0 0 2.66l.62.62a1.88 1.88 0 0 0-.9 3.16l5.01 5.02c1.6 1.6 3.52 2.64 5.4 2.96a7.16 7.16 0 0 0 1.18.1c1.03 0 2-.25 2.9-.7A5.9 5.9 0 0 0 23 23.24c3.34-3.34 3.08-6.93 1.74-9.17l-2.87-5.04z">
                              </path>
                            </g>
                          </svg></div>
                      </a></div>
                    <div class="nw r">
                      <div class="nx">
                        <h4 class="bj dv dp bl bo"><button class="at au av aw ax ay az ba bb bc bd be bf bg bh bi">81
                          </button></h4>
                      </div>
                    </div>
                  </div>
                </div>
                <div>
                  <div class="cf"><a
                      href="https://web.archive.org/web/20191204194248/https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Fstm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c&amp;source=post_sidebar--------------------------bookmark_sidebar-"
                      class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener"><svg width="25" height="25"
                        viewbox="0 0 25 25">
                        <path
                          d="M19 6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14.66h.01c.01.1.05.2.12.28a.5.5 0 0 0 .7.03l5.67-4.12 5.66 4.13a.5.5 0 0 0 .71-.03.5.5 0 0 0 .12-.29H19V6zm-6.84 9.97L7 19.64V6a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v13.64l-5.16-3.67a.49.49 0 0 0-.68 0z"
                          fill-rule="evenodd"></path>
                      </svg></a></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="db ct nd s ny eu nz oa nf ob"></div>
      <div>
        <div class="oc cz n co p">
          <div class="n p">
            <div class="ac ae af ag ah dw aj ak">
              <div class="n od"></div>
              <div class="n o od"></div>
              <div class="oe r">
                <ul class="ba bb">
                  <li class="cf of og oh"><a href="/web/20191204194248/https://medium.com/tag/usb"
                      class="oi oj cg bo r mq ok a b ft">USB</a></li>
                  <li class="cf of og oh"><a href="/web/20191204194248/https://medium.com/tag/stm32"
                      class="oi oj cg bo r mq ok a b ft">Stm32</a></li>
                  <li class="cf of og oh"><a href="/web/20191204194248/https://medium.com/tag/programming"
                      class="oi oj cg bo r mq ok a b ft">Programming</a></li>
                  <li class="cf of og oh"><a href="/web/20191204194248/https://medium.com/tag/embedded-systems"
                      class="oi oj cg bo r mq ok a b ft">Embedded Systems</a></li>
                </ul>
              </div>
              <div class="ol n ek ab">
                <div class="n o">
                  <div class="om r di"><a
                      href="https://web.archive.org/web/20191204194248/https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Fstm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c&amp;source=post_actions_footer-----36d7fe245b5c---------------------clap_footer-"
                      class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener">
                      <div class="c on ew n o oo di op oq or os ot ou ov ow ox oy oz pa pb pc">
                        <div class="ba nm nn no np nq pd ns o do ew n p pe u dd cp t ak nt nu nv pf"><svg width="33"
                            height="33" viewbox="0 0 33 33">
                            <path
                              d="M28.86 17.34l-3.64-6.4c-.3-.43-.71-.73-1.16-.8a1.12 1.12 0 0 0-.9.21c-.62.5-.73 1.18-.32 2.06l1.22 2.6 1.4 2.45c2.23 4.09 1.51 8-2.15 11.66a9.6 9.6 0 0 1-.8.71 6.53 6.53 0 0 0 4.3-2.1c3.82-3.82 3.57-7.87 2.05-10.39zm-6.25 11.08c3.35-3.35 4-6.78 1.98-10.47L21.2 12c-.3-.43-.71-.72-1.16-.8a1.12 1.12 0 0 0-.9.22c-.62.49-.74 1.18-.32 2.06l1.72 3.63a.5.5 0 0 1-.81.57l-8.91-8.9a1.33 1.33 0 0 0-1.89 1.88l5.3 5.3a.5.5 0 0 1-.71.7l-5.3-5.3-1.49-1.49c-.5-.5-1.38-.5-1.88 0a1.34 1.34 0 0 0 0 1.89l1.49 1.5 5.3 5.28a.5.5 0 0 1-.36.86.5.5 0 0 1-.36-.15l-5.29-5.29a1.34 1.34 0 0 0-1.88 0 1.34 1.34 0 0 0 0 1.89l2.23 2.23L9.3 21.4a.5.5 0 0 1-.36.85.5.5 0 0 1-.35-.14l-3.32-3.33a1.33 1.33 0 0 0-1.89 0 1.32 1.32 0 0 0-.39.95c0 .35.14.69.4.94l6.39 6.4c3.53 3.53 8.86 5.3 12.82 1.35zM12.73 9.26l5.68 5.68-.49-1.04c-.52-1.1-.43-2.13.22-2.89l-3.3-3.3a1.34 1.34 0 0 0-1.88 0 1.33 1.33 0 0 0-.4.94c0 .22.07.42.17.61zm14.79 19.18a7.46 7.46 0 0 1-6.41 2.31 7.92 7.92 0 0 1-3.67.9c-3.05 0-6.12-1.63-8.36-3.88l-6.4-6.4A2.31 2.31 0 0 1 2 19.72a2.33 2.33 0 0 1 1.92-2.3l-.87-.87a2.34 2.34 0 0 1 0-3.3 2.33 2.33 0 0 1 1.24-.64l-.14-.14a2.34 2.34 0 0 1 0-3.3 2.39 2.39 0 0 1 3.3 0l.14.14a2.33 2.33 0 0 1 3.95-1.24l.09.09c.09-.42.29-.83.62-1.16a2.34 2.34 0 0 1 3.3 0l3.38 3.39a2.17 2.17 0 0 1 1.27-.17c.54.08 1.03.35 1.45.76.1-.55.41-1.03.9-1.42a2.12 2.12 0 0 1 1.67-.4 2.8 2.8 0 0 1 1.85 1.25l3.65 6.43c1.7 2.83 2.03 7.37-2.2 11.6zM13.22.48l-1.92.89 2.37 2.83-.45-3.72zm8.48.88L19.78.5l-.44 3.7 2.36-2.84zM16.5 3.3L15.48 0h2.04L16.5 3.3z"
                              fill-rule="evenodd"></path>
                          </svg></div>
                      </div>
                    </a></div>
                  <div class="nw r">
                    <div class="nx">
                      <h4 class="bj dv dp bl dz"><button class="at au av aw ax ay az ba bb bc bd be bf bg bh bi">81
                          claps</button></h4>
                    </div>
                  </div>
                </div>
                <div class="n o">
                  <div class="gc r ar"><a
                      href="//web.archive.org/web/20191204194248/https://medium.com/p/36d7fe245b5c/share/twitter?source=post_actions_footer---------------------------"
                      class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" target="_blank" rel="noopener"><svg
                        width="29" height="29" class="q">
                        <path
                          d="M22.05 7.54a4.47 4.47 0 0 0-3.3-1.46 4.53 4.53 0 0 0-4.53 4.53c0 .35.04.7.08 1.05A12.9 12.9 0 0 1 5 6.89a5.1 5.1 0 0 0-.65 2.26c.03 1.6.83 2.99 2.02 3.79a4.3 4.3 0 0 1-2.02-.57v.08a4.55 4.55 0 0 0 3.63 4.44c-.4.08-.8.13-1.21.16l-.81-.08a4.54 4.54 0 0 0 4.2 3.15 9.56 9.56 0 0 1-5.66 1.94l-1.05-.08c2 1.27 4.38 2.02 6.94 2.02 8.3 0 12.86-6.9 12.84-12.85.02-.24 0-.43 0-.65a8.68 8.68 0 0 0 2.26-2.34c-.82.38-1.7.62-2.6.72a4.37 4.37 0 0 0 1.95-2.51c-.84.53-1.81.9-2.83 1.13z">
                        </path>
                      </svg></a></div>
                  <div class="gc r ar"><a
                      href="//web.archive.org/web/20191204194248/https://medium.com/p/36d7fe245b5c/share/linkedIn?source=post_actions_footer---------------------------"
                      class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" target="_blank" rel="noopener"><svg
                        width="29" height="29" viewbox="0 0 29 29" fill="none" class="q">
                        <path
                          d="M5 6.36C5 5.61 5.63 5 6.4 5h16.2c.77 0 1.4.61 1.4 1.36v16.28c0 .75-.63 1.36-1.4 1.36H6.4c-.77 0-1.4-.6-1.4-1.36V6.36z">
                        </path>
                        <path fill-rule="evenodd" clip-rule="evenodd"
                          d="M10.76 20.9v-8.57H7.89v8.58h2.87zm-1.44-9.75c1 0 1.63-.65 1.63-1.48-.02-.84-.62-1.48-1.6-1.48-.99 0-1.63.64-1.63 1.48 0 .83.62 1.48 1.59 1.48h.01zM12.35 20.9h2.87v-4.79c0-.25.02-.5.1-.7.2-.5.67-1.04 1.46-1.04 1.04 0 1.46.8 1.46 1.95v4.59h2.87v-4.92c0-2.64-1.42-3.87-3.3-3.87-1.55 0-2.23.86-2.61 1.45h.02v-1.24h-2.87c.04.8 0 8.58 0 8.58z"
                          fill="#fff"></path>
                      </svg></a></div>
                  <div class="gc r ar"><a
                      href="//web.archive.org/web/20191204194248/https://medium.com/p/36d7fe245b5c/share/facebook?source=post_actions_footer---------------------------"
                      class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" target="_blank" rel="noopener"><svg
                        width="29" height="29" class="q">
                        <path
                          d="M23.2 5H5.8a.8.8 0 0 0-.8.8V23.2c0 .44.35.8.8.8h9.3v-7.13h-2.38V13.9h2.38v-2.38c0-2.45 1.55-3.66 3.74-3.66 1.05 0 1.95.08 2.2.11v2.57h-1.5c-1.2 0-1.48.57-1.48 1.4v1.96h2.97l-.6 2.97h-2.37l.05 7.12h5.1a.8.8 0 0 0 .79-.8V5.8a.8.8 0 0 0-.8-.79">
                        </path>
                      </svg></a></div>
                  <div class="gc r ar">
                    <div>
                      <div class="cf"><a
                          href="https://web.archive.org/web/20191204194248/https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Fstm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c&amp;source=post_actions_footer--------------------------bookmark_sidebar-"
                          class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener"><svg width="25"
                            height="25" viewbox="0 0 25 25">
                            <path
                              d="M19 6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14.66h.01c.01.1.05.2.12.28a.5.5 0 0 0 .7.03l5.67-4.12 5.66 4.13a.5.5 0 0 0 .71-.03.5.5 0 0 0 .12-.29H19V6zm-6.84 9.97L7 19.64V6a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v13.64l-5.16-3.67a.49.49 0 0 0-.68 0z"
                              fill-rule="evenodd"></path>
                          </svg></a></div>
                    </div>
                  </div>
                  <div class="cf">
                    <div class="cf">
                      <div class="cf">
                        <div class="r ar"><button class="at au av aw ax ay az ba bb bc bd be bf bg bh bi"><svg
                              width="25" height="25" viewbox="-480.5 272.5 21 21" class="q">
                              <path
                                d="M-463 284.6c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5zm-7-.9c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5zm-7-.9c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5z">
                              </path>
                            </svg></button></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="pg ph pi oe r ab">
                <div class="pj pk r di"><span class="r pl an pm">
                    <div class="r cp pn po"><a rel="noopener"
                        href="/web/20191204194248/https://medium.com/@ly.lee?source=follow_footer--------------------------follow_footer-">
                        <div class="di pp pq">
                          <div class="bs n eq o p cp er es et eu ev ct"><svg width="91" height="91" viewbox="0 0 91 91">
                              <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M45.5 1.4c-17.14 0-32 9.95-39.25 24.5L5 25.28C12.47 10.28 27.8 0 45.5 0S78.53 10.29 86 25.28l-1.25.62C77.5 11.35 62.65 1.4 45.5 1.4zM6.25 65.1c7.25 14.55 22.1 24.5 39.25 24.5 17.14 0 32-9.95 39.25-24.5l1.25.62C78.53 80.72 63.2 91 45.5 91S12.47 80.71 5 65.72l1.25-.62z">
                              </path>
                            </svg></div><img alt="Lup Yuen Lee 李立源" class="r ew pq pp"
                            src="https://web.archive.org/web/20191204194248im_/https://miro.medium.com/fit/c/160/160/1*KGohS3sQaUnr58gc0BIfoQ.jpeg"
                            width="80" height="80" />
                        </div>
                      </a></div><span class="r">
                      <div class="pr r ps">
                        <p class="bj dv ft bl bo pt pu">Written by</p>
                      </div>
                      <div class="pr pv n ps">
                        <div class="ak n o ek">
                          <h2 class="bj hx ik pw dz"><a class="at au av aw ax ay az ba bb bc bd be bf bg bh bi"
                              rel="noopener"
                              href="/web/20191204194248/https://medium.com/@ly.lee?source=follow_footer--------------------------follow_footer-">Lup
                              Yuen Lee 李立源</a></h2>
                          <div class="r g"><button
                              class="px dz q by fi fj fk fl bc bh fm fn fo fp fq fr cb bj b bk bl bm bn cc cd ce cf cg bf">Follow</button>
                          </div>
                        </div>
                      </div>
                    </span>
                  </span>
                  <div class="pr py r ps aq">
                    <div class="pz r">
                      <h4 class="bj dv hy qa bo">Techie and Educator in IoT 物聯網教師</h4>
                    </div>
                    <div class="ap qb aq"><button
                        class="px dz q by fi fj fk fl bc bh fm fn fo fp fq fr cb bj b bk bl bm bn cc cd ce cf cg bf">Follow</button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="qc ph r ab"><a
                  href="https://web.archive.org/web/20191204194248/https://medium.com/p/36d7fe245b5c/responses/show?source=follow_footer--------------------------follow_footer-"
                  class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener"><span class="qd qe np">
                    <div class="mp qf cb r ds aq"><span class="br">See responses (1)</span></div>
                  </span></a></div>
            </div>
          </div>
          <div class="qg r qh ab">
            <div class="n p">
              <div class="ac ae af ag ah ai aj ak"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="qi r qj qk">
        <section class="cl cm ak ce r hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht">
          <div class="ql qm pj n ek g">
            <div class="qn n ek">
              <div class="qo r qp">
                <div class="qq r"><a
                    href="https://web.archive.org/web/20191204194248/https://medium.com/about?autoplay=1&amp;source=post_page-----36d7fe245b5c----------------------"
                    class="at au av aw ax ay az ba bb bc qr qs bf bg qt qu" rel="noopener">
                    <h4 class="qv qw qx bj hx bk qa qy qz r">Discover
                      <!-- -->Medium
                    </h4>
                  </a></div><span class="bj b bk bl bm bn r ra rb">Welcome to a place where words matter. On
                  <!-- -->Medium
                  <!-- -->, smart voices and original ideas take center stage - with no ads in sight.
                  <!-- --> <a
                    href="https://web.archive.org/web/20191204194248/https://medium.com/about?autoplay=1&amp;source=post_page-----36d7fe245b5c----------------------"
                    class="at au av aw ax ay az ba bb bc bf bg qt qu rc" rel="noopener">Watch</a>
                </span>
              </div>
              <div class="qo r qp">
                <div class="rd r"><a
                    href="https://web.archive.org/web/20191204194248/https://medium.com/topics?source=post_page-----36d7fe245b5c----------------------"
                    class="at au av aw ax ay az ba bb bc qr qs bf bg qt qu" rel="noopener">
                    <h4 class="qv qw qx bj hx bk qa qy qz r">Make
                      <!-- -->Medium
                      <!-- --> yours
                    </h4>
                  </a></div><span class="bj b bk bl bm bn r ra rb">Follow all the topics you care about, and we’ll
                  deliver the best stories for you to your homepage and inbox.
                  <!-- --> <a
                    href="https://web.archive.org/web/20191204194248/https://medium.com/topics?source=post_page-----36d7fe245b5c----------------------"
                    class="at au av aw ax ay az ba bb bc bf bg qt qu rc" rel="noopener">Explore</a>
                </span>
              </div>
              <div class="qo r qp">
                <div class="qq r"><a
                    href="https://web.archive.org/web/20191204194248/https://medium.com/membership?source=post_page-----36d7fe245b5c----------------------"
                    class="at au av aw ax ay az ba bb bc qr qs bf bg qt qu" rel="noopener">
                    <h4 class="qv qw qx bj hx bk qa qy qz r">Become a member</h4>
                  </a></div><span class="bj b bk bl bm bn r ra rb">Get unlimited access to the best stories on
                  <!-- -->Medium
                  <!-- --> — and support writers while you’re at it. Just $5/month.
                  <!-- --> <a
                    href="https://web.archive.org/web/20191204194248/https://medium.com/membership?source=post_page-----36d7fe245b5c----------------------"
                    class="at au av aw ax ay az ba bb bc bf bg qt qu rc" rel="noopener">Upgrade</a>
                </span>
              </div>
            </div>
          </div>
          <div class="n o ek"><a class="at au av aw ax ay az ba bb bc qr qs bf bg qt qu" rel="noopener"
              href="/web/20191204194248/https://medium.com/?source=post_page-----36d7fe245b5c----------------------"><svg
                height="22" width="112" viewbox="0 0 111.5 22" class="qw">
                <path
                  d="M56.3 19.5c0 .4 0 .5.3.7l1.5 1.4v.1h-6.5V19c-.7 1.8-2.4 3-4.3 3-3.3 0-5.8-2.6-5.8-7.5 0-4.5 2.6-7.6 6.3-7.6 1.6-.1 3.1.8 3.8 2.4V3.2c0-.3-.1-.6-.3-.7l-1.4-1.4V1l6.5-.8v19.3zm-4.8-.8V9.5c-.5-.6-1.2-.9-1.9-.9-1.6 0-3.1 1.4-3.1 5.7 0 4 1.3 5.4 3 5.4.8.1 1.6-.3 2-1zm9.1 3.1V9.4c0-.3-.1-.6-.3-.7l-1.4-1.5v-.1h6.5v12.5c0 .4 0 .5.3.7l1.4 1.4v.1h-6.5zm-.2-19.2C60.4 1.2 61.5 0 63 0c1.4 0 2.6 1.2 2.6 2.6S64.4 5.3 63 5.3a2.6 2.6 0 0 1-2.6-2.7zm22.5 16.9c0 .4 0 .5.3.7l1.5 1.4v.1h-6.5v-3.2c-.6 2-2.4 3.4-4.5 3.4-2.9 0-4.4-2.1-4.4-6.2 0-1.9 0-4.1.1-6.5 0-.3-.1-.5-.3-.7L67.7 7v.1H74v8c0 2.6.4 4.4 2 4.4.9-.1 1.7-.6 2.1-1.3V9.5c0-.3-.1-.6-.3-.7l-1.4-1.5v-.2h6.5v12.4zm22 2.3c0-.5.1-6.5.1-7.9 0-2.6-.4-4.5-2.2-4.5-.9 0-1.8.5-2.3 1.3.2.8.3 1.7.3 2.5 0 1.8-.1 4.2-.1 6.5 0 .3.1.5.3.7l1.5 1.4v.1H96c0-.4.1-6.5.1-7.9 0-2.7-.4-4.5-2.2-4.5-.9 0-1.7.5-2.2 1.3v9c0 .4 0 .5.3.7l1.4 1.4v.1h-6.5V9.5c0-.3-.1-.6-.3-.7l-1.4-1.5v-.2h6.5v3.1a4.6 4.6 0 0 1 4.6-3.4c2.2 0 3.6 1.2 4.2 3.5.7-2.1 2.7-3.6 4.9-3.5 2.9 0 4.5 2.2 4.5 6.2 0 1.9-.1 4.2-.1 6.5-.1.3.1.6.3.7l1.4 1.4v.1h-6.6zm-81.4-2l1.9 1.9v.1h-9.8v-.1l2-1.9c.2-.2.3-.4.3-.7V7.3c0-.5 0-1.2.1-1.8L11.4 22h-.1L4.5 6.8c-.1-.4-.2-.4-.3-.6v10c-.1.7 0 1.3.3 1.9l2.7 3.6v.1H0v-.1L2.7 18c.3-.6.4-1.3.3-1.9v-11c0-.5-.1-1.1-.5-1.5L.7 1.1V1h7l5.8 12.9L18.6 1h6.8v.1l-1.9 2.2c-.2.2-.3.5-.3.7v15.2c0 .2.1.5.3.6zm7.6-5.9c0 3.8 1.9 5.3 4.2 5.3 1.9.1 3.6-1 4.4-2.7h.1c-.8 3.7-3.1 5.5-6.5 5.5-3.7 0-7.2-2.2-7.2-7.4 0-5.5 3.5-7.6 7.3-7.6 3.1 0 6.4 1.5 6.4 6.2v.8h-8.7zm0-.8h4.3v-.8c0-3.9-.8-4.9-2-4.9-1.4.1-2.3 1.6-2.3 5.7z">
                </path>
              </svg></a><span class="bj b bk bl bm bn r ra rb">
              <div class="re rf n ek rg an"><a
                  href="https://web.archive.org/web/20191204194248/https://medium.com/about?autoplay=1&amp;source=post_page-----36d7fe245b5c----------------------"
                  class="at au av aw ax ay az ba bb bc ff bf bg qt qu" rel="noopener">About</a><a
                  href="https://web.archive.org/web/20191204194248/https://help.medium.com/?source=post_page-----36d7fe245b5c----------------------"
                  class="at au av aw ax ay az ba bb bc ff bf bg qt qu" rel="noopener">Help</a><a
                  class="at au av aw ax ay az ba bb bc ff bf bg qt qu" rel="noopener"
                  href="/web/20191204194248/https://medium.com/policy/9db0094a1e0f?source=post_page-----36d7fe245b5c----------------------">Legal</a>
              </div>
            </span></div>
        </section>
      </div>
    </div>
  </div>
  <script src="https://web.archive.org/web/20191204194248js_/https://cdn.optimizely.com/js/16180790160.js"></script>
  <script>window.__BUILD_ID__ = "development"</script>
  <script>window.__GRAPHQL_URI__ = "https://web.archive.org/web/20191204194248/https://medium.com/_/graphql"</script>
  <script>window.__PRELOADED_STATE__ = { "config": { "nodeEnv": "production", "version": "master-20191204-181919-f1d0be3b6c", "productName": "Medium", "publicUrl": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fcdn-client.medium.com\u002Flite", "authDomain": "medium.com", "authGoogleClientId": "216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com", "favicon": "production", "glyphUrl": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fglyph.medium.com", "branchKey": "key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm", "lightStep": { "name": "lite-web", "host": "collector-medium.lightstep.com", "token": "ce5be895bef60919541332990ac9fef2", "appVersion": "master-20191204-181919-f1d0be3b6c" }, "algolia": { "appId": "MQ57UUUQZ2", "apiKeySearch": "394474ced050e3911ae2249ecc774921", "indexPrefix": "medium_", "host": "-dsn.algolia.net" }, "recaptchaKey": "6Lfc37IUAAAAAKGGtC6rLS13R1Hrw_BqADfS1LRk", "sentry": { "dsn": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002F589e367c28ca47b195ce200d1507d18b@sentry.io\u002F1423575", "environment": "production" }, "isAmp": false, "googleAnalyticsCode": "UA-24232453-2", "signInWallCustomDomainCollectionIds": ["3a8144eabfe3", "336d898217ee", "61061eb0c96b", "138adf9c44c", "819cc2aaeee0"], "mediumOwnedAndOperatedCollectionIds": ["544c7006046e", "bcc38c8f6edf", "444d13b52878", "8d6b8a439e32", "92d2092dc598", "1285ba81cada", "cb8577c9149e", "8ccfed20cbb2", "ae2a65f35510", "3f6ecf56618", "7b6769f2748b", "fc8964313712", "ef8e90590e66", "191186aaafa0", "d944778ce714", "bdc4052bbdba", "88d9857e584e"], "tierOneDomains": ["medium.com", "thebolditalic.com", "arcdigital.media", "towardsdatascience.com", "uxdesign.cc", "codeburst.io", "psiloveyou.xyz", "writingcooperative.com", "entrepreneurshandbook.co", "prototypr.io", "betterhumans.coach.me", "theascent.pub"] }, "debug": { "requestId": "fb5eb8b1-62af-4eaf-8b58-b9700e6ebdb3", "originalSpanCarrier": { "ot-tracer-spanid": "0bee0cbf359a4bda", "ot-tracer-traceid": "3174022305de76f2", "ot-tracer-sampled": "true" } }, "session": { "user": { "id": "lo_t5gWaiuNn6B7" }, "xsrf": "" }, "stats": { "itemCount": 0, "sending": false, "timeout": null, "backup": {} }, "navigation": { "showBranchBanner": null, "hasRenderedBranchBanner": null, "hideGoogleOneTap": false, "hideAlternateUser": false, "branchData": { "loaded": false }, "shareKey": "70a29cd31425ec4d03144bce14a1c922", "referrerSource": "friends_link", "currentLocation": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fstm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c", "host": "medium.com", "hostname": "medium.com", "referrer": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fmedium.com\u002Ftag\u002Frust", "susiModal": { "step": null, "operation": "register", "reportEventInfo": { "eventName": "", "data": {} } } }, "client": { "isBot": false, "isEu": false, "isNativeMedium": false, "isCustomDomain": false }, "multiVote": { "clapsPerPost": {} }, "metadata": { "faviconImageId": null } }</script>
  <script>window.__APOLLO_STATE__ = { "ROOT_QUERY": { "viewer": null, "variantFlags": [{ "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.0", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.1", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.2", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.3", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.4", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.5", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.6", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.7", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.8", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.9", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.10", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.11", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.12", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.13", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.14", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.15", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.16", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.17", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.18", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.19", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.20", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.21", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.22", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.23", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.24", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.25", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.26", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.27", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.28", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.29", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.30", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.31", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.32", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.33", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.34", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.35", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.36", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.37", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.38", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.39", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.40", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.41", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.42", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.43", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.44", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.45", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.46", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.47", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.48", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.49", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.50", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.51", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.52", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.53", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.54", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.55", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.56", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.57", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.58", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.59", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.60", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.61", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.62", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.63", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.64", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.65", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.66", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.67", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.68", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.69", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.70", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.71", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.72", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.73", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.74", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.75", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.76", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.77", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.78", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.79", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.80", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.81", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.82", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.83", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.84", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.85", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.86", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.87", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.88", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.89", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.90", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.91", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.92", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.93", "typename": "VariantFlag" }, { "type": "id", "generated": true, "id": "ROOT_QUERY.variantFlags.94", "typename": "VariantFlag" }], "meterPost({\"postId\":\"36d7fe245b5c\",\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}})": { "type": "id", "generated": false, "id": "MeteringInfo:singleton", "typename": "MeteringInfo" }, "postResult({\"id\":\"36d7fe245b5c\"})": { "type": "id", "generated": false, "id": "Post:36d7fe245b5c", "typename": "Post" } }, "ROOT_QUERY.variantFlags.0": { "name": "allow_access", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.0.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.0.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.1": { "name": "allow_signup", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.1.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.1.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.2": { "name": "allow_test_auth", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.2.valueType", "typename": "VariantFlagString" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.2.valueType": { "__typename": "VariantFlagString", "value": "disallow" }, "ROOT_QUERY.variantFlags.3": { "name": "available_annual_plan", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.3.valueType", "typename": "VariantFlagString" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.3.valueType": { "__typename": "VariantFlagString", "value": "2c754bcc2995" }, "ROOT_QUERY.variantFlags.4": { "name": "available_monthly_plan", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.4.valueType", "typename": "VariantFlagString" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.4.valueType": { "__typename": "VariantFlagString", "value": "60e220181034" }, "ROOT_QUERY.variantFlags.5": { "name": "browsable_stream_config_bucket", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.5.valueType", "typename": "VariantFlagString" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.5.valueType": { "__typename": "VariantFlagString", "value": "curated-topics" }, "ROOT_QUERY.variantFlags.6": { "name": "daily_read_non_silent", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.6.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.6.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.7": { "name": "disable_gosocial_followers_that_you_follow", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.7.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.7.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.8": { "name": "disable_ios_resume_reading_toast", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.8.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.8.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.9": { "name": "disable_mobile_featured_chunk", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.9.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.9.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.10": { "name": "disable_post_recommended_from_friends_provider", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.10.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.10.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.11": { "name": "enable_annual_renewal_reminder_email", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.11.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.11.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.12": { "name": "enable_app_flirty_thirty", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.12.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.12.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.13": { "name": "enable_automated_mission_control_triggers", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.13.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.13.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.14": { "name": "enable_branch_io", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.14.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.14.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.15": { "name": "enable_branding", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.15.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.15.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.16": { "name": "enable_branding_fonts", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.16.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.16.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.17": { "name": "enable_dedicated_series_tab_api_ios", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.17.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.17.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.18": { "name": "enable_different_grid", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.18.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.18.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.19": { "name": "enable_disregard_trunc_state_for_footer", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.19.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.19.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.20": { "name": "enable_edit_alt_text", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.20.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.20.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.21": { "name": "enable_email_sign_in_captcha", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.21.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.21.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.22": { "name": "enable_embedding_based_diversification", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.22.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.22.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.23": { "name": "enable_filter_by_resend_rules", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.23.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.23.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.24": { "name": "enable_first_name_on_blocker_banner", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.24.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.24.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.25": { "name": "enable_first_name_on_paywall", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.25.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.25.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.26": { "name": "enable_gift_membership_ended_email", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.26.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.26.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.27": { "name": "enable_google_one_tap", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.27.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.27.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.28": { "name": "enable_inline_search_lite", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.28.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.28.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.29": { "name": "enable_inline_search_popover_lite", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.29.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.29.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.30": { "name": "enable_ios_post_stats", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.30.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.30.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.31": { "name": "enable_janky_spam_rules", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.31.valueType", "typename": "VariantFlagString" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.31.valueType": { "__typename": "VariantFlagString", "value": "users,posts" }, "ROOT_QUERY.variantFlags.32": { "name": "enable_kafka_events", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.32.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.32.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.33": { "name": "enable_lite_notifications", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.33.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.33.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.34": { "name": "enable_lite_post", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.34.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.34.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.35": { "name": "enable_lite_post_cd", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.35.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.35.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.36": { "name": "enable_lite_post_highlights", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.36.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.36.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.37": { "name": "enable_lite_post_highlights_view_only", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.37.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.37.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.38": { "name": "enable_lite_profile", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.38.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.38.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.39": { "name": "enable_lite_pub_header_menu", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.39.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.39.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.40": { "name": "enable_lite_read_next", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.40.valueType", "typename": "VariantFlagString" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.40.valueType": { "__typename": "VariantFlagString", "value": "sidebar" }, "ROOT_QUERY.variantFlags.41": { "name": "enable_lite_stories", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.41.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.41.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.42": { "name": "enable_lite_topics", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.42.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.42.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.43": { "name": "enable_lite_unread_notification_count_mutation", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.43.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.43.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.44": { "name": "enable_lo_homepage", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.44.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.44.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.45": { "name": "enable_lo_scroll_away_metabar", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.45.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.45.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.46": { "name": "enable_logged_out_homepage_signup", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.46.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.46.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.47": { "name": "enable_marketing_emails", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.47.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.47.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.48": { "name": "enable_media_resource_try_catch", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.48.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.48.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.49": { "name": "enable_membership_remove_section_a", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.49.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.49.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.50": { "name": "enable_membership_thank_you_email", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.50.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.50.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.51": { "name": "enable_more_branch_data", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.51.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.51.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.52": { "name": "enable_multi_day_pub_digests", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.52.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.52.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.53": { "name": "enable_new_collaborative_filtering_data", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.53.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.53.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.54": { "name": "enable_new_gdpr_partner_export", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.54.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.54.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.55": { "name": "enable_new_partner_dashboard", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.55.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.55.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.56": { "name": "enable_new_partner_program_updates", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.56.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.56.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.57": { "name": "enable_new_pub_fonts", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.57.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.57.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.58": { "name": "enable_new_pub_modules", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.58.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.58.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.59": { "name": "enable_new_suspended_page", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.59.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.59.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.60": { "name": "enable_new_three_dot_menu", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.60.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.60.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.61": { "name": "enable_no_cache_control", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.61.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.61.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.62": { "name": "enable_optimizely", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.62.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.62.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.63": { "name": "enable_parsely", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.63.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.63.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.64": { "name": "enable_patronus_on_kubernetes", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.64.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.64.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.65": { "name": "enable_popularity_feature_exp_retrain", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.65.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.65.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.66": { "name": "enable_post_import", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.66.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.66.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.67": { "name": "enable_post_settings_screen", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.67.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.67.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.68": { "name": "enable_primary_topic_for_mobile", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.68.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.68.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.69": { "name": "enable_pub_digest_send_after_pub_follow", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.69.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.69.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.70": { "name": "enable_pubs_cta_follow", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.70.valueType", "typename": "VariantFlagString" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.70.valueType": { "__typename": "VariantFlagString", "value": "clear_and_concise" }, "ROOT_QUERY.variantFlags.71": { "name": "enable_rtr_channel", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.71.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.71.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.72": { "name": "enable_save_to_medium", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.72.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.72.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.73": { "name": "enable_sign_up_with_email", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.73.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.73.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.74": { "name": "enable_stripe_express_initial_expansion_copy", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.74.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.74.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.75": { "name": "enable_stripe_express_rest_of_world_copy", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.75.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.75.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.76": { "name": "enable_suggest_account_li", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.76.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.76.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.77": { "name": "enable_susi_font_changes", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.77.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.77.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.78": { "name": "enable_tick_landing_page", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.78.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.78.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.79": { "name": "enable_tipalti_onboarding", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.79.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.79.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.80": { "name": "enable_topic_lifecycle_email", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.80.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.80.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.81": { "name": "enable_tribute_landing_page", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.81.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.81.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.82": { "name": "enable_trumpland_landing_page", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.82.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.82.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.83": { "name": "glyph_font_set", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.83.valueType", "typename": "VariantFlagString" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.83.valueType": { "__typename": "VariantFlagString", "value": "m2" }, "ROOT_QUERY.variantFlags.84": { "name": "google_sign_in_android", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.84.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.84.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.85": { "name": "is_not_medium_subscriber", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.85.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.85.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.86": { "name": "new_transition_page", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.86.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.86.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.87": { "name": "pub_digest_cta_in_digest_copy2", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.87.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.87.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.88": { "name": "pub_sidebar", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.88.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.88.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.89": { "name": "rank_model", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.89.valueType", "typename": "VariantFlagString" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.89.valueType": { "__typename": "VariantFlagString", "value": "default" }, "ROOT_QUERY.variantFlags.90": { "name": "redis_read_write_splitting", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.90.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.90.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.91": { "name": "share_post_linkedin", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.91.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.91.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "ROOT_QUERY.variantFlags.92": { "name": "signin_services", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.92.valueType", "typename": "VariantFlagString" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.92.valueType": { "__typename": "VariantFlagString", "value": "twitter,facebook,google,email,google-fastidv,google-one-tap" }, "ROOT_QUERY.variantFlags.93": { "name": "signup_services", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.93.valueType", "typename": "VariantFlagString" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.93.valueType": { "__typename": "VariantFlagString", "value": "twitter,facebook,google,email,google-fastidv,google-one-tap" }, "ROOT_QUERY.variantFlags.94": { "name": "use_new_admin_topic_backend", "valueType": { "type": "id", "generated": true, "id": "$ROOT_QUERY.variantFlags.94.valueType", "typename": "VariantFlagBoolean" }, "__typename": "VariantFlag" }, "$ROOT_QUERY.variantFlags.94.valueType": { "__typename": "VariantFlagBoolean", "value": true }, "MeteringInfo:singleton": { "__typename": "MeteringInfo", "postIds": { "type": "json", "json": [] }, "maxUnlockCount": 3, "unlocksRemaining": 3 }, "Post:36d7fe245b5c": { "__typename": "Post", "visibility": "PUBLIC", "latestPublishedVersion": "4571f6d18025", "collection": null, "id": "36d7fe245b5c", "creator": { "type": "id", "generated": false, "id": "User:1da08193a324", "typename": "User" }, "isLocked": false, "lockedSource": "LOCKED_POST_SOURCE_NONE", "sequence": null, "mediumUrl": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fstm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c", "canonicalUrl": "", "content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}})": { "type": "id", "generated": true, "id": "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}})", "typename": "PostContent" }, "firstPublishedAt": 1545074702825, "isPublished": true, "layerCake": 4, "primaryTopic": null, "title": "STM32 Blue Pill USB Bootloader —  How I fixed the USB Storage, Serial, DFU and WebUSB interfaces", "isLimitedState": false, "pendingCollection": { "type": "id", "generated": false, "id": "Collection:721b17443fd5", "typename": "Collection" }, "shareKey": null, "statusForCollection": "PENDING", "readingTime": 13.187735849056603, "readingList": "READING_LIST_NONE", "license": "ALL_RIGHTS_RESERVED", "allowResponses": true, "tags": [{ "type": "id", "generated": false, "id": "Tag:usb", "typename": "Tag" }, { "type": "id", "generated": false, "id": "Tag:stm32", "typename": "Tag" }, { "type": "id", "generated": false, "id": "Tag:programming", "typename": "Tag" }, { "type": "id", "generated": false, "id": "Tag:embedded-systems", "typename": "Tag" }], "viewerClapCount": 0, "clapCount": 81, "voterCount": 11, "recommenders": [], "responsesCount": 1, "collaborators": [], "translationSourcePost": null, "newsletterId": "", "inResponseToPostResult": null, "inResponseToMediaResource": null, "curationEligibleAt": 1545074701193, "audioVersionUrl": "", "seoTitle": "", "socialTitle": "", "socialDek": "", "metaDescription": "Building a complex composite USB device with libopencm3 that works on Windows, Mac and Linux", "latestPublishedAt": 1554331795131, "wordCount": 3137, "previewContent": { "type": "id", "generated": true, "id": "$Post:36d7fe245b5c.previewContent", "typename": "PreviewContent" }, "previewImage": { "type": "id", "generated": false, "id": "ImageMetadata:1*fjfoda1Ovwdahy09TwUkqA.png", "typename": "ImageMetadata" }, "updatedAt": 1554331795131, "topics": [], "seoDescription": "", "isSuspended": false }, "User:1da08193a324": { "id": "1da08193a324", "__typename": "User", "isSuspended": false, "allowNotes": true, "name": "Lup Yuen Lee 李立源", "isFollowing": false, "username": "ly.lee", "bio": "Techie and Educator in IoT 物聯網教師", "imageId": "1*KGohS3sQaUnr58gc0BIfoQ.jpeg", "mediumMemberAt": 1571194811000, "isBlocking": false, "isPartnerProgramEnrolled": false, "twitterScreenName": "MisterTechBlog" }, "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}})": { "isLockedPreviewOnly": false, "validatedShareKey": "70a29cd31425ec4d03144bce14a1c922", "__typename": "PostContent", "bodyModel": { "type": "id", "generated": true, "id": "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel", "typename": "RichText" } }, "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel.sections.0": { "name": "2fa6", "startIndex": 0, "textLayout": null, "imageLayout": null, "backgroundImage": null, "videoLayout": null, "backgroundVideo": null, "__typename": "Section" }, "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel.sections.1": { "name": "ccac", "startIndex": 6, "textLayout": null, "imageLayout": null, "backgroundImage": null, "videoLayout": null, "backgroundVideo": null, "__typename": "Section" }, "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel.sections.2": { "name": "6f03", "startIndex": 12, "textLayout": null, "imageLayout": null, "backgroundImage": null, "videoLayout": null, "backgroundVideo": null, "__typename": "Section" }, "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel.sections.3": { "name": "1e41", "startIndex": 19, "textLayout": null, "imageLayout": null, "backgroundImage": null, "videoLayout": null, "backgroundVideo": null, "__typename": "Section" }, "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel.sections.4": { "name": "225f", "startIndex": 40, "textLayout": null, "imageLayout": null, "backgroundImage": null, "videoLayout": null, "backgroundVideo": null, "__typename": "Section" }, "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel.sections.5": { "name": "801c", "startIndex": 50, "textLayout": null, "imageLayout": null, "backgroundImage": null, "videoLayout": null, "backgroundVideo": null, "__typename": "Section" }, "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel.sections.6": { "name": "77a6", "startIndex": 97, "textLayout": null, "imageLayout": null, "backgroundImage": null, "videoLayout": null, "backgroundVideo": null, "__typename": "Section" }, "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel.sections.7": { "name": "229c", "startIndex": 112, "textLayout": null, "imageLayout": null, "backgroundImage": null, "videoLayout": null, "backgroundVideo": null, "__typename": "Section" }, "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel.sections.8": { "name": "c34a", "startIndex": 125, "textLayout": null, "imageLayout": null, "backgroundImage": null, "videoLayout": null, "backgroundVideo": null, "__typename": "Section" }, "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel.sections.9": { "name": "2db0", "startIndex": 138, "textLayout": null, "imageLayout": null, "backgroundImage": null, "videoLayout": null, "backgroundVideo": null, "__typename": "Section" }, "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel.sections.10": { "name": "5886", "startIndex": 142, "textLayout": null, "imageLayout": null, "backgroundImage": null, "videoLayout": null, "backgroundVideo": null, "__typename": "Section" }, "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel": { "sections": [{ "type": "id", "generated": true, "id": "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel.sections.0", "typename": "Section" }, { "type": "id", "generated": true, "id": "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel.sections.1", "typename": "Section" }, { "type": "id", "generated": true, "id": "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel.sections.2", "typename": "Section" }, { "type": "id", "generated": true, "id": "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel.sections.3", "typename": "Section" }, { "type": "id", "generated": true, "id": "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel.sections.4", "typename": "Section" }, { "type": "id", "generated": true, "id": "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel.sections.5", "typename": "Section" }, { "type": "id", "generated": true, "id": "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel.sections.6", "typename": "Section" }, { "type": "id", "generated": true, "id": "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel.sections.7", "typename": "Section" }, { "type": "id", "generated": true, "id": "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel.sections.8", "typename": "Section" }, { "type": "id", "generated": true, "id": "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel.sections.9", "typename": "Section" }, { "type": "id", "generated": true, "id": "$Post:36d7fe245b5c.content({\"postMeteringOptions\":{\"referrer\":\"https:\u002F\u002Fmedium.com\u002Ftag\u002Frust\",\"sk\":\"70a29cd31425ec4d03144bce14a1c922\",\"source\":\"friends_link\"}}).bodyModel.sections.10", "typename": "Section" }], "paragraphs": [{ "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_0", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_1", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_2", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_3", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_4", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_5", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_6", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_7", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_8", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_9", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_10", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_11", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_12", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_13", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_14", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_15", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_16", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_17", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_18", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_19", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_20", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_21", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_22", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_23", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_24", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_25", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_26", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_27", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_28", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_29", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_30", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_31", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_32", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_33", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_34", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_35", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_36", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_37", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_38", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_39", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_40", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_41", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_42", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_43", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_44", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_45", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_46", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_47", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_48", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_49", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_50", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_51", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_52", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_53", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_54", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_55", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_56", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_57", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_58", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_59", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_60", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_61", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_62", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_63", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_64", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_65", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_66", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_67", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_68", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_69", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_70", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_71", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_72", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_73", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_74", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_75", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_76", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_77", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_78", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_79", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_80", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_81", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_82", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_83", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_84", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_85", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_86", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_87", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_88", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_89", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_90", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_91", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_92", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_93", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_94", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_95", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_96", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_97", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_98", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_99", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_100", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_101", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_102", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_103", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_104", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_105", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_106", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_107", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_108", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_109", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_110", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_111", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_112", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_113", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_114", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_115", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_116", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_117", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_118", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_119", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_120", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_121", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_122", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_123", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_124", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_125", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_126", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_127", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_128", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_129", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_130", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_131", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_132", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_133", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_134", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_135", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_136", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_137", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_138", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_139", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_140", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_141", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_142", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_143", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_144", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_145", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_146", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_147", "typename": "Paragraph" }, { "type": "id", "generated": false, "id": "Paragraph:4571f6d18025_148", "typename": "Paragraph" }], "__typename": "RichText" }, "Paragraph:4571f6d18025_0": { "id": "4571f6d18025_0", "name": "45f2", "type": "IMG", "href": null, "layout": "FULL_WIDTH", "metadata": { "type": "id", "generated": false, "id": "ImageMetadata:1*fjfoda1Ovwdahy09TwUkqA.png", "typename": "ImageMetadata" }, "text": "Blue Pill Bootloader connected to Windows", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "ImageMetadata:1*fjfoda1Ovwdahy09TwUkqA.png": { "id": "1*fjfoda1Ovwdahy09TwUkqA.png", "originalHeight": 1080, "originalWidth": 1920, "focusPercentX": null, "focusPercentY": null, "alt": null, "__typename": "ImageMetadata" }, "Paragraph:4571f6d18025_1": { "id": "4571f6d18025_1", "name": "e9ca", "type": "H3", "href": null, "layout": null, "metadata": null, "text": "STM32 Blue Pill USB Bootloader — How I fixed the USB Storage, Serial, DFU and WebUSB interfaces", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_2": { "id": "4571f6d18025_2", "name": "e317", "type": "P", "href": null, "layout": null, "metadata": null, "text": "The STM32 Blue Pill is a remarkable microcontroller for US$ 2. I proved it by running the USB Storage, USB Serial, USB DFU (Direct Firmware Upgrade) and WebUSB interfaces all on the same Blue Pill concurrently, without any additional hardware!", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_2.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_2.markups.0": { "type": "A", "start": 4, "end": 19, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttp:\u002F\u002Fwiki.stm32duino.com\u002Findex.php?title=Blue_Pill", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_3": { "id": "4571f6d18025_3", "name": "5552", "type": "P", "href": null, "layout": null, "metadata": null, "text": "Why did I do this? I was building a USB Bootloader for the MakeCode visual programming tool that’s web-browser based and requires all these interfaces. I ran into lots of difficulty making all these interfaces coexist, almost giving up, thinking it’s a Blue Pill hardware limitation… But it turned out to be a software problem.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_3.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_3.markups.0": { "type": "A", "start": 36, "end": 91, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fwork-in-progress-stm32-blue-pill-visual-programming-with-makecode-codal-and-libopencm3-422d308f252e", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_4": { "id": "4571f6d18025_4", "name": "faa5", "type": "P", "href": null, "layout": null, "metadata": null, "text": "This article documents all the fixes I have made to create a working Blue Pill bootloader that has been tested on Windows, Mac and Linux. If you’re creating a USB device based on STM32 microcontrollers, this article might help you learn about the complex world of USB protocols. The complete source code is here…", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_5": { "id": "4571f6d18025_5", "name": "2aa3", "type": "MIXTAPE_EMBED", "href": null, "layout": null, "metadata": null, "text": "lupyuen\u002Fbluepill-bootloader\nMakeCode UF2 bootloader for STM32 Blue Pill. Contribute to lupyuen\u002Fbluepill-bootloader development by creating an…github.com", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_5.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_5.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_5.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_5.mixtapeMetadata", "typename": "MixtapeMetadata" } }, "Paragraph:4571f6d18025_5.markups.0": { "type": "A", "start": 0, "end": 152, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_5.markups.1": { "type": "STRONG", "start": 0, "end": 27, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_5.markups.2": { "type": "EM", "start": 28, "end": 142, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "$Paragraph:4571f6d18025_5.mixtapeMetadata": { "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader", "thumbnailImageId": "0*6Yh4um9qbSlQjW3d", "mediaResourceId": "0*6Yh4um9qbSlQjW3d", "__typename": "MixtapeMetadata" }, "Paragraph:4571f6d18025_6": { "id": "4571f6d18025_6", "name": "b0d5", "type": "H3", "href": null, "layout": null, "metadata": null, "text": "Capture USB Data with Wireshark", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_7": { "id": "4571f6d18025_7", "name": "1861", "type": "P", "href": null, "layout": null, "metadata": null, "text": "I highly recommend installing Wireshark to capture and view USB data. After installing Wireshark (be sure to select USBPcap or usbmon when prompted during installation), check this article for further instructions (Windows and Linux)…", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_7.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_7.markups.0": { "type": "A", "start": 30, "end": 39, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fwww.wireshark.org\u002F", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_8": { "id": "4571f6d18025_8", "name": "0353", "type": "MIXTAPE_EMBED", "href": null, "layout": null, "metadata": null, "text": "CaptureSetup\u002FUSB - The Wireshark Wiki\nThe USB bus will add additional overhead, so the raw USB traffic will have higher volume than the network traffic, even…wiki.wireshark.org", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_8.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_8.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_8.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_8.mixtapeMetadata", "typename": "MixtapeMetadata" } }, "Paragraph:4571f6d18025_8.markups.0": { "type": "A", "start": 0, "end": 176, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fwiki.wireshark.org\u002FCaptureSetup\u002FUSB", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_8.markups.1": { "type": "STRONG", "start": 0, "end": 37, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_8.markups.2": { "type": "EM", "start": 38, "end": 158, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "$Paragraph:4571f6d18025_8.mixtapeMetadata": { "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fwiki.wireshark.org\u002FCaptureSetup\u002FUSB", "thumbnailImageId": "0*dzqLBS1jPrWWixzq", "mediaResourceId": "0*dzqLBS1jPrWWixzq", "__typename": "MixtapeMetadata" }, "Paragraph:4571f6d18025_9": { "id": "4571f6d18025_9", "name": "b506", "type": "P", "href": null, "layout": null, "metadata": null, "text": "For Mac check this article…", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_10": { "id": "4571f6d18025_10", "name": "89b7", "type": "MIXTAPE_EMBED", "href": null, "layout": null, "metadata": null, "text": "macOS - How to: USB Monitoring with WireShark\nAs developers know, the utility tool to debug and monitor USB Traffic hasn't been available for quite a while. However…aud-ios.com", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_10.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_10.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_10.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_10.mixtapeMetadata", "typename": "MixtapeMetadata" } }, "Paragraph:4571f6d18025_10.markups.0": { "type": "A", "start": 0, "end": 176, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Faud-ios.com\u002F2017\u002F10\u002F22\u002Fusb-monitoring-with-wireshark\u002F", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_10.markups.1": { "type": "STRONG", "start": 0, "end": 45, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_10.markups.2": { "type": "EM", "start": 46, "end": 165, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "$Paragraph:4571f6d18025_10.mixtapeMetadata": { "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Faud-ios.com\u002F2017\u002F10\u002F22\u002Fusb-monitoring-with-wireshark\u002F", "thumbnailImageId": "0*D1A20q3EzpBI8gq9", "mediaResourceId": "0*D1A20q3EzpBI8gq9", "__typename": "MixtapeMetadata" }, "Paragraph:4571f6d18025_11": { "id": "4571f6d18025_11", "name": "5689", "type": "P", "href": null, "layout": null, "metadata": null, "text": "Once you have Wireshark installed, you may download and view the USB logs that I have captured while connecting our Blue Pill bootloader to Windows, Mac and Ubuntu.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_11.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_11.markups.0": { "type": "A", "start": 61, "end": 94, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Ftree\u002Fmaster\u002Flogs", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_12": { "id": "4571f6d18025_12", "name": "881c", "type": "IMG", "href": null, "layout": "INSET_CENTER", "metadata": { "type": "id", "generated": false, "id": "ImageMetadata:1*oPbLTojzzwFwT3LYDa-xEw.png", "typename": "ImageMetadata" }, "text": "Common sight during my USB development… “Drivers not installed” due to USB descriptor errors or USB request processing errors", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "ImageMetadata:1*oPbLTojzzwFwT3LYDa-xEw.png": { "id": "1*oPbLTojzzwFwT3LYDa-xEw.png", "originalHeight": 505, "originalWidth": 400, "focusPercentX": null, "focusPercentY": null, "alt": null, "__typename": "ImageMetadata" }, "Paragraph:4571f6d18025_13": { "id": "4571f6d18025_13", "name": "62ce", "type": "H3", "href": null, "layout": null, "metadata": null, "text": "The Original Bootloader", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_14": { "id": "4571f6d18025_14", "name": "3134", "type": "P", "href": null, "layout": null, "metadata": null, "text": "I started with this bootloader code by Michał Moskal and Devan Lai…", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_15": { "id": "4571f6d18025_15", "name": "b893", "type": "MIXTAPE_EMBED", "href": null, "layout": null, "metadata": null, "text": "mmoskal\u002Fuf2-stm32f103\nUF2 bootloader for STM32 boards. Contribute to mmoskal\u002Fuf2-stm32f103 development by creating an account on GitHub.github.com", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_15.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_15.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_15.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_15.mixtapeMetadata", "typename": "MixtapeMetadata" } }, "Paragraph:4571f6d18025_15.markups.0": { "type": "A", "start": 0, "end": 146, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Fmmoskal\u002Fuf2-stm32f103", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_15.markups.1": { "type": "STRONG", "start": 0, "end": 21, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_15.markups.2": { "type": "EM", "start": 22, "end": 136, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "$Paragraph:4571f6d18025_15.mixtapeMetadata": { "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Fmmoskal\u002Fuf2-stm32f103", "thumbnailImageId": "0*NoY4wyKCio5_awGy", "mediaResourceId": "0*NoY4wyKCio5_awGy", "__typename": "MixtapeMetadata" }, "Paragraph:4571f6d18025_16": { "id": "4571f6d18025_16", "name": "97a9", "type": "P", "href": null, "layout": null, "metadata": null, "text": "It’s based on the open-source libopencm3 library for STM32. It didn’t build with the latest version of libopencm3 on Visual Studio Code with the PlatformIO extension, so I applied some patches from here…", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_16.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_16.markups.0": { "type": "A", "start": 18, "end": 48, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttp:\u002F\u002Flibopencm3.org\u002Fdocs\u002Flatest\u002Fstm32f1\u002Fhtml\u002Fmodules.html", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_17": { "id": "4571f6d18025_17", "name": "31a3", "type": "MIXTAPE_EMBED", "href": null, "layout": null, "metadata": null, "text": "trezor\u002Ftrezor-mcu\nlock: Sources for TREZOR firmware. Contribute to trezor\u002Ftrezor-mcu development by creating an account on GitHub.github.com", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_17.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_17.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_17.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_17.mixtapeMetadata", "typename": "MixtapeMetadata" } }, "Paragraph:4571f6d18025_17.markups.0": { "type": "A", "start": 0, "end": 140, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Ftrezor\u002Ftrezor-mcu", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_17.markups.1": { "type": "STRONG", "start": 0, "end": 17, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_17.markups.2": { "type": "EM", "start": 18, "end": 130, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "$Paragraph:4571f6d18025_17.mixtapeMetadata": { "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Ftrezor\u002Ftrezor-mcu", "thumbnailImageId": "0*QjfIWiNSUFsBds1T", "mediaResourceId": "0*QjfIWiNSUFsBds1T", "__typename": "MixtapeMetadata" }, "Paragraph:4571f6d18025_18": { "id": "4571f6d18025_18", "name": "5d60", "type": "P", "href": null, "layout": null, "metadata": null, "text": "The patches fixed the build to support WebUSB, USB 2.1 and Windows USB (more about this later). After flashing the Blue Pill with the ST Link V2 and PlatformIO, I soon ran into interesting problems…", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_18.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_18.markups.0": { "type": "A", "start": 102, "end": 159, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fmedium.com\u002Fcoinmonks\u002Fconnect-stm32-blue-pill-to-sigfox-28c6f91bddc1?source=friends_link&sk=d0f0d9f40e36badadfb04dc4c0846775", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_19": { "id": "4571f6d18025_19", "name": "5cdc", "type": "IMG", "href": null, "layout": "INSET_CENTER", "metadata": { "type": "id", "generated": false, "id": "ImageMetadata:1*6GIcdEMCbtXb346Bt9S7JQ.png", "typename": "ImageMetadata" }, "text": "USB Mass Storage Class (MSC) request to fetch the maximum logical unit number (i.e. drive number). From the Wireshark log https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Flogs\u002Fusb-windows.pcapng.gz", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_19.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "ImageMetadata:1*6GIcdEMCbtXb346Bt9S7JQ.png": { "id": "1*6GIcdEMCbtXb346Bt9S7JQ.png", "originalHeight": 598, "originalWidth": 719, "focusPercentX": null, "focusPercentY": null, "alt": null, "__typename": "ImageMetadata" }, "Paragraph:4571f6d18025_19.markups.0": { "type": "A", "start": 122, "end": 207, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Flogs\u002Fusb-windows.pcapng.gz", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_20": { "id": "4571f6d18025_20", "name": "2619", "type": "H3", "href": null, "layout": null, "metadata": null, "text": "USB Storage", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_21": { "id": "4571f6d18025_21", "name": "353c", "type": "P", "href": null, "layout": null, "metadata": null, "text": "The fixed code for supporting USB storage is in msc.c.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_21.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_21.markups.0": { "type": "A", "start": 48, "end": 53, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fmsc.c", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_22": { "id": "4571f6d18025_22", "name": "1a23", "type": "IMG", "href": null, "layout": "OUTSET_LEFT", "metadata": { "type": "id", "generated": false, "id": "ImageMetadata:1*KG-fnIeqEsgZ8LJv9dckpA.png", "typename": "ImageMetadata" }, "text": "Blue Pill appears on Windows as a USB Mass Storage Device. At the lower left are the files emulated by Blue Pill (done by ghostfat.c)", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "ImageMetadata:1*KG-fnIeqEsgZ8LJv9dckpA.png": { "id": "1*KG-fnIeqEsgZ8LJv9dckpA.png", "originalHeight": 908, "originalWidth": 1095, "focusPercentX": null, "focusPercentY": null, "alt": null, "__typename": "ImageMetadata" }, "Paragraph:4571f6d18025_23": { "id": "4571f6d18025_23", "name": "b519", "type": "P", "href": null, "layout": null, "metadata": null, "text": "To implement USB storage in any USB device, we need to implement the USB Mass Storage Class (MSC) specs. So that we can connect the Blue Pill to a computer and it will appear as a USB drive. Within the specs, we’ll see that it actually uses the (very old!) SCSI protocol for reading and writing to the USB drive, and also for fetching the storage details. The Wireshark screen above shows a simple USB MSC command.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_23.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_23.markups.1", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_23.markups.0": { "type": "A", "start": 69, "end": 103, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fusb.org\u002Fsites\u002Fdefault\u002Ffiles\u002Fusbmassbulk_10.pdf", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_23.markups.1": { "type": "STRONG", "start": 69, "end": 97, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_24": { "id": "4571f6d18025_24", "name": "f7b0", "type": "P", "href": null, "layout": null, "metadata": null, "text": "Thankfully we don’t need to implement the SCSI protocol ourselves. libopencm3 handles it for us, according to this sample code… just call usb_msc_init() and libopencm3 does everything automagically. However the USB MSC implementation usb_msc_init() in libopencm3 is missing some features, so I copied the libopencm3 source file and patched myself…", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_24.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_24.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_24.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_24.markups.0": { "type": "CODE", "start": 138, "end": 152, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_24.markups.1": { "type": "CODE", "start": 234, "end": 248, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_24.markups.2": { "type": "A", "start": 110, "end": 126, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flibopencm3\u002Flibopencm3-examples\u002Fblob\u002Fmaster\u002Fexamples\u002Fstm32\u002Ff4\u002Fstm32f4-discovery\u002Fusb_msc\u002Fmsc.c", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_25": { "id": "4571f6d18025_25", "name": "7080", "type": "P", "href": null, "layout": null, "metadata": null, "text": "1️⃣ libopencm3 doesn’t implement the SCSI_READ_FORMAT_CAPACITIES and SCSI_PREVENT_ALLOW_MEDIUM_REMOVAL SCSI commands", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_25.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_25.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_25.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_25.markups.0": { "type": "CODE", "start": 37, "end": 64, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_25.markups.1": { "type": "CODE", "start": 69, "end": 102, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_25.markups.2": { "type": "STRONG", "start": 0, "end": 116, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_26": { "id": "4571f6d18025_26", "name": "e501", "type": "P", "href": null, "layout": null, "metadata": null, "text": "SCSI_READ_FORMAT_CAPACITIES is important because Windows will send this command to query the storage size. Without it, our USB bootloader won’t work with Windows. I found the implementation here..", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_26.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_26.markups.0": { "type": "CODE", "start": 0, "end": 27, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_27": { "id": "4571f6d18025_27", "name": "00fe", "type": "MIXTAPE_EMBED", "href": null, "layout": null, "metadata": null, "text": "USB mass storage device и libopencm3\nМоя работа связана с программированием микроконтроллеров, в частности STM32. Долгое время для работы с периферией я…habr.com", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_27.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_27.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_27.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_27.mixtapeMetadata", "typename": "MixtapeMetadata" } }, "Paragraph:4571f6d18025_27.markups.0": { "type": "A", "start": 0, "end": 161, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fhabr.com\u002Fcompany\u002Fthirdpin\u002Fblog\u002F304924\u002F", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_27.markups.1": { "type": "STRONG", "start": 0, "end": 36, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_27.markups.2": { "type": "EM", "start": 37, "end": 153, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "$Paragraph:4571f6d18025_27.mixtapeMetadata": { "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fhabr.com\u002Fcompany\u002Fthirdpin\u002Fblog\u002F304924\u002F", "thumbnailImageId": "0*6X3oVR8okP5lcm5g", "mediaResourceId": "0*6X3oVR8okP5lcm5g", "__typename": "MixtapeMetadata" }, "Paragraph:4571f6d18025_28": { "id": "4571f6d18025_28", "name": "65dd", "type": "P", "href": null, "layout": null, "metadata": null, "text": "And patched it in my code here. Note that the bytes_to_write setting in the article is incorrect. I have also applied a patch for MSC request handling that’s mentioned in the article.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_28.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_28.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_28.markups.2", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_28.markups.3", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_28.markups.0": { "type": "CODE", "start": 46, "end": 60, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_28.markups.1": { "type": "A", "start": 15, "end": 30, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fmsc.c#L551-L572", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_28.markups.2": { "type": "A", "start": 46, "end": 96, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fmsc.c#L568", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_28.markups.3": { "type": "A", "start": 120, "end": 150, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fmsc.c#L723-L739", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_29": { "id": "4571f6d18025_29", "name": "aa3e", "type": "P", "href": null, "layout": null, "metadata": null, "text": "According my logs, Windows is also sending the command SCSI_PREVENT_ALLOW_MEDIUM_REMOVAL. I cooked up a dummy implementation here.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_29.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_29.markups.1", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_29.markups.0": { "type": "CODE", "start": 55, "end": 88, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_29.markups.1": { "type": "A", "start": 104, "end": 129, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fmsc.c#L624-L632", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_30": { "id": "4571f6d18025_30", "name": "1891", "type": "P", "href": null, "layout": null, "metadata": null, "text": "2️⃣ libopencm3 doesn’t implement SCSI_INQUIRY completely", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_30.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_30.markups.1", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_30.markups.0": { "type": "CODE", "start": 33, "end": 45, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_30.markups.1": { "type": "STRONG", "start": 4, "end": 56, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_31": { "id": "4571f6d18025_31", "name": "9467", "type": "P", "href": null, "layout": null, "metadata": null, "text": "This bug took me a while to track down. When I logged the USB requests from Windows, I noticed that Windows kept sending the SET_ADDRESS USB request to Blue Pill every minute. Windows was telling Blue Pill, “use USB address 5 now… switch to address 6 now… switch back to address 5 now…”", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_31.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_31.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_31.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_31.markups.0": { "type": "CODE", "start": 125, "end": 136, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_31.markups.1": { "type": "A", "start": 125, "end": 136, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttp:\u002F\u002Fwww.usbmadesimple.co.uk\u002Fums_4.htm", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_31.markups.2": { "type": "EM", "start": 207, "end": 286, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_32": { "id": "4571f6d18025_32", "name": "8c13", "type": "IFRAME", "href": null, "layout": "INSET_CENTER", "metadata": null, "text": "Windows sending SET_ADDRESS 5… 6… 5… 6…", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_32.iframe", "typename": "Iframe" }, "mixtapeMetadata": null }, "MediaResource:505faac62832155fd41495ce40277a44": { "id": "505faac62832155fd41495ce40277a44", "iframeSrc": "", "iframeHeight": 0, "iframeWidth": 0, "title": "usb-set-address.log", "__typename": "MediaResource" }, "$Paragraph:4571f6d18025_32.iframe": { "mediaResource": { "type": "id", "generated": false, "id": "MediaResource:505faac62832155fd41495ce40277a44", "typename": "MediaResource" }, "__typename": "Iframe" }, "Paragraph:4571f6d18025_33": { "id": "4571f6d18025_33", "name": "e9dc", "type": "P", "href": null, "layout": null, "metadata": null, "text": "I soon discovered that’s a sign that Windows is resetting our Blue Pill because it didn’t like the response to one of the previous commands. I traced it to the SCSI_INQUIRY command, which missed out some important bits, and I patched my version here. (Yes I had to dig through the tedious SCSI specs.)", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_33.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_33.markups.1", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_33.markups.0": { "type": "CODE", "start": 160, "end": 172, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_33.markups.1": { "type": "A", "start": 219, "end": 249, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fmsc.c#L438-L549", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_34": { "id": "4571f6d18025_34", "name": "4074", "type": "P", "href": null, "layout": null, "metadata": null, "text": "3️⃣ libopencm3 doesn’t play nice with with multiple USB interfaces", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_34.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_34.markups.0": { "type": "STRONG", "start": 4, "end": 66, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_35": { "id": "4571f6d18025_35", "name": "0abf", "type": "P", "href": null, "layout": null, "metadata": null, "text": "The official documentation for usb_msc_init() says cryptically, “Currently you can only have this profile active.” I found out the hard way that it doesn’t coexist well with other USB interfaces (e.g. USB Serial). Instead of rejecting unrecognised USB requests with an error (USBD_REQ_NOTSUPP), I fixed the code to hand off the unknown request to the next USB interface (USBD_REQ_NEXT_CALLBACK).", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_35.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_35.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_35.markups.2", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_35.markups.3", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_35.markups.4", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_35.markups.5", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_35.markups.0": { "type": "CODE", "start": 31, "end": 45, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_35.markups.1": { "type": "CODE", "start": 276, "end": 292, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_35.markups.2": { "type": "CODE", "start": 371, "end": 393, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_35.markups.3": { "type": "A", "start": 64, "end": 114, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttp:\u002F\u002Flibopencm3.org\u002Fdocs\u002Flatest\u002Fstm32f1\u002Fhtml\u002Fgroup__usb__msc.html#ga5e6959c3ac6ff4efab4fd3b59353f497", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_35.markups.4": { "type": "A", "start": 315, "end": 369, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fmsc.c#L887", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_35.markups.5": { "type": "EM", "start": 64, "end": 114, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_36": { "id": "4571f6d18025_36", "name": "c978", "type": "IMG", "href": null, "layout": "OUTSET_LEFT", "metadata": { "type": "id", "generated": false, "id": "ImageMetadata:1*hF2n5xeSEOsDNP_Heymgbg.png", "typename": "ImageMetadata" }, "text": "ghostfat.c emulates a 4 MB flash drive and exposes the 3 files above", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "ImageMetadata:1*hF2n5xeSEOsDNP_Heymgbg.png": { "id": "1*hF2n5xeSEOsDNP_Heymgbg.png", "originalHeight": 695, "originalWidth": 1539, "focusPercentX": null, "focusPercentY": null, "alt": null, "__typename": "ImageMetadata" }, "Paragraph:4571f6d18025_37": { "id": "4571f6d18025_37", "name": "e6fe", "type": "P", "href": null, "layout": null, "metadata": null, "text": "For our bootloader, we expect MakeCode users to copy UF2 files in order to flash the Blue Pill ROM. So in the USB storage code we register the callbacks read_block(), write_block() (defined in ghostfat.c) that will flash each 512-byte block of the UF2 file into ROM.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_37.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_37.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_37.markups.2", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_37.markups.3", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_37.markups.4", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_37.markups.0": { "type": "CODE", "start": 153, "end": 180, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_37.markups.1": { "type": "CODE", "start": 193, "end": 203, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_37.markups.2": { "type": "A", "start": 53, "end": 62, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002FMicrosoft\u002Fuf2", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_37.markups.3": { "type": "A", "start": 127, "end": 152, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fusb_conf.c#L395-L403", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_37.markups.4": { "type": "A", "start": 182, "end": 203, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fghostfat.c", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_38": { "id": "4571f6d18025_38", "name": "9e5a", "type": "P", "href": null, "layout": null, "metadata": null, "text": "By handling the read_block(), write_block() callbacks, the code in ghostfat.c emulates a 4 MB flash drive formatted with the FAT filesystem (sector size 512). The Blue Pill hardware doesn’t actually have 4 MB of storage. When we copy a UF2 file into the drive for flashing, ghostfat.c will read in 1 sector (512 bytes) from the computer, write the 512 bytes into flash memory, and repeat until the entire UF2 file is processed.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_38.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_38.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_38.markups.2", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_38.markups.3", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_38.markups.0": { "type": "CODE", "start": 16, "end": 43, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_38.markups.1": { "type": "CODE", "start": 67, "end": 77, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_38.markups.2": { "type": "CODE", "start": 274, "end": 284, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_38.markups.3": { "type": "A", "start": 55, "end": 77, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fghostfat.c", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_39": { "id": "4571f6d18025_39", "name": "c3ae", "type": "P", "href": null, "layout": null, "metadata": null, "text": "Check this file for a RAM Disk implementation of the FAT filesystem.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_39.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_39.markups.0": { "type": "A", "start": 0, "end": 15, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fmsc.c.old", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_40": { "id": "4571f6d18025_40", "name": "ebb8", "type": "H3", "href": null, "layout": null, "metadata": null, "text": "USB Serial", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_41": { "id": "4571f6d18025_41", "name": "814c", "type": "P", "href": null, "layout": null, "metadata": null, "text": "The code for handling USB Serial interface is in cdc.c. This is based on the sample code here.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_41.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_41.markups.1", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_41.markups.0": { "type": "A", "start": 49, "end": 54, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fcdc.c", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_41.markups.1": { "type": "A", "start": 77, "end": 93, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002FApress\u002FBeg-STM32-Devel-FreeRTOS-libopencm3-GCC\u002Fblob\u002Fmaster\u002Frtos\u002Fusbcdcdemo\u002Fusbcdc.c", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_42": { "id": "4571f6d18025_42", "name": "4794", "type": "IMG", "href": null, "layout": "OUTSET_LEFT", "metadata": { "type": "id", "generated": false, "id": "ImageMetadata:1*UA6gHiWDenc0WOmYtQmL-A.png", "typename": "ImageMetadata" }, "text": "Blue Pill appears as a USB Serial Device on COM3. We may use putty to connect to COM3 and Blue Pill will echo everything that we type", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "ImageMetadata:1*UA6gHiWDenc0WOmYtQmL-A.png": { "id": "1*UA6gHiWDenc0WOmYtQmL-A.png", "originalHeight": 771, "originalWidth": 602, "focusPercentX": null, "focusPercentY": null, "alt": null, "__typename": "ImageMetadata" }, "Paragraph:4571f6d18025_43": { "id": "4571f6d18025_43", "name": "aead", "type": "P", "href": null, "layout": null, "metadata": null, "text": "When you connect the Blue Pill to your computer, the bootloader code exposes a USB serial port to the computer, which is useful for debugging Blue Pill programs. For completeness I added the implementation of USB_CDC_REQ_GET_LINE_CODING just to satisfy Windows when it asks for the serial port parameters (e.g. 9600 bps, 1 stop bit, 8 data bits).", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_43.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_43.markups.1", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_43.markups.0": { "type": "CODE", "start": 209, "end": 236, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_43.markups.1": { "type": "A", "start": 179, "end": 209, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fcdc.c", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_44": { "id": "4571f6d18025_44", "name": "6ef3", "type": "P", "href": null, "layout": null, "metadata": null, "text": "USB Serial is more complex than USB Storage because we need to implement not one but two interfaces from the USB Communications Device Class (CDC) spec:", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_44.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_44.markups.1", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_44.markups.0": { "type": "A", "start": 109, "end": 146, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FUSB_communications_device_class", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_44.markups.1": { "type": "STRONG", "start": 109, "end": 147, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_45": { "id": "4571f6d18025_45", "name": "541c", "type": "OLI", "href": null, "layout": null, "metadata": null, "text": "Data Model for sending and receiving data over the serial port", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_45.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_45.markups.0": { "type": "STRONG", "start": 0, "end": 10, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_46": { "id": "4571f6d18025_46", "name": "1a60", "type": "OLI", "href": null, "layout": null, "metadata": null, "text": "Abstract Control Model (ACM) for getting and setting the serial connection parameters, like 9600 bps, 1 stop bit, 8 data bits. USB_CDC_REQ_GET_LINE_CODING is part of the ACM interface. More details here.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_46.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_46.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_46.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_46.markups.0": { "type": "CODE", "start": 127, "end": 154, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_46.markups.1": { "type": "A", "start": 185, "end": 202, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fcscott.net\u002Fusb_dev\u002Fdata\u002Fdevclass\u002Fusbcdc11.pdf", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_46.markups.2": { "type": "STRONG", "start": 0, "end": 28, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_47": { "id": "4571f6d18025_47", "name": "fd80", "type": "P", "href": null, "layout": null, "metadata": null, "text": "We are stacking up multiple interfaces — USB MSC (for storage) and USB CDC (for serial comms). And within USB CDC interface we are stacking up the CDC Data and CDC ACM sub-interfaces.", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_48": { "id": "4571f6d18025_48", "name": "ee2f", "type": "P", "href": null, "layout": null, "metadata": null, "text": "How does USB support this stacking? With a USB Composite Device and multiple USB Descriptors.", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_49": { "id": "4571f6d18025_49", "name": "7fcb", "type": "MIXTAPE_EMBED", "href": null, "layout": null, "metadata": null, "text": "Lup Yuen Lee on LinkedIn: \"Supercomplicated USB Descriptors for #STM32 Blue Pill UF2 Bootloader…\nDecember 15, 2018: Lup Yuen Lee posted images on LinkedInwww.linkedin.com", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_49.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_49.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_49.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_49.mixtapeMetadata", "typename": "MixtapeMetadata" } }, "Paragraph:4571f6d18025_49.markups.0": { "type": "A", "start": 0, "end": 170, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fwww.linkedin.com\u002Ffeed\u002Fupdate\u002Furn:li:activity:6479715878161223680", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_49.markups.1": { "type": "STRONG", "start": 0, "end": 96, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_49.markups.2": { "type": "EM", "start": 97, "end": 154, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "$Paragraph:4571f6d18025_49.mixtapeMetadata": { "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fwww.linkedin.com\u002Ffeed\u002Fupdate\u002Furn:li:activity:6479715878161223680", "thumbnailImageId": "0*q0g3Cp3d612i0I_9", "mediaResourceId": "0*q0g3Cp3d612i0I_9", "__typename": "MixtapeMetadata" }, "Paragraph:4571f6d18025_50": { "id": "4571f6d18025_50", "name": "339b", "type": "H3", "href": null, "layout": null, "metadata": null, "text": "USB Descriptors", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_51": { "id": "4571f6d18025_51", "name": "2c5e", "type": "P", "href": null, "layout": null, "metadata": null, "text": "The Blue Pill Bootloader is a USB Composite Device, meaning that it supports multiple USB interfaces (storage, serial, DFU). When we connect the Blue Pill to a computer, Windows (or Mac or Linux) will query the Blue Pill for the USB interfaces that it supports. In the USB world, everything is defined through “Descriptors”. Descriptors are very important for getting our Blue Pill to function as a proper USB device under Windows, Mac AND Linux. So pay attention…", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_51.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_51.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_51.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_51.markups.0": { "type": "A", "start": 280, "end": 324, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows-hardware\u002Fdrivers\u002Fusbcon\u002Fstandard-usb-descriptors", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_51.markups.1": { "type": "STRONG", "start": 30, "end": 50, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_51.markups.2": { "type": "STRONG", "start": 77, "end": 100, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_52": { "id": "4571f6d18025_52", "name": "183a", "type": "IMG", "href": null, "layout": "INSET_CENTER", "metadata": { "type": "id", "generated": false, "id": "ImageMetadata:0*12MBGX-VO0gqSVnW.png", "typename": "ImageMetadata" }, "text": "Hierarchy of USB Descriptors. From https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows-hardware\u002Fdrivers\u002Fusbcon\u002Fstandard-usb-descriptors", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_52.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "ImageMetadata:0*12MBGX-VO0gqSVnW.png": { "id": "0*12MBGX-VO0gqSVnW.png", "originalHeight": 458, "originalWidth": 444, "focusPercentX": null, "focusPercentY": null, "alt": null, "__typename": "ImageMetadata" }, "Paragraph:4571f6d18025_52.markups.0": { "type": "A", "start": 35, "end": 124, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows-hardware\u002Fdrivers\u002Fusbcon\u002Fstandard-usb-descriptors", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_53": { "id": "4571f6d18025_53", "name": "872f", "type": "P", "href": null, "layout": null, "metadata": null, "text": "Our Blue Pill USB Descriptors are defined here. As shown in the diagram above, the USB Descriptors are defined in a hierarchy…", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_53.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_53.markups.0": { "type": "A", "start": 30, "end": 46, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fusb_conf.c#L51-L336", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_54": { "id": "4571f6d18025_54", "name": "c2ad", "type": "IFRAME", "href": null, "layout": "OUTSET_LEFT", "metadata": null, "text": "USB Device Descriptor", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_54.iframe", "typename": "Iframe" }, "mixtapeMetadata": null }, "MediaResource:1b80eb94276d5660c75c300a75f3129b": { "id": "1b80eb94276d5660c75c300a75f3129b", "iframeSrc": "", "iframeHeight": 0, "iframeWidth": 0, "title": "usb-device.c", "__typename": "MediaResource" }, "$Paragraph:4571f6d18025_54.iframe": { "mediaResource": { "type": "id", "generated": false, "id": "MediaResource:1b80eb94276d5660c75c300a75f3129b", "typename": "MediaResource" }, "__typename": "Iframe" }, "Paragraph:4571f6d18025_55": { "id": "4571f6d18025_55", "name": "14fc", "type": "P", "href": null, "layout": null, "metadata": null, "text": "1️⃣ Device Descriptor: At the top level we define the USB Device.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_55.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_55.markups.0": { "type": "STRONG", "start": 0, "end": 21, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_56": { "id": "4571f6d18025_56", "name": "be99", "type": "P", "href": null, "layout": null, "metadata": null, "text": "The Device Descriptor includes the USB Vendor ID and Product ID (the official designation of the device), plus the manufacturer and product names (defined as String Descriptors, explained below).", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_57": { "id": "4571f6d18025_57", "name": "6070", "type": "IFRAME", "href": null, "layout": "OUTSET_LEFT", "metadata": null, "text": "USB Configuration Descriptor", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_57.iframe", "typename": "Iframe" }, "mixtapeMetadata": null }, "MediaResource:cd3f7d00cb03baa919e9d9c47ed0edbe": { "id": "cd3f7d00cb03baa919e9d9c47ed0edbe", "iframeSrc": "", "iframeHeight": 0, "iframeWidth": 0, "title": "usb-configuration.c", "__typename": "MediaResource" }, "$Paragraph:4571f6d18025_57.iframe": { "mediaResource": { "type": "id", "generated": false, "id": "MediaResource:cd3f7d00cb03baa919e9d9c47ed0edbe", "typename": "MediaResource" }, "__typename": "Iframe" }, "Paragraph:4571f6d18025_58": { "id": "4571f6d18025_58", "name": "e025", "type": "P", "href": null, "layout": null, "metadata": null, "text": "2️⃣ Configuration Descriptor: At the next level we define the device configuration, which includes the list of interfaces and the expected power to be supplied to the device.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_58.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_58.markups.0": { "type": "STRONG", "start": 4, "end": 28, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_59": { "id": "4571f6d18025_59", "name": "3e05", "type": "IFRAME", "href": null, "layout": "OUTSET_LEFT", "metadata": null, "text": "USB Interface Descriptor for USB Storage (MSC) interface", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_59.iframe", "typename": "Iframe" }, "mixtapeMetadata": null }, "MediaResource:11f4e3391f124fe6bd87638c61801e33": { "id": "11f4e3391f124fe6bd87638c61801e33", "iframeSrc": "", "iframeHeight": 0, "iframeWidth": 0, "title": "usb-interface.c", "__typename": "MediaResource" }, "$Paragraph:4571f6d18025_59.iframe": { "mediaResource": { "type": "id", "generated": false, "id": "MediaResource:11f4e3391f124fe6bd87638c61801e33", "typename": "MediaResource" }, "__typename": "Iframe" }, "Paragraph:4571f6d18025_60": { "id": "4571f6d18025_60", "name": "08e0", "type": "P", "href": null, "layout": null, "metadata": null, "text": "3️⃣ Interface Descriptor: Defines the interfaces implemented by the device, like MSC for USB Storage and CDC for USB Serial.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_60.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_60.markups.0": { "type": "STRONG", "start": 4, "end": 24, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_61": { "id": "4571f6d18025_61", "name": "4727", "type": "P", "href": null, "layout": null, "metadata": null, "text": "Each interface includes a list of USB endpoints (usually 0, 1 or 2 endpoints).", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_62": { "id": "4571f6d18025_62", "name": "535a", "type": "IFRAME", "href": null, "layout": "OUTSET_LEFT", "metadata": null, "text": "USB Endpoint Descriptors for USB Storage (MSC) interface", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_62.iframe", "typename": "Iframe" }, "mixtapeMetadata": null }, "MediaResource:02f6a2b8f9952d17b445bf465bd7b381": { "id": "02f6a2b8f9952d17b445bf465bd7b381", "iframeSrc": "", "iframeHeight": 0, "iframeWidth": 0, "title": "usb-endpoint.c", "__typename": "MediaResource" }, "$Paragraph:4571f6d18025_62.iframe": { "mediaResource": { "type": "id", "generated": false, "id": "MediaResource:02f6a2b8f9952d17b445bf465bd7b381", "typename": "MediaResource" }, "__typename": "Iframe" }, "Paragraph:4571f6d18025_63": { "id": "4571f6d18025_63", "name": "d8dc", "type": "P", "href": null, "layout": null, "metadata": null, "text": "4️⃣ Endpoint Descriptor: What’s a USB endpoint? It works like a TCP socket. When our Windows \u002F Mac \u002F Linux computer wishes to send a storage or serial request to the Blue Pill, the computer needs to send the request to a USB endpoint (or address) for the USB interface (storage or serial).", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_63.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_63.markups.0": { "type": "STRONG", "start": 4, "end": 23, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_64": { "id": "4571f6d18025_64", "name": "5c64", "type": "P", "href": null, "layout": null, "metadata": null, "text": "OUT endpoints are used by the computer to send data to our Blue Pill. OUT endpoints are numbered 0x01, 0x02, … 0x0F.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_64.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_64.markups.0": { "type": "CODE", "start": 97, "end": 115, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_65": { "id": "4571f6d18025_65", "name": "e516", "type": "P", "href": null, "layout": null, "metadata": null, "text": "IN endpoints are used by the Blue Pill to send data to the computer. IN endpoints are numbered 0x81, 0x82, … 0x8F.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_65.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_65.markups.0": { "type": "CODE", "start": 95, "end": 113, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_66": { "id": "4571f6d18025_66", "name": "d9e4", "type": "P", "href": null, "layout": null, "metadata": null, "text": "Endpoints 0x00 and 0x80 are reserved for USB device control messages. They are used by the computer to fetch the Blue Pill’s USB descriptors and to control the Blue Pill.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_66.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_66.markups.1", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_66.markups.0": { "type": "CODE", "start": 10, "end": 14, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_66.markups.1": { "type": "CODE", "start": 19, "end": 23, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_67": { "id": "4571f6d18025_67", "name": "db32", "type": "IFRAME", "href": null, "layout": "OUTSET_LEFT", "metadata": null, "text": "USB Interface Association Descriptor for USB Serial (CDC) interface", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_67.iframe", "typename": "Iframe" }, "mixtapeMetadata": null }, "MediaResource:6ad4cb5f33eaaf161c0e137b9847dd88": { "id": "6ad4cb5f33eaaf161c0e137b9847dd88", "iframeSrc": "", "iframeHeight": 0, "iframeWidth": 0, "title": "usb-interface-assoc.c", "__typename": "MediaResource" }, "$Paragraph:4571f6d18025_67.iframe": { "mediaResource": { "type": "id", "generated": false, "id": "MediaResource:6ad4cb5f33eaaf161c0e137b9847dd88", "typename": "MediaResource" }, "__typename": "Iframe" }, "Paragraph:4571f6d18025_68": { "id": "4571f6d18025_68", "name": "1b5d", "type": "P", "href": null, "layout": null, "metadata": null, "text": "5️⃣ Interface Association Descriptor: Remember that the USB Serial CDC interface requires two sub-interfaces — CDC ACM and CDC Data?", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_68.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_68.markups.0": { "type": "STRONG", "start": 4, "end": 36, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_69": { "id": "4571f6d18025_69", "name": "ed4b", "type": "P", "href": null, "layout": null, "metadata": null, "text": "To do this we need to define the parent interface for CDC and define ACM and Data as the child interfaces. The parent interface is defined using the Interface Association Descriptor.", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_70": { "id": "4571f6d18025_70", "name": "20e4", "type": "P", "href": null, "layout": null, "metadata": null, "text": "Check out the sample code, which defines cdc_iface_assoc as the parent Interface Association Descriptor, and comm_iface, data_iface as the child interfaces.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_70.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_70.markups.1", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_70.markups.0": { "type": "CODE", "start": 41, "end": 56, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_70.markups.1": { "type": "CODE", "start": 109, "end": 131, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_71": { "id": "4571f6d18025_71", "name": "6ee3", "type": "P", "href": null, "layout": null, "metadata": null, "text": "How did I discover this obscure descriptor? By using Wireshark to capture the USB traffic from BBC micro:bit! The micro:bit runs a UF2 Bootloader that’s as complex as ours, so it’s a good reference for our Blue Pill bootloader.", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_72": { "id": "4571f6d18025_72", "name": "486c", "type": "IFRAME", "href": null, "layout": "OUTSET_LEFT", "metadata": null, "text": "USB String Descriptor", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_72.iframe", "typename": "Iframe" }, "mixtapeMetadata": null }, "MediaResource:c50500b9b344d8e89846b805af0cf93b": { "id": "c50500b9b344d8e89846b805af0cf93b", "iframeSrc": "", "iframeHeight": 0, "iframeWidth": 0, "title": "usb-string.c", "__typename": "MediaResource" }, "$Paragraph:4571f6d18025_72.iframe": { "mediaResource": { "type": "id", "generated": false, "id": "MediaResource:c50500b9b344d8e89846b805af0cf93b", "typename": "MediaResource" }, "__typename": "Iframe" }, "Paragraph:4571f6d18025_73": { "id": "4571f6d18025_73", "name": "b06a", "type": "P", "href": null, "layout": null, "metadata": null, "text": "6️⃣ String Descriptor: The last descriptor defines all the text strings referenced by the other descriptors, like the interface names. Each string is assigned a running sequence number 1, 2, 3, …", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_73.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_73.markups.0": { "type": "STRONG", "start": 4, "end": 21, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_74": { "id": "4571f6d18025_74", "name": "7492", "type": "IMG", "href": null, "layout": "OUTSET_LEFT", "metadata": { "type": "id", "generated": false, "id": "ImageMetadata:1*EDMD5Q8sFnKDNxzeZAQjKg.png", "typename": "ImageMetadata" }, "text": "String Descriptor 0 returns the supported Language ID (0x0409). From the Wireshark log https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Flogs\u002Fusb-windows.pcapng.gz", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_74.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "ImageMetadata:1*EDMD5Q8sFnKDNxzeZAQjKg.png": { "id": "1*EDMD5Q8sFnKDNxzeZAQjKg.png", "originalHeight": 522, "originalWidth": 619, "focusPercentX": null, "focusPercentY": null, "alt": null, "__typename": "ImageMetadata" }, "Paragraph:4571f6d18025_74.markups.0": { "type": "A", "start": 87, "end": 172, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Flogs\u002Fusb-windows.pcapng.gz", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_75": { "id": "4571f6d18025_75", "name": "edbe", "type": "P", "href": null, "layout": null, "metadata": null, "text": "In the Wireshark capture logs we may see the computer requesting for String Descriptor with index 0.", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_76": { "id": "4571f6d18025_76", "name": "8c07", "type": "P", "href": null, "layout": null, "metadata": null, "text": "This is actually a request for the Language ID that our device supports. By default the Blue Pill returns 0x0409, the Language ID for US English.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_76.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_76.markups.0": { "type": "CODE", "start": 106, "end": 112, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_77": { "id": "4571f6d18025_77", "name": "4a8c", "type": "P", "href": null, "layout": null, "metadata": null, "text": "The above USB descriptors are standard and we don’t need to write any code to handle the descriptor processing — libopencm3 handles the requests for all these descriptors automagically.", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_78": { "id": "4571f6d18025_78", "name": "c9f7", "type": "IMG", "href": null, "layout": "OUTSET_CENTER", "metadata": { "type": "id", "generated": false, "id": "ImageMetadata:1*5GAoWCMuQ8VMP4p5jfAC4g.png", "typename": "ImageMetadata" }, "text": "Long list of USB Descriptors used by our Blue Pill bootloader. From https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fusb_conf.c", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_78.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "ImageMetadata:1*5GAoWCMuQ8VMP4p5jfAC4g.png": { "id": "1*5GAoWCMuQ8VMP4p5jfAC4g.png", "originalHeight": 892, "originalWidth": 1756, "focusPercentX": null, "focusPercentY": null, "alt": null, "__typename": "ImageMetadata" }, "Paragraph:4571f6d18025_78.markups.0": { "type": "A", "start": 68, "end": 141, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fusb_conf.c", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_79": { "id": "4571f6d18025_79", "name": "9845", "type": "P", "href": null, "layout": null, "metadata": null, "text": "The complete list of USB descriptors for our Blue Pill bootloader is rather long, and it’s amazing that they all work for Windows, Mac AND Linux! It’s unlikely that you’ll work on something this complex, but if you’re stuck, do what I did… use Wireshark to sniff out another device that works!", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_80": { "id": "4571f6d18025_80", "name": "15b1", "type": "H3", "href": null, "layout": null, "metadata": null, "text": "USB 2.1 Descriptors", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_81": { "id": "4571f6d18025_81", "name": "4b7a", "type": "P", "href": null, "layout": null, "metadata": null, "text": "Ready for more USB descriptors? Here’s a long and powerful one— the Binary Device Object Store (BOS) Descriptor. The BOS Descriptor allows us to define USB descriptors that for non-standard platforms, like Windows.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_81.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_81.markups.0": { "type": "STRONG", "start": 68, "end": 112, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_82": { "id": "4571f6d18025_82", "name": "817c", "type": "P", "href": null, "layout": null, "metadata": null, "text": "Remember that we defined in the USB Device Descriptor that we support USB 2.1 instead of the usual USB 2.0? USB 2.1 devices are required to support BOS Descriptors, which are not implemented in libopencm3, so we have to handle them in usb21_standard.c.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_82.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_82.markups.1", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_82.markups.0": { "type": "A", "start": 220, "end": 251, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fusb21_standard.c#L61-L87", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_82.markups.1": { "type": "STRONG", "start": 108, "end": 163, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_83": { "id": "4571f6d18025_83", "name": "adb7", "type": "P", "href": null, "layout": null, "metadata": null, "text": "Why did we choose to implement USB 2.1 and BOS Descriptors? So that we could implement WebUSB and USB DFU (we’ll meet them later). The two BOS Descriptors we have implemented in webusb.c are…", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_83.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_83.markups.0": { "type": "A", "start": 163, "end": 186, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fwebusb.c", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_84": { "id": "4571f6d18025_84", "name": "09b2", "type": "IFRAME", "href": null, "layout": "OUTSET_LEFT", "metadata": null, "text": "", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_84.iframe", "typename": "Iframe" }, "mixtapeMetadata": null }, "MediaResource:5eff58ddcaef3b7c7b8ef1ca02c631b9": { "id": "5eff58ddcaef3b7c7b8ef1ca02c631b9", "iframeSrc": "", "iframeHeight": 0, "iframeWidth": 0, "title": "webusb-bos.c", "__typename": "MediaResource" }, "$Paragraph:4571f6d18025_84.iframe": { "mediaResource": { "type": "id", "generated": false, "id": "MediaResource:5eff58ddcaef3b7c7b8ef1ca02c631b9", "typename": "MediaResource" }, "__typename": "Iframe" }, "Paragraph:4571f6d18025_85": { "id": "4571f6d18025_85", "name": "6ec6", "type": "P", "href": null, "layout": null, "metadata": null, "text": "1️⃣ WebUSB Descriptor: Here we declare that our Blue Pill bootloader supports the WebUSB standard, implemented by Google Chrome web browsers.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_85.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_85.markups.0": { "type": "STRONG", "start": 4, "end": 21, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_86": { "id": "4571f6d18025_86", "name": "cf25", "type": "P", "href": null, "layout": null, "metadata": null, "text": "When the Chrome browser detects that our device supports WebUSB, it will send our device a USB request to fetch the landing page URL for our device.", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_87": { "id": "4571f6d18025_87", "name": "d762", "type": "IMG", "href": null, "layout": "INSET_CENTER", "metadata": { "type": "id", "generated": false, "id": "ImageMetadata:1*bXb6nabe53yN9EX-K9P5TA.png", "typename": "ImageMetadata" }, "text": "On macOS, the landing page URL is displayed as a Chrome notification. On Windows the notification seems to be disabled.", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "ImageMetadata:1*bXb6nabe53yN9EX-K9P5TA.png": { "id": "1*bXb6nabe53yN9EX-K9P5TA.png", "originalHeight": 347, "originalWidth": 976, "focusPercentX": null, "focusPercentY": null, "alt": null, "__typename": "ImageMetadata" }, "Paragraph:4571f6d18025_88": { "id": "4571f6d18025_88", "name": "5139", "type": "P", "href": null, "layout": null, "metadata": null, "text": "This WebUSB request is implemented in webusb.c since it’s not a standard USB request handled by libopencm3. Chrome transmits the vendor code 0x22 in the request so that we know the request is from Chrome WebUSB.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_88.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_88.markups.1", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_88.markups.0": { "type": "CODE", "start": 141, "end": 145, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_88.markups.1": { "type": "A", "start": 23, "end": 46, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fwebusb.c#L74-L118", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_89": { "id": "4571f6d18025_89", "name": "f6c5", "type": "IFRAME", "href": null, "layout": "OUTSET_LEFT", "metadata": null, "text": "", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_89.iframe", "typename": "Iframe" }, "mixtapeMetadata": null }, "MediaResource:93b52df9345a64c126abf08a4d1344cc": { "id": "93b52df9345a64c126abf08a4d1344cc", "iframeSrc": "", "iframeHeight": 0, "iframeWidth": 0, "title": "msos-bos.c", "__typename": "MediaResource" }, "$Paragraph:4571f6d18025_89.iframe": { "mediaResource": { "type": "id", "generated": false, "id": "MediaResource:93b52df9345a64c126abf08a4d1344cc", "typename": "MediaResource" }, "__typename": "Iframe" }, "Paragraph:4571f6d18025_90": { "id": "4571f6d18025_90", "name": "8ffb", "type": "P", "href": null, "layout": null, "metadata": null, "text": "2️⃣ Microsoft OS 2.0 Descriptor: This defines a set of descriptors specific to Windows that we’ll cover in the next section.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_90.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_90.markups.0": { "type": "STRONG", "start": 4, "end": 31, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_91": { "id": "4571f6d18025_91", "name": "e77a", "type": "P", "href": null, "layout": null, "metadata": null, "text": "Windows will send our device a USB request to fetch the set of Windows-specific descriptors.", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_92": { "id": "4571f6d18025_92", "name": "46fe", "type": "P", "href": null, "layout": null, "metadata": null, "text": "This Windows descriptor request is implemented in winusb.c since it’s not a standard USB request handled by libopencm3. Windows transmits the vendor code 0x21 in the request so that we know the request is from Windows.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_92.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_92.markups.1", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_92.markups.0": { "type": "CODE", "start": 154, "end": 158, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_92.markups.1": { "type": "A", "start": 35, "end": 58, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fwinusb.c#L159-L185", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_93": { "id": "4571f6d18025_93", "name": "38f0", "type": "IMG", "href": null, "layout": "OUTSET_LEFT", "metadata": { "type": "id", "generated": false, "id": "ImageMetadata:1*n5_A43SFau7JB29cmykQmg.png", "typename": "ImageMetadata" }, "text": "Windows requesting the BOS Descriptor from Blue Pill. From the Wireshark log https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Flogs\u002Fusb-windows.pcapng.gz", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_93.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "ImageMetadata:1*n5_A43SFau7JB29cmykQmg.png": { "id": "1*n5_A43SFau7JB29cmykQmg.png", "originalHeight": 1402, "originalWidth": 1814, "focusPercentX": null, "focusPercentY": null, "alt": null, "__typename": "ImageMetadata" }, "Paragraph:4571f6d18025_93.markups.0": { "type": "A", "start": 77, "end": 162, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Flogs\u002Fusb-windows.pcapng.gz", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_94": { "id": "4571f6d18025_94", "name": "e432", "type": "P", "href": null, "layout": null, "metadata": null, "text": "The Microsoft OS 2.0 Descriptor implementation is not part of the original bootloader source code. I added this code as a replacement for the older Microsoft OS 1.0 Descriptor implementation. The older implementation is still in winusb.c.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_94.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_94.markups.0": { "type": "A", "start": 220, "end": 237, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fwinusb.c#L186-L213", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_95": { "id": "4571f6d18025_95", "name": "3ea5", "type": "P", "href": null, "layout": null, "metadata": null, "text": "For details of the BOS Descriptor format, see the official USB 3.2 Specification, Section 9.6.2 “Binary Device Object Store (BOS)”. If you’re looking for the official USB 2.1 Specs… Don’t! Technically USB 2.1 doesn’t exist as a standard.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_95.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_95.markups.1", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_95.markups.0": { "type": "A", "start": 59, "end": 80, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fwww.usb.org\u002Fdocument-library\u002Fusb-32-specification-released-september-22-2017-and-ecns", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_95.markups.1": { "type": "STRONG", "start": 80, "end": 82, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_96": { "id": "4571f6d18025_96", "name": "2fec", "type": "P", "href": null, "layout": null, "metadata": null, "text": "BOS is actually part of the USB 3.0 specs, but our Blue Pill bootloader doesn’t implement the entire USB 3.0 specs. The industry has adopted the name “USB 2.1” to refer to a USB 2.0 device that supports BOS. Which fits our purpose perfectly.", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_97": { "id": "4571f6d18025_97", "name": "bbc1", "type": "MIXTAPE_EMBED", "href": null, "layout": null, "metadata": null, "text": "Microsoft OS 2.0 Descriptors Specification\n(a) “Your Implementation” means Your: (i) firmware and\u002For hardware that implements the OS Descriptor set described in…msdn.microsoft.com", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_97.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_97.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_97.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_97.mixtapeMetadata", "typename": "MixtapeMetadata" } }, "Paragraph:4571f6d18025_97.markups.0": { "type": "A", "start": 0, "end": 179, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fmsdn.microsoft.com\u002Fen-us\u002Flibrary\u002Fwindows\u002Fhardware\u002Fdn385747.aspx", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_97.markups.1": { "type": "STRONG", "start": 0, "end": 42, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_97.markups.2": { "type": "EM", "start": 43, "end": 161, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "$Paragraph:4571f6d18025_97.mixtapeMetadata": { "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fmsdn.microsoft.com\u002Fen-us\u002Flibrary\u002Fwindows\u002Fhardware\u002Fdn385747.aspx", "thumbnailImageId": "", "mediaResourceId": "", "__typename": "MixtapeMetadata" }, "Paragraph:4571f6d18025_98": { "id": "4571f6d18025_98", "name": "eb4a", "type": "H3", "href": null, "layout": null, "metadata": null, "text": "Windows USB Descriptors", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_99": { "id": "4571f6d18025_99", "name": "437c", "type": "P", "href": null, "layout": null, "metadata": null, "text": "Because of the BOS Descriptor, Windows will query our Blue Pill bootloader for the Microsoft OS 2.0 Descriptors documented above. The long list of Windows descriptors for Blue Pill is defined in winusb.c (obtained from here). We’ll look at two interesting descriptors…", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_99.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_99.markups.1", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_99.markups.0": { "type": "A", "start": 184, "end": 203, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fwinusb.c#L33-L91", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_99.markups.1": { "type": "A", "start": 214, "end": 223, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Fintel\u002Fzephyr.js\u002Fblob\u002Fmaster\u002Fsrc\u002Fzjs_webusb.c", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_100": { "id": "4571f6d18025_100", "name": "c9dc", "type": "IFRAME", "href": null, "layout": "OUTSET_LEFT", "metadata": null, "text": "Compatible ID Descriptor", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_100.iframe", "typename": "Iframe" }, "mixtapeMetadata": null }, "MediaResource:bf71431157301245a58f7e7d71cf318e": { "id": "bf71431157301245a58f7e7d71cf318e", "iframeSrc": "", "iframeHeight": 0, "iframeWidth": 0, "title": "msos-compatible-id.c", "__typename": "MediaResource" }, "$Paragraph:4571f6d18025_100.iframe": { "mediaResource": { "type": "id", "generated": false, "id": "MediaResource:bf71431157301245a58f7e7d71cf318e", "typename": "MediaResource" }, "__typename": "Iframe" }, "Paragraph:4571f6d18025_101": { "id": "4571f6d18025_101", "name": "0ea1", "type": "IFRAME", "href": null, "layout": "OUTSET_LEFT", "metadata": null, "text": "Registry Property Descriptor", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_101.iframe", "typename": "Iframe" }, "mixtapeMetadata": null }, "MediaResource:61d9c66dbc4296748ead3e5488786aab": { "id": "61d9c66dbc4296748ead3e5488786aab", "iframeSrc": "", "iframeHeight": 0, "iframeWidth": 0, "title": "msos-property.c", "__typename": "MediaResource" }, "$Paragraph:4571f6d18025_101.iframe": { "mediaResource": { "type": "id", "generated": false, "id": "MediaResource:61d9c66dbc4296748ead3e5488786aab", "typename": "MediaResource" }, "__typename": "Iframe" }, "Paragraph:4571f6d18025_102": { "id": "4571f6d18025_102", "name": "d533", "type": "P", "href": null, "layout": null, "metadata": null, "text": "1️⃣ Compatible ID Descriptor: This declares to Windows that the first USB interface (DFU) of our Blue Pill bootloader is compatible with WinUSB.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_102.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_102.markups.0": { "type": "STRONG", "start": 4, "end": 28, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_103": { "id": "4571f6d18025_103", "name": "58f8", "type": "P", "href": null, "layout": null, "metadata": null, "text": "Windows will then use the standard WinUSB.sys driver for the DFU interface.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_103.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_103.markups.0": { "type": "CODE", "start": 35, "end": 45, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_104": { "id": "4571f6d18025_104", "name": "8db4", "type": "P", "href": null, "layout": null, "metadata": null, "text": "2️⃣ Registry Property Descriptor: This declares to Windows that it should create a Windows registry setting named DeviceInterfaceGUIDs with value {9D32F82C-1FB2–4486–8501-B6145B5BA336}", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_104.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_104.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_104.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_104.markups.0": { "type": "CODE", "start": 114, "end": 134, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_104.markups.1": { "type": "CODE", "start": 146, "end": 184, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_104.markups.2": { "type": "STRONG", "start": 4, "end": 32, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_105": { "id": "4571f6d18025_105", "name": "1846", "type": "P", "href": null, "layout": null, "metadata": null, "text": "Creating this registry setting is mandatory when using the WinUSB driver for a USB interface.", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_106": { "id": "4571f6d18025_106", "name": "d413", "type": "P", "href": null, "layout": null, "metadata": null, "text": "Why use WinUSB for the DFU interface?", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_106.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_106.markups.0": { "type": "STRONG", "start": 0, "end": 37, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_107": { "id": "4571f6d18025_107", "name": "87f5", "type": "P", "href": null, "layout": null, "metadata": null, "text": "The STM32 DFU USB Interface implemented in dfu.c is meant to allow us to flash the Blue Pill through the Chrome browser, without the installation of any drivers. The WinUSB driver is preloaded with Windows, so it doesn’t need any installation.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_107.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_107.markups.1", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_107.markups.0": { "type": "A", "start": 4, "end": 13, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fwww.st.com\u002Fcontent\u002Fccc\u002Fresource\u002Ftechnical\u002Fdocument\u002Fapplication_note\u002F6a\u002F17\u002F92\u002F02\u002F58\u002F98\u002F45\u002F0c\u002FCD00264379.pdf\u002Ffiles\u002FCD00264379.pdf\u002Fjcr:content\u002Ftranslations\u002Fen.CD00264379.pdf", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_107.markups.1": { "type": "A", "start": 28, "end": 48, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fdfu.c", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_108": { "id": "4571f6d18025_108", "name": "8468", "type": "P", "href": null, "layout": null, "metadata": null, "text": "WinUSB exposes a low-level data transfer interface that WebUSB applications may call to transfer data to the DFU interface. So WinUSB is the right Windows USB driver for supporting the DFU interface. For more details, check this article…", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_108.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_108.markups.0": { "type": "A", "start": 88, "end": 122, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FAPI\u002FUSBDevice\u002FcontrolTransferOut", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_109": { "id": "4571f6d18025_109", "name": "ac95", "type": "MIXTAPE_EMBED", "href": null, "layout": null, "metadata": null, "text": "WinUSB Device - Windows drivers\nIn this topic, you will learn about how a WinUSB device is recognized in Windows 8. The information in this topic…docs.microsoft.com", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_109.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_109.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_109.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_109.mixtapeMetadata", "typename": "MixtapeMetadata" } }, "Paragraph:4571f6d18025_109.markups.0": { "type": "A", "start": 0, "end": 164, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows-hardware\u002Fdrivers\u002Fusbcon\u002Fautomatic-installation-of-winusb", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_109.markups.1": { "type": "STRONG", "start": 0, "end": 31, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_109.markups.2": { "type": "EM", "start": 32, "end": 146, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "$Paragraph:4571f6d18025_109.mixtapeMetadata": { "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows-hardware\u002Fdrivers\u002Fusbcon\u002Fautomatic-installation-of-winusb", "thumbnailImageId": "0*cLJuFgEzC52GDiLZ", "mediaResourceId": "0*cLJuFgEzC52GDiLZ", "__typename": "MixtapeMetadata" }, "Paragraph:4571f6d18025_110": { "id": "4571f6d18025_110", "name": "1cfa", "type": "P", "href": null, "layout": null, "metadata": null, "text": "When you’re changing the Blue Pill bootloader code and testing it, make sure you run regedit and delete the Windows registry key HLKM\\SYSTEM\\CurrentControlSet\\Control\\UsbFlags\\vvvvpppprrrrr where vvvv is the vendor ID, pppp is the product ID and rrrrr is the device revision number. If the key exists, Windows will skip the querying of descriptors from the Blue Pill bootloader, and use the old descriptors values instead. This is mentioned here…", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_110.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_110.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_110.markups.2", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_110.markups.3", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_110.markups.4", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_110.markups.5", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_110.markups.0": { "type": "CODE", "start": 85, "end": 92, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_110.markups.1": { "type": "CODE", "start": 129, "end": 189, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_110.markups.2": { "type": "CODE", "start": 196, "end": 200, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_110.markups.3": { "type": "CODE", "start": 219, "end": 223, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_110.markups.4": { "type": "CODE", "start": 246, "end": 251, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_110.markups.5": { "type": "EM", "start": 189, "end": 190, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_111": { "id": "4571f6d18025_111", "name": "ebd1", "type": "MIXTAPE_EMBED", "href": null, "layout": null, "metadata": null, "text": "Microsoft OS Descriptors for USB Devices - Windows drivers\nMicrosoft provides a set of proprietary device classes and USB descriptors, which are called Microsoft OS Descriptors…docs.microsoft.com", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_111.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_111.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_111.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_111.mixtapeMetadata", "typename": "MixtapeMetadata" } }, "Paragraph:4571f6d18025_111.markups.0": { "type": "A", "start": 0, "end": 195, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows-hardware\u002Fdrivers\u002Fusbcon\u002Fmicrosoft-defined-usb-descriptors", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_111.markups.1": { "type": "STRONG", "start": 0, "end": 58, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_111.markups.2": { "type": "EM", "start": 59, "end": 177, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "$Paragraph:4571f6d18025_111.mixtapeMetadata": { "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows-hardware\u002Fdrivers\u002Fusbcon\u002Fmicrosoft-defined-usb-descriptors", "thumbnailImageId": "0*ciCUynsO_72Hln8T", "mediaResourceId": "0*ciCUynsO_72Hln8T", "__typename": "MixtapeMetadata" }, "Paragraph:4571f6d18025_112": { "id": "4571f6d18025_112", "name": "55c6", "type": "MIXTAPE_EMBED", "href": null, "layout": null, "metadata": null, "text": "WebUSB DFU\nYour device has multiple DFU interfaces. Select one from the list below:devanlai.github.io", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_112.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_112.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_112.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_112.mixtapeMetadata", "typename": "MixtapeMetadata" } }, "Paragraph:4571f6d18025_112.markups.0": { "type": "A", "start": 0, "end": 101, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fdevanlai.github.io\u002Fwebdfu\u002Fdfu-util\u002F", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_112.markups.1": { "type": "STRONG", "start": 0, "end": 10, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_112.markups.2": { "type": "EM", "start": 11, "end": 83, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "$Paragraph:4571f6d18025_112.mixtapeMetadata": { "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fdevanlai.github.io\u002Fwebdfu\u002Fdfu-util\u002F", "thumbnailImageId": "", "mediaResourceId": "", "__typename": "MixtapeMetadata" }, "Paragraph:4571f6d18025_113": { "id": "4571f6d18025_113", "name": "1171", "type": "H3", "href": null, "layout": null, "metadata": null, "text": "WebUSB", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_114": { "id": "4571f6d18025_114", "name": "a0c3", "type": "P", "href": null, "layout": null, "metadata": null, "text": "Now that WebUSB and WinUSB have been configured for our Blue Pill’s DFU interface, click the link above to test them. We should be able to communicate with the Blue Pill bootloader through the Chrome browser and prepare to flash the ROM (set the Transfer Size to 256 bytes) with the firmware.bin file. (But don’t run the flash command yet because the bootloader has exceeded the 16K limit and will clash with the flashed firmware.)", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_114.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_114.markups.0": { "type": "A", "start": 283, "end": 300, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Ffirmware.bin", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_115": { "id": "4571f6d18025_115", "name": "9645", "type": "IFRAME", "href": null, "layout": "OUTSET_CENTER", "metadata": null, "text": "", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_115.iframe", "typename": "Iframe" }, "mixtapeMetadata": null }, "MediaResource:19d661216d1952ebb4b5e509c88f0892": { "id": "19d661216d1952ebb4b5e509c88f0892", "iframeSrc": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fcdn.embedly.com\u002Fwidgets\u002Fmedia.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FsrSTTt1fTeI%3Ffeature%3Doembed&url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DsrSTTt1fTeI&image=https%3A%2F%2Fi.ytimg.com%2Fvi%2FsrSTTt1fTeI%2Fhqdefault.jpg&key=a19fcc184b9711e1b4764040d3dc5c07&type=text%2Fhtml&schema=youtube", "iframeHeight": 480, "iframeWidth": 640, "title": "STM32 Blue Pill Bootloader with WebUSB DFU", "__typename": "MediaResource" }, "$Paragraph:4571f6d18025_115.iframe": { "mediaResource": { "type": "id", "generated": false, "id": "MediaResource:19d661216d1952ebb4b5e509c88f0892", "typename": "MediaResource" }, "__typename": "Iframe" }, "Paragraph:4571f6d18025_116": { "id": "4571f6d18025_116", "name": "a9ee", "type": "P", "href": null, "layout": null, "metadata": null, "text": "To experiment with WebUSB, open a Chrome console and enter this…", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_117": { "id": "4571f6d18025_117", "name": "261f", "type": "PRE", "href": null, "layout": null, "metadata": null, "text": "await navigator.usb.requestDevice({ filters: [] })", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_118": { "id": "4571f6d18025_118", "name": "6315", "type": "P", "href": null, "layout": null, "metadata": null, "text": "This lets us browse the Blue Pill bootloader descriptors through the JavaScript console in Chrome. If we sniff the USB data with Wireshark while this is running, we’ll see that the Chrome browser actually sends its own queries to refetch the USB descriptors.", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_119": { "id": "4571f6d18025_119", "name": "5122", "type": "IFRAME", "href": null, "layout": "OUTSET_CENTER", "metadata": null, "text": "", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_119.iframe", "typename": "Iframe" }, "mixtapeMetadata": null }, "MediaResource:ba5a8eb1436698e72e11a2f0590bb879": { "id": "ba5a8eb1436698e72e11a2f0590bb879", "iframeSrc": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fcdn.embedly.com\u002Fwidgets\u002Fmedia.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FJbwl7g-jMIw%3Ffeature%3Doembed&url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DJbwl7g-jMIw&image=https%3A%2F%2Fi.ytimg.com%2Fvi%2FJbwl7g-jMIw%2Fhqdefault.jpg&key=a19fcc184b9711e1b4764040d3dc5c07&type=text%2Fhtml&schema=youtube", "iframeHeight": 480, "iframeWidth": 640, "title": "STM32 Blue Pill Bootloader with WebUSB", "__typename": "MediaResource" }, "$Paragraph:4571f6d18025_119.iframe": { "mediaResource": { "type": "id", "generated": false, "id": "MediaResource:ba5a8eb1436698e72e11a2f0590bb879", "typename": "MediaResource" }, "__typename": "Iframe" }, "Paragraph:4571f6d18025_120": { "id": "4571f6d18025_120", "name": "ae89", "type": "P", "href": null, "layout": null, "metadata": null, "text": "I have tested the Blue Pill bootloader’s WebUSB support on Chrome for Windows, Mac and Ubuntu (requires root privilege). To troubleshoot the WebUSB interface, use the Chrome Device Log:", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_120.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_120.markups.1", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_120.markups.0": { "type": "STRONG", "start": 70, "end": 93, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_120.markups.1": { "type": "STRONG", "start": 167, "end": 184, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_121": { "id": "4571f6d18025_121", "name": "d16d", "type": "PRE", "href": null, "layout": null, "metadata": null, "text": "chrome:\u002F\u002Fdevice-log\u002F", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_122": { "id": "4571f6d18025_122", "name": "2de7", "type": "P", "href": null, "layout": null, "metadata": null, "text": "For details of the WebUSB JavaScript API, refer to these docs…", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_123": { "id": "4571f6d18025_123", "name": "fc9f", "type": "MIXTAPE_EMBED", "href": null, "layout": null, "metadata": null, "text": "USB\nThe USB interface of the WebUSB API provides attributes and methods for finding and connecting USB devices from a web…developer.mozilla.org", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_123.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_123.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_123.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_123.mixtapeMetadata", "typename": "MixtapeMetadata" } }, "Paragraph:4571f6d18025_123.markups.0": { "type": "A", "start": 0, "end": 143, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FAPI\u002FUSB", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_123.markups.1": { "type": "STRONG", "start": 0, "end": 3, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_123.markups.2": { "type": "EM", "start": 4, "end": 122, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "$Paragraph:4571f6d18025_123.mixtapeMetadata": { "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FAPI\u002FUSB", "thumbnailImageId": "0*cpjS37X9wxUR57gU", "mediaResourceId": "0*cpjS37X9wxUR57gU", "__typename": "MixtapeMetadata" }, "Paragraph:4571f6d18025_124": { "id": "4571f6d18025_124", "name": "3924", "type": "MIXTAPE_EMBED", "href": null, "layout": null, "metadata": null, "text": "USBDevice\nThe USBDevice interface of the the WebUSB API provides access to metadata about a paired USB device and methods for…developer.mozilla.org", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_124.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_124.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_124.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_124.mixtapeMetadata", "typename": "MixtapeMetadata" } }, "Paragraph:4571f6d18025_124.markups.0": { "type": "A", "start": 0, "end": 147, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FAPI\u002FUSBDevice", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_124.markups.1": { "type": "STRONG", "start": 0, "end": 9, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_124.markups.2": { "type": "EM", "start": 10, "end": 126, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "$Paragraph:4571f6d18025_124.mixtapeMetadata": { "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FAPI\u002FUSBDevice", "thumbnailImageId": "0*Dd6E5t1_EsHL75-Q", "mediaResourceId": "0*Dd6E5t1_EsHL75-Q", "__typename": "MixtapeMetadata" }, "Paragraph:4571f6d18025_125": { "id": "4571f6d18025_125", "name": "909f", "type": "MIXTAPE_EMBED", "href": null, "layout": null, "metadata": null, "text": "Lup Yuen Lee on LinkedIn: \"Quiz for #libopencm3 hackers... What's wrong with this sample code…\nDecember 15, 2018: Lup Yuen Lee posted images on LinkedInwww.linkedin.com", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_125.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_125.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_125.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_125.mixtapeMetadata", "typename": "MixtapeMetadata" } }, "Paragraph:4571f6d18025_125.markups.0": { "type": "A", "start": 0, "end": 168, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fwww.linkedin.com\u002Ffeed\u002Fupdate\u002Furn:li:activity:6479571365698605056", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_125.markups.1": { "type": "STRONG", "start": 0, "end": 94, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_125.markups.2": { "type": "EM", "start": 95, "end": 152, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "$Paragraph:4571f6d18025_125.mixtapeMetadata": { "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fwww.linkedin.com\u002Ffeed\u002Fupdate\u002Furn:li:activity:6479571365698605056", "thumbnailImageId": "0*bIiUwE42Y-dj1Dm6", "mediaResourceId": "0*bIiUwE42Y-dj1Dm6", "__typename": "MixtapeMetadata" }, "Paragraph:4571f6d18025_126": { "id": "4571f6d18025_126", "name": "e170", "type": "H3", "href": null, "layout": null, "metadata": null, "text": "USB Callbacks", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_127": { "id": "4571f6d18025_127", "name": "267c", "type": "P", "href": null, "layout": null, "metadata": null, "text": "The sample USB programs for libopencm3 look like this…", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_128": { "id": "4571f6d18025_128", "name": "f5b2", "type": "IFRAME", "href": null, "layout": "INSET_CENTER", "metadata": null, "text": "Sample USB code from https:\u002F\u002Fgithub.com\u002Flibopencm3\u002Flibopencm3-examples\u002Fblob\u002Fmaster\u002Fexamples\u002Fstm32\u002Ff3\u002Fstm32f3-discovery\u002Fusb_cdcacm\u002Fcdcacm.c", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_128.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_128.iframe", "typename": "Iframe" }, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_128.markups.0": { "type": "A", "start": 21, "end": 138, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flibopencm3\u002Flibopencm3-examples\u002Fblob\u002Fmaster\u002Fexamples\u002Fstm32\u002Ff3\u002Fstm32f3-discovery\u002Fusb_cdcacm\u002Fcdcacm.c", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "MediaResource:d0c2d2616aa9b8287c11887e73e9e553": { "id": "d0c2d2616aa9b8287c11887e73e9e553", "iframeSrc": "", "iframeHeight": 0, "iframeWidth": 0, "title": "register-usb.c", "__typename": "MediaResource" }, "$Paragraph:4571f6d18025_128.iframe": { "mediaResource": { "type": "id", "generated": false, "id": "MediaResource:d0c2d2616aa9b8287c11887e73e9e553", "typename": "MediaResource" }, "__typename": "Iframe" }, "Paragraph:4571f6d18025_129": { "id": "4571f6d18025_129", "name": "b377", "type": "P", "href": null, "layout": null, "metadata": null, "text": "There are 2 functions used to register callbacks in USB programs…", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_130": { "id": "4571f6d18025_130", "name": "c30f", "type": "OLI", "href": null, "layout": null, "metadata": null, "text": "usbd_register_set_config_callback(): This registers a callback function that is called when the USB device has set its configuration.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_130.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_130.markups.0": { "type": "CODE", "start": 0, "end": 35, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_131": { "id": "4571f6d18025_131", "name": "a34d", "type": "OLI", "href": null, "layout": null, "metadata": null, "text": "usbd_register_control_callback(): This registers a callback function that is called when the USB device receives a request on the control channel.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_131.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_131.markups.0": { "type": "CODE", "start": 0, "end": 32, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_132": { "id": "4571f6d18025_132", "name": "b7b2", "type": "P", "href": null, "layout": null, "metadata": null, "text": "Each of these functions support up to maximum of 4 callbacks. Since our Blue Pill bootloader has 4 USB interfaces + BOS Interface + WinUSB + WebUSB, we would have exceeded the limit. So I wrote my own code to aggregate the callbacks, supporting up to 10 callbacks.", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_132.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_132.markups.0": { "type": "A", "start": 194, "end": 232, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fusb_conf.c#L407-L532", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_133": { "id": "4571f6d18025_133", "name": "0794", "type": "P", "href": null, "layout": null, "metadata": null, "text": "To use the aggregated callbacks, we change the code as follows…", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_134": { "id": "4571f6d18025_134", "name": "e3ad", "type": "OLI", "href": null, "layout": null, "metadata": null, "text": "Change usbd_register_set_config_callback \nto aggregate_register_config_callback", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_134.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_134.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_134.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_134.markups.0": { "type": "CODE", "start": 7, "end": 40, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_134.markups.1": { "type": "STRONG", "start": 45, "end": 79, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_134.markups.2": { "type": "EM", "start": 6, "end": 40, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_135": { "id": "4571f6d18025_135", "name": "21c1", "type": "OLI", "href": null, "layout": null, "metadata": null, "text": "Change usbd_register_control_callback \nto aggregate_register_callback", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_135.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_135.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_135.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_135.markups.0": { "type": "CODE", "start": 7, "end": 37, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_135.markups.1": { "type": "STRONG", "start": 41, "end": 69, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_135.markups.2": { "type": "EM", "start": 7, "end": 39, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_136": { "id": "4571f6d18025_136", "name": "1276", "type": "P", "href": null, "layout": null, "metadata": null, "text": "We should always check the status of the callback registration like this…", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_137": { "id": "4571f6d18025_137", "name": "97c6", "type": "IFRAME", "href": null, "layout": "INSET_CENTER", "metadata": null, "text": "Aggregating USB callbacks, from https:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fcdc.c", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_137.markups.0", "typename": "Markup" }], "__typename": "Paragraph", "iframe": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_137.iframe", "typename": "Iframe" }, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_137.markups.0": { "type": "A", "start": 32, "end": 100, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fgithub.com\u002Flupyuen\u002Fbluepill-bootloader\u002Fblob\u002Fmaster\u002Fsrc\u002Fcdc.c", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "MediaResource:a2f724f467d3f42fdb4cf52cf05b0b17": { "id": "a2f724f467d3f42fdb4cf52cf05b0b17", "iframeSrc": "", "iframeHeight": 0, "iframeWidth": 0, "title": "aggregate-usb.c", "__typename": "MediaResource" }, "$Paragraph:4571f6d18025_137.iframe": { "mediaResource": { "type": "id", "generated": false, "id": "MediaResource:a2f724f467d3f42fdb4cf52cf05b0b17", "typename": "MediaResource" }, "__typename": "Iframe" }, "Paragraph:4571f6d18025_138": { "id": "4571f6d18025_138", "name": "2ee0", "type": "MIXTAPE_EMBED", "href": null, "layout": null, "metadata": null, "text": "Lup Yuen Lee on LinkedIn: \"#STM32 Blue Pill Bootloader now runs great... Supports USB Storage, USB…\nDecember 17, 2018: Lup Yuen Lee posted images on LinkedInwww.linkedin.com", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_138.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_138.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_138.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_138.mixtapeMetadata", "typename": "MixtapeMetadata" } }, "Paragraph:4571f6d18025_138.markups.0": { "type": "A", "start": 0, "end": 173, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fwww.linkedin.com\u002Ffeed\u002Fupdate\u002Furn:li:activity:6480260050907693056", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_138.markups.1": { "type": "STRONG", "start": 0, "end": 99, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_138.markups.2": { "type": "EM", "start": 100, "end": 157, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "$Paragraph:4571f6d18025_138.mixtapeMetadata": { "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fwww.linkedin.com\u002Ffeed\u002Fupdate\u002Furn:li:activity:6480260050907693056", "thumbnailImageId": "0*6LQgyN9PhP2Nwh6-", "mediaResourceId": "0*6LQgyN9PhP2Nwh6-", "__typename": "MixtapeMetadata" }, "Paragraph:4571f6d18025_139": { "id": "4571f6d18025_139", "name": "6c25", "type": "H3", "href": null, "layout": null, "metadata": null, "text": "Finally It Works!", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_140": { "id": "4571f6d18025_140", "name": "405c", "type": "P", "href": null, "layout": null, "metadata": null, "text": "This version of the Blue Pill Bootloader worked successfully on Windows, Mac and Linux after lots of experimenting. It’s my first time working on USB firmware and I wished there were more articles explaining what’s really happening in the USB realm. I hope this article, source code and captured USB logs will get you started on USB firmware programming a lot faster.", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_141": { "id": "4571f6d18025_141", "name": "1639", "type": "IMG", "href": null, "layout": "FULL_WIDTH", "metadata": { "type": "id", "generated": false, "id": "ImageMetadata:1*fjfoda1Ovwdahy09TwUkqA.png", "typename": "ImageMetadata" }, "text": "", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_142": { "id": "4571f6d18025_142", "name": "366f", "type": "MIXTAPE_EMBED", "href": null, "layout": null, "metadata": null, "text": "Lup Yuen Lee on LinkedIn: \"#STM32 Blue Pill Bootloader now supports ROM flashing via Chrome…\nDecember 19, 2018: Lup Yuen Lee posted on LinkedInwww.linkedin.com", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_142.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_142.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_142.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_142.mixtapeMetadata", "typename": "MixtapeMetadata" } }, "Paragraph:4571f6d18025_142.markups.0": { "type": "A", "start": 0, "end": 159, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fwww.linkedin.com\u002Ffeed\u002Fupdate\u002Furn:li:activity:6481124238043504640", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_142.markups.1": { "type": "STRONG", "start": 0, "end": 92, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_142.markups.2": { "type": "EM", "start": 93, "end": 143, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "$Paragraph:4571f6d18025_142.mixtapeMetadata": { "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fwww.linkedin.com\u002Ffeed\u002Fupdate\u002Furn:li:activity:6481124238043504640", "thumbnailImageId": "0*TZITb2iGt0sGOHvB", "mediaResourceId": "0*TZITb2iGt0sGOHvB", "__typename": "MixtapeMetadata" }, "Paragraph:4571f6d18025_143": { "id": "4571f6d18025_143", "name": "171d", "type": "H3", "href": null, "layout": null, "metadata": null, "text": "And the work goes on…", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_144": { "id": "4571f6d18025_144", "name": "771d", "type": "P", "href": null, "layout": null, "metadata": null, "text": "I have started working on a new branch that supports WebUSB flashing using MakeCode’s HF2 protocol. Check out my updates here…", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_145": { "id": "4571f6d18025_145", "name": "c766", "type": "MIXTAPE_EMBED", "href": null, "layout": null, "metadata": null, "text": "STM32 Blue Pill — Dissecting the WebUSB Bootloader for MakeCode\nHow the MakeCode Bootloader for Blue Pill implements flashing over WebUSBmedium.com", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_145.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_145.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_145.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_145.mixtapeMetadata", "typename": "MixtapeMetadata" } }, "Paragraph:4571f6d18025_145.markups.0": { "type": "A", "start": 0, "end": 147, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fstm32-blue-pill-dissecting-the-webusb-bootloader-for-makecode-b7f1a1508e89", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_145.markups.1": { "type": "STRONG", "start": 0, "end": 63, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_145.markups.2": { "type": "EM", "start": 64, "end": 137, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "$Paragraph:4571f6d18025_145.mixtapeMetadata": { "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fstm32-blue-pill-dissecting-the-webusb-bootloader-for-makecode-b7f1a1508e89", "thumbnailImageId": "1*0P7BkmUox48Rak_cta48QA.png", "mediaResourceId": "1*0P7BkmUox48Rak_cta48QA.png", "__typename": "MixtapeMetadata" }, "Paragraph:4571f6d18025_146": { "id": "4571f6d18025_146", "name": "c3ce", "type": "P", "href": null, "layout": null, "metadata": null, "text": "Is it possible to upgrade the Bootloader through another Bootloader? Yes we can! Check this article…", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": null }, "Paragraph:4571f6d18025_147": { "id": "4571f6d18025_147", "name": "feea", "type": "MIXTAPE_EMBED", "href": null, "layout": null, "metadata": null, "text": "STM32 Blue Pill — Bootloading the WebUSB Bootloader\nHow does the WebUSB Bootloader upgrade itself? With a special Baseloadermedium.com", "hasDropCap": null, "dropCapImage": null, "markups": [{ "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_147.markups.0", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_147.markups.1", "typename": "Markup" }, { "type": "id", "generated": true, "id": "Paragraph:4571f6d18025_147.markups.2", "typename": "Markup" }], "__typename": "Paragraph", "iframe": null, "mixtapeMetadata": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_147.mixtapeMetadata", "typename": "MixtapeMetadata" } }, "Paragraph:4571f6d18025_147.markups.0": { "type": "A", "start": 0, "end": 134, "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fstm32-blue-pill-bootloading-the-webusb-bootloader-63398ef5eb76", "anchorType": "LINK", "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_147.markups.1": { "type": "STRONG", "start": 0, "end": 51, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "Paragraph:4571f6d18025_147.markups.2": { "type": "EM", "start": 52, "end": 124, "href": null, "anchorType": null, "userId": null, "linkMetadata": null, "__typename": "Markup" }, "$Paragraph:4571f6d18025_147.mixtapeMetadata": { "href": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fmedium.com\u002F@ly.lee\u002Fstm32-blue-pill-bootloading-the-webusb-bootloader-63398ef5eb76", "thumbnailImageId": "1*0EWymp7F8ROU0pUX-vyC7A.gif", "mediaResourceId": "1*0EWymp7F8ROU0pUX-vyC7A.gif", "__typename": "MixtapeMetadata" }, "Paragraph:4571f6d18025_148": { "id": "4571f6d18025_148", "name": "f10a", "type": "IFRAME", "href": null, "layout": "FULL_WIDTH", "metadata": null, "text": "", "hasDropCap": null, "dropCapImage": null, "markups": [], "__typename": "Paragraph", "iframe": { "type": "id", "generated": true, "id": "$Paragraph:4571f6d18025_148.iframe", "typename": "Iframe" }, "mixtapeMetadata": null }, "MediaResource:5219459c1c52e52b3a87de0e2f406a2f": { "id": "5219459c1c52e52b3a87de0e2f406a2f", "iframeSrc": "https:\u002F\u002Fweb.archive.org\u002Fweb\u002F20191204194248\u002Fhttps:\u002F\u002Fcdn.embedly.com\u002Fwidgets\u002Fmedia.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2Ff3inYvl6j4E%3Ffeature%3Doembed&url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3Df3inYvl6j4E&image=https%3A%2F%2Fi.ytimg.com%2Fvi%2Ff3inYvl6j4E%2Fhqdefault.jpg&key=a19fcc184b9711e1b4764040d3dc5c07&type=text%2Fhtml&schema=youtube", "iframeHeight": 480, "iframeWidth": 640, "title": "STM32 Blue Pill and MakeCode flashing with HF2 over WebUSB", "__typename": "MediaResource" }, "$Paragraph:4571f6d18025_148.iframe": { "mediaResource": { "type": "id", "generated": false, "id": "MediaResource:5219459c1c52e52b3a87de0e2f406a2f", "typename": "MediaResource" }, "__typename": "Iframe" }, "User:87a61f1520ab": { "id": "87a61f1520ab", "__typename": "User" }, "Collection:721b17443fd5": { "creator": { "type": "id", "generated": false, "id": "User:87a61f1520ab", "typename": "User" }, "viewerIsEditor": false, "__typename": "Collection", "name": "Coinmonks", "avatar": { "type": "id", "generated": false, "id": "ImageMetadata:1*-_aiJHzJPz655N7iSSrLrQ.png", "typename": "ImageMetadata" }, "id": "721b17443fd5", "domain": null, "slug": "coinmonks" }, "Tag:usb": { "id": "usb", "displayTitle": "USB", "__typename": "Tag" }, "Tag:stm32": { "id": "stm32", "displayTitle": "Stm32", "__typename": "Tag" }, "Tag:programming": { "id": "programming", "displayTitle": "Programming", "__typename": "Tag" }, "Tag:embedded-systems": { "id": "embedded-systems", "displayTitle": "Embedded Systems", "__typename": "Tag" }, "ImageMetadata:1*-_aiJHzJPz655N7iSSrLrQ.png": { "id": "1*-_aiJHzJPz655N7iSSrLrQ.png", "__typename": "ImageMetadata" }, "$Post:36d7fe245b5c.previewContent": { "subtitle": "Building a complex composite USB device with libopencm3 that works on Windows, Mac and Linux", "__typename": "PreviewContent" } }</script>
  <script
    src="https://web.archive.org/web/20191204194248js_/https://cdn-client.medium.com/lite/static/js/manifest.c83c1a1a.js"></script>
  <script
    src="https://web.archive.org/web/20191204194248js_/https://cdn-client.medium.com/lite/static/js/vendors~main.9c8dc7d0.chunk.js"></script>
  <script
    src="https://web.archive.org/web/20191204194248js_/https://cdn-client.medium.com/lite/static/js/main.c5c932e3.chunk.js"></script>
  <script
    src="https://web.archive.org/web/20191204194248js_/https://cdn-client.medium.com/lite/static/js/vendors~screen.collection.packageBuilder~screen.landingpages.pres45~screen.landingpages.tribute~scre~3e410f11.faa5af01.chunk.js"></script>
  <script
    src="https://web.archive.org/web/20191204194248js_/https://cdn-client.medium.com/lite/static/js/screen.collection.packageBuilder~screen.landingpages.pres45~screen.landingpages.tribute~screen.post~~73c4bb05.cf7c8ea6.chunk.js"></script>
  <script
    src="https://web.archive.org/web/20191204194248js_/https://cdn-client.medium.com/lite/static/js/screen.post~screen.post.amp~screen.post.series~screen.profile~screen.sequence.library~screen.sequenc~036c6b37.3e471c5d.chunk.js"></script>
  <script
    src="https://web.archive.org/web/20191204194248js_/https://cdn-client.medium.com/lite/static/js/screen.collection.packageBuilder~screen.landingpages.pres45~screen.landingpages.tick~screen.landingp~ed90ee39.3c8733a8.chunk.js"></script>
  <script
    src="https://web.archive.org/web/20191204194248js_/https://cdn-client.medium.com/lite/static/js/screen.post.1aa42b57.chunk.js"></script>
  <script>window.main();</script>
</body>

</html>
<!--
     FILE ARCHIVED ON 19:42:48 Dec 04, 2019 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 01:30:37 Feb 23, 2021.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  captures_list: 351.768
  exclusion.robots: 0.209
  exclusion.robots.policy: 0.202
  RedisCDXSource: 1.556
  esindex: 0.009
  LoadShardBlock: 325.298 (3)
  PetaboxLoader3.datanode: 115.218 (4)
  CDXLines.iter: 21.705 (3)
  load_resource: 76.421
  PetaboxLoader3.resolve: 44.493
-->