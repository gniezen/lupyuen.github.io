<!doctype html>
<html lang="en">

<head>
  <link rel="stylesheet" type="text/css" href="/_static/css/banner-styles.css?v=bsmaklHF" />
  <link rel="stylesheet" type="text/css" href="/_static/css/iconochive.css?v=qtvMKcIJ" />
  <!-- End Wayback Rewrite JS Include -->
  <title data-rh="true">STM32 Blue Pill — Dissecting the WebUSB Bootloader for MakeCode</title>
  <meta data-rh="true" charset="utf-8" />
  <meta data-rh="true" name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1" />
  <meta data-rh="true" name="theme-color" content="#000000" />
  <meta data-rh="true" name="twitter:app:name:iphone" content="Medium" />
  <meta data-rh="true" name="twitter:app:id:iphone" content="828256236" />
  <meta data-rh="true" property="al:ios:app_name" content="Medium" />
  <meta data-rh="true" property="al:ios:app_store_id" content="828256236" />
  <meta data-rh="true" property="al:android:package" content="com.medium.reader" />
  <meta data-rh="true" property="fb:app_id" content="542599432471018" />
  <meta data-rh="true" property="og:site_name" content="Medium" />
  <meta data-rh="true" property="og:type" content="article" />
  <meta data-rh="true" property="article:published_time" content="2019-02-15T17:01:46.544Z" />
  <meta data-rh="true" name="title" content="STM32 Blue Pill — Dissecting the WebUSB Bootloader for MakeCode" />
  <meta data-rh="true" property="og:title" content="STM32 Blue Pill — Dissecting the WebUSB Bootloader for MakeCode" />
  <meta data-rh="true" property="twitter:title"
    content="STM32 Blue Pill — Dissecting the WebUSB Bootloader for MakeCode" />
  <meta data-rh="true" name="twitter:site" content="@Medium" />
  <meta data-rh="true" name="twitter:app:url:iphone" content="medium://p/b7f1a1508e89" />
  <meta data-rh="true" property="al:android:url" content="medium://p/b7f1a1508e89" />
  <meta data-rh="true" property="al:ios:url" content="medium://p/b7f1a1508e89" />
  <meta data-rh="true" property="al:android:app_name" content="Medium" />
  <meta data-rh="true" name="description"
    content="How the MakeCode Bootloader for Blue Pill implements flashing over WebUSB" />
  <meta data-rh="true" property="og:description"
    content="How  the MakeCode Bootloader for Blue Pill implements flashing over WebUSB" />
  <meta data-rh="true" property="twitter:description"
    content="How  the MakeCode Bootloader for Blue Pill implements flashing over WebUSB" />
  <meta data-rh="true" property="og:url"
    content="https://web.archive.org/web/20191204194207/https://medium.com/@ly.lee/stm32-blue-pill-dissecting-the-webusb-bootloader-for-makecode-b7f1a1508e89" />
  <meta data-rh="true" property="al:web:url"
    content="https://medium.com/@ly.lee/stm32-blue-pill-dissecting-the-webusb-bootloader-for-makecode-b7f1a1508e89" />
  <meta data-rh="true" property="og:image"
    content="https://web.archive.org/web/20191204194207im_/https://miro.medium.com/max/1200/1*0P7BkmUox48Rak_cta48QA.png" />
  <meta data-rh="true" name="twitter:image:src"
    content="https://miro.medium.com/max/1200/1*0P7BkmUox48Rak_cta48QA.png" />
  <meta data-rh="true" name="twitter:card" content="summary_large_image" />
  <meta data-rh="true" property="article:author" content="https://medium.com/@ly.lee" />
  <meta data-rh="true" name="twitter:creator" content="@MisterTechBlog" />
  <meta data-rh="true" name="author" content="Lup Yuen Lee 李立源" />
  <meta data-rh="true" name="robots" content="index,follow" />
  <meta data-rh="true" name="referrer" content="unsafe-url" />
  <meta data-rh="true" name="twitter:label1" value="Reading time" />
  <meta data-rh="true" name="twitter:data1" value="13 min read" />
  <meta data-rh="true" name="parsely-post-id" content="b7f1a1508e89" />
  <link data-rh="true" rel="publisher" href="https://plus.google.com/103654360130207659246" />
  <link data-rh="true" rel="search" type="application/opensearchdescription+xml" title="Medium"
    href="/web/20191204194207/https://medium.com/osd.xml" />
  <link data-rh="true" rel="apple-touch-icon" sizes="152x152"
    href="https://web.archive.org/web/20191204194207im_/https://cdn-images-1.medium.com/fit/c/152/152/1*8I-HPL0bfoIzGied-dzOvA.png" />
  <link data-rh="true" rel="apple-touch-icon" sizes="120x120"
    href="https://web.archive.org/web/20191204194207im_/https://cdn-images-1.medium.com/fit/c/120/120/1*8I-HPL0bfoIzGied-dzOvA.png" />
  <link data-rh="true" rel="apple-touch-icon" sizes="76x76"
    href="https://web.archive.org/web/20191204194207im_/https://cdn-images-1.medium.com/fit/c/76/76/1*8I-HPL0bfoIzGied-dzOvA.png" />
  <link data-rh="true" rel="apple-touch-icon" sizes="60x60"
    href="https://web.archive.org/web/20191204194207im_/https://cdn-images-1.medium.com/fit/c/60/60/1*8I-HPL0bfoIzGied-dzOvA.png" />
  <link data-rh="true" rel="mask-icon"
    href="https://web.archive.org/web/20191204194207im_/https://cdn-static-1.medium.com/_/fp/icons/monogram-mask.KPLCSFEZviQN0jQ7veN2RQ.svg"
    color="#171717" />
  <link data-rh="true" rel="icon"
    href="https://web.archive.org/web/20191204194207im_/https://cdn-static-1.medium.com/_/fp/icons/favicon-rebrand-medium.3Y6xpZ-0FSdWDnPM3hSBIA.ico" />
  <link data-rh="true" id="glyph_link" rel="stylesheet" type="text/css"
    href="https://web.archive.org/web/20191204194207cs_/https://glyph.medium.com/css/e/sr/latin/e/ssr/latin/e/ssb/latin/m2.css" />
  <link data-rh="true" rel="author" href="https://medium.com/@ly.lee" />
  <link data-rh="true" rel="canonical"
    href="https://web.archive.org/web/20191204194207/https://medium.com/@ly.lee/stm32-blue-pill-dissecting-the-webusb-bootloader-for-makecode-b7f1a1508e89" />
  <link data-rh="true" rel="alternate"
    href="https://web.archive.org/web/20191204194207/android-app://com.medium.reader/https/medium.com/p/b7f1a1508e89" />
  <style type="text/css" data-fela-rehydration="438" data-fela-type="STATIC">
    html {
      box-sizing: border-box
    }

    *,
    *:before,
    *:after {
      box-sizing: inherit
    }

    body {
      margin: 0;
      padding: 0;
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
      color: rgba(0, 0, 0, 0.8);
      position: relative;
      min-height: 100vh
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    dl,
    dd,
    ol,
    ul,
    menu,
    figure,
    blockquote,
    p,
    pre,
    form {
      margin: 0
    }

    menu,
    ol,
    ul {
      padding: 0;
      list-style: none;
      list-style-image: none
    }

    main {
      display: block
    }

    a {
      color: inherit;
      text-decoration: none
    }

    a,
    button,
    input {
      -webkit-tap-highlight-color: transparent
    }

    img,
    svg {
      vertical-align: middle
    }

    button {
      background: transparent;
      overflow: visible
    }

    button,
    input,
    optgroup,
    select,
    textarea {
      margin: 0
    }
  </style>
  <style type="text/css" data-fela-rehydration="438" data-fela-type="KEYFRAME">
    @-webkit-keyframes k1 {
      0% {
        transform: scale(1);
        opacity: 1
      }

      70% {
        transform: scale(1.4);
        opacity: 0
      }

      100% {
        opacity: 0
      }
    }

    @-moz-keyframes k1 {
      0% {
        transform: scale(1);
        opacity: 1
      }

      70% {
        transform: scale(1.4);
        opacity: 0
      }

      100% {
        opacity: 0
      }
    }

    @keyframes k1 {
      0% {
        transform: scale(1);
        opacity: 1
      }

      70% {
        transform: scale(1.4);
        opacity: 0
      }

      100% {
        opacity: 0
      }
    }
  </style>
  <style type="text/css" data-fela-rehydration="438" data-fela-type="RULE">
    .a {
      font-family: medium-content-sans-serif-font, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif
    }

    .b {
      font-weight: 400
    }

    .c {
      background-color: rgba(255, 255, 255, 1)
    }

    .l {
      height: 100vh
    }

    .m {
      width: 100vw
    }

    .n {
      display: flex
    }

    .o {
      align-items: center
    }

    .p {
      justify-content: center
    }

    .q {
      fill: rgba(0, 0, 0, 0.84)
    }

    .r {
      display: block
    }

    .s {
      position: fixed
    }

    .t {
      top: 0
    }

    .u {
      left: 0
    }

    .v {
      right: 0
    }

    .w {
      z-index: 500
    }

    .x {
      box-shadow: 0 4px 12px 0 rgba(0, 0, 0, 0.05)
    }

    .ai {
      max-width: 1192px
    }

    .aj {
      min-width: 0
    }

    .ak {
      width: 100%
    }

    .al {
      height: 65px
    }

    .ao {
      flex: 1 0 auto
    }

    .ap {
      font-family: 'Helvetica Neue', sans-serif
    }

    .aq {
      font-size: 20px
    }

    .ar {
      color: rgba(0, 0, 0, 0.84)
    }

    .as {
      margin-top: 7px
    }

    .at {
      margin-left: 10px
    }

    .au {
      display: -webkit-box
    }

    .av {
      -webkit-line-clamp: 1
    }

    .aw {
      -webkit-box-orient: vertical
    }

    .ax {
      overflow: hidden
    }

    .bc {
      display: none
    }

    .be {
      margin-left: 15px
    }

    .bf {
      margin-top: 1px
    }

    .bg {
      visibility: hidden
    }

    .bh {
      flex: 0 0 auto
    }

    .bi {
      color: inherit
    }

    .bj {
      fill: inherit
    }

    .bk {
      font-size: inherit
    }

    .bl {
      border: inherit
    }

    .bm {
      font-family: inherit
    }

    .bn {
      letter-spacing: inherit
    }

    .bo {
      font-weight: inherit
    }

    .bp {
      padding: 0
    }

    .bq {
      margin: 0
    }

    .br:hover {
      cursor: pointer
    }

    .bs:hover {
      color: rgba(0, 0, 0, 0.9)
    }

    .bt:hover {
      fill: rgba(0, 0, 0, 0.9)
    }

    .bu:focus {
      outline: none
    }

    .bv:disabled {
      cursor: default
    }

    .bw:disabled {
      color: rgba(0, 0, 0, 0.54)
    }

    .bx:disabled {
      fill: rgba(0, 0, 0, 0.54)
    }

    .by {
      font-family: medium-content-sans-serif-font, "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", Geneva, Arial, sans-serif
    }

    .bz {
      font-style: normal
    }

    .ca {
      line-height: 20px
    }

    .cb {
      font-size: 15.8px
    }

    .cc {
      letter-spacing: 0px
    }

    .cd {
      color: rgba(0, 0, 0, 0.54)
    }

    .ce {
      fill: rgba(0, 0, 0, 0.54)
    }

    .cf {
      margin-left: 16px
    }

    .cg {
      color: rgba(2, 158, 116, 1)
    }

    .ch {
      fill: rgba(3, 168, 124, 1)
    }

    .ci:hover {
      color: rgba(1, 143, 105, 1)
    }

    .cj:hover {
      fill: rgba(2, 158, 116, 1)
    }

    .ck:disabled {
      color: rgba(3, 168, 124, 0.5)
    }

    .cl:disabled {
      fill: rgba(3, 168, 124, 0.5)
    }

    .cm {
      padding: 8px 16px
    }

    .cn {
      background: 0
    }

    .co {
      border-color: rgba(3, 168, 124, 1)
    }

    .cp:hover {
      border-color: rgba(2, 158, 116, 1)
    }

    .cq {
      border-radius: 4px
    }

    .cr {
      border-width: 1px
    }

    .cs {
      border-style: solid
    }

    .ct {
      box-sizing: border-box
    }

    .cu {
      display: inline-block
    }

    .cv {
      text-decoration: none
    }

    .cw {
      margin-bottom: 0px
    }

    .cy {
      padding-left: 24px
    }

    .cz {
      padding-right: 24px
    }

    .da {
      margin-left: auto
    }

    .db {
      margin-right: auto
    }

    .dc {
      max-width: 728px
    }

    .dd {
      flex-direction: column
    }

    .de {
      position: absolute
    }

    .df {
      top: calc(100vh + 100px)
    }

    .dg {
      bottom: calc(100vh + 100px)
    }

    .dh {
      width: 10px
    }

    .di {
      pointer-events: none
    }

    .dj {
      word-break: break-word
    }

    .dk {
      word-wrap: break-word
    }

    .dl:after {
      display: block
    }

    .dm:after {
      content: ""
    }

    .dn:after {
      clear: both
    }

    .do {
      clear: both
    }

    .dp {
      margin-top: 0px
    }

    .dq {
      transition: transform 300ms cubic-bezier(0.2, 0, 0.2, 1)
    }

    .dr {
      cursor: zoom-in
    }

    .ds {
      position: relative
    }

    .dt {
      z-index: auto
    }

    .du {
      opacity: 0
    }

    .dv {
      transition: opacity 100ms 400ms
    }

    .dw {
      height: 100%
    }

    .dx {
      will-change: transform
    }

    .dy {
      transform: translateZ(0)
    }

    .dz {
      margin: auto
    }

    .ea {
      background-color: rgba(0, 0, 0, 0.05)
    }

    .eb {
      padding-bottom: 40.05947323704333%
    }

    .ec {
      filter: blur(20px)
    }

    .ed {
      transform: scale(1.1)
    }

    .ee {
      visibility: visible
    }

    .ef {
      background: rgba(255, 255, 255, 1)
    }

    .eg {
      max-width: 680px
    }

    .eh {
      line-height: 1.23
    }

    .ei {
      letter-spacing: 0
    }

    .ej {
      font-family: medium-content-title-font, Georgia, Cambria, "Times New Roman", Times, serif
    }

    .ek {
      font-size: 40px
    }

    .eq {
      margin-bottom: -0.27em
    }

    .er {
      line-height: 48px
    }

    .es {
      margin-top: 32px
    }

    .et {
      justify-content: space-between
    }

    .ex {
      width: 48px
    }

    .ey {
      height: 48px
    }

    .ez {
      flex-direction: row
    }

    .fa {
      width: calc(100% + 25px)
    }

    .fb {
      height: calc(100% + 25px)
    }

    .fc {
      top: 50%
    }

    .fd {
      left: 50%
    }

    .fe {
      transform: translateX(-50%) translateY(-50%)
    }

    .ff {
      border-radius: 50%
    }

    .fg {
      margin-left: 12px
    }

    .fh {
      margin-bottom: 2px
    }

    .fj {
      font-weight: 300
    }

    .fk {
      font-size: 16px
    }

    .fl {
      max-height: 20px
    }

    .fm {
      text-overflow: ellipsis
    }

    .fn:hover {
      text-decoration: underline
    }

    .fo {
      margin-left: 8px
    }

    .fp {
      padding: 0px 8px
    }

    .fq {
      border-color: rgba(0, 0, 0, 0.54)
    }

    .fr:hover {
      color: rgba(0, 0, 0, 0.97)
    }

    .fs:hover {
      fill: rgba(0, 0, 0, 0.97)
    }

    .ft:hover {
      border-color: rgba(0, 0, 0, 0.84)
    }

    .fu:disabled {
      fill: rgba(0, 0, 0, 0.76)
    }

    .fv:disabled {
      border-color: rgba(0, 0, 0, 0.2)
    }

    .fw:disabled {
      cursor: inherit
    }

    .fx:disabled:hover {
      color: rgba(0, 0, 0, 0.54)
    }

    .fy:disabled:hover {
      fill: rgba(0, 0, 0, 0.76)
    }

    .fz:disabled:hover {
      border-color: rgba(0, 0, 0, 0.2)
    }

    .ga {
      line-height: 18px
    }

    .gb {
      font-size: 15px
    }

    .gc {
      align-items: flex-end
    }

    .gk {
      padding-right: 8px
    }

    .gl {
      margin-right: -6px
    }

    .gm {
      line-height: 1.58
    }

    .gn {
      letter-spacing: -0.004em
    }

    .go {
      font-family: medium-content-serif-font, Georgia, Cambria, "Times New Roman", Times, serif
    }

    .gz {
      margin-bottom: -0.46em
    }

    .ha {
      background-repeat: repeat-x
    }

    .hb {
      background-image: linear-gradient(to right, rgba(0, 0, 0, 0.84) 100%, rgba(0, 0, 0, 0.84) 0);
      background-image: url('data:image/svg+xml;utf8,<svg preserveAspectRatio="none" viewBox="0 0 1 1" xmlns="http://www.w3.org/2000/svg"><line x1="0" y1="0" x2="1" y2="1" stroke="rgba(0, 0, 0, 0.84)" /></svg>')
    }

    .hc {
      background-size: 1px 1px
    }

    .hd {
      background-position: 0 1.05em;
      background-position: 0 calc(1em + 1px)
    }

    .he {
      font-weight: 700
    }

    .hf {
      font-style: italic
    }

    .hl {
      padding-bottom: 75%
    }

    .hm {
      line-height: 1.4
    }

    .hn {
      margin-top: 10px
    }

    .ho {
      text-align: center
    }

    .hr {
      list-style-type: decimal
    }

    .hs {
      margin-left: 30px
    }

    .ht {
      padding-left: 0px
    }

    .hz {
      font-family: medium-content-slab-serif-font, Georgia, Cambria, "Times New Roman", Times, serif
    }

    .ia {
      font-size: 28px
    }

    .ib {
      border: none
    }

    .ic {
      margin-top: 30px
    }

    .id:before {
      content: "..."
    }

    .ie:before {
      letter-spacing: 0.6em
    }

    .if:before {
      text-indent: 0.6em
    }

    .ig:before {
      font-style: italic
    }

    .ih:before {
      line-height: 1.4
    }

    .ii {
      line-height: 1.12
    }

    .ij {
      letter-spacing: -0.022em
    }

    .ik {
      font-weight: 600
    }

    .iv {
      margin-bottom: -0.28em
    }

    .jb {
      padding: 2px 4px
    }

    .jc {
      font-size: 75%
    }

    .jd>strong {
      font-family: inherit
    }

    .je {
      font-family: Menlo, Monaco, "Courier New", Courier, monospace
    }

    .jp {
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1), inset 0 0 0 1px rgba(0, 0, 0, 0.1)
    }

    .jq {
      max-height: 40px
    }

    .jr {
      -webkit-line-clamp: 2
    }

    .js {
      padding: 0px
    }

    .ki {
      padding: 16px 20px
    }

    .kj {
      flex: 1 1 auto
    }

    .kl {
      font-size: 18px
    }

    .km {
      margin-top: 8px
    }

    .kn {
      margin-top: 12px
    }

    .ko {
      width: 160px
    }

    .kp {
      background-image: url(https://web.archive.org/web/20191204194207im_/https://miro.medium.com/max/320/1*fjfoda1Ovwdahy09TwUkqA.png)
    }

    .kq {
      background-origin: border-box
    }

    .kr {
      background-size: cover
    }

    .ks {
      height: 167px
    }

    .kt {
      background-position: 50% 50%
    }

    .ku {
      max-width: 100%
    }

    .kv {
      box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.1)
    }

    .kw {
      padding: 20px
    }

    .kx {
      background: rgba(0, 0, 0, 0.05)
    }

    .ky {
      overflow-x: auto
    }

    .kz {
      line-height: 1.18
    }

    .la {
      margin-top: -0.09em
    }

    .lb {
      margin-bottom: -0.09em
    }

    .lc {
      white-space: pre-wrap
    }

    .ld {
      background-image: url(https://web.archive.org/web/20191204194207im_/https://miro.medium.com/max/320/0*DObDXKFSly6ip9jt)
    }

    .le {
      background-image: url(https://web.archive.org/web/20191204194207im_/https://miro.medium.com/max/320/1*sqHQVxWsmoA7_PW7j9_GJQ.png)
    }

    .lf {
      padding-bottom: 24.520804114071996%
    }

    .lg {
      list-style-type: disc
    }

    .lh {
      padding-bottom: 56.70202507232401%
    }

    .li {
      max-width: 1726px
    }

    .lj {
      padding-bottom: 71.14716106604867%
    }

    .lk {
      padding-bottom: 86.79026651216685%
    }

    .ll {
      background-image: url(https://web.archive.org/web/20191204194207im_/https://miro.medium.com/max/320/1*Vxgr9fS45NRgtYPmDzkOgg.png)
    }

    .lm {
      background-image: url(https://web.archive.org/web/20191204194207im_/https://miro.medium.com/max/320/1*M3Y_T_EI28gPHHBXGxTmjw.png)
    }

    .ln {
      background-image: url(https://web.archive.org/web/20191204194207im_/https://miro.medium.com/max/320/1*nRCSpyqsYtpaJSNGwD13bQ.jpeg)
    }

    .lt {
      will-change: opacity
    }

    .lu {
      top: calc(65px + 54px + 40px)
    }

    .lx {
      width: 131px
    }

    .ly {
      padding-top: 28px
    }

    .lz {
      margin-bottom: 19px
    }

    .ma {
      margin-left: -5px
    }

    .mb {
      margin-right: 5px
    }

    .mc {
      outline: 0
    }

    .md {
      border: 0
    }

    .me {
      user-select: none
    }

    .mf {
      cursor: pointer
    }

    .mg>svg {
      pointer-events: none
    }

    .mh:active {
      border-style: none
    }

    .mi {
      -webkit-user-select: none
    }

    .mj {
      fill: rgba(0, 0, 0, 0.76)
    }

    .mk:focus {
      fill: rgba(0, 0, 0, 0.54)
    }

    .ml:hover {
      fill: rgba(0, 0, 0, 0.54)
    }

    .mm {
      margin-top: 5px
    }

    .mn button {
      text-align: left
    }

    .mo {
      width: 188px
    }

    .mp {
      transform: translateX(406px)
    }

    .mq {
      top: calc(65px + 54px + 14px)
    }

    .ms {
      margin-top: 40px
    }

    .mt {
      flex-wrap: wrap
    }

    .mu {
      margin-top: 25px
    }

    .mv {
      list-style-type: none
    }

    .mw {
      margin-right: 8px
    }

    .mx {
      margin-bottom: 8px
    }

    .my {
      border-radius: 3px
    }

    .mz {
      padding: 5px 10px
    }

    .na {
      line-height: 22px
    }

    .nb {
      margin-top: 15px
    }

    .nc {
      margin-right: 16px
    }

    .nd {
      border: 1px solid rgba(0, 0, 0, 0.1)
    }

    .ne {
      height: 60px
    }

    .nf {
      width: 60px
    }

    .ns:hover {
      border-color: rgba(0, 0, 0, 0.54)
    }

    .nt:active {
      border-style: solid
    }

    .nu {
      z-index: 2
    }

    .nw {
      padding-top: 32px
    }

    .nx {
      border-top: 1px solid rgba(0, 0, 0, 0.1)
    }

    .ny {
      margin-bottom: 25px
    }

    .nz {
      margin-bottom: 32px
    }

    .oa {
      min-height: 80px
    }

    .of {
      width: 80px
    }

    .og {
      height: 80px
    }

    .oh {
      padding-left: 102px
    }

    .oj {
      text-transform: uppercase
    }

    .ok {
      letter-spacing: 0.05em
    }

    .ol {
      margin-bottom: 6px
    }

    .om {
      line-height: 36px
    }

    .on {
      padding: 4px 12px
    }

    .oo {
      max-width: 555px
    }

    .op {
      max-width: 450px
    }

    .oq {
      line-height: 24px
    }

    .os {
      padding-top: 25px
    }

    .ot {
      color: rgba(0, 0, 0, 0.76)
    }

    .ou {
      opacity: 1
    }

    .ov {
      border: 1px solid rgba(3, 168, 124, 1)
    }

    .ow {
      margin-top: 64px
    }

    .ox {
      background-color: rgba(0, 0, 0, 0.02)
    }

    .oy {
      padding: 60px 0
    }

    .oz {
      background-color: rgba(0, 0, 0, 0.9)
    }

    .pb {
      padding-bottom: 48px
    }

    .pc {
      border-bottom: 1px solid rgba(255, 255, 255, 0.54)
    }

    .pd {
      margin: 0 -12px
    }

    .pe {
      margin: 0 12px
    }

    .pf {
      flex: 1 1 0
    }

    .pg {
      padding-bottom: 12px
    }

    .ph:hover {
      color: rgba(255, 255, 255, 0.99)
    }

    .pi:hover {
      fill: rgba(255, 255, 255, 0.99)
    }

    .pj:disabled {
      color: rgba(255, 255, 255, 0.7)
    }

    .pk:disabled {
      fill: rgba(255, 255, 255, 0.7)
    }

    .pl {
      color: rgba(255, 255, 255, 0.98)
    }

    .pm {
      fill: rgba(255, 255, 255, 0.98)
    }

    .pn {
      text-align: inherit
    }

    .po {
      font-size: 21.6px
    }

    .pp {
      letter-spacing: -0.32px
    }

    .pq {
      color: rgba(255, 255, 255, 0.7)
    }

    .pr {
      fill: rgba(255, 255, 255, 0.7)
    }

    .ps {
      text-decoration: underline
    }

    .pt {
      padding-bottom: 8px
    }

    .pu {
      padding-top: 8px
    }

    .pv {
      width: 200px
    }
  </style>
  <style type="text/css" data-fela-rehydration="438" data-fela-type="RULE" media="all and (min-width: 1080px)">
    .d {
      display: none
    }

    .ah {
      margin: 0 64px
    }

    .ep {
      margin-top: 0.78em
    }

    .gj {
      margin-left: 30px
    }

    .gx {
      font-size: 21px
    }

    .gy {
      margin-top: 2em
    }

    .hk {
      margin-top: 56px
    }

    .hy {
      margin-top: 1.05em
    }

    .it {
      font-size: 34px
    }

    .iu {
      margin-top: 1.25em
    }

    .ja {
      margin-top: 0.86em
    }

    .jj {
      margin-top: 1.95em
    }

    .jo {
      margin-top: 32px
    }

    .kf {
      padding-left: 64px
    }

    .kg {
      padding-right: 64px
    }

    .kh {
      max-width: 1320px
    }

    .ls {
      margin-top: 1.91em
    }
  </style>
  <style type="text/css" data-fela-rehydration="438" data-fela-type="RULE" media="all and (max-width: 1079.98px)">
    .e {
      display: none
    }

    .gi {
      margin-left: 30px
    }

    .hp {
      margin-left: auto
    }

    .hq {
      text-align: center
    }

    .kc {
      padding-left: 64px
    }

    .kd {
      padding-right: 64px
    }

    .ke {
      max-width: 1080px
    }
  </style>
  <style type="text/css" data-fela-rehydration="438" data-fela-type="RULE" media="all and (max-width: 903.98px)">
    .f {
      display: none
    }

    .gh {
      margin-left: 30px
    }

    .jz {
      padding-left: 48px
    }

    .ka {
      padding-right: 48px
    }

    .kb {
      max-width: 904px
    }
  </style>
  <style type="text/css" data-fela-rehydration="438" data-fela-type="RULE" media="all and (max-width: 727.98px)">
    .g {
      display: none
    }

    .am {
      height: 56px
    }

    .an {
      display: flex
    }

    .ay {
      font-size: 14px
    }

    .az {
      margin-top: 0px
    }

    .ba {
      margin-left: 4px
    }

    .bb {
      -webkit-line-clamp: 2
    }

    .bd {
      display: block
    }

    .cx {
      margin-bottom: 0px
    }

    .ev {
      margin-top: 32px
    }

    .ew {
      flex-direction: column-reverse
    }

    .gf {
      margin-bottom: 30px
    }

    .gg {
      margin-left: 0px
    }

    .jw {
      padding-left: 24px
    }

    .jx {
      padding-right: 24px
    }

    .jy {
      max-width: 728px
    }

    .kk {
      padding: 10px 12px 10px
    }

    .ob {
      margin-bottom: 24px
    }

    .oc {
      align-items: center
    }

    .od {
      width: 102px
    }

    .oe {
      position: relative
    }

    .oi {
      padding-left: 0
    }

    .or {
      margin-top: 24px
    }

    .pa {
      padding: 32px 0
    }

    .pw {
      width: 140px
    }
  </style>
  <style type="text/css" data-fela-rehydration="438" data-fela-type="RULE" media="all and (max-width: 551.98px)">
    .h {
      display: none
    }

    .ac {
      margin: 0 24px
    }

    .el {
      margin-top: 0.39em
    }

    .eu {
      margin-top: 32px
    }

    .fi {
      margin-bottom: 0px
    }

    .gd {
      margin-bottom: 30px
    }

    .ge {
      margin-left: 0px
    }

    .gp {
      font-size: 18px
    }

    .gq {
      margin-top: 1.56em
    }

    .hg {
      margin-top: 40px
    }

    .hu {
      margin-top: 1.34em
    }

    .il {
      font-size: 30px
    }

    .im {
      margin-top: 0.93em
    }

    .iw {
      margin-top: 0.67em
    }

    .jf {
      margin-top: 1.2em
    }

    .jk {
      margin-top: 24px
    }

    .jt {
      padding-left: 24px
    }

    .ju {
      padding-right: 24px
    }

    .jv {
      max-width: 552px
    }

    .lo {
      margin-top: 1.41em
    }
  </style>
  <style type="text/css" data-fela-rehydration="438" data-fela-type="RULE"
    media="all and (min-width: 904px) and (max-width: 1079.98px)">
    .i {
      display: none
    }

    .ag {
      margin: 0 64px
    }

    .eo {
      margin-top: 0.78em
    }

    .gv {
      font-size: 21px
    }

    .gw {
      margin-top: 2em
    }

    .hj {
      margin-top: 56px
    }

    .hx {
      margin-top: 1.05em
    }

    .ir {
      font-size: 34px
    }

    .is {
      margin-top: 1.25em
    }

    .iz {
      margin-top: 0.86em
    }

    .ji {
      margin-top: 1.95em
    }

    .jn {
      margin-top: 32px
    }

    .lr {
      margin-top: 1.91em
    }
  </style>
  <style type="text/css" data-fela-rehydration="438" data-fela-type="RULE"
    media="all and (min-width: 728px) and (max-width: 903.98px)">
    .j {
      display: none
    }

    .af {
      margin: 0 48px
    }

    .en {
      margin-top: 0.78em
    }

    .gt {
      font-size: 21px
    }

    .gu {
      margin-top: 2em
    }

    .hi {
      margin-top: 56px
    }

    .hw {
      margin-top: 1.05em
    }

    .ip {
      font-size: 34px
    }

    .iq {
      margin-top: 1.25em
    }

    .iy {
      margin-top: 0.86em
    }

    .jh {
      margin-top: 1.95em
    }

    .jm {
      margin-top: 32px
    }

    .lq {
      margin-top: 1.91em
    }
  </style>
  <style type="text/css" data-fela-rehydration="438" data-fela-type="RULE"
    media="all and (min-width: 552px) and (max-width: 727.98px)">
    .k {
      display: none
    }

    .ae {
      margin: 0 24px
    }

    .em {
      margin-top: 0.39em
    }

    .gr {
      font-size: 18px
    }

    .gs {
      margin-top: 1.56em
    }

    .hh {
      margin-top: 40px
    }

    .hv {
      margin-top: 1.34em
    }

    .in {
      font-size: 30px
    }

    .io {
      margin-top: 0.93em
    }

    .ix {
      margin-top: 0.67em
    }

    .jg {
      margin-top: 1.2em
    }

    .jl {
      margin-top: 24px
    }

    .lp {
      margin-top: 1.41em
    }
  </style>
  <style type="text/css" data-fela-rehydration="438" data-fela-type="RULE" media="print">
    .ab {
      display: none
    }
  </style>
  <style type="text/css" data-fela-rehydration="438" data-fela-type="RULE"
    media="(prefers-reduced-motion: no-preference)">
    .y {
      transition: transform 300ms ease
    }

    .z {
      will-change: transform
    }

    .lv {
      transition: opacity 200ms
    }

    .ng {
      transition: border-color 150ms ease
    }

    .nh::before {
      background:
        radial-gradient(circle, rgba(0, 0, 0, 0.84) 60%, transparent 70%)
    }

    .ni::before {
      border-radius: 50%
    }

    .nj::before {
      content: ""
    }

    .nk::before {
      display: block
    }

    .nl::before {
      z-index: 0
    }

    .nm::before {
      left: 0
    }

    .nn::before {
      height: 100%
    }

    .no::before {
      position: absolute
    }

    .np::before {
      top: 0
    }

    .nq::before {
      width: 100%
    }

    .nr:hover::before {
      animation: k1 2000ms infinite cubic-bezier(.1, .12, .25, 1)
    }

    .nv {
      transition: fill 200ms ease
    }
  </style>
  <style type="text/css" data-fela-rehydration="438" data-fela-type="RULE" media="all and (max-width: 1198px)">
    .lw {
      display: none
    }
  </style>
  <style type="text/css" data-fela-rehydration="438" data-fela-type="RULE" media="all and (max-width: 1230px)">
    .mr {
      display: none
    }
  </style>
</head>

<body>
  <!-- BEGIN WAYBACK TOOLBAR INSERT -->
  <style type="text/css">
    body {
      margin-top: 0 !important;
      padding-top: 0 !important;
      /*min-width:800px !important;*/
    }
  </style>
  <div id="wm-ipp-base" lang="en" style="display:none;direction:ltr;">
    <div id="wm-ipp" style="position:fixed;left:0;top:0;right:0;">
      <div id="wm-ipp-inside">
        <div style="position:relative;">
          <div id="wm-logo" style="float:left;width:110px;padding-top:12px;">
            <a href="/web/" title="Wayback Machine home page"><img
                src="/_static/images/toolbar/wayback-toolbar-logo-200.png"
                srcset="/_static/images/toolbar/wayback-toolbar-logo-100.png, /_static/images/toolbar/wayback-toolbar-logo-150.png 1.5x, /_static/images/toolbar/wayback-toolbar-logo-200.png 2x"
                alt="Wayback Machine" style="width:100px" border="0" /></a>
          </div>
          <div class="r" style="float:right;">
            <div id="wm-btns" style="text-align:right;height:25px;">
              <div id="wm-save-snapshot-success">success</div>
              <div id="wm-save-snapshot-fail">fail</div>
              <a id="wm-save-snapshot-open" href="#" title="Share via My Web Archive">
                <span class="iconochive-web"></span>
              </a>
              <a href="https://archive.org/account/login.php" title="Sign In" id="wm-sign-in">
                <span class="iconochive-person"></span>
              </a>
              <span id="wm-save-snapshot-in-progress" class="iconochive-web"></span>
              <a href="http://faq.web.archive.org/" title="Get some help using the Wayback Machine"
                style="top:-6px;"><span class="iconochive-question"
                  style="color:rgb(87,186,244);font-size:160%;"></span></a>
              <a id="wm-tb-close" href="#close" onclick="__wm.h(event);return false;" style="top:-2px;"
                title="Close the toolbar"><span class="iconochive-remove-circle"
                  style="color:#888888;font-size:240%;"></span></a>
            </div>
            <div id="wm-share">
              <a href="/web/20191204194207/http://web.archive.org/screenshot/https://medium.com/@ly.lee/stm32-blue-pill-dissecting-the-webusb-bootloader-for-makecode-b7f1a1508e89?source=friends_link&sk=661984e9775f991a97e5747a67214b60"
                id="wm-screenshot" title="screenshot">
                <span class="wm-icon-screen-shot"></span>
              </a>
              <a id="wm-share-facebook" href="#"
                data-url="https://web.archive.org/web/20191204194207/https://medium.com/@ly.lee/stm32-blue-pill-dissecting-the-webusb-bootloader-for-makecode-b7f1a1508e89?source=friends_link&amp;sk=661984e9775f991a97e5747a67214b60"
                title="Share on Facebook" style="margin-right:5px;" target="_blank"><span class="iconochive-facebook"
                  style="color:#3b5998;font-size:160%;"></span></a>
              <a id="wm-share-twitter" href="#"
                data-url="https://web.archive.org/web/20191204194207/https://medium.com/@ly.lee/stm32-blue-pill-dissecting-the-webusb-bootloader-for-makecode-b7f1a1508e89?source=friends_link&amp;sk=661984e9775f991a97e5747a67214b60"
                title="Share on Twitter" style="margin-right:5px;" target="_blank"><span class="iconochive-twitter"
                  style="color:#1dcaff;font-size:160%;"></span></a>
            </div>
          </div>
          <table class="c" style="">
            <tbody>
              <tr>
                <td class="u" colspan="2">
                  <form target="_top" method="get" action="/web/submit" name="wmtb" id="wmtb"><input type="text"
                      name="url" id="wmtbURL"
                      value="https://medium.com/@ly.lee/stm32-blue-pill-dissecting-the-webusb-bootloader-for-makecode-b7f1a1508e89?source=friends_link&sk=661984e9775f991a97e5747a67214b60"
                      onfocus="this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input
                      type="hidden" name="date" value="20191204194207" /><input type="submit" value="Go" /></form>
                </td>
                <td class="n" rowspan="2" style="width:110px;">
                  <table>
                    <tbody>
                      <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
                      <tr class="m">
                        <td class="b" nowrap="nowrap">Nov</td>
                        <td class="c" id="displayMonthEl" title="You are here: 19:42:07 Dec 04, 2019">DEC</td>
                        <td class="f" nowrap="nowrap">Jan</td>
                      </tr>
                      <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
                      <tr class="d">
                        <td class="b" nowrap="nowrap"><img src="/_static/images/toolbar/wm_tb_prv_off.png"
                            alt="Previous capture" width="14" height="16" border="0" /></td>
                        <td class="c" id="displayDayEl" style="width:34px;font-size:24px;white-space:nowrap;"
                          title="You are here: 19:42:07 Dec 04, 2019">04</td>
                        <td class="f" nowrap="nowrap"><img src="/_static/images/toolbar/wm_tb_nxt_off.png"
                            alt="Next capture" width="14" height="16" border="0" /></td>
                      </tr>
                      <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
                      <tr class="y">
                        <td class="b" nowrap="nowrap">2018</td>
                        <td class="c" id="displayYearEl" title="You are here: 19:42:07 Dec 04, 2019">2019</td>
                        <td class="f" nowrap="nowrap">2020</td>
                      </tr>
                    </tbody>
                  </table>
                </td>
              </tr>
              <tr>
                <td class="s">
                  <div id="wm-nav-captures">
                    <a class="t"
                      href="/web/20191204194207*/https://medium.com/@ly.lee/stm32-blue-pill-dissecting-the-webusb-bootloader-for-makecode-b7f1a1508e89?source=friends_link&sk=661984e9775f991a97e5747a67214b60"
                      title="See a list of every capture for this URL">1 capture</a>
                    <div class="r" title="Timespan for captures of this URL">04 Dec 2019</div>
                  </div>
                </td>
                <td class="k">
                  <a href="" id="wm-graph-anchor">
                    <div id="wm-ipp-sparkline" title="Explore captures for this URL" style="position: relative">
                      <canvas id="wm-sparkline-canvas" width="650" height="27" border="0"></canvas>
                    </div>
                  </a>
                </td>
              </tr>
            </tbody>
          </table>
          <div style="position:absolute;bottom:0;right:2px;text-align:right;">
            <a id="wm-expand" class="wm-btn wm-closed" href="#expand" onclick="__wm.ex(event);return false;"><span
                id="wm-expand-icon" class="iconochive-down-solid"></span> <span style="font-size:80%">About this
                capture</span></a>
          </div>
        </div>
        <div id="wm-capinfo" style="border-top:1px solid #777;display:none; overflow: hidden">
          <div id="wm-capinfo-collected-by">
            <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center">COLLECTED BY</div>
            <div style="padding:3px;position:relative" id="wm-collected-by-content">
              <div style="display:inline-block;vertical-align:top;width:50%;">
                <span class="c-logo"
                  style="background-image:url(https://archive.org/services/img/ArchiveIt-Partner-1028);"></span>
                Organization: <a style="color:#33f;" href="https://archive.org/details/ArchiveIt-Partner-1028"
                  target="_new"><span class="wm-title">Mark Graham&#39;s Archive-IT Collections</span></a>
                <div style="max-height:75px;overflow:hidden;position:relative;">
                  <div
                    style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);">
                  </div>
                  This is a set of web collections curated by Mark Graham using the <a
                    href="http://archive-it.org">Archive-IT</a> service of the <a href="http//archive.org">Internet
                    Archive.</a>
                  <br>
                  <br>
                  They include web captures of the ISKME.org website as well as captures from sites hosted by IGC.org.
                  <br>
                  <br>
                  <br><br>
                  These web captures are available to the general public.
                  <br>
                  <br>
                  For more information about this collection please feel free to contact Mark via <a
                    href="mailto:mark@archive.org?Subject=Question%20about%20you%20Archive-IT%20Collection"
                    target="_top">Send Mail</a>
                </div>
              </div>
              <div style="display:inline-block;vertical-align:top;width:49%;">
                <span class="c-logo"
                  style="background-image:url(https://archive.org/services/img/ArchiveIt-Collection-8332)"></span>
                <div>Collection: <a style="color:#33f;" href="https://archive.org/details/ArchiveIt-Collection-8332"
                    target="_new"><span class="wm-title">General Crawls</span></a></div>
                <div style="max-height:75px;overflow:hidden;position:relative;">
                  <div
                    style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);">
                  </div>
                  Archive-It Partner 1028: Mark Graham - Collection 8332: General Crawls
                </div>
              </div>
            </div>
          </div>
          <div id="wm-capinfo-timestamps">
            <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center"
              title="Timestamps for the elements of this page">TIMESTAMPS</div>
            <div>
              <div id="wm-capresources" style="margin:0 5px 5px 5px;max-height:250px;overflow-y:scroll !important">
              </div>
              <div id="wm-capresources-loading" style="text-align:left;margin:0 20px 5px 5px;display:none"><img
                  src="/_static/images/loading.gif" alt="loading" /></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="donato" style="position:relative;width:100%;">
    <div id="donato-base">
      <iframe id="donato-if"
        src="https://archive.org/includes/donate.php?as_page=1&amp;platform=wb&amp;referer=https%3A//web.archive.org/web/20191204194207/https%3A//medium.com/%2540ly.lee/stm32-blue-pill-dissecting-the-webusb-bootloader-for-makecode-b7f1a1508e89%3Fsource%3Dfriends_link%26sk%3D661984e9775f991a97e5747a67214b60"
        scrolling="no" frameborder="0" style="width:100%; height:100%">
      </iframe>
    </div>
  </div>
  <!-- END WAYBACK TOOLBAR INSERT -->
  <div id="root">
    <div class="a b c">
      <article class="meteredContent">
        <section class="cy cz da db ak dc ct n dd"></section><span class="r"></span>
        <div>
          <div class="de u df dg dh di"></div>
          <section class="dj dk dl dm dn">
            <div class="do ak">
              <figure class="dp do ak paragraph-image">
                <div class="dq dr ds dt ak">
                  <div class="dz r ds ea">
                    <div class="eb r">
                      <div class="du dv de t u dw ak ax dx dy"><img class="de t u dw ak ec ed ee"
                          src="https://web.archive.org/web/20191204194207im_/https://miro.medium.com/max/60/1*0P7BkmUox48Rak_cta48QA.png?q=20"
                          width="4708" height="1886" role="presentation" /></div><img class="du dv de t u dw ak ef"
                        width="4708" height="1886" role="presentation" /><noscript><img class="de t u dw ak"
                          src="https://web.archive.org/web/20191204194207im_/https://miro.medium.com/max/9416/1*0P7BkmUox48Rak_cta48QA.png"
                          width="4708" height="1886" role="presentation" /></noscript>
                    </div>
                  </div>
                </div>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <div>
                  <div id="8c8f" class="eh ei ar bz ej b ek el em en eo ep eq">
                    <h1 class="ej b ek er ar">STM32 Blue Pill — Dissecting the WebUSB Bootloader for MakeCode</h1>
                  </div>
                  <div class="es">
                    <div class="n et eu ev ew">
                      <div class="o n">
                        <div><a rel="noopener"
                            href="/web/20191204194207/https://medium.com/@ly.lee?source=post_page-----b7f1a1508e89----------------------">
                            <div class="ds ex ey">
                              <div class="ch n ez o p de fa fb fc fd fe di"><svg width="57" height="57"
                                  viewbox="0 0 57 57">
                                  <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M28.5 1.2A27.45 27.45 0 0 0 4.06 15.82L3 15.27A28.65 28.65 0 0 1 28.5 0C39.64 0 49.29 6.2 54 15.27l-1.06.55A27.45 27.45 0 0 0 28.5 1.2zM4.06 41.18A27.45 27.45 0 0 0 28.5 55.8a27.45 27.45 0 0 0 24.44-14.62l1.06.55A28.65 28.65 0 0 1 28.5 57 28.65 28.65 0 0 1 3 41.73l1.06-.55z">
                                  </path>
                                </svg></div><img alt="Lup Yuen Lee 李立源" class="r ff ey ex"
                                src="https://web.archive.org/web/20191204194207im_/https://miro.medium.com/fit/c/96/96/1*KGohS3sQaUnr58gc0BIfoQ.jpeg"
                                width="48" height="48" />
                            </div>
                          </a></div>
                        <div class="fg ak r">
                          <div class="n">
                            <div style="flex:1"><span class="by b bz ca cb cc r ar q">
                                <div class="fh n o fi"><span class="by fj fk ca ax fl fm au av aw ar"><a
                                      class="bi bj bk bl bm bn bo bp bq br fn bu bv bw bx" rel="noopener"
                                      href="/web/20191204194207/https://medium.com/@ly.lee?source=post_page-----b7f1a1508e89----------------------">Lup
                                      Yuen Lee 李立源</a></span>
                                  <div class="fo r bh h"><button
                                      class="fp ar q cn fq fr fs ft br bw fu fv fw fx fy fz cq by b bz ga gb cc cr cs ct cu cv bu">Follow</button>
                                  </div>
                                </div>
                              </span></div>
                          </div><span class="by b bz ca cb cc r cd ce"><span class="by fj fk ca ax fl fm au av aw cd">
                              <div><a class="bi bj bk bl bm bn bo bp bq br fn bu bv bw bx" rel="noopener"
                                  href="/web/20191204194207/https://medium.com/@ly.lee/stm32-blue-pill-dissecting-the-webusb-bootloader-for-makecode-b7f1a1508e89?source=post_page-----b7f1a1508e89----------------------">Feb
                                  15</a> <!-- -->·
                                <!-- -->
                                <!-- -->13
                                <!-- --> min read<span style="padding-left:4px"><svg class="star-15px_svg__svgIcon-use"
                                    width="15" height="15" viewbox="0 0 15 15" style="margin-top:-2px">
                                    <path
                                      d="M7.44 2.32c.03-.1.09-.1.12 0l1.2 3.53a.29.29 0 0 0 .26.2h3.88c.11 0 .13.04.04.1L9.8 8.33a.27.27 0 0 0-.1.29l1.2 3.53c.03.1-.01.13-.1.07l-3.14-2.18a.3.3 0 0 0-.32 0L4.2 12.22c-.1.06-.14.03-.1-.07l1.2-3.53a.27.27 0 0 0-.1-.3L2.06 6.16c-.1-.06-.07-.12.03-.12h3.89a.29.29 0 0 0 .26-.19l1.2-3.52z">
                                    </path>
                                  </svg></span>
                              </div>
                            </span></span>
                        </div>
                      </div>
                      <div class="n gc gd ge gf gg gh gi gj ab">
                        <div class="n o">
                          <div class="gk r bh"><a
                              href="//web.archive.org/web/20191204194207/https://medium.com/p/b7f1a1508e89/share/twitter?source=post_actions_header---------------------------"
                              class="bi bj bk bl bm bn bo bp bq br bs bt bu bv bw bx" target="_blank"
                              rel="noopener"><svg width="29" height="29" class="q">
                                <path
                                  d="M22.05 7.54a4.47 4.47 0 0 0-3.3-1.46 4.53 4.53 0 0 0-4.53 4.53c0 .35.04.7.08 1.05A12.9 12.9 0 0 1 5 6.89a5.1 5.1 0 0 0-.65 2.26c.03 1.6.83 2.99 2.02 3.79a4.3 4.3 0 0 1-2.02-.57v.08a4.55 4.55 0 0 0 3.63 4.44c-.4.08-.8.13-1.21.16l-.81-.08a4.54 4.54 0 0 0 4.2 3.15 9.56 9.56 0 0 1-5.66 1.94l-1.05-.08c2 1.27 4.38 2.02 6.94 2.02 8.3 0 12.86-6.9 12.84-12.85.02-.24 0-.43 0-.65a8.68 8.68 0 0 0 2.26-2.34c-.82.38-1.7.62-2.6.72a4.37 4.37 0 0 0 1.95-2.51c-.84.53-1.81.9-2.83 1.13z">
                                </path>
                              </svg></a></div>
                          <div class="gk r bh"><a
                              href="//web.archive.org/web/20191204194207/https://medium.com/p/b7f1a1508e89/share/linkedIn?source=post_actions_header---------------------------"
                              class="bi bj bk bl bm bn bo bp bq br bs bt bu bv bw bx" target="_blank"
                              rel="noopener"><svg width="29" height="29" viewbox="0 0 29 29" fill="none" class="q">
                                <path
                                  d="M5 6.36C5 5.61 5.63 5 6.4 5h16.2c.77 0 1.4.61 1.4 1.36v16.28c0 .75-.63 1.36-1.4 1.36H6.4c-.77 0-1.4-.6-1.4-1.36V6.36z">
                                </path>
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                  d="M10.76 20.9v-8.57H7.89v8.58h2.87zm-1.44-9.75c1 0 1.63-.65 1.63-1.48-.02-.84-.62-1.48-1.6-1.48-.99 0-1.63.64-1.63 1.48 0 .83.62 1.48 1.59 1.48h.01zM12.35 20.9h2.87v-4.79c0-.25.02-.5.1-.7.2-.5.67-1.04 1.46-1.04 1.04 0 1.46.8 1.46 1.95v4.59h2.87v-4.92c0-2.64-1.42-3.87-3.3-3.87-1.55 0-2.23.86-2.61 1.45h.02v-1.24h-2.87c.04.8 0 8.58 0 8.58z"
                                  fill="#fff"></path>
                              </svg></a></div>
                          <div class="gk r bh"><a
                              href="//web.archive.org/web/20191204194207/https://medium.com/p/b7f1a1508e89/share/facebook?source=post_actions_header---------------------------"
                              class="bi bj bk bl bm bn bo bp bq br bs bt bu bv bw bx" target="_blank"
                              rel="noopener"><svg width="29" height="29" class="q">
                                <path
                                  d="M23.2 5H5.8a.8.8 0 0 0-.8.8V23.2c0 .44.35.8.8.8h9.3v-7.13h-2.38V13.9h2.38v-2.38c0-2.45 1.55-3.66 3.74-3.66 1.05 0 1.95.08 2.2.11v2.57h-1.5c-1.2 0-1.48.57-1.48 1.4v1.96h2.97l-.6 2.97h-2.37l.05 7.12h5.1a.8.8 0 0 0 .79-.8V5.8a.8.8 0 0 0-.8-.79">
                                </path>
                              </svg></a></div>
                          <div class="gl r ao">
                            <div>
                              <div class="cu"><a
                                  href="https://web.archive.org/web/20191204194207/https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Fstm32-blue-pill-dissecting-the-webusb-bootloader-for-makecode-b7f1a1508e89&amp;source=post_actions_header--------------------------bookmark_sidebar-"
                                  class="bi bj bk bl bm bn bo bp bq br bs bt bu bv bw bx" rel="noopener"><svg width="25"
                                    height="25" viewbox="0 0 25 25">
                                    <path
                                      d="M19 6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14.66h.01c.01.1.05.2.12.28a.5.5 0 0 0 .7.03l5.67-4.12 5.66 4.13a.5.5 0 0 0 .71-.03.5.5 0 0 0 .12-.29H19V6zm-6.84 9.97L7 19.64V6a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v13.64l-5.16-3.67a.49.49 0 0 0-.68 0z"
                                      fill-rule="evenodd"></path>
                                  </svg></a></div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <p id="d978" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Could <a
                    href="https://web.archive.org/web/20191204194207/http://wiki.stm32duino.com/index.php?title=Blue_Pill"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">STM32 Blue Pill</a> overtake
                  Arduino as the <strong class="go he">preferred platform for creating IoT prototypes?</strong></p>
                <p id="f241" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">1️⃣ Blue Pill is <strong
                    class="go he">packed with features</strong>, yet costs <strong class="go he">under US$ 2</strong>
                </p>
                <p id="5d99" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">2️⃣ <strong class="go he">Cheaper
                    Blue Pill clones</strong> are now emerging. No signs of Blue Pill fatigue.</p>
                <p id="76af" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">3️⃣ Microcontrollers are joining
                  <strong class="go he">mesh networks</strong> to become smarter collectives. Cheap microcontrollers
                  like Blue Pill are needed.</p>
                <p id="9df0" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">4️⃣ The closest competitor,
                  <strong class="go he">ESP8266 / ESP32</strong>, is still slowly growing its software base from scratch
                  (though the embedded WiFi is a huge advantage)</p>
                <p id="f4a0" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">5️⃣ Blue Pill developers have
                  <strong class="go he">plenty of open-source Arm and STM32 code</strong> to guide them</p>
                <p id="c014" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">So what’s holding back Blue Pill?
                  <em class="hf">Blue Pill is way more advanced than the ancient Arduino Uno, yet we are still using the
                    same primitive coding tools… </em><strong class="go he"><em class="hf">a text editor and a C
                      compiler.</em></strong></p>
                <p id="9613" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">There must be a modern, easier
                  way to write Blue Pill programs. Maybe we should sacrifice a bit of Blue Pill’s processing power to
                  make it faster and friendlier to code and test. And this leads to MakeCode, the popular web-based tool
                  for programming and flashing microcontrollers…</p>
              </div>
            </div>
            <div class="do ak">
              <figure class="hg hh hi hj hk do">
                <div class="dz r ds">
                  <div class="hl r"><iframe
                      src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FDSNDvrVOJns%3Ffeature%3Doembed&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DDSNDvrVOJns&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2FDSNDvrVOJns%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube"
                      allowfullscreen="" frameborder="0" height="480" width="640"
                      title="STM32 Blue Pill USB Bootloader and MakeCode" class="de t u dw ak"
                      scrolling="auto"></iframe></div>
                </div>
                <figcaption class="cd fk hm hn ho dc da db hp hq by fj">Creating a MakeCode visual program and flashing
                  to Blue Pill</figcaption>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <p id="8ac4" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz"><a
                    href="https://web.archive.org/web/20191204194207/https://makecode.com/about"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow"><strong
                      class="go he">MakeCode</strong></a> is an open-source <strong class="go he">visual programming
                    tool</strong> that’s easy to learn and use — makers around the world are already using MakeCode
                  today with the BBC micro:bit. It generates <a
                    href="https://web.archive.org/web/20191204194207/https://makecode.com/language"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow"><strong class="go he">Static
                      TypeScript</strong></a>, a variant of JavaScript that’s optimised for newer powerful
                  microcontrollers like Blue Pill. <em class="hf">MakeCode could be the missing element that will make
                    Blue Pill wildly successful for IoT.</em></p>
                <p id="f46e" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Will MakeCode run on Blue Pill?
                  There’s no official port of MakeCode for Blue Pill, but we’re nearly there. I have ported the most
                  complicated part of MakeCode to Blue Pill: the <strong class="go he">MakeCode Bootloader</strong>. If
                  the MakeCode Bootloader runs on Blue Pill, the rest is a piece of cake!</p>
                <p id="0c84" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">In this article we’ll take our
                  surgical scalpels, dissect and explore the innards of the MakeCode Bootloader that I have ported to
                  Blue Pill. We’ll learn…</p>
                <ol class="">
                  <li id="54b7" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz hr hs ht">What’s a <strong
                      class="go he">Bootloader</strong> and why we need a <strong class="go he">Custom
                      Bootloader</strong></li>
                  <li id="9c81" class="gm gn ar bz go b gp hu gr hv gt hw gv hx gx hy gz hr hs ht"><strong
                      class="go he">CODAL</strong> runtime library used by MakeCode to execute Blue Pill-specific
                    functions</li>
                  <li id="8dc0" class="gm gn ar bz go b gp hu gr hv gt hw gv hx gx hy gz hr hs ht">How the <strong
                      class="go he">Bootloader uses Blue Pill memory optimally</strong></li>
                  <li id="f6de" class="gm gn ar bz go b gp hu gr hv gt hw gv hx gx hy gz hr hs ht"><strong
                      class="go he">HF2 Protocol</strong> used by MakeCode and the Bootloader to flash the Blue Pill
                  </li>
                  <li id="bc88" class="gm gn ar bz go b gp hu gr hv gt hw gv hx gx hy gz hr hs ht"><strong
                      class="go he">Linker Script</strong> used to create the Bootloader memory layout</li>
                </ol>
                <p id="e56c" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">What’s a visual program? <a
                    href="https://web.archive.org/web/20191204194207/https://youtu.be/P8GDrmWWSbk"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">Check this video</a> to see how
                  MakeCode may be used to write a visual program that blinks the Blue Pill LED.</p>
              </div>
            </div>
          </section>
          <hr class="hz fj ia ib ic ho id ie if ig ih" />
          <section class="dj dk dl dm dn">
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <h1 id="16d5" class="ii ij ar bz by ik il im in io ip iq ir is it iu iv">What’s A Bootloader?</h1>
                <p id="15ae" class="gm gn ar bz go b gp iw gr ix gt iy gv iz gx ja gz">Well it <strong
                    class="go he">boots</strong> and it <strong class="go he">loads</strong>… Duh.</p>
                <p id="54b9" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz"><strong
                    class="go he">Boot</strong>: The Bootloader is a small program that’s pre-installed in the ROM of
                  the microcontroller. It’s the first program that runs when we power on the device. Normally the
                  Bootloader will jump to the custom program that we have flashed into the ROM (assuming it has been
                  flashed). So most of the time we won’t notice that the Bootloader is actually started before our
                  custom program.</p>
                <p id="7a08" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz"><strong
                    class="go he">Load</strong>: The Bootloader enables us to load (or flash) our custom program into
                  ROM. On the Arduino Uno, the Bootloader receives our custom program file via the USB Serial Port and
                  flashes the custom program into ROM. For Blue Pill, the factory-installed Bootloader works the same
                  way except that it uses the UART pins instead of the USB port. See<em class="hf"> </em><a
                    href="https://web.archive.org/web/20191204194207/https://www.st.com/content/ccc/resource/technical/document/application_note/51/5f/03/1e/bd/9b/45/be/CD00264342.pdf/files/CD00264342.pdf/jcr:content/translations/en.CD00264342.pdf"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow"><em class="hf">AN3155: USART
                      protocol used in the STM32 bootloader</em></a> and <a
                    href="https://web.archive.org/web/20191204194207/https://www.st.com/content/ccc/resource/technical/document/application_note/b9/9b/16/3a/12/1e/40/0c/CD00167594.pdf/files/CD00167594.pdf/jcr:content/translations/en.CD00167594.pdf"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow"><em class="hf">AN2606: STM32
                      microcontroller system memory boot mode</em></a>.</p>
                <p id="090f" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Remember that we set the <code
                    class="ea jb jc jd je b">BOOT0</code> jumper to <code class="ea jb jc jd je b">0</code> while
                  flashing Blue Pill via ST Link? This disables the factory-installed Bootloader so we don’t actually
                  flash the custom program via the UART pins. ST Link uses the SWD port on the Blue Pill to flash our
                  custom program into the ROM.</p>
                <h1 id="af68" class="ii ij ar bz by ik il jf in jg ip jh ir ji it jj iv">Why Build A Custom Bootloader?
                </h1>
                <p id="4960" class="gm gn ar bz go b gp iw gr ix gt iy gv iz gx ja gz">Flashing the Blue Pill via the
                  bare UART pins or the SWD port (via ST Link) is cumbersome. What if we could simply <strong
                    class="go he">click a button in a web page, and transmit our custom program directly into the Blue
                    Pill ROM</strong>? And how would we connect the Blue Pill to our computer? Just use the <strong
                    class="go he">USB port</strong> that’s already provided on Blue Pill! <em class="hf">Flashing the
                    Blue Pill would become so easy — just like in the demo above!</em></p>
                <p id="fe22" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz"><strong class="go he"><em
                      class="hf">But there’s a catch (or two)…</em></strong></p>
                <p id="f15e" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">1️⃣ <strong class="go he">The
                    Blue Pill’s USB port doesn’t have any built-in functionality.</strong> (Surprised? Many of my
                  students assumed that the Blue Pill USB port actually did <em class="hf">something</em>.) We need to
                  write the Blue Pill code to perform the flashing over USB. And the code will go into a <strong
                    class="go he">Custom Bootloader</strong> that we’ll install ourselves into our new Blue Pills. Once
                  installed, we shouldn’t need to re-flash the Custom Bootloader <em class="hf">(although there’s
                    actually an easy way to do this… in our next article!)</em></p>
                <p id="642a" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">2️⃣ <strong class="go he">Web
                    Browsers won’t allow us to access all types of USB devices (e.g. Blue Pill) directly through a web
                    page, for safety reasons</strong>. The Chrome browser provides the <a
                    href="https://web.archive.org/web/20191204194207/https://developers.google.com/web/updates/2016/03/access-usb-devices-on-the-web"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow"><strong class="go he">WebUSB
                      JavaScript API</strong></a> for safely accessing some USB devices, including Blue Pill. With the
                  right code in the web page and the right code in the Custom Bootloader, we’ll see in a while that it’s
                  indeed possible to flash the Blue Pill via a web page, as we have seen in the demo above.</p>
                <p id="7ea0" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">So this article is all about the
                  <strong class="go he">internals of the Custom Bootloader for Blue Pill that supports flashing over
                    WebUSB</strong>. Details on implementing WebUSB on Blue Pill may be found in <a
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener"
                    href="/web/20191204194207/https://medium.com/@ly.lee/stm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c?source=friends_link&amp;sk=70a29cd31425ec4d03144bce14a1c922">my
                    earlier article</a>.</p>
                <div class="jk jl jm jn jo jp"><a rel="noopener"
                    href="/web/20191204194207/https://medium.com/@ly.lee/stm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c?source=post_page-----b7f1a1508e89----------------------">
                    <section class="js da db ak ct n bh jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh">
                      <div class="ki n dd p kj kk">
                        <h2 class="by ik kl ca ar">
                          <div class="ax jq fm au jr aw">STM32 Blue Pill USB Bootloader — How I fixed the USB Storage,
                            Serial, DFU and WebUSB interfaces</div>
                        </h2>
                        <div class="km r">
                          <h3 class="by fj fk ca cd">
                            <div class="ax jq fm au jr aw">Building a complex composite USB device with libopencm3 that
                              works on Windows, Mac and Linux</div>
                          </h3>
                        </div>
                        <div class="kn r">
                          <h4 class="by fj gb ca cd">
                            <div class="ax jq fm au jr aw">medium.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ko r">
                        <div class="kp r kq kr ks ko kt ku kv"></div>
                      </div>
                    </section>
                  </a></div>
              </div>
            </div>
          </section>
          <hr class="hz fj ia ib ic ho id ie if ig ih" />
          <section class="dj dk dl dm dn">
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <div class="hg hh hi hj hk jp"><a
                    href="https://web.archive.org/web/20191204194207/https://lancaster-university.github.io/codal/?source=post_page-----b7f1a1508e89----------------------"
                    rel="noopener nofollow">
                    <section class="js da db ak ct n bh jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh">
                      <div class="ki n dd p kj kk">
                        <h2 class="by ik kl ca ar">
                          <div class="ax jq fm au jr aw">CODAL</div>
                        </h2>
                        <div class="km r">
                          <h3 class="by fj fk ca cd">
                            <div class="ax jq fm au jr aw">Information on the Component Oriented Device Abstraction
                              Layer (CODAL), created and maintained by Lancaster University.</div>
                          </h3>
                        </div>
                        <div class="kn r">
                          <h4 class="by fj gb ca cd">
                            <div class="ax jq fm au jr aw">lancaster-university.github.io</div>
                          </h4>
                        </div>
                      </div>
                    </section>
                  </a></div>
                <h1 id="a2de" class="ii ij ar bz by ik il jf in jg ip jh ir ji it jj iv">CODAL Runtime for Embedded
                  Devices</h1>
                <p id="5671" class="gm gn ar bz go b gp iw gr ix gt iy gv iz gx ja gz">The <a
                    href="https://web.archive.org/web/20191204194207/https://lancaster-university.github.io/codal/"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">CODAL runtime library created by
                    Lancaster University</a> provides a friendly and flexible C++ API for programming embedded devices.
                  MakeCode compiles our visual programs into Static TypeScript code that calls the CODAL library to
                  access the device and peripheral functions like the onboard LED and ports for UART, I2C, SPI, …</p>
                <p id="1d1f" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Here’s a <a
                    href="https://web.archive.org/web/20191204194207/https://github.com/lupyuen/codal-libopencm3/blob/master/samples/main.cpp"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">sample CODAL program that blinks
                    the LED</a>…</p>
                <pre
                  class="hg hh hi hj hk kw kx ky"><span id="e934" class="kz ij ar bz je b fk la lb r lc">void Blink_main(<strong class="je he">STM32BluePill</strong>&amp; device) {<br/> int state = 0;<br/> while(1) {    <br/><strong class="je he">   device.io.led.setDigitalValue(state);<br/></strong>   device.sleep(1000);<br/>   state = !state;<br/> }<br/>}</span></pre>
                <p id="0122" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Comparing this with the <a
                    href="https://web.archive.org/web/20191204194207/https://www.arduino.cc/en/tutorial/blink"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">same Arduino program that blinks
                    the LED</a>, it doesn’t look that different. But note that the onboard LED is neatly encapsulated as
                  <code class="ea jb jc jd je b"><strong class="go he">device.io.led</strong></code>. <code
                    class="ea jb jc jd je b">device</code> is an <code
                    class="ea jb jc jd je b"><a href="https://web.archive.org/web/20191204194207/https://github.com/lupyuen/codal-libopencm3/blob/master/stm32/model/STM32BluePill.h" class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow"><strong class="go he">STM32BluePill</strong></a></code>
                  object that’s defined as…</p>
                <pre
                  class="hg hh hi hj hk kw kx ky"><span id="9810" class="kz ij ar bz je b fk la lb r lc">class STM32BluePill : public CodalComponent {<br/>public:<br/>  Timer              timer;<br/>  MessageBus         messageBus;<br/>  STM32BluePillIO    io;<br/>  I2C                i2c1;<br/>  SPI                spi1;<br/>  SPI                spi2;<br/>  Serial             usart2;</span></pre>
                <p id="decb" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Wow we have just dissected the
                  Blue Pill to reveal its innards: the system timer, I2C port, SPI port, USART port, … Each of these are
                  CODAL objects that expose methods for accessing the device and port-specific functions. The <code
                    class="ea jb jc jd je b">led</code> object we saw earlier is just another CODAL object defined in
                  <code class="ea jb jc jd je b">STM32BluePillIO</code>.</p>
                <p id="beba" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">CODAL gives us a clean way to
                  write embedded programs in C++ that will work with many types of modern microcontrollers, without
                  resorting to Arduino’s preprocessor symbols like in <code
                    class="ea jb jc jd je b">digitalWrite(LED_BUILTIN, HIGH)</code>.</p>
                <p id="7c1e" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">CODAL is officially supported for
                  <a href="https://web.archive.org/web/20191204194207/https://github.com/lancaster-university/codal-mbed"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">Arm microcontrollers</a> that use
                  Arm’s Mbed device library (including the <a
                    href="https://web.archive.org/web/20191204194207/https://github.com/lancaster-university/microbit-dal"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">BBC micro:bit</a>). However Mbed
                  is not optimised for Blue Pill so I have ported CODAL to Blue Pill using the optimised open-source <a
                    href="https://web.archive.org/web/20191204194207/https://github.com/libopencm3/libopencm3/wiki"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">libopencm3</a> library instead…
                </p>
                <div class="jk jl jm jn jo jp"><a
                    href="https://web.archive.org/web/20191204194207/https://github.com/lupyuen/codal-libopencm3?source=post_page-----b7f1a1508e89----------------------"
                    rel="noopener nofollow">
                    <section class="js da db ak ct n bh jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh">
                      <div class="ki n dd p kj kk">
                        <h2 class="by ik kl ca ar">
                          <div class="ax jq fm au jr aw">lupyuen/codal-libopencm3</div>
                        </h2>
                        <div class="km r">
                          <h3 class="by fj fk ca cd">
                            <div class="ax jq fm au jr aw">Codal framework ported to libopencm3 to support MakeCode on
                              STM32 Blue Pill - lupyuen/codal-libopencm3</div>
                          </h3>
                        </div>
                        <div class="kn r">
                          <h4 class="by fj gb ca cd">
                            <div class="ax jq fm au jr aw">github.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ko r">
                        <div class="ld r kq kr ks ko kt ku kv"></div>
                      </div>
                    </section>
                  </a></div>
                <p id="ea2e" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">From here onwards, we’ll use the
                  term “CODAL” to refer to the Blue Pill version of CODAL. We’ll now look at the challenges in squeezing
                  CODAL to run on Blue Pill, coexisting with the Bootloader.</p>
              </div>
            </div>
          </section>
          <hr class="hz fj ia ib ic ho id ie if ig ih" />
          <section class="dj dk dl dm dn">
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <div class="hg hh hi hj hk jp"><a rel="noopener"
                    href="/web/20191204194207/https://medium.com/@ly.lee/stm32-blue-pill-analyse-and-optimise-your-ram-and-rom-9fc805e16ed7?source=post_page-----b7f1a1508e89----------------------">
                    <section class="js da db ak ct n bh jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh">
                      <div class="ki n dd p kj kk">
                        <h2 class="by ik kl ca ar">
                          <div class="ax jq fm au jr aw">STM32 Blue Pill — Analyse and Optimise Your RAM and ROM</div>
                        </h2>
                        <div class="km r">
                          <h3 class="by fj fk ca cd">
                            <div class="ax jq fm au jr aw">Tips and tools to prevent Blue Pill Bloat</div>
                          </h3>
                        </div>
                        <div class="kn r">
                          <h4 class="by fj gb ca cd">
                            <div class="ax jq fm au jr aw">medium.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ko r">
                        <div class="le r kq kr ks ko kt ku kv"></div>
                      </div>
                    </section>
                  </a></div>
                <h1 id="1d5c" class="ii ij ar bz by ik il jf in jg ip jh ir ji it jj iv">Memory Layout for Bootloader
                </h1>
                <p id="1b01" class="gm gn ar bz go b gp iw gr ix gt iy gv iz gx ja gz">In <a class="bi cv ha hb hc hd"
                    target="_blank" rel="noopener"
                    href="/web/20191204194207/https://medium.com/@ly.lee/stm32-blue-pill-analyse-and-optimise-your-ram-and-rom-9fc805e16ed7?source=friends_link&amp;sk=54719084d640bb1d92ac1097d623bba2">my
                    article on memory optimisation</a>, we learnt that the Blue Pill has <strong class="go he">64 KB of
                    ROM</strong>, from address <code class="ea jb jc jd je b">0x0800 0000</code> to <code
                    class="ea jb jc jd je b">0x0801 0000</code>. Assuming that we can use all 64 KB of ROM, our MakeCode
                  Application (the one we created through drag-and-drop) will fill up the available ROM like this…</p>
              </div>
            </div>
            <div class="do ak">
              <figure class="hg hh hi hj hk do ak paragraph-image">
                <div class="dq dr ds dt ak">
                  <div class="dz r ds ea">
                    <div class="lf r">
                      <div class="du dv de t u dw ak ax dx dy"><img class="de t u dw ak ec ed ee"
                          src="https://web.archive.org/web/20191204194207im_/https://miro.medium.com/max/60/1*yso3pjwk8Vkvb3GxOqwkgg.png?q=20"
                          width="4278" height="1049" role="presentation" /></div><img class="du dv de t u dw ak ef"
                        width="4278" height="1049" role="presentation" /><noscript><img class="de t u dw ak"
                          src="https://web.archive.org/web/20191204194207im_/https://miro.medium.com/max/8556/1*yso3pjwk8Vkvb3GxOqwkgg.png"
                          width="4278" height="1049" role="presentation" /></noscript>
                    </div>
                  </div>
                </div>
                <figcaption class="cd fk hm hn ho dc da db hp hq by fj">Memory Layout for MakeCode Application
                </figcaption>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <p id="651c" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">MakeCode compiles our visual
                  program into <strong class="go he">Arm Cortex machine code </strong>(not into intermediate bytecode),
                  so the compiled MakeCode App appears to Blue Pill like any other C function. The compiled MakeCode App
                  calls the <a
                    href="https://web.archive.org/web/20191204194207/https://github.com/lupyuen/codal-libopencm3"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">CODAL library</a> to execute Blue
                  Pill device functions. To do its job, CODAL needs to call some friends…</p>
                <ul class="">
                  <li id="a327" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz lg hs ht"><strong
                      class="go he">libopencm3</strong>: The <a
                      href="https://web.archive.org/web/20191204194207/https://github.com/libopencm3/libopencm3/wiki"
                      class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">open-source library</a> for Blue
                    Pill device functions</li>
                  <li id="8e8b" class="gm gn ar bz go b gp hu gr hv gt hw gv hx gx hy gz lg hs ht"><strong
                      class="go he">nano-float</strong>:<a
                      href="https://web.archive.org/web/20191204194207/https://github.com/lupyuen/codal-libopencm3/tree/master/lib/nano-float"
                      class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow"> Math library</a> optimised for
                    Blue Pill. Includes <a
                      href="https://web.archive.org/web/20191204194207/https://www.quinapalus.com/qfplib.html"
                      class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">Qfplib</a>. I wrote about
                    nano-float <a class="bi cv ha hb hc hd" target="_blank" rel="noopener"
                      href="/web/20191204194207/https://medium.com/@ly.lee/stm32-blue-pill-shrink-your-math-libraries-with-qfplib-55093aab163a?source=friends_link&amp;sk=d7cd162dabcc45f96490e5e1f5f4c534">in
                      this article</a> and the <a class="bi cv ha hb hc hd" target="_blank" rel="noopener"
                      href="/web/20191204194207/https://medium.com/@ly.lee/stm32-blue-pill-unit-testing-with-qemu-blue-pill-emulator-9d88002a68b2?source=friends_link&amp;sk=9a9389cdea5828cb48713f963c8f7615">Unit
                      Testing</a> too.</li>
                  <li id="7ba2" class="gm gn ar bz go b gp hu gr hv gt hw gv hx gx hy gz lg hs ht"><strong
                      class="go he">newlib</strong>: <a
                      href="https://web.archive.org/web/20191204194207/https://github.com/lupyuen/newlib/tree/master"
                      class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">Standard C library</a> optimised
                    for Blue Pill</li>
                  <li id="73d2" class="gm gn ar bz go b gp hu gr hv gt hw gv hx gx hy gz lg hs ht"><strong
                      class="go he">logger</strong>: <a
                      href="https://web.archive.org/web/20191204194207/https://github.com/lupyuen/codal-libopencm3/tree/master/stm32/logger"
                      class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">Library for logging</a> errors
                    and diagnostic messages</li>
                  <li id="2836" class="gm gn ar bz go b gp hu gr hv gt hw gv hx gx hy gz lg hs ht"><strong
                      class="go he">bluepill</strong>: <a
                      href="https://web.archive.org/web/20191204194207/https://github.com/lupyuen/codal-libopencm3/tree/master/stm32/bluepill"
                      class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">Common functions</a> for
                    Real-Time Clock and System Timers</li>
                  <li id="0077" class="gm gn ar bz go b gp hu gr hv gt hw gv hx gx hy gz lg hs ht"><strong
                      class="go he">hal</strong>: <a
                      href="https://web.archive.org/web/20191204194207/https://github.com/lupyuen/codal-libopencm3/tree/master/stm32/hal"
                      class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">Hardware Adaptation Layer</a>,
                    called by CODAL</li>
                </ul>
                <p id="ed9c" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">What’s missing from the picture?
                  The <strong class="go he">Bootloader</strong> of course! Without the Bootloader, we won’t be able to
                  flash the MakeCode App to Blue Pill via the web browser. Let’s add the Bootloader…</p>
              </div>
            </div>
            <div class="do ak">
              <figure class="hg hh hi hj hk do ak paragraph-image">
                <div class="dq dr ds dt ak">
                  <div class="dz r ds ea">
                    <div class="lf r">
                      <div class="du dv de t u dw ak ax dx dy"><img class="de t u dw ak ec ed ee"
                          src="https://web.archive.org/web/20191204194207im_/https://miro.medium.com/max/60/1*6-mdzt_0NGcai867jdRFJw.png?q=20"
                          width="4278" height="1049" role="presentation" /></div><img class="du dv de t u dw ak ef"
                        width="4278" height="1049" role="presentation" /><noscript><img class="de t u dw ak"
                          src="https://web.archive.org/web/20191204194207im_/https://miro.medium.com/max/8556/1*6-mdzt_0NGcai867jdRFJw.png"
                          width="4278" height="1049" role="presentation" /></noscript>
                    </div>
                  </div>
                </div>
                <figcaption class="cd fk hm hn ho dc da db hp hq by fj">Memory Layout after adding Bootloader
                </figcaption>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <p id="fb1e" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Now we have a problem… 1️⃣
                  <strong class="go he">CODAL calls the libopencm3 library</strong> to access the Blue Pill device
                  functions 2️⃣ <strong class="go he">Bootloader needs the libopencm3 library</strong> to write to flash
                  memory and to access the USB port. So we have <strong class="go he">TWO copies</strong> of the
                  libopencm3 code in ROM.</p>
                <p id="3421" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">We don’t have enough ROM space
                  for two copies of libopencm3, so let’s use only one copy of libopencm3, shared by the <strong
                    class="go he">Application</strong> (CODAL + MakeCode App) and the <strong
                    class="go he">Bootloader</strong>…</p>
              </div>
            </div>
            <div class="do ak">
              <figure class="hg hh hi hj hk do ak paragraph-image">
                <div class="dq dr ds dt ak">
                  <div class="dz r ds ea">
                    <div class="lf r">
                      <div class="du dv de t u dw ak ax dx dy"><img class="de t u dw ak ec ed ee"
                          src="https://web.archive.org/web/20191204194207im_/https://miro.medium.com/max/60/1*afGJhqhuce_Ld0b6Eks1kw.png?q=20"
                          width="4278" height="1049" role="presentation" /></div><img class="du dv de t u dw ak ef"
                        width="4278" height="1049" role="presentation" /><noscript><img class="de t u dw ak"
                          src="https://web.archive.org/web/20191204194207im_/https://miro.medium.com/max/8556/1*afGJhqhuce_Ld0b6Eks1kw.png"
                          width="4278" height="1049" role="presentation" /></noscript>
                    </div>
                  </div>
                </div>
                <figcaption class="cd fk hm hn ho dc da db hp hq by fj">Memory Layout optimised for Application +
                  Bootloader</figcaption>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <p id="e92a" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">For clarity, we segregate the
                  Bootloader and the Application into two Memory Regions: <code
                    class="ea jb jc jd je b"><strong class="go he">bootrom</strong></code> (for Bootloader) and <code
                    class="ea jb jc jd je b"><strong class="go he">rom</strong></code> (for Application). Recall that
                  the Application (<code class="ea jb jc jd je b">rom</code>) will be updated more often than the
                  Bootloader (<code class="ea jb jc jd je b">bootrom</code>).</p>
                <p id="5001" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">This Bootloader design is rarely
                  used in real life because it needs the <strong class="go he">Bootloader and the Application to be
                    carefully matched by code version.</strong> Otherwise the Application might call a shared function
                  (in libopencm3, for example) using an older address that’s no longer valid in the current Bootloader.
                </p>
                <p id="dfc1" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">How do we tell the Blue Pill
                  compiler and linker to use this memory layout? We define the memory layout in the <a
                    href="https://web.archive.org/web/20191204194207/https://github.com/lupyuen/codal-libopencm3/blob/master/ld/stm32f103x8.ld"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">Linker Script</a>. The details may
                  be found in the <em class="hf">“For Advanced Programmers: Linker Script for Bootloader”</em> section
                  below.</p>
              </div>
            </div>
          </section>
          <hr class="hz fj ia ib ic ho id ie if ig ih" />
          <section class="dj dk dl dm dn">
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <h1 id="d175" class="ii ij ar bz by ik il im in io ip iq ir is it iu iv">WebUSB Flashing with the HF2
                  Protocol</h1>
                <p id="5c9c" class="gm gn ar bz go b gp iw gr ix gt iy gv iz gx ja gz">The <a
                    href="https://web.archive.org/web/20191204194207/https://github.com/lupyuen/codal-libopencm3/tree/master/stm32/bootloader"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">WebUSB Bootloader</a> that I have
                  implemented for Blue Pill (adapted from <a
                    href="https://web.archive.org/web/20191204194207/https://github.com/lupyuen/codal-libopencm3/blob/master/stm32/bootloader/README.md"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">various sources</a>) is a hefty
                  embedded program taking <strong class="go he">29 KB of ROM</strong> space. Why is it so huge? Because
                  it supports…</p>
                <p id="ebdd" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">1️⃣ <strong class="go he">WebUSB
                    and WinUSB</strong> protocols. Allows the MakeCode website to access the Blue Pill via USB through
                  the Chrome web browser, without installing any drivers. I wrote about WebUSB and WinUSB <a
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener"
                    href="/web/20191204194207/https://medium.com/@ly.lee/stm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c?source=friends_link&amp;sk=70a29cd31425ec4d03144bce14a1c922">in
                    this article</a>.</p>
                <p id="9346" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">2️⃣ <strong class="go he">USB
                    Serial Port</strong> (<a
                    href="https://web.archive.org/web/20191204194207/https://en.wikipedia.org/wiki/USB_communications_device_class"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">USB CDC</a>) for debug logging</p>
                <p id="c131" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">3️⃣ <a
                    href="https://web.archive.org/web/20191204194207/https://github.com/Microsoft/uf2/blob/master/hf2.md"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow"><strong class="go he">HF2
                      Protocol</strong></a> for flashing Blue Pill via WebUSB</p>
                <p id="36f1" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">4️⃣ And remember that the
                  Bootloader includes <strong class="go he">libopencm3 and other common functions</strong> used by the
                  MakeCode Application, due to the way we partitioned the ROM space into Bootloader and Application
                  regions.</p>
                <p id="fe8e" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">How do we tell Blue Pill that we
                  want to flash a new Application into ROM? Do we press a button on Blue Pill to enter Bootloader Mode,
                  <a href="https://web.archive.org/web/20191204194207/https://learn.adafruit.com/makecode/downloading-and-flashing"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">like on some MakeCode devices</a>?
                </p>
                <p id="8214" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Not so! The demo above shows that
                  the flashing of Blue Pill is fully automated and triggered by the web browser, when we click the <code
                    class="ea jb jc jd je b">Download</code> button in the MakeCode web page. How does this work?</p>
                <p id="aa78" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">While the Application runs on
                  Blue Pill (we call this the <strong class="go he">Application Mode</strong>), the Bootloader is called
                  periodically to check for USB requests. When the Bootloader receives a request for flashing, it
                  restarts the Blue Pill into <strong class="go he">Bootloader Mode</strong> to perform the flashing.
                  The Application doesn’t run until the flashing has been completed.</p>
              </div>
            </div>
            <div class="do ak">
              <figure class="hg hh hi hj hk do ak paragraph-image">
                <div class="dz r ds ea">
                  <div class="lh r">
                    <div class="du dv de t u dw ak ax dx dy"><img class="de t u dw ak ec ed ee"
                        src="https://web.archive.org/web/20191204194207im_/https://miro.medium.com/max/60/1*kciuJ3Kl_p9eC1cVE9hOPw.png?q=20"
                        width="2074" height="1176" role="presentation" /></div><img class="du dv de t u dw ak ef"
                      width="2074" height="1176" role="presentation" /><noscript><img class="de t u dw ak"
                        src="https://web.archive.org/web/20191204194207im_/https://miro.medium.com/max/4148/1*kciuJ3Kl_p9eC1cVE9hOPw.png"
                        width="2074" height="1176" role="presentation" /></noscript>
                  </div>
                </div>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <p id="386b" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">The flashing magic is made
                  possible by the <strong class="go he">HF2 Protocol</strong> implemented in the <a
                    href="https://web.archive.org/web/20191204194207/https://github.com/lupyuen/stm32bluepill-makecode"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">MakeCode website</a> and in the
                  Bootloader code. The MakeCode website <a
                    href="https://web.archive.org/web/20191204194207/https://github.com/lupyuen/pxt/blob/master/pxtlib/hf2.ts"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">transmits HF2 command packets</a>
                  via in-browser JavaScript, via the WebUSB JavaScript API, via the WinUSB driver (on Windows), finally
                  to the USB port of the Blue Pill.</p>
                <p id="fa37" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">The <a
                    href="https://web.archive.org/web/20191204194207/https://github.com/lupyuen/codal-libopencm3/blob/master/stm32/bootloader/hf2.c"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">Blue Pill Bootloader</a> receives
                  the HF2 command packets and executes them, switching between Application and Bootloader Modes when
                  necessary.</p>
                <p id="c82a" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Here’s the overall flow of the
                  HF2 flashing process as implemented in our <a
                    href="https://web.archive.org/web/20191204194207/https://github.com/lupyuen/codal-libopencm3/blob/master/stm32/bootloader/hf2.c#L101-L215"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">Blue Pill WebUSB Bootloader</a>…
                </p>
                <figure class="hg hh hi hj hk do da db paragraph-image">
                  <div class="dq dr ds dt ak">
                    <div class="da db li">
                      <div class="dz r ds ea">
                        <div class="lj r">
                          <div class="du dv de t u dw ak ax dx dy"><img class="de t u dw ak ec ed ee"
                              src="https://web.archive.org/web/20191204194207im_/https://miro.medium.com/max/60/1*niQsB5ijxu28x4dj3naRiw.png?q=20"
                              width="1726" height="1228" role="presentation" /></div><img class="du dv de t u dw ak ef"
                            width="1726" height="1228" role="presentation" /><noscript><img class="de t u dw ak"
                              src="https://web.archive.org/web/20191204194207im_/https://miro.medium.com/max/3452/1*niQsB5ijxu28x4dj3naRiw.png"
                              width="1726" height="1228" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <p id="2f2b" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">1️⃣ MakeCode website first sends
                  the <code class="ea jb jc jd je b">BININFO</code> command. Blue Pill returns the current mode
                  (Application or Bootloader Mode), and the flash memory size (64 KB).</p>
                <p id="f7df" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">2️⃣ MakeCode then sends the <code
                    class="ea jb jc jd je b">INFO</code> command. Blue Pill returns the identity of the device e.g.
                  <code class="ea jb jc jd je b">STM32BLUEPILL</code>.</p>
                <p id="2696" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">3️⃣ MakeCode sends <code
                    class="ea jb jc jd je b">START_FLASH</code>. Blue Pill restarts in Bootloader Mode to begin
                  flashing.</p>
                <figure class="hg hh hi hj hk do da db paragraph-image">
                  <div class="dq dr ds dt ak">
                    <div class="da db li">
                      <div class="dz r ds ea">
                        <div class="lk r">
                          <div class="du dv de t u dw ak ax dx dy"><img class="de t u dw ak ec ed ee"
                              src="https://web.archive.org/web/20191204194207im_/https://miro.medium.com/max/60/1*8BrNvbyovzAuZDjn9yTrlg.png?q=20"
                              width="1726" height="1498" role="presentation" /></div><img class="du dv de t u dw ak ef"
                            width="1726" height="1498" role="presentation" /><noscript><img class="de t u dw ak"
                              src="https://web.archive.org/web/20191204194207im_/https://miro.medium.com/max/3452/1*8BrNvbyovzAuZDjn9yTrlg.png"
                              width="1726" height="1498" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <p id="ed5f" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">4️⃣ For each 1 KB page of data to
                  be flashed, MakeCode sends the <code class="ea jb jc jd je b">WRITE_FLASH_PAGE</code> command and the
                  data to be flashed. Blue Pill compares the received data with the current ROM data. If the data is
                  different, it writes the received data to ROM. This is only applicable for the Application ROM, not
                  the Bootloader ROM.</p>
                <p id="3328" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">5️⃣ MakeCode sends <code
                    class="ea jb jc jd je b">RESET_INTO_APP</code>. Blue Pill restarts in Application Mode and runs the
                  flashed Application.</p>
                <p id="6fe6" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">What if the Bootloader needs to
                  be upgraded? The same flow works for upgrading the Bootloader as well. In the next article I’ll
                  explain how the <a
                    href="https://web.archive.org/web/20191204194207/https://github.com/lupyuen/codal-libopencm3/tree/master/stm32/baseloader"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">Baseloader</a> upgrades the
                  Bootloader code.</p>
              </div>
            </div>
          </section>
          <hr class="hz fj ia ib ic ho id ie if ig ih" />
          <section class="dj dk dl dm dn">
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <h1 id="5c8c" class="ii ij ar bz by ik il im in io ip iq ir is it iu iv">What’s Next?</h1>
                <p id="4055" class="gm gn ar bz go b gp iw gr ix gt iy gv iz gx ja gz">The WebUSB Bootloader for
                  MakeCode on Blue Pill is incredibly complex — it required four articles (plus this article) to explain
                  the topics that we have covered today…</p>
                <p id="7026" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">1️⃣ We implemented the WebUSB and
                  WinUSB interfaces on Blue Pill…</p>
                <div class="jk jl jm jn jo jp"><a rel="noopener"
                    href="/web/20191204194207/https://medium.com/@ly.lee/stm32-blue-pill-usb-bootloader-how-i-fixed-the-usb-storage-serial-dfu-and-webusb-interfaces-36d7fe245b5c?source=post_page-----b7f1a1508e89----------------------">
                    <section class="js da db ak ct n bh jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh">
                      <div class="ki n dd p kj kk">
                        <h2 class="by ik kl ca ar">
                          <div class="ax jq fm au jr aw">STM32 Blue Pill USB Bootloader — How I fixed the USB Storage,
                            Serial, DFU and WebUSB interfaces</div>
                        </h2>
                        <div class="km r">
                          <h3 class="by fj fk ca cd">
                            <div class="ax jq fm au jr aw">Building a complex composite USB device with libopencm3 that
                              works on Windows, Mac and Linux</div>
                          </h3>
                        </div>
                        <div class="kn r">
                          <h4 class="by fj gb ca cd">
                            <div class="ax jq fm au jr aw">medium.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ko r">
                        <div class="kp r kq kr ks ko kt ku kv"></div>
                      </div>
                    </section>
                  </a></div>
                <p id="4e43" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">2️⃣ We applied memory
                  optimisation tools and techniques to squeeze the Bootloader into Blue Pill…</p>
                <div class="jk jl jm jn jo jp"><a rel="noopener"
                    href="/web/20191204194207/https://medium.com/@ly.lee/stm32-blue-pill-analyse-and-optimise-your-ram-and-rom-9fc805e16ed7?source=post_page-----b7f1a1508e89----------------------">
                    <section class="js da db ak ct n bh jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh">
                      <div class="ki n dd p kj kk">
                        <h2 class="by ik kl ca ar">
                          <div class="ax jq fm au jr aw">STM32 Blue Pill — Analyse and Optimise Your RAM and ROM</div>
                        </h2>
                        <div class="km r">
                          <h3 class="by fj fk ca cd">
                            <div class="ax jq fm au jr aw">Tips and tools to prevent Blue Pill Bloat</div>
                          </h3>
                        </div>
                        <div class="kn r">
                          <h4 class="by fj gb ca cd">
                            <div class="ax jq fm au jr aw">medium.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ko r">
                        <div class="le r kq kr ks ko kt ku kv"></div>
                      </div>
                    </section>
                  </a></div>
                <p id="38d8" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">3️⃣ We created nano-float, an
                  optimised version of the standard math library…</p>
                <div class="jk jl jm jn jo jp"><a rel="noopener"
                    href="/web/20191204194207/https://medium.com/@ly.lee/stm32-blue-pill-shrink-your-math-libraries-with-qfplib-55093aab163a?source=post_page-----b7f1a1508e89----------------------">
                    <section class="js da db ak ct n bh jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh">
                      <div class="ki n dd p kj kk">
                        <h2 class="by ik kl ca ar">
                          <div class="ax jq fm au jr aw">STM32 Blue Pill – Shrink your math libraries with Qfplib</div>
                        </h2>
                        <div class="km r">
                          <h3 class="by fj fk ca cd">
                            <div class="ax jq fm au jr aw">Floating-point math libraries can bloat your Blue Pill code.
                              Here’s one way to fix that</div>
                          </h3>
                        </div>
                        <div class="kn r">
                          <h4 class="by fj gb ca cd">
                            <div class="ax jq fm au jr aw">medium.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ko r">
                        <div class="ll r kq kr ks ko kt ku kv"></div>
                      </div>
                    </section>
                  </a></div>
                <p id="60d5" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">4️⃣ And we verified the accuracy
                  of the nano-float library through Unit Testing…</p>
                <div class="jk jl jm jn jo jp"><a rel="noopener"
                    href="/web/20191204194207/https://medium.com/@ly.lee/stm32-blue-pill-unit-testing-with-qemu-blue-pill-emulator-9d88002a68b2?source=post_page-----b7f1a1508e89----------------------">
                    <section class="js da db ak ct n bh jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh">
                      <div class="ki n dd p kj kk">
                        <h2 class="by ik kl ca ar">
                          <div class="ax jq fm au jr aw">STM32 Blue Pill — Unit Testing with Qemu Blue Pill Emulator
                          </div>
                        </h2>
                        <div class="km r">
                          <h3 class="by fj fk ca cd">
                            <div class="ax jq fm au jr aw">Unit Testing can help to stop bugs before they pollute the
                              entire IoT chain</div>
                          </h3>
                        </div>
                        <div class="kn r">
                          <h4 class="by fj gb ca cd">
                            <div class="ax jq fm au jr aw">medium.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ko r">
                        <div class="lm r kq kr ks ko kt ku kv"></div>
                      </div>
                    </section>
                  </a></div>
                <p id="1c37" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">5️⃣ We have one upcoming article
                  that explains how the Baseloader upgrades the Bootloader.</p>
                <p id="e041" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">It’s been a long journey —<strong
                    class="go he"> join me if you’re keen to complete the Blue Pill port of MakeCode!</strong> So that
                  we’ll finally have the perfect platform to build and test IoT prototypes.</p>
                <p id="b3c7" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">There are too many topics to
                  cover, so I kept a log of all things that I have tried (even the failed ones)…</p>
                <div class="jk jl jm jn jo jp"><a rel="noopener"
                    href="/web/20191204194207/https://medium.com/@ly.lee/work-in-progress-stm32-blue-pill-visual-programming-with-makecode-codal-and-libopencm3-422d308f252e?source=post_page-----b7f1a1508e89----------------------">
                    <section class="js da db ak ct n bh jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh">
                      <div class="ki n dd p kj kk">
                        <h2 class="by ik kl ca ar">
                          <div class="ax jq fm au jr aw">[Work In Progress] STM32 Blue Pill Visual Programming with
                            MakeCode, CODAL and libopencm3</div>
                        </h2>
                        <div class="km r">
                          <h3 class="by fj fk ca cd">
                            <div class="ax jq fm au jr aw">Note: This work-in-progress document describes an incomplete
                              implementation of STM32 Blue Pill visual programming. The…</div>
                          </h3>
                        </div>
                        <div class="kn r">
                          <h4 class="by fj gb ca cd">
                            <div class="ax jq fm au jr aw">medium.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="ko r">
                        <div class="ln r kq kr ks ko kt ku kv"></div>
                      </div>
                    </section>
                  </a></div>
                <p id="427a" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Why not port MicroPython to Blue
                  Pill? <a
                    href="https://web.archive.org/web/20191204194207/https://github.com/lupyuen/send_altitude_cocoos/tree/micropython/lib/bluepill-micropython/ports/bluepill"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">I tried but failed miserably</a>.
                  MicroPython was designed for dynamic memory allocation, which works poorly on Blue Pill’s constrained
                  RAM. Unlike MakeCode, which implements Static TypeScript without dynamic memory.</p>
                <p id="345d" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">Look forward to having you
                  onboard the Blue Pill MakeCode journey! :-)</p>
              </div>
            </div>
          </section>
          <hr class="hz fj ia ib ic ho id ie if ig ih" />
          <section class="dj dk dl dm dn">
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <h1 id="37f4" class="ii ij ar bz by ik il im in io ip iq ir is it iu iv">For Advanced Programmers:
                  Linker Script for Bootloader</h1>
                <p id="b877" class="gm gn ar bz go b gp iw gr ix gt iy gv iz gx ja gz"><em class="hf">If you’re
                    interested in writing a Linker Script to customise the memory layout in your embedded program, read
                    on…</em></p>
                <pre
                  class="hg hh hi hj hk kw kx ky"><span id="465f" class="kz ij ar bz je b fk la lb r lc">_bootrom_size = 29K<br/>...<br/>MEMORY /* Define memory regions. */<br/>{<br/>  /* Available ROM is 64K (0x10000). <br/>     Reserve lower part for Bootloader, <br/>     upper part for Application. */</span><span id="3538" class="kz ij ar bz je b fk lo lp lq lr ls lb r lc">bootrom (rx)  : ORIGIN = 0x08000000,      <br/>                 LENGTH = _bootrom_size</span><span id="5fc9" class="kz ij ar bz je b fk lo lp lq lr ls lb r lc">rom     (rx)  : ORIGIN = 0x08000000 + _bootrom_size, <br/>                 LENGTH = 64K - _bootrom_size</span></pre>
                <p id="05a6" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">The above <a
                    href="https://web.archive.org/web/20191204194207/https://github.com/lupyuen/codal-libopencm3/blob/master/ld/stm32f103x8.ld"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">Linker Script</a> tells the GNU
                  Linker to create two memory regions: <code class="ea jb jc jd je b">bootrom</code> (29 KB) and <code
                    class="ea jb jc jd je b">rom</code> (64–29=35 KB). How do we instruct the linker to allocate various
                  libraries to <code class="ea jb jc jd je b">bootrom</code> and <code
                    class="ea jb jc jd je b">rom</code>?</p>
              </div>
            </div>
            <div class="do ak">
              <figure class="hg hh hi hj hk do ak paragraph-image">
                <div class="dq dr ds dt ak">
                  <div class="dz r ds ea">
                    <div class="lf r">
                      <div class="du dv de t u dw ak ax dx dy"><img class="de t u dw ak ec ed ee"
                          src="https://web.archive.org/web/20191204194207im_/https://miro.medium.com/max/60/1*afGJhqhuce_Ld0b6Eks1kw.png?q=20"
                          width="4278" height="1049" role="presentation" /></div><img class="du dv de t u dw ak ef"
                        width="4278" height="1049" role="presentation" /><noscript><img class="de t u dw ak"
                          src="https://web.archive.org/web/20191204194207im_/https://miro.medium.com/max/8556/1*afGJhqhuce_Ld0b6Eks1kw.png"
                          width="4278" height="1049" role="presentation" /></noscript>
                    </div>
                  </div>
                </div>
                <figcaption class="cd fk hm hn ho dc da db hp hq by fj">Memory Layout with two memory regions
                </figcaption>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah eg aj ak">
                <p id="fef5" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">From <a class="bi cv ha hb hc hd"
                    target="_blank" rel="noopener"
                    href="/web/20191204194207/https://medium.com/@ly.lee/stm32-blue-pill-analyse-and-optimise-your-ram-and-rom-9fc805e16ed7?source=friends_link&amp;sk=54719084d640bb1d92ac1097d623bba2">my
                    article on memory optimisation</a>, you’ll recall that the <code class="ea jb jc jd je b">rom</code>
                  memory region contains a <strong class="go he">Text Section</strong> (for program code) and a <strong
                    class="go he">Data Section</strong> (for initial values of non-zero variables). Here’s how we tell
                  the linker which libraries to allocate into the Text Section of <code
                    class="ea jb jc jd je b">bootrom</code>…</p>
                <pre
                  class="hg hh hi hj hk kw kx ky"><span id="bbd7" class="kz ij ar bz je b fk la lb r lc">SECTIONS<br/>{<br/> .boot_text : { /* Bootloader ROM */<br/>  ...<br/>  *liblibopencm3.a: (.text*) /* libopencm3       */<br/>  *libnano-float.a: (.text*) /* Math Library     */<br/>  *libnewlib.a:     (.text*) /* C Library        */<br/>  *liblogger.a:     (.text*) /* Logger           */<br/>  *libbluepill.a:   (.text*) /* Device Functions */<br/>  *libbootloader.a: (.text*) /* Bootloader       */<br/>  ...<br/>} &gt;bootrom</span></pre>
                <p id="23f2" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">The <code
                    class="ea jb jc jd je b">*</code> wildcard matches any number of characters. When used like this…
                </p>
                <pre
                  class="hg hh hi hj hk kw kx ky"><span id="804b" class="kz ij ar bz je b fk la lb r lc">*liblibopencm3.a: (.text*)</span></pre>
                <p id="0888" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">…the linker takes all object
                  files (<code class="ea jb jc jd je b">*.o</code>) from the library <code
                    class="ea jb jc jd je b">liblibopencm3.a</code>, extracts all the Text Sections, and writes them
                  into the <code class="ea jb jc jd je b">bootrom</code> memory region.</p>
                <p id="0f36" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">All other libraries and object
                  files that don’t match the above patterns will be allocated in the <code
                    class="ea jb jc jd je b">rom</code> memory region, according to this rule…</p>
                <pre
                  class="hg hh hi hj hk kw kx ky"><span id="0eac" class="kz ij ar bz je b fk la lb r lc">.text : {          /* Application ROM        */<br/>  ...<br/>  * (.text*) /* Other Application Code */<br/>  ...<br/>} &gt;rom</span></pre>
                <p id="fa86" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">What about the Blue Pill RAM? We
                  allocate the available RAM into three memory regions: <code class="ea jb jc jd je b">bootram</code>
                  (for the Bootloader), <code class="ea jb jc jd je b">ram</code> (for the Application) and <code
                    class="ea jb jc jd je b">bootbuf</code>. <code class="ea jb jc jd je b">bootbuf</code> contains the
                  RAM buffers used for flashing the ROM in Bootloader Mode. Since <code
                    class="ea jb jc jd je b">bootbuf</code> is not used in Application Mode, <a
                    href="https://web.archive.org/web/20191204194207/https://github.com/lupyuen/codal-libopencm3/blob/master/stm32/bootloader/bootloader.c#L170-L173"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">we convert </a><code
                    class="ea jb jc jd je b"><a href="https://web.archive.org/web/20191204194207/https://github.com/lupyuen/codal-libopencm3/blob/master/stm32/bootloader/bootloader.c#L170-L173" class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">bootbuf</a></code><a
                    href="https://web.archive.org/web/20191204194207/https://github.com/lupyuen/codal-libopencm3/blob/master/stm32/bootloader/bootloader.c#L170-L173"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow"> into an extended memory space for
                    the stack and the heap</a> while running the Application.</p>
                <p id="05ef" class="gm gn ar bz go b gp gq gr gs gt gu gv gw gx gy gz">The <a
                    href="https://web.archive.org/web/20191204194207/https://github.com/lupyuen/codal-libopencm3/blob/master/ld/stm32f103x8.ld"
                    class="bi cv ha hb hc hd" target="_blank" rel="noopener nofollow">Linker Script</a> for RAM layout
                  looks like this…</p>
                <pre
                  class="hg hh hi hj hk kw kx ky"><span id="13cc" class="kz ij ar bz je b fk la lb r lc">_bootrom_size = 29K;    /* Size of Bootloader ROM <br/>                           (code + constant data) */</span><span id="5881" class="kz ij ar bz je b fk lo lp lq lr ls lb r lc">_bootram_size =  4K;    /* Size of Bootloader RAM */</span><span id="c6c3" class="kz ij ar bz je b fk lo lp lq lr ls lb r lc">_bootbuf_size = /* Size of the Bootloader buffers...         */<br/> 1090 +         /* flashBuf from stm32/bootloader/ghostfat.c */<br/> 1024 +         /* hf2_buffer from stm32/bootloader/hf2.c    */<br/>    2;          /* Align to 4 bytes */<br/>...<br/>MEMORY /* Define memory regions. */<br/>{<br/>  /* Available RAM is 20K (0x5000). <br/>     Reserve lower part for Bootloader, <br/>     middle part for Application,<br/>     upper part for Bootloader flash buffers <br/>     (not used in Application Mode). */</span><span id="2ee4" class="kz ij ar bz je b fk lo lp lq lr ls lb r lc">  bootram (rwx) : ORIGIN = 0x20000000,      <br/>                  LENGTH = _bootram_size</span><span id="0368" class="kz ij ar bz je b fk lo lp lq lr ls lb r lc">  ram     (rwx) : ORIGIN = 0x20000000 + _bootram_size, <br/>                  LENGTH = 20K - _bootram_size - _bootbuf_size</span><span id="531c" class="kz ij ar bz je b fk lo lp lq lr ls lb r lc">  bootbuf (rwx) : ORIGIN = 0x20005000 - _bootbuf_size, <br/>                  LENGTH = _bootbuf_size</span></pre>
              </div>
            </div>
          </section>
        </div>
      </article>
      <div class="du di lt s ak lu lv lw" data-test-id="post-sidebar">
        <div class="n p">
          <div class="ac ae af ag ah ai aj ak">
            <div class="lx n dd">
              <div class="di">
                <div class="ly lz ma n">
                  <div class="n o">
                    <div class="mb r ds"><a
                        href="https://web.archive.org/web/20191204194207/https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Fstm32-blue-pill-dissecting-the-webusb-bootloader-for-makecode-b7f1a1508e89&amp;source=post_sidebar-----b7f1a1508e89---------------------clap_sidebar-"
                        class="bi bj bk bl bm bn bo bp bq br bs bt bu bv bw bx" rel="noopener">
                        <div class="bp mc md me mf mg mh mi mj mk ml"><svg width="29" height="29">
                            <g fill-rule="evenodd">
                              <path
                                d="M13.74 1l.76 2.97.76-2.97zM16.82 4.78l1.84-2.56-1.43-.47zM10.38 2.22l1.84 2.56-.41-3.03zM22.38 22.62a5.11 5.11 0 0 1-3.16 1.61l.49-.45c2.88-2.89 3.45-5.98 1.69-9.21l-1.1-1.94-.96-2.02c-.31-.67-.23-1.18.25-1.55a.84.84 0 0 1 .66-.16c.34.05.66.28.88.6l2.85 5.02c1.18 1.97 1.38 5.12-1.6 8.1M9.1 22.1l-5.02-5.02a1 1 0 0 1 .7-1.7 1 1 0 0 1 .72.3l2.6 2.6a.44.44 0 0 0 .63-.62L6.1 15.04l-1.75-1.75a1 1 0 1 1 1.41-1.41l4.15 4.15a.44.44 0 0 0 .63 0 .44.44 0 0 0 0-.62L6.4 11.26l-1.18-1.18a1 1 0 0 1 0-1.4 1.02 1.02 0 0 1 1.41 0l1.18 1.16L11.96 14a.44.44 0 0 0 .62 0 .44.44 0 0 0 0-.63L8.43 9.22a.99.99 0 0 1-.3-.7.99.99 0 0 1 .3-.7 1 1 0 0 1 1.41 0l7 6.98a.44.44 0 0 0 .7-.5l-1.35-2.85c-.31-.68-.23-1.19.25-1.56a.85.85 0 0 1 .66-.16c.34.06.66.28.88.6L20.63 15c1.57 2.88 1.07 5.54-1.55 8.16a5.62 5.62 0 0 1-5.06 1.65 9.35 9.35 0 0 1-4.93-2.72zM13 6.98l2.56 2.56c-.5.6-.56 1.41-.15 2.28l.26.56-4.25-4.25a.98.98 0 0 1-.12-.45 1 1 0 0 1 .29-.7 1.02 1.02 0 0 1 1.41 0zm8.89 2.06c-.38-.56-.9-.92-1.49-1.01a1.74 1.74 0 0 0-1.34.33c-.38.29-.61.65-.71 1.06a2.1 2.1 0 0 0-1.1-.56 1.78 1.78 0 0 0-.99.13l-2.64-2.64a1.88 1.88 0 0 0-2.65 0 1.86 1.86 0 0 0-.48.85 1.89 1.89 0 0 0-2.67-.01 1.87 1.87 0 0 0-.5.9c-.76-.75-2-.75-2.7-.04a1.88 1.88 0 0 0 0 2.66c-.3.12-.61.29-.87.55a1.88 1.88 0 0 0 0 2.66l.62.62a1.88 1.88 0 0 0-.9 3.16l5.01 5.02c1.6 1.6 3.52 2.64 5.4 2.96a7.16 7.16 0 0 0 1.18.1c1.03 0 2-.25 2.9-.7A5.9 5.9 0 0 0 23 23.24c3.34-3.34 3.08-6.93 1.74-9.17l-2.87-5.04z">
                              </path>
                            </g>
                          </svg></div>
                      </a></div>
                    <div class="mm r">
                      <div class="mn">
                        <h4 class="by fj fk ca cd"><button class="bi bj bk bl bm bn bo bp bq br bs bt bu bv bw bx">98
                          </button></h4>
                      </div>
                    </div>
                  </div>
                </div>
                <div>
                  <div class="cu"><a
                      href="https://web.archive.org/web/20191204194207/https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Fstm32-blue-pill-dissecting-the-webusb-bootloader-for-makecode-b7f1a1508e89&amp;source=post_sidebar--------------------------bookmark_sidebar-"
                      class="bi bj bk bl bm bn bo bp bq br bs bt bu bv bw bx" rel="noopener"><svg width="25" height="25"
                        viewbox="0 0 25 25">
                        <path
                          d="M19 6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14.66h.01c.01.1.05.2.12.28a.5.5 0 0 0 .7.03l5.67-4.12 5.66 4.13a.5.5 0 0 0 .71-.03.5.5 0 0 0 .12-.29H19V6zm-6.84 9.97L7 19.64V6a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v13.64l-5.16-3.67a.49.49 0 0 0-.68 0z"
                          fill-rule="evenodd"></path>
                      </svg></a></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="du di lt s mo fd mp mq lv mr"></div>
      <div>
        <div class="ms do n dd p">
          <div class="n p">
            <div class="ac ae af ag ah eg aj ak">
              <div class="n mt"></div>
              <div class="n o mt"></div>
              <div class="mu r">
                <ul class="bp bq">
                  <li class="cu mv mw mx"><a href="/web/20191204194207/https://medium.com/tag/programming"
                      class="my mz cv cd r kx na a b gb">Programming</a></li>
                  <li class="cu mv mw mx"><a href="/web/20191204194207/https://medium.com/tag/gadgets"
                      class="my mz cv cd r kx na a b gb">Gadgets</a></li>
                  <li class="cu mv mw mx"><a href="/web/20191204194207/https://medium.com/tag/internet-of-things"
                      class="my mz cv cd r kx na a b gb">Internet of Things</a></li>
                  <li class="cu mv mw mx"><a href="/web/20191204194207/https://medium.com/tag/stm32"
                      class="my mz cv cd r kx na a b gb">Stm32</a></li>
                </ul>
              </div>
              <div class="nb n et ab">
                <div class="n o">
                  <div class="nc r ds"><a
                      href="https://web.archive.org/web/20191204194207/https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Fstm32-blue-pill-dissecting-the-webusb-bootloader-for-makecode-b7f1a1508e89&amp;source=post_actions_footer-----b7f1a1508e89---------------------clap_footer-"
                      class="bi bj bk bl bm bn bo bp bq br bs bt bu bv bw bx" rel="noopener">
                      <div class="c nd ff n o ne ds nf ng nh ni nj nk nl nm nn no np nq nr ns">
                        <div class="bp mc md me mf mg nt mi o ef ff n p nu u dw de t ak mj mk ml nv"><svg width="33"
                            height="33" viewbox="0 0 33 33">
                            <path
                              d="M28.86 17.34l-3.64-6.4c-.3-.43-.71-.73-1.16-.8a1.12 1.12 0 0 0-.9.21c-.62.5-.73 1.18-.32 2.06l1.22 2.6 1.4 2.45c2.23 4.09 1.51 8-2.15 11.66a9.6 9.6 0 0 1-.8.71 6.53 6.53 0 0 0 4.3-2.1c3.82-3.82 3.57-7.87 2.05-10.39zm-6.25 11.08c3.35-3.35 4-6.78 1.98-10.47L21.2 12c-.3-.43-.71-.72-1.16-.8a1.12 1.12 0 0 0-.9.22c-.62.49-.74 1.18-.32 2.06l1.72 3.63a.5.5 0 0 1-.81.57l-8.91-8.9a1.33 1.33 0 0 0-1.89 1.88l5.3 5.3a.5.5 0 0 1-.71.7l-5.3-5.3-1.49-1.49c-.5-.5-1.38-.5-1.88 0a1.34 1.34 0 0 0 0 1.89l1.49 1.5 5.3 5.28a.5.5 0 0 1-.36.86.5.5 0 0 1-.36-.15l-5.29-5.29a1.34 1.34 0 0 0-1.88 0 1.34 1.34 0 0 0 0 1.89l2.23 2.23L9.3 21.4a.5.5 0 0 1-.36.85.5.5 0 0 1-.35-.14l-3.32-3.33a1.33 1.33 0 0 0-1.89 0 1.32 1.32 0 0 0-.39.95c0 .35.14.69.4.94l6.39 6.4c3.53 3.53 8.86 5.3 12.82 1.35zM12.73 9.26l5.68 5.68-.49-1.04c-.52-1.1-.43-2.13.22-2.89l-3.3-3.3a1.34 1.34 0 0 0-1.88 0 1.33 1.33 0 0 0-.4.94c0 .22.07.42.17.61zm14.79 19.18a7.46 7.46 0 0 1-6.41 2.31 7.92 7.92 0 0 1-3.67.9c-3.05 0-6.12-1.63-8.36-3.88l-6.4-6.4A2.31 2.31 0 0 1 2 19.72a2.33 2.33 0 0 1 1.92-2.3l-.87-.87a2.34 2.34 0 0 1 0-3.3 2.33 2.33 0 0 1 1.24-.64l-.14-.14a2.34 2.34 0 0 1 0-3.3 2.39 2.39 0 0 1 3.3 0l.14.14a2.33 2.33 0 0 1 3.95-1.24l.09.09c.09-.42.29-.83.62-1.16a2.34 2.34 0 0 1 3.3 0l3.38 3.39a2.17 2.17 0 0 1 1.27-.17c.54.08 1.03.35 1.45.76.1-.55.41-1.03.9-1.42a2.12 2.12 0 0 1 1.67-.4 2.8 2.8 0 0 1 1.85 1.25l3.65 6.43c1.7 2.83 2.03 7.37-2.2 11.6zM13.22.48l-1.92.89 2.37 2.83-.45-3.72zm8.48.88L19.78.5l-.44 3.7 2.36-2.84zM16.5 3.3L15.48 0h2.04L16.5 3.3z"
                              fill-rule="evenodd"></path>
                          </svg></div>
                      </div>
                    </a></div>
                  <div class="mm r">
                    <div class="mn">
                      <h4 class="by fj fk ca ar"><button class="bi bj bk bl bm bn bo bp bq br bs bt bu bv bw bx">98
                          claps</button></h4>
                    </div>
                  </div>
                </div>
                <div class="n o">
                  <div class="gk r bh"><a
                      href="//web.archive.org/web/20191204194207/https://medium.com/p/b7f1a1508e89/share/twitter?source=post_actions_footer---------------------------"
                      class="bi bj bk bl bm bn bo bp bq br bs bt bu bv bw bx" target="_blank" rel="noopener"><svg
                        width="29" height="29" class="q">
                        <path
                          d="M22.05 7.54a4.47 4.47 0 0 0-3.3-1.46 4.53 4.53 0 0 0-4.53 4.53c0 .35.04.7.08 1.05A12.9 12.9 0 0 1 5 6.89a5.1 5.1 0 0 0-.65 2.26c.03 1.6.83 2.99 2.02 3.79a4.3 4.3 0 0 1-2.02-.57v.08a4.55 4.55 0 0 0 3.63 4.44c-.4.08-.8.13-1.21.16l-.81-.08a4.54 4.54 0 0 0 4.2 3.15 9.56 9.56 0 0 1-5.66 1.94l-1.05-.08c2 1.27 4.38 2.02 6.94 2.02 8.3 0 12.86-6.9 12.84-12.85.02-.24 0-.43 0-.65a8.68 8.68 0 0 0 2.26-2.34c-.82.38-1.7.62-2.6.72a4.37 4.37 0 0 0 1.95-2.51c-.84.53-1.81.9-2.83 1.13z">
                        </path>
                      </svg></a></div>
                  <div class="gk r bh"><a
                      href="//web.archive.org/web/20191204194207/https://medium.com/p/b7f1a1508e89/share/linkedIn?source=post_actions_footer---------------------------"
                      class="bi bj bk bl bm bn bo bp bq br bs bt bu bv bw bx" target="_blank" rel="noopener"><svg
                        width="29" height="29" viewbox="0 0 29 29" fill="none" class="q">
                        <path
                          d="M5 6.36C5 5.61 5.63 5 6.4 5h16.2c.77 0 1.4.61 1.4 1.36v16.28c0 .75-.63 1.36-1.4 1.36H6.4c-.77 0-1.4-.6-1.4-1.36V6.36z">
                        </path>
                        <path fill-rule="evenodd" clip-rule="evenodd"
                          d="M10.76 20.9v-8.57H7.89v8.58h2.87zm-1.44-9.75c1 0 1.63-.65 1.63-1.48-.02-.84-.62-1.48-1.6-1.48-.99 0-1.63.64-1.63 1.48 0 .83.62 1.48 1.59 1.48h.01zM12.35 20.9h2.87v-4.79c0-.25.02-.5.1-.7.2-.5.67-1.04 1.46-1.04 1.04 0 1.46.8 1.46 1.95v4.59h2.87v-4.92c0-2.64-1.42-3.87-3.3-3.87-1.55 0-2.23.86-2.61 1.45h.02v-1.24h-2.87c.04.8 0 8.58 0 8.58z"
                          fill="#fff"></path>
                      </svg></a></div>
                  <div class="gk r bh"><a
                      href="//web.archive.org/web/20191204194207/https://medium.com/p/b7f1a1508e89/share/facebook?source=post_actions_footer---------------------------"
                      class="bi bj bk bl bm bn bo bp bq br bs bt bu bv bw bx" target="_blank" rel="noopener"><svg
                        width="29" height="29" class="q">
                        <path
                          d="M23.2 5H5.8a.8.8 0 0 0-.8.8V23.2c0 .44.35.8.8.8h9.3v-7.13h-2.38V13.9h2.38v-2.38c0-2.45 1.55-3.66 3.74-3.66 1.05 0 1.95.08 2.2.11v2.57h-1.5c-1.2 0-1.48.57-1.48 1.4v1.96h2.97l-.6 2.97h-2.37l.05 7.12h5.1a.8.8 0 0 0 .79-.8V5.8a.8.8 0 0 0-.8-.79">
                        </path>
                      </svg></a></div>
                  <div class="gk r bh">
                    <div>
                      <div class="cu"><a
                          href="https://web.archive.org/web/20191204194207/https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Fstm32-blue-pill-dissecting-the-webusb-bootloader-for-makecode-b7f1a1508e89&amp;source=post_actions_footer--------------------------bookmark_sidebar-"
                          class="bi bj bk bl bm bn bo bp bq br bs bt bu bv bw bx" rel="noopener"><svg width="25"
                            height="25" viewbox="0 0 25 25">
                            <path
                              d="M19 6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14.66h.01c.01.1.05.2.12.28a.5.5 0 0 0 .7.03l5.67-4.12 5.66 4.13a.5.5 0 0 0 .71-.03.5.5 0 0 0 .12-.29H19V6zm-6.84 9.97L7 19.64V6a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v13.64l-5.16-3.67a.49.49 0 0 0-.68 0z"
                              fill-rule="evenodd"></path>
                          </svg></a></div>
                    </div>
                  </div>
                  <div class="cu">
                    <div class="cu">
                      <div class="cu">
                        <div class="r bh"><button class="bi bj bk bl bm bn bo bp bq br bs bt bu bv bw bx"><svg
                              width="25" height="25" viewbox="-480.5 272.5 21 21" class="q">
                              <path
                                d="M-463 284.6c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5zm-7-.9c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5zm-7-.9c.9 0 1.6-.7 1.6-1.6s-.7-1.6-1.6-1.6-1.6.7-1.6 1.6.7 1.6 1.6 1.6zm0 .9c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5z">
                              </path>
                            </svg></button></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="nw nx ny mu r ab">
                <div class="nz oa r ds"><span class="r ob an oc">
                    <div class="r de od oe"><a rel="noopener"
                        href="/web/20191204194207/https://medium.com/@ly.lee?source=follow_footer--------------------------follow_footer-">
                        <div class="ds of og">
                          <div class="ch n ez o p de fa fb fc fd fe di"><svg width="91" height="91" viewbox="0 0 91 91">
                              <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M45.5 1.4c-17.14 0-32 9.95-39.25 24.5L5 25.28C12.47 10.28 27.8 0 45.5 0S78.53 10.29 86 25.28l-1.25.62C77.5 11.35 62.65 1.4 45.5 1.4zM6.25 65.1c7.25 14.55 22.1 24.5 39.25 24.5 17.14 0 32-9.95 39.25-24.5l1.25.62C78.53 80.72 63.2 91 45.5 91S12.47 80.71 5 65.72l1.25-.62z">
                              </path>
                            </svg></div><img alt="Lup Yuen Lee 李立源" class="r ff og of"
                            src="https://web.archive.org/web/20191204194207im_/https://miro.medium.com/fit/c/160/160/1*KGohS3sQaUnr58gc0BIfoQ.jpeg"
                            width="80" height="80" />
                        </div>
                      </a></div><span class="r">
                      <div class="oh r oi">
                        <p class="by fj gb ca cd oj ok">Written by</p>
                      </div>
                      <div class="oh ol n oi">
                        <div class="ak n o et">
                          <h2 class="by ik ia om ar"><a class="bi bj bk bl bm bn bo bp bq br bs bt bu bv bw bx"
                              rel="noopener"
                              href="/web/20191204194207/https://medium.com/@ly.lee?source=follow_footer--------------------------follow_footer-">Lup
                              Yuen Lee 李立源</a></h2>
                          <div class="r g"><button
                              class="on ar q cn fq fr fs ft br bw fu fv fw fx fy fz cq by b bz ca cb cc cr cs ct cu cv bu">Follow</button>
                          </div>
                        </div>
                      </div>
                    </span>
                  </span>
                  <div class="oh oo r oi bd">
                    <div class="op r">
                      <h4 class="by fj kl oq cd">Techie and Educator in IoT 物聯網教師</h4>
                    </div>
                    <div class="bc or bd"><button
                        class="on ar q cn fq fr fs ft br bw fu fv fw fx fy fz cq by b bz ca cb cc cr cs ct cu cv bu">Follow</button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="os nx r ab"><a
                  href="https://web.archive.org/web/20191204194207/https://medium.com/p/b7f1a1508e89/responses/show?source=follow_footer--------------------------follow_footer-"
                  class="bi bj bk bl bm bn bo bp bq br bs bt bu bv bw bx" rel="noopener"><span class="ot ou mf">
                    <div class="kw ov cq r ho g"><span class="cg">Write the first response</span></div>
                  </span></a></div>
            </div>
          </div>
          <div class="ow r ox ab">
            <div class="n p">
              <div class="ac ae af ag ah ai aj ak"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="oy r oz pa">
        <section class="da db ak ct r jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh">
          <div class="pb pc nz n et g">
            <div class="pd n et">
              <div class="pe r pf">
                <div class="pg r"><a
                    href="https://web.archive.org/web/20191204194207/https://medium.com/about?autoplay=1&amp;source=post_page-----b7f1a1508e89----------------------"
                    class="bi bj bk bl bm bn bo bp bq br ph pi bu bv pj pk" rel="noopener">
                    <h4 class="pl pm pn by ik bz oq po pp r">Discover
                      <!-- -->Medium
                    </h4>
                  </a></div><span class="by b bz ca cb cc r pq pr">Welcome to a place where words matter. On
                  <!-- -->Medium
                  <!-- -->, smart voices and original ideas take center stage - with no ads in sight.
                  <!-- --> <a
                    href="https://web.archive.org/web/20191204194207/https://medium.com/about?autoplay=1&amp;source=post_page-----b7f1a1508e89----------------------"
                    class="bi bj bk bl bm bn bo bp bq br bu bv pj pk ps" rel="noopener">Watch</a>
                </span>
              </div>
              <div class="pe r pf">
                <div class="pt r"><a
                    href="https://web.archive.org/web/20191204194207/https://medium.com/topics?source=post_page-----b7f1a1508e89----------------------"
                    class="bi bj bk bl bm bn bo bp bq br ph pi bu bv pj pk" rel="noopener">
                    <h4 class="pl pm pn by ik bz oq po pp r">Make
                      <!-- -->Medium
                      <!-- --> yours
                    </h4>
                  </a></div><span class="by b bz ca cb cc r pq pr">Follow all the topics you care about, and we’ll
                  deliver the best stories for you to your homepage and inbox.
                  <!-- --> <a
                    href="https://web.archive.org/web/20191204194207/https://medium.com/topics?source=post_page-----b7f1a1508e89----------------------"
                    class="bi bj bk bl bm bn bo bp bq br bu bv pj pk ps" rel="noopener">Explore</a>
                </span>
              </div>
              <div class="pe r pf">
                <div class="pg r"><a
                    href="https://web.archive.org/web/20191204194207/https://medium.com/membership?source=post_page-----b7f1a1508e89----------------------"
                    class="bi bj bk bl bm bn bo bp bq br ph pi bu bv pj pk" rel="noopener">
                    <h4 class="pl pm pn by ik bz oq po pp r">Become a member</h4>
                  </a></div><span class="by b bz ca cb cc r pq pr">Get unlimited access to the best stories on
                  <!-- -->Medium
                  <!-- --> — and support writers while you’re at it. Just $5/month.
                  <!-- --> <a
                    href="https://web.archive.org/web/20191204194207/https://medium.com/membership?source=post_page-----b7f1a1508e89----------------------"
                    class="bi bj bk bl bm bn bo bp bq br bu bv pj pk ps" rel="noopener">Upgrade</a>
                </span>
              </div>
            </div>
          </div>
          <div class="n o et"><a class="bi bj bk bl bm bn bo bp bq br ph pi bu bv pj pk" rel="noopener"
              href="/web/20191204194207/https://medium.com/?source=post_page-----b7f1a1508e89----------------------"><svg
                height="22" width="112" viewbox="0 0 111.5 22" class="pm">
                <path
                  d="M56.3 19.5c0 .4 0 .5.3.7l1.5 1.4v.1h-6.5V19c-.7 1.8-2.4 3-4.3 3-3.3 0-5.8-2.6-5.8-7.5 0-4.5 2.6-7.6 6.3-7.6 1.6-.1 3.1.8 3.8 2.4V3.2c0-.3-.1-.6-.3-.7l-1.4-1.4V1l6.5-.8v19.3zm-4.8-.8V9.5c-.5-.6-1.2-.9-1.9-.9-1.6 0-3.1 1.4-3.1 5.7 0 4 1.3 5.4 3 5.4.8.1 1.6-.3 2-1zm9.1 3.1V9.4c0-.3-.1-.6-.3-.7l-1.4-1.5v-.1h6.5v12.5c0 .4 0 .5.3.7l1.4 1.4v.1h-6.5zm-.2-19.2C60.4 1.2 61.5 0 63 0c1.4 0 2.6 1.2 2.6 2.6S64.4 5.3 63 5.3a2.6 2.6 0 0 1-2.6-2.7zm22.5 16.9c0 .4 0 .5.3.7l1.5 1.4v.1h-6.5v-3.2c-.6 2-2.4 3.4-4.5 3.4-2.9 0-4.4-2.1-4.4-6.2 0-1.9 0-4.1.1-6.5 0-.3-.1-.5-.3-.7L67.7 7v.1H74v8c0 2.6.4 4.4 2 4.4.9-.1 1.7-.6 2.1-1.3V9.5c0-.3-.1-.6-.3-.7l-1.4-1.5v-.2h6.5v12.4zm22 2.3c0-.5.1-6.5.1-7.9 0-2.6-.4-4.5-2.2-4.5-.9 0-1.8.5-2.3 1.3.2.8.3 1.7.3 2.5 0 1.8-.1 4.2-.1 6.5 0 .3.1.5.3.7l1.5 1.4v.1H96c0-.4.1-6.5.1-7.9 0-2.7-.4-4.5-2.2-4.5-.9 0-1.7.5-2.2 1.3v9c0 .4 0 .5.3.7l1.4 1.4v.1h-6.5V9.5c0-.3-.1-.6-.3-.7l-1.4-1.5v-.2h6.5v3.1a4.6 4.6 0 0 1 4.6-3.4c2.2 0 3.6 1.2 4.2 3.5.7-2.1 2.7-3.6 4.9-3.5 2.9 0 4.5 2.2 4.5 6.2 0 1.9-.1 4.2-.1 6.5-.1.3.1.6.3.7l1.4 1.4v.1h-6.6zm-81.4-2l1.9 1.9v.1h-9.8v-.1l2-1.9c.2-.2.3-.4.3-.7V7.3c0-.5 0-1.2.1-1.8L11.4 22h-.1L4.5 6.8c-.1-.4-.2-.4-.3-.6v10c-.1.7 0 1.3.3 1.9l2.7 3.6v.1H0v-.1L2.7 18c.3-.6.4-1.3.3-1.9v-11c0-.5-.1-1.1-.5-1.5L.7 1.1V1h7l5.8 12.9L18.6 1h6.8v.1l-1.9 2.2c-.2.2-.3.5-.3.7v15.2c0 .2.1.5.3.6zm7.6-5.9c0 3.8 1.9 5.3 4.2 5.3 1.9.1 3.6-1 4.4-2.7h.1c-.8 3.7-3.1 5.5-6.5 5.5-3.7 0-7.2-2.2-7.2-7.4 0-5.5 3.5-7.6 7.3-7.6 3.1 0 6.4 1.5 6.4 6.2v.8h-8.7zm0-.8h4.3v-.8c0-3.9-.8-4.9-2-4.9-1.4.1-2.3 1.6-2.3 5.7z">
                </path>
              </svg></a><span class="by b bz ca cb cc r pq pr">
              <div class="pu pv n et pw an"><a
                  href="https://web.archive.org/web/20191204194207/https://medium.com/about?autoplay=1&amp;source=post_page-----b7f1a1508e89----------------------"
                  class="bi bj bk bl bm bn bo bp bq br fn bu bv pj pk" rel="noopener">About</a><a
                  href="https://web.archive.org/web/20191204194207/https://help.medium.com/?source=post_page-----b7f1a1508e89----------------------"
                  class="bi bj bk bl bm bn bo bp bq br fn bu bv pj pk" rel="noopener">Help</a><a
                  class="bi bj bk bl bm bn bo bp bq br fn bu bv pj pk" rel="noopener"
                  href="/web/20191204194207/https://medium.com/policy/9db0094a1e0f?source=post_page-----b7f1a1508e89----------------------">Legal</a>
              </div>
            </span></div>
        </section>
      </div>
    </div>
  </div>
</body>

</html>
<!--
     FILE ARCHIVED ON 19:42:07 Dec 04, 2019 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 01:30:26 Feb 23, 2021.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  captures_list: 132.391
  exclusion.robots: 0.37
  exclusion.robots.policy: 0.357
  RedisCDXSource: 2.02
  esindex: 0.016
  LoadShardBlock: 94.043 (3)
  PetaboxLoader3.datanode: 54.885 (4)
  CDXLines.iter: 31.615 (3)
  load_resource: 52.065
  PetaboxLoader3.resolve: 20.617
-->