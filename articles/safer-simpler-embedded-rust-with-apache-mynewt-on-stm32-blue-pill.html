<!doctype html>
<html lang="en">

<head>
  <link rel="stylesheet" type="text/css" href="/_static/css/banner-styles.css?v=bsmaklHF" />
  <link rel="stylesheet" type="text/css" href="/_static/css/iconochive.css?v=qtvMKcIJ" />
  <!-- End Wayback Rewrite JS Include -->
  <title data-rh="true">Safer, Simpler Embedded Rust with Apache Mynewt on STM32 Blue Pill</title>
  <meta data-rh="true" charset="utf-8" />
  <meta data-rh="true" name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1" />
  <meta data-rh="true" name="theme-color" content="#000000" />
  <meta data-rh="true" name="twitter:app:name:iphone" content="Medium" />
  <meta data-rh="true" name="twitter:app:id:iphone" content="828256236" />
  <meta data-rh="true" property="al:ios:app_name" content="Medium" />
  <meta data-rh="true" property="al:ios:app_store_id" content="828256236" />
  <meta data-rh="true" property="al:android:package" content="com.medium.reader" />
  <meta data-rh="true" property="fb:app_id" content="542599432471018" />
  <meta data-rh="true" property="og:site_name" content="Medium" />
  <meta data-rh="true" property="og:type" content="article" />
  <meta data-rh="true" property="article:published_time" content="2019-08-17T17:16:02.949Z" />
  <meta data-rh="true" name="title" content="Safer, Simpler Embedded Rust with Apache Mynewt on STM32 Blue Pill" />
  <meta data-rh="true" property="og:title"
    content="Safer, Simpler Embedded Rust with Apache Mynewt on STM32 Blue Pill" />
  <meta data-rh="true" property="twitter:title"
    content="Safer, Simpler Embedded Rust with Apache Mynewt on STM32 Blue Pill" />
  <meta data-rh="true" name="twitter:site" content="@Medium" />
  <meta data-rh="true" name="twitter:app:url:iphone" content="medium://p/d8fcb41969ac" />
  <meta data-rh="true" property="al:android:url" content="medium://p/d8fcb41969ac" />
  <meta data-rh="true" property="al:ios:url" content="medium://p/d8fcb41969ac" />
  <meta data-rh="true" property="al:android:app_name" content="Medium" />
  <meta data-rh="true" name="description"
    content=" Declarative and Procedural Macros (plus bindgen and tips for Visual Studio Code) to protect Embedded Rust coders from stumbling into embedded traps What’s great about Apache Mynewt? Today Mynewt…" />
  <meta data-rh="true" property="og:description"
    content="Declarative and Procedural Macros (plus bindgen and tips for Visual Studio Code) to protect Embedded Rust coders" />
  <meta data-rh="true" property="twitter:description"
    content="Declarative and Procedural Macros (plus bindgen and tips for Visual Studio Code) to protect Embedded Rust coders" />
  <meta data-rh="true" property="og:url"
    content="https://web.archive.org/web/20191204194043/https://medium.com/@ly.lee/safer-simpler-embedded-rust-with-apache-mynewt-on-stm32-blue-pill-d8fcb41969ac" />
  <meta data-rh="true" property="al:web:url"
    content="https://medium.com/@ly.lee/safer-simpler-embedded-rust-with-apache-mynewt-on-stm32-blue-pill-d8fcb41969ac" />
  <meta data-rh="true" property="og:image"
    content="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/1200/1*rx5uTlvZn3RWW_MOgEtd_w.png" />
  <meta data-rh="true" name="twitter:image:src"
    content="https://miro.medium.com/max/1200/1*rx5uTlvZn3RWW_MOgEtd_w.png" />
  <meta data-rh="true" name="twitter:card" content="summary_large_image" />
  <meta data-rh="true" property="article:author" content="https://medium.com/@ly.lee" />
  <meta data-rh="true" name="twitter:creator" content="@MisterTechBlog" />
  <meta data-rh="true" name="author" content="Lup Yuen Lee 李立源" />
  <meta data-rh="true" name="robots" content="index,follow" />
  <meta data-rh="true" name="referrer" content="unsafe-url" />
  <meta data-rh="true" name="twitter:label1" value="Reading time" />
  <meta data-rh="true" name="twitter:data1" value="18 min read" />
  <meta data-rh="true" name="parsely-post-id" content="d8fcb41969ac" />
  <link data-rh="true" rel="publisher" href="https://plus.google.com/103654360130207659246" />
  <link data-rh="true" rel="search" type="application/opensearchdescription+xml" title="Medium"
    href="/web/20191204194043/https://medium.com/osd.xml" />
  <link data-rh="true" rel="apple-touch-icon" sizes="152x152"
    href="https://web.archive.org/web/20191204194043im_/https://cdn-images-1.medium.com/fit/c/152/152/1*8I-HPL0bfoIzGied-dzOvA.png" />
  <link data-rh="true" rel="apple-touch-icon" sizes="120x120"
    href="https://web.archive.org/web/20191204194043im_/https://cdn-images-1.medium.com/fit/c/120/120/1*8I-HPL0bfoIzGied-dzOvA.png" />
  <link data-rh="true" rel="apple-touch-icon" sizes="76x76"
    href="https://web.archive.org/web/20191204194043im_/https://cdn-images-1.medium.com/fit/c/76/76/1*8I-HPL0bfoIzGied-dzOvA.png" />
  <link data-rh="true" rel="apple-touch-icon" sizes="60x60"
    href="https://web.archive.org/web/20191204194043im_/https://cdn-images-1.medium.com/fit/c/60/60/1*8I-HPL0bfoIzGied-dzOvA.png" />
  <link data-rh="true" rel="mask-icon"
    href="https://web.archive.org/web/20191204194043im_/https://cdn-static-1.medium.com/_/fp/icons/monogram-mask.KPLCSFEZviQN0jQ7veN2RQ.svg"
    color="#171717" />
  <link data-rh="true" rel="icon"
    href="https://web.archive.org/web/20191204194043im_/https://cdn-static-1.medium.com/_/fp/icons/favicon-rebrand-medium.3Y6xpZ-0FSdWDnPM3hSBIA.ico" />
  <link data-rh="true" id="glyph_link" rel="stylesheet" type="text/css"
    href="https://web.archive.org/web/20191204194043cs_/https://glyph.medium.com/css/e/sr/latin/e/ssr/latin/e/ssb/latin/m2.css" />
  <link data-rh="true" rel="author" href="https://medium.com/@ly.lee" />
  <link data-rh="true" rel="canonical"
    href="https://web.archive.org/web/20191204194043/https://medium.com/@ly.lee/safer-simpler-embedded-rust-with-apache-mynewt-on-stm32-blue-pill-d8fcb41969ac" />
  <link data-rh="true" rel="alternate"
    href="https://web.archive.org/web/20191204194043/android-app://com.medium.reader/https/medium.com/p/d8fcb41969ac" />
  <style type="text/css" data-fela-rehydration="460" data-fela-type="STATIC">
    html {
      box-sizing: border-box
    }

    *,
    *:before,
    *:after {
      box-sizing: inherit
    }

    body {
      margin: 0;
      padding: 0;
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
      color: rgba(0, 0, 0, 0.8);
      position: relative;
      min-height: 100vh
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    dl,
    dd,
    ol,
    ul,
    menu,
    figure,
    blockquote,
    p,
    pre,
    form {
      margin: 0
    }

    menu,
    ol,
    ul {
      padding: 0;
      list-style: none;
      list-style-image: none
    }

    main {
      display: block
    }

    a {
      color: inherit;
      text-decoration: none
    }

    a,
    button,
    input {
      -webkit-tap-highlight-color: transparent
    }

    img,
    svg {
      vertical-align: middle
    }

    button {
      background: transparent;
      overflow: visible
    }

    button,
    input,
    optgroup,
    select,
    textarea {
      margin: 0
    }
  </style>
  <style type="text/css" data-fela-rehydration="460" data-fela-type="KEYFRAME">
    @-webkit-keyframes k1 {
      0% {
        transform: scale(1);
        opacity: 1
      }

      70% {
        transform: scale(1.4);
        opacity: 0
      }

      100% {
        opacity: 0
      }
    }

    @-moz-keyframes k1 {
      0% {
        transform: scale(1);
        opacity: 1
      }

      70% {
        transform: scale(1.4);
        opacity: 0
      }

      100% {
        opacity: 0
      }
    }

    @keyframes k1 {
      0% {
        transform: scale(1);
        opacity: 1
      }

      70% {
        transform: scale(1.4);
        opacity: 0
      }

      100% {
        opacity: 0
      }
    }
  </style>
  <style type="text/css" data-fela-rehydration="460" data-fela-type="RULE">
    .a {
      font-family: medium-content-sans-serif-font, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif
    }

    .b {
      font-weight: 400
    }

    .c {
      background-color: rgba(255, 255, 255, 1)
    }

    .l {
      height: 100vh
    }

    .m {
      width: 100vw
    }

    .n {
      display: flex
    }

    .o {
      align-items: center
    }

    .p {
      justify-content: center
    }

    .q {
      fill: rgba(0, 0, 0, 0.84)
    }

    .r {
      display: block
    }

    .s {
      position: fixed
    }

    .t {
      top: 0
    }

    .u {
      left: 0
    }

    .v {
      right: 0
    }

    .w {
      z-index: 500
    }

    .x {
      box-shadow: 0 4px 12px 0 rgba(0, 0, 0, 0.05)
    }

    .ai {
      max-width: 1192px
    }

    .aj {
      min-width: 0
    }

    .ak {
      width: 100%
    }

    .al {
      height: 65px
    }

    .ao {
      flex: 1 0 auto
    }

    .ap {
      display: none
    }

    .ar {
      flex: 0 0 auto
    }

    .as {
      visibility: hidden
    }

    .at {
      color: inherit
    }

    .au {
      fill: inherit
    }

    .av {
      font-size: inherit
    }

    .aw {
      border: inherit
    }

    .ax {
      font-family: inherit
    }

    .ay {
      letter-spacing: inherit
    }

    .az {
      font-weight: inherit
    }

    .ba {
      padding: 0
    }

    .bb {
      margin: 0
    }

    .bc:hover {
      cursor: pointer
    }

    .bd:hover {
      color: rgba(0, 0, 0, 0.9)
    }

    .be:hover {
      fill: rgba(0, 0, 0, 0.9)
    }

    .bf:focus {
      outline: none
    }

    .bg:disabled {
      cursor: default
    }

    .bh:disabled {
      color: rgba(0, 0, 0, 0.54)
    }

    .bi:disabled {
      fill: rgba(0, 0, 0, 0.54)
    }

    .bj {
      font-family: medium-content-sans-serif-font, "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", Geneva, Arial, sans-serif
    }

    .bk {
      font-style: normal
    }

    .bl {
      line-height: 20px
    }

    .bm {
      font-size: 15.8px
    }

    .bn {
      letter-spacing: 0px
    }

    .bo {
      color: rgba(0, 0, 0, 0.54)
    }

    .bp {
      fill: rgba(0, 0, 0, 0.54)
    }

    .bq {
      margin-left: 16px
    }

    .br {
      color: rgba(2, 158, 116, 1)
    }

    .bs {
      fill: rgba(3, 168, 124, 1)
    }

    .bt:hover {
      color: rgba(1, 143, 105, 1)
    }

    .bu:hover {
      fill: rgba(2, 158, 116, 1)
    }

    .bv:disabled {
      color: rgba(3, 168, 124, 0.5)
    }

    .bw:disabled {
      fill: rgba(3, 168, 124, 0.5)
    }

    .bx {
      padding: 8px 16px
    }

    .by {
      background: 0
    }

    .bz {
      border-color: rgba(3, 168, 124, 1)
    }

    .ca:hover {
      border-color: rgba(2, 158, 116, 1)
    }

    .cb {
      border-radius: 4px
    }

    .cc {
      border-width: 1px
    }

    .cd {
      border-style: solid
    }

    .ce {
      box-sizing: border-box
    }

    .cf {
      display: inline-block
    }

    .cg {
      text-decoration: none
    }

    .ch {
      margin-bottom: 0px
    }

    .cj {
      padding-left: 24px
    }

    .ck {
      padding-right: 24px
    }

    .cl {
      margin-left: auto
    }

    .cm {
      margin-right: auto
    }

    .cn {
      max-width: 728px
    }

    .co {
      flex-direction: column
    }

    .cp {
      position: absolute
    }

    .cq {
      top: calc(100vh + 100px)
    }

    .cr {
      bottom: calc(100vh + 100px)
    }

    .cs {
      width: 10px
    }

    .ct {
      pointer-events: none
    }

    .cu {
      word-break: break-word
    }

    .cv {
      word-wrap: break-word
    }

    .cw:after {
      display: block
    }

    .cx:after {
      content: ""
    }

    .cy:after {
      clear: both
    }

    .cz {
      clear: both
    }

    .da {
      margin-top: 0px
    }

    .db {
      transition: transform 300ms cubic-bezier(0.2, 0, 0.2, 1)
    }

    .dc {
      cursor: zoom-in
    }

    .dd {
      position: relative
    }

    .de {
      z-index: auto
    }

    .df {
      opacity: 0
    }

    .dg {
      transition: opacity 100ms 400ms
    }

    .dh {
      height: 100%
    }

    .di {
      overflow: hidden
    }

    .dj {
      will-change: transform
    }

    .dk {
      transform: translateZ(0)
    }

    .dl {
      margin: auto
    }

    .dm {
      background-color: rgba(0, 0, 0, 0.05)
    }

    .dn {
      padding-bottom: 44.01402278702892%
    }

    .do {
      filter: blur(20px)
    }

    .dp {
      transform: scale(1.1)
    }

    .dq {
      visibility: visible
    }

    .dr {
      background: rgba(255, 255, 255, 1)
    }

    .ds {
      font-size: 16px
    }

    .dt {
      line-height: 1.4
    }

    .du {
      margin-top: 10px
    }

    .dv {
      text-align: center
    }

    .dy {
      font-weight: 300
    }

    .dz {
      max-width: 680px
    }

    .ea {
      line-height: 1.23
    }

    .eb {
      letter-spacing: 0
    }

    .ec {
      color: rgba(0, 0, 0, 0.84)
    }

    .ed {
      font-family: medium-content-title-font, Georgia, Cambria, "Times New Roman", Times, serif
    }

    .ee {
      font-size: 40px
    }

    .ek {
      margin-bottom: -0.27em
    }

    .el {
      line-height: 48px
    }

    .em {
      margin-top: 32px
    }

    .en {
      justify-content: space-between
    }

    .er {
      width: 48px
    }

    .es {
      height: 48px
    }

    .et {
      flex-direction: row
    }

    .eu {
      width: calc(100% + 25px)
    }

    .ev {
      height: calc(100% + 25px)
    }

    .ew {
      top: 50%
    }

    .ex {
      left: 50%
    }

    .ey {
      transform: translateX(-50%) translateY(-50%)
    }

    .ez {
      border-radius: 50%
    }

    .fa {
      margin-left: 12px
    }

    .fb {
      margin-bottom: 2px
    }

    .fd {
      max-height: 20px
    }

    .fe {
      text-overflow: ellipsis
    }

    .ff {
      display: -webkit-box
    }

    .fg {
      -webkit-line-clamp: 1
    }

    .fh {
      -webkit-box-orient: vertical
    }

    .fi:hover {
      text-decoration: underline
    }

    .fj {
      margin-left: 8px
    }

    .fk {
      padding: 0px 8px
    }

    .fl {
      border-color: rgba(0, 0, 0, 0.54)
    }

    .fm:hover {
      color: rgba(0, 0, 0, 0.97)
    }

    .fn:hover {
      fill: rgba(0, 0, 0, 0.97)
    }

    .fo:hover {
      border-color: rgba(0, 0, 0, 0.84)
    }

    .fp:disabled {
      fill: rgba(0, 0, 0, 0.76)
    }

    .fq:disabled {
      border-color: rgba(0, 0, 0, 0.2)
    }

    .fr:disabled {
      cursor: inherit
    }

    .fs:disabled:hover {
      color: rgba(0, 0, 0, 0.54)
    }

    .ft:disabled:hover {
      fill: rgba(0, 0, 0, 0.76)
    }

    .fu:disabled:hover {
      border-color: rgba(0, 0, 0, 0.2)
    }

    .fv {
      line-height: 18px
    }

    .fw {
      font-size: 15px
    }

    .fx {
      align-items: flex-end
    }

    .gf {
      padding-right: 8px
    }

    .gg {
      margin-right: -6px
    }

    .gh {
      line-height: 1.58
    }

    .gi {
      letter-spacing: -0.004em
    }

    .gj {
      font-family: medium-content-serif-font, Georgia, Cambria, "Times New Roman", Times, serif
    }

    .gu {
      margin-bottom: -0.46em
    }

    .gv {
      font-style: italic
    }

    .gw {
      padding: 2px 4px
    }

    .gx {
      font-size: 75%
    }

    .gy>strong {
      font-family: inherit
    }

    .gz {
      font-family: Menlo, Monaco, "Courier New", Courier, monospace
    }

    .ha {
      max-width: 3024px
    }

    .hg {
      padding-bottom: 133.33333333333334%
    }

    .hh {
      box-shadow: inset 3px 0 0 0 rgba(0, 0, 0, 0.84)
    }

    .hi {
      padding-left: 23px
    }

    .hj {
      margin-left: -20px
    }

    .hk {
      font-weight: 700
    }

    .hl {
      background-repeat: repeat-x
    }

    .hm {
      background-image: linear-gradient(to right, rgba(0, 0, 0, 0.84) 100%, rgba(0, 0, 0, 0.84) 0);
      background-image: url('data:image/svg+xml;utf8,<svg preserveAspectRatio="none" viewBox="0 0 1 1" xmlns="http://www.w3.org/2000/svg"><line x1="0" y1="0" x2="1" y2="1" stroke="rgba(0, 0, 0, 0.84)" /></svg>')
    }

    .hn {
      background-size: 1px 1px
    }

    .ho {
      background-position: 0 1.05em;
      background-position: 0 calc(1em + 1px)
    }

    .hp {
      max-width: 2015px
    }

    .hq {
      padding-bottom: 143.12655086848636%
    }

    .hr {
      font-family: medium-content-slab-serif-font, Georgia, Cambria, "Times New Roman", Times, serif
    }

    .hs {
      font-size: 28px
    }

    .ht {
      border: none
    }

    .hu {
      margin-top: 30px
    }

    .hv:before {
      content: "..."
    }

    .hw:before {
      letter-spacing: 0.6em
    }

    .hx:before {
      text-indent: 0.6em
    }

    .hy:before {
      font-style: italic
    }

    .hz:before {
      line-height: 1.4
    }

    .ia {
      padding-bottom: 117.62566137566137%
    }

    .ig {
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1), inset 0 0 0 1px rgba(0, 0, 0, 0.1)
    }

    .ih {
      max-height: 40px
    }

    .ii {
      -webkit-line-clamp: 2
    }

    .ij {
      padding: 0px
    }

    .iz {
      padding: 16px 20px
    }

    .ja {
      flex: 1 1 auto
    }

    .jc {
      font-weight: 600
    }

    .jd {
      font-size: 18px
    }

    .je {
      margin-top: 8px
    }

    .jf {
      margin-top: 12px
    }

    .jg {
      width: 160px
    }

    .jh {
      background-image: url(https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/320/1*fyYjlV_EPqraAEYuRbst1A.png)
    }

    .ji {
      background-origin: border-box
    }

    .jj {
      background-size: cover
    }

    .jk {
      height: 167px
    }

    .jl {
      background-position: 50% 50%
    }

    .jm {
      max-width: 100%
    }

    .jn {
      box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.1)
    }

    .jo {
      line-height: 1.12
    }

    .jp {
      letter-spacing: -0.022em
    }

    .ka {
      margin-bottom: -0.28em
    }

    .kg {
      padding-bottom: NaN%
    }

    .kh {
      padding: 20px
    }

    .ki {
      background: rgba(0, 0, 0, 0.05)
    }

    .kj {
      overflow-x: auto
    }

    .kk {
      line-height: 1.18
    }

    .kl {
      margin-top: -0.09em
    }

    .km {
      margin-bottom: -0.09em
    }

    .kn {
      white-space: pre-wrap
    }

    .ko {
      padding-bottom: 35.92914438502674%
    }

    .kp {
      max-width: 4032px
    }

    .kq {
      padding-bottom: 75%
    }

    .kr {
      max-width: 2969px
    }

    .ks {
      padding-bottom: 131.02054563826204%
    }

    .kt {
      background-image: url(https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/320/0*rC2B1raThh__pZbR)
    }

    .ku {
      padding-bottom: 124.0079365079365%
    }

    .kv {
      border-width: 2px
    }

    .kw {
      border-color: rgba(255, 255, 255, 1)
    }

    .kx {
      float: left
    }

    .ky {
      margin-left: -150px
    }

    .kz {
      margin-right: 30px
    }

    .la {
      width: 75%
    }

    .lb {
      padding-bottom: 10px
    }

    .lg {
      margin-bottom: 16px
    }

    .lh {
      padding-bottom: 52.111449717022204%
    }

    .ln {
      padding-bottom: 59.223706176961606%
    }

    .lo {
      padding-bottom: 56.206088992974244%
    }

    .lx {
      max-width: 1800px
    }

    .ly {
      padding-bottom: 2.7777777777777777%
    }

    .lz {
      max-width: 456px
    }

    .me {
      padding-bottom: 45.17543859649123%
    }

    .mf {
      max-width: 594px
    }

    .mg {
      padding-bottom: 27.60942760942761%
    }

    .mh {
      max-width: 5134px
    }

    .mi {
      padding-bottom: 5px
    }

    .mj {
      padding-top: 5px
    }

    .mk {
      padding-bottom: 67.82236073237242%
    }

    .ml {
      background-image: url(https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/320/1*cWkz4VgkkdnGOdTMoAxcmQ.png)
    }

    .mo {
      max-width: 2992px
    }

    .mp {
      will-change: opacity
    }

    .mq {
      top: calc(65px + 54px + 40px)
    }

    .mt {
      width: 131px
    }

    .mu {
      padding-top: 28px
    }

    .mv {
      margin-bottom: 19px
    }

    .mw {
      margin-left: -5px
    }

    .mx {
      margin-right: 5px
    }

    .my {
      outline: 0
    }

    .mz {
      border: 0
    }

    .na {
      user-select: none
    }

    .nb {
      cursor: pointer
    }

    .nc>svg {
      pointer-events: none
    }

    .nd:active {
      border-style: none
    }

    .ne {
      -webkit-user-select: none
    }

    .nf {
      fill: rgba(0, 0, 0, 0.76)
    }

    .ng:focus {
      fill: rgba(0, 0, 0, 0.54)
    }

    .nh:hover {
      fill: rgba(0, 0, 0, 0.54)
    }

    .ni {
      margin-top: 5px
    }

    .nj button {
      text-align: left
    }

    .nk {
      width: 188px
    }

    .nl {
      transform: translateX(406px)
    }

    .nm {
      top: calc(65px + 54px + 14px)
    }

    .no {
      margin-top: 40px
    }

    .np {
      flex-wrap: wrap
    }

    .nq {
      margin-top: 25px
    }

    .nr {
      list-style-type: none
    }

    .ns {
      margin-right: 8px
    }

    .nt {
      margin-bottom: 8px
    }

    .nu {
      border-radius: 3px
    }

    .nv {
      padding: 5px 10px
    }

    .nw {
      line-height: 22px
    }

    .nx {
      margin-top: 15px
    }

    .ny {
      margin-right: 16px
    }

    .nz {
      border: 1px solid rgba(0, 0, 0, 0.1)
    }

    .oa {
      height: 60px
    }

    .ob {
      width: 60px
    }

    .oo:hover {
      border-color: rgba(0, 0, 0, 0.54)
    }

    .op:active {
      border-style: solid
    }

    .oq {
      z-index: 2
    }

    .os {
      padding-top: 32px
    }

    .ot {
      border-top: 1px solid rgba(0, 0, 0, 0.1)
    }

    .ou {
      margin-bottom: 25px
    }

    .ov {
      margin-bottom: 32px
    }

    .ow {
      min-height: 80px
    }

    .pb {
      width: 80px
    }

    .pc {
      height: 80px
    }

    .pd {
      padding-left: 102px
    }

    .pf {
      text-transform: uppercase
    }

    .pg {
      letter-spacing: 0.05em
    }

    .ph {
      margin-bottom: 6px
    }

    .pi {
      line-height: 36px
    }

    .pj {
      padding: 4px 12px
    }

    .pk {
      max-width: 555px
    }

    .pl {
      max-width: 450px
    }

    .pm {
      line-height: 24px
    }

    .po {
      padding-top: 25px
    }

    .pp {
      color: rgba(0, 0, 0, 0.76)
    }

    .pq {
      opacity: 1
    }

    .pr {
      border: 1px solid rgba(3, 168, 124, 1)
    }

    .ps {
      margin-top: 64px
    }

    .pt {
      background-color: rgba(0, 0, 0, 0.02)
    }

    .pu {
      padding: 60px 0
    }

    .pv {
      background-color: rgba(0, 0, 0, 0.9)
    }

    .px {
      padding-bottom: 48px
    }

    .py {
      border-bottom: 1px solid rgba(255, 255, 255, 0.54)
    }

    .pz {
      margin: 0 -12px
    }

    .qa {
      margin: 0 12px
    }

    .qb {
      flex: 1 1 0
    }

    .qc {
      padding-bottom: 12px
    }

    .qd:hover {
      color: rgba(255, 255, 255, 0.99)
    }

    .qe:hover {
      fill: rgba(255, 255, 255, 0.99)
    }

    .qf:disabled {
      color: rgba(255, 255, 255, 0.7)
    }

    .qg:disabled {
      fill: rgba(255, 255, 255, 0.7)
    }

    .qh {
      color: rgba(255, 255, 255, 0.98)
    }

    .qi {
      fill: rgba(255, 255, 255, 0.98)
    }

    .qj {
      text-align: inherit
    }

    .qk {
      font-size: 21.6px
    }

    .ql {
      letter-spacing: -0.32px
    }

    .qm {
      color: rgba(255, 255, 255, 0.7)
    }

    .qn {
      fill: rgba(255, 255, 255, 0.7)
    }

    .qo {
      text-decoration: underline
    }

    .qp {
      padding-bottom: 8px
    }

    .qq {
      padding-top: 8px
    }

    .qr {
      width: 200px
    }
  </style>
  <style type="text/css" data-fela-rehydration="460" data-fela-type="RULE" media="all and (min-width: 1080px)">
    .d {
      display: none
    }

    .ah {
      margin: 0 64px
    }

    .ej {
      margin-top: 0.78em
    }

    .ge {
      margin-left: 30px
    }

    .gs {
      font-size: 21px
    }

    .gt {
      margin-top: 2em
    }

    .hf {
      margin-top: 56px
    }

    .if {
      margin-top: 32px
    }

    .iw {
      padding-left: 64px
    }

    .ix {
      padding-right: 64px
    }

    .iy {
      max-width: 1320px
    }

    .jy {
      font-size: 34px
    }

    .jz {
      margin-top: 1.25em
    }

    .kf {
      margin-top: 0.86em
    }

    .lm {
      margin-top: 1.95em
    }

    .lw {
      max-width: 1192px
    }

    .mn {
      margin-top: 0px
    }
  </style>
  <style type="text/css" data-fela-rehydration="460" data-fela-type="RULE" media="all and (max-width: 1079.98px)">
    .e {
      display: none
    }

    .dw {
      margin-left: auto
    }

    .dx {
      text-align: center
    }

    .gd {
      margin-left: 30px
    }

    .it {
      padding-left: 64px
    }

    .iu {
      padding-right: 64px
    }

    .iv {
      max-width: 1080px
    }

    .ma {
      float: none
    }

    .mb {
      margin-left: 0
    }

    .mc {
      margin-right: 0
    }

    .md {
      width: 100%
    }
  </style>
  <style type="text/css" data-fela-rehydration="460" data-fela-type="RULE" media="all and (max-width: 903.98px)">
    .f {
      display: none
    }

    .gc {
      margin-left: 30px
    }

    .iq {
      padding-left: 48px
    }

    .ir {
      padding-right: 48px
    }

    .is {
      max-width: 904px
    }

    .lc {
      float: none
    }

    .ld {
      margin-left: 0
    }

    .le {
      margin-right: 0
    }

    .lf {
      width: 100%
    }
  </style>
  <style type="text/css" data-fela-rehydration="460" data-fela-type="RULE" media="all and (max-width: 727.98px)">
    .g {
      display: none
    }

    .am {
      height: 56px
    }

    .an {
      display: flex
    }

    .aq {
      display: block
    }

    .ci {
      margin-bottom: 0px
    }

    .ep {
      margin-top: 32px
    }

    .eq {
      flex-direction: column-reverse
    }

    .ga {
      margin-bottom: 30px
    }

    .gb {
      margin-left: 0px
    }

    .in {
      padding-left: 24px
    }

    .io {
      padding-right: 24px
    }

    .ip {
      max-width: 728px
    }

    .jb {
      padding: 10px 12px 10px
    }

    .ox {
      margin-bottom: 24px
    }

    .oy {
      align-items: center
    }

    .oz {
      width: 102px
    }

    .pa {
      position: relative
    }

    .pe {
      padding-left: 0
    }

    .pn {
      margin-top: 24px
    }

    .pw {
      padding: 32px 0
    }

    .qs {
      width: 140px
    }
  </style>
  <style type="text/css" data-fela-rehydration="460" data-fela-type="RULE" media="all and (max-width: 551.98px)">
    .h {
      display: none
    }

    .ac {
      margin: 0 24px
    }

    .ef {
      margin-top: 0.39em
    }

    .eo {
      margin-top: 32px
    }

    .fc {
      margin-bottom: 0px
    }

    .fy {
      margin-bottom: 30px
    }

    .fz {
      margin-left: 0px
    }

    .gk {
      font-size: 18px
    }

    .gl {
      margin-top: 1.56em
    }

    .hb {
      margin-top: 40px
    }

    .ib {
      margin-top: 24px
    }

    .ik {
      padding-left: 24px
    }

    .il {
      padding-right: 24px
    }

    .im {
      max-width: 552px
    }

    .jq {
      font-size: 30px
    }

    .jr {
      margin-top: 0.93em
    }

    .kb {
      margin-top: 0.67em
    }

    .li {
      margin-top: 1.2em
    }

    .lp {
      margin: 0
    }

    .lq {
      max-width: 100%
    }
  </style>
  <style type="text/css" data-fela-rehydration="460" data-fela-type="RULE"
    media="all and (min-width: 904px) and (max-width: 1079.98px)">
    .i {
      display: none
    }

    .ag {
      margin: 0 64px
    }

    .ei {
      margin-top: 0.78em
    }

    .gq {
      font-size: 21px
    }

    .gr {
      margin-top: 2em
    }

    .he {
      margin-top: 56px
    }

    .ie {
      margin-top: 32px
    }

    .jw {
      font-size: 34px
    }

    .jx {
      margin-top: 1.25em
    }

    .ke {
      margin-top: 0.86em
    }

    .ll {
      margin-top: 1.95em
    }

    .lv {
      max-width: 1192px
    }

    .mm {
      margin-top: 0px
    }
  </style>
  <style type="text/css" data-fela-rehydration="460" data-fela-type="RULE"
    media="all and (min-width: 728px) and (max-width: 903.98px)">
    .j {
      display: none
    }

    .af {
      margin: 0 48px
    }

    .eh {
      margin-top: 0.78em
    }

    .go {
      font-size: 21px
    }

    .gp {
      margin-top: 2em
    }

    .hd {
      margin-top: 56px
    }

    .id {
      margin-top: 32px
    }

    .ju {
      font-size: 34px
    }

    .jv {
      margin-top: 1.25em
    }

    .kd {
      margin-top: 0.86em
    }

    .lk {
      margin-top: 1.95em
    }

    .lt {
      margin: 0
    }

    .lu {
      max-width: 100%
    }
  </style>
  <style type="text/css" data-fela-rehydration="460" data-fela-type="RULE"
    media="all and (min-width: 552px) and (max-width: 727.98px)">
    .k {
      display: none
    }

    .ae {
      margin: 0 24px
    }

    .eg {
      margin-top: 0.39em
    }

    .gm {
      font-size: 18px
    }

    .gn {
      margin-top: 1.56em
    }

    .hc {
      margin-top: 40px
    }

    .ic {
      margin-top: 24px
    }

    .js {
      font-size: 30px
    }

    .jt {
      margin-top: 0.93em
    }

    .kc {
      margin-top: 0.67em
    }

    .lj {
      margin-top: 1.2em
    }

    .lr {
      margin: 0
    }

    .ls {
      max-width: 100%
    }
  </style>
  <style type="text/css" data-fela-rehydration="460" data-fela-type="RULE" media="print">
    .ab {
      display: none
    }
  </style>
  <style type="text/css" data-fela-rehydration="460" data-fela-type="RULE"
    media="(prefers-reduced-motion: no-preference)">
    .y {
      transition: transform 300ms ease
    }

    .z {
      will-change: transform
    }

    .mr {
      transition: opacity 200ms
    }

    .oc {
      transition: border-color 150ms ease
    }

    .od::before {
      background:
        radial-gradient(circle, rgba(0, 0, 0, 0.84) 60%, transparent 70%)
    }

    .oe::before {
      border-radius: 50%
    }

    .of::before {
      content: ""
    }

    .og::before {
      display: block
    }

    .oh::before {
      z-index: 0
    }

    .oi::before {
      left: 0
    }

    .oj::before {
      height: 100%
    }

    .ok::before {
      position: absolute
    }

    .ol::before {
      top: 0
    }

    .om::before {
      width: 100%
    }

    .on:hover::before {
      animation: k1 2000ms infinite cubic-bezier(.1, .12, .25, 1)
    }

    .or {
      transition: fill 200ms ease
    }
  </style>
  <style type="text/css" data-fela-rehydration="460" data-fela-type="RULE" media="all and (max-width: 1198px)">
    .ms {
      display: none
    }
  </style>
  <style type="text/css" data-fela-rehydration="460" data-fela-type="RULE" media="all and (max-width: 1230px)">
    .nn {
      display: none
    }
  </style>
</head>

<body>
  <!-- BEGIN WAYBACK TOOLBAR INSERT -->
  <style type="text/css">
    body {
      margin-top: 0 !important;
      padding-top: 0 !important;
      /*min-width:800px !important;*/
    }
  </style>
  <div id="wm-ipp-base" lang="en" style="display:none;direction:ltr;">
    <div id="wm-ipp" style="position:fixed;left:0;top:0;right:0;">
      <div id="wm-ipp-inside">
        <div style="position:relative;">
          <div id="wm-logo" style="float:left;width:110px;padding-top:12px;">
            <a href="/web/" title="Wayback Machine home page"><img
                src="/_static/images/toolbar/wayback-toolbar-logo-200.png"
                srcset="/_static/images/toolbar/wayback-toolbar-logo-100.png, /_static/images/toolbar/wayback-toolbar-logo-150.png 1.5x, /_static/images/toolbar/wayback-toolbar-logo-200.png 2x"
                alt="Wayback Machine" style="width:100px" border="0" /></a>
          </div>
          <div class="r" style="float:right;">
            <div id="wm-btns" style="text-align:right;height:25px;">
              <div id="wm-save-snapshot-success">success</div>
              <div id="wm-save-snapshot-fail">fail</div>
              <a id="wm-save-snapshot-open" href="#" title="Share via My Web Archive">
                <span class="iconochive-web"></span>
              </a>
              <a href="https://archive.org/account/login.php" title="Sign In" id="wm-sign-in">
                <span class="iconochive-person"></span>
              </a>
              <span id="wm-save-snapshot-in-progress" class="iconochive-web"></span>
              <a href="http://faq.web.archive.org/" title="Get some help using the Wayback Machine"
                style="top:-6px;"><span class="iconochive-question"
                  style="color:rgb(87,186,244);font-size:160%;"></span></a>
              <a id="wm-tb-close" href="#close" onclick="__wm.h(event);return false;" style="top:-2px;"
                title="Close the toolbar"><span class="iconochive-remove-circle"
                  style="color:#888888;font-size:240%;"></span></a>
            </div>
            <div id="wm-share">
              <a href="/web/20191204194043/http://web.archive.org/screenshot/https://medium.com/@ly.lee/safer-simpler-embedded-rust-with-apache-mynewt-on-stm32-blue-pill-d8fcb41969ac?source=friends_link&sk=16a27a4b9910aadcfcb9881c02d84adc"
                id="wm-screenshot" title="screenshot">
                <span class="wm-icon-screen-shot"></span>
              </a>
              <a id="wm-share-facebook" href="#"
                data-url="https://web.archive.org/web/20191204194043/https://medium.com/@ly.lee/safer-simpler-embedded-rust-with-apache-mynewt-on-stm32-blue-pill-d8fcb41969ac?source=friends_link&amp;sk=16a27a4b9910aadcfcb9881c02d84adc"
                title="Share on Facebook" style="margin-right:5px;" target="_blank"><span class="iconochive-facebook"
                  style="color:#3b5998;font-size:160%;"></span></a>
              <a id="wm-share-twitter" href="#"
                data-url="https://web.archive.org/web/20191204194043/https://medium.com/@ly.lee/safer-simpler-embedded-rust-with-apache-mynewt-on-stm32-blue-pill-d8fcb41969ac?source=friends_link&amp;sk=16a27a4b9910aadcfcb9881c02d84adc"
                title="Share on Twitter" style="margin-right:5px;" target="_blank"><span class="iconochive-twitter"
                  style="color:#1dcaff;font-size:160%;"></span></a>
            </div>
          </div>
          <table class="c" style="">
            <tbody>
              <tr>
                <td class="u" colspan="2">
                  <form target="_top" method="get" action="/web/submit" name="wmtb" id="wmtb"><input type="text"
                      name="url" id="wmtbURL"
                      value="https://medium.com/@ly.lee/safer-simpler-embedded-rust-with-apache-mynewt-on-stm32-blue-pill-d8fcb41969ac?source=friends_link&sk=16a27a4b9910aadcfcb9881c02d84adc"
                      onfocus="this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input
                      type="hidden" name="date" value="20191204194043" /><input type="submit" value="Go" /></form>
                </td>
                <td class="n" rowspan="2" style="width:110px;">
                  <table>
                    <tbody>
                      <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
                      <tr class="m">
                        <td class="b" nowrap="nowrap">Nov</td>
                        <td class="c" id="displayMonthEl" title="You are here: 19:40:43 Dec 04, 2019">DEC</td>
                        <td class="f" nowrap="nowrap">Jan</td>
                      </tr>
                      <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
                      <tr class="d">
                        <td class="b" nowrap="nowrap"><img src="/_static/images/toolbar/wm_tb_prv_off.png"
                            alt="Previous capture" width="14" height="16" border="0" /></td>
                        <td class="c" id="displayDayEl" style="width:34px;font-size:24px;white-space:nowrap;"
                          title="You are here: 19:40:43 Dec 04, 2019">04</td>
                        <td class="f" nowrap="nowrap"><img src="/_static/images/toolbar/wm_tb_nxt_off.png"
                            alt="Next capture" width="14" height="16" border="0" /></td>
                      </tr>
                      <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
                      <tr class="y">
                        <td class="b" nowrap="nowrap">2018</td>
                        <td class="c" id="displayYearEl" title="You are here: 19:40:43 Dec 04, 2019">2019</td>
                        <td class="f" nowrap="nowrap">2020</td>
                      </tr>
                    </tbody>
                  </table>
                </td>
              </tr>
              <tr>
                <td class="s">
                  <div id="wm-nav-captures">
                    <a class="t"
                      href="/web/20191204194043*/https://medium.com/@ly.lee/safer-simpler-embedded-rust-with-apache-mynewt-on-stm32-blue-pill-d8fcb41969ac?source=friends_link&sk=16a27a4b9910aadcfcb9881c02d84adc"
                      title="See a list of every capture for this URL">1 capture</a>
                    <div class="r" title="Timespan for captures of this URL">04 Dec 2019</div>
                  </div>
                </td>
                <td class="k">
                  <a href="" id="wm-graph-anchor">
                    <div id="wm-ipp-sparkline" title="Explore captures for this URL" style="position: relative">
                      <canvas id="wm-sparkline-canvas" width="650" height="27" border="0"></canvas>
                    </div>
                  </a>
                </td>
              </tr>
            </tbody>
          </table>
          <div style="position:absolute;bottom:0;right:2px;text-align:right;">
            <a id="wm-expand" class="wm-btn wm-closed" href="#expand" onclick="__wm.ex(event);return false;"><span
                id="wm-expand-icon" class="iconochive-down-solid"></span> <span style="font-size:80%">About this
                capture</span></a>
          </div>
        </div>
        <div id="wm-capinfo" style="border-top:1px solid #777;display:none; overflow: hidden">
          <div id="wm-capinfo-collected-by">
            <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center">COLLECTED BY</div>
            <div style="padding:3px;position:relative" id="wm-collected-by-content">
              <div style="display:inline-block;vertical-align:top;width:50%;">
                <span class="c-logo"
                  style="background-image:url(https://archive.org/services/img/ArchiveIt-Partner-1028);"></span>
                Organization: <a style="color:#33f;" href="https://archive.org/details/ArchiveIt-Partner-1028"
                  target="_new"><span class="wm-title">Mark Graham&#39;s Archive-IT Collections</span></a>
                <div style="max-height:75px;overflow:hidden;position:relative;">
                  <div
                    style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);">
                  </div>
                  This is a set of web collections curated by Mark Graham using the <a
                    href="http://archive-it.org">Archive-IT</a> service of the <a href="http//archive.org">Internet
                    Archive.</a>
                  <br>
                  <br>
                  They include web captures of the ISKME.org website as well as captures from sites hosted by IGC.org.
                  <br>
                  <br>
                  <br><br>
                  These web captures are available to the general public.
                  <br>
                  <br>
                  For more information about this collection please feel free to contact Mark via <a
                    href="mailto:mark@archive.org?Subject=Question%20about%20you%20Archive-IT%20Collection"
                    target="_top">Send Mail</a>
                </div>
              </div>
              <div style="display:inline-block;vertical-align:top;width:49%;">
                <span class="c-logo"
                  style="background-image:url(https://archive.org/services/img/ArchiveIt-Collection-8332)"></span>
                <div>Collection: <a style="color:#33f;" href="https://archive.org/details/ArchiveIt-Collection-8332"
                    target="_new"><span class="wm-title">General Crawls</span></a></div>
                <div style="max-height:75px;overflow:hidden;position:relative;">
                  <div
                    style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);">
                  </div>
                  Archive-It Partner 1028: Mark Graham - Collection 8332: General Crawls
                </div>
              </div>
            </div>
          </div>
          <div id="wm-capinfo-timestamps">
            <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center"
              title="Timestamps for the elements of this page">TIMESTAMPS</div>
            <div>
              <div id="wm-capresources" style="margin:0 5px 5px 5px;max-height:250px;overflow-y:scroll !important">
              </div>
              <div id="wm-capresources-loading" style="text-align:left;margin:0 20px 5px 5px;display:none"><img
                  src="/_static/images/loading.gif" alt="loading" /></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="donato" style="position:relative;width:100%;">
    <div id="donato-base">
      <iframe id="donato-if"
        src="https://archive.org/includes/donate.php?as_page=1&amp;platform=wb&amp;referer=https%3A//web.archive.org/web/20191204194043/https%3A//medium.com/%2540ly.lee/safer-simpler-embedded-rust-with-apache-mynewt-on-stm32-blue-pill-d8fcb41969ac%3Fsource%3Dfriends_link%26sk%3D16a27a4b9910aadcfcb9881c02d84adc"
        scrolling="no" frameborder="0" style="width:100%; height:100%">
      </iframe>
    </div>
  </div>
  <!-- END WAYBACK TOOLBAR INSERT -->
  <div id="root">
    <div class="a b c">
      <article>
        <section class="cj ck cl cm ak cn ce n co"></section><span class="r"></span>
        <div>
          <div class="cp u cq cr cs ct"></div>
          <section class="cu cv cw cx cy">
            <div class="cz ak">
              <figure class="da cz ak paragraph-image">
                <div class="db dc dd de ak">
                  <div class="dl r dd dm">
                    <div class="dn r">
                      <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                          src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/60/1*rx5uTlvZn3RWW_MOgEtd_w.png?q=20"
                          width="5705" height="2511" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                        width="5705" height="2511" role="presentation" /><noscript><img class="cp t u dh ak"
                          src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/11410/1*rx5uTlvZn3RWW_MOgEtd_w.png"
                          width="5705" height="2511" role="presentation" /></noscript>
                    </div>
                  </div>
                </div>
                <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Article Roadmap: From JSON parsing to bindgen to
                  Declarative and Procedural Macros and how to debug them</figcaption>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <div>
                  <div id="cf95" class="ea eb ec bk ed b ee ef eg eh ei ej ek">
                    <h1 class="ed b ee el ec">Safer, Simpler Embedded Rust with Apache Mynewt on STM32 Blue Pill</h1>
                  </div>
                  <div class="em">
                    <div class="n en eo ep eq">
                      <div class="o n">
                        <div><a rel="noopener"
                            href="/web/20191204194043/https://medium.com/@ly.lee?source=post_page-----d8fcb41969ac----------------------">
                            <div class="dd er es">
                              <div class="bs n et o p cp eu ev ew ex ey ct"><svg width="57" height="57"
                                  viewbox="0 0 57 57">
                                  <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M28.5 1.2A27.45 27.45 0 0 0 4.06 15.82L3 15.27A28.65 28.65 0 0 1 28.5 0C39.64 0 49.29 6.2 54 15.27l-1.06.55A27.45 27.45 0 0 0 28.5 1.2zM4.06 41.18A27.45 27.45 0 0 0 28.5 55.8a27.45 27.45 0 0 0 24.44-14.62l1.06.55A28.65 28.65 0 0 1 28.5 57 28.65 28.65 0 0 1 3 41.73l1.06-.55z">
                                  </path>
                                </svg></div><img alt="Lup Yuen Lee 李立源" class="r ez es er"
                                src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/fit/c/96/96/1*KGohS3sQaUnr58gc0BIfoQ.jpeg"
                                width="48" height="48" />
                            </div>
                          </a></div>
                        <div class="fa ak r">
                          <div class="n">
                            <div style="flex:1"><span class="bj b bk bl bm bn r ec q">
                                <div class="fb n o fc"><span class="bj dy ds bl di fd fe ff fg fh ec"><a
                                      class="at au av aw ax ay az ba bb bc fi bf bg bh bi" rel="noopener"
                                      href="/web/20191204194043/https://medium.com/@ly.lee?source=post_page-----d8fcb41969ac----------------------">Lup
                                      Yuen Lee 李立源</a></span>
                                  <div class="fj r ar h"><button
                                      class="fk ec q by fl fm fn fo bc bh fp fq fr fs ft fu cb bj b bk fv fw bn cc cd ce cf cg bf">Follow</button>
                                  </div>
                                </div>
                              </span></div>
                          </div><span class="bj b bk bl bm bn r bo bp"><span class="bj dy ds bl di fd fe ff fg fh bo">
                              <div><a class="at au av aw ax ay az ba bb bc fi bf bg bh bi" rel="noopener"
                                  href="/web/20191204194043/https://medium.com/@ly.lee/safer-simpler-embedded-rust-with-apache-mynewt-on-stm32-blue-pill-d8fcb41969ac?source=post_page-----d8fcb41969ac----------------------">Jul
                                  6</a> <!-- -->·
                                <!-- -->
                                <!-- -->18
                                <!-- --> min read
                              </div>
                            </span></span>
                        </div>
                      </div>
                      <div class="n fx fy fz ga gb gc gd ge ab">
                        <div class="n o">
                          <div class="gf r ar"><a
                              href="//web.archive.org/web/20191204194043/https://medium.com/p/d8fcb41969ac/share/twitter?source=post_actions_header---------------------------"
                              class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" target="_blank"
                              rel="noopener"><svg width="29" height="29" class="q">
                                <path
                                  d="M22.05 7.54a4.47 4.47 0 0 0-3.3-1.46 4.53 4.53 0 0 0-4.53 4.53c0 .35.04.7.08 1.05A12.9 12.9 0 0 1 5 6.89a5.1 5.1 0 0 0-.65 2.26c.03 1.6.83 2.99 2.02 3.79a4.3 4.3 0 0 1-2.02-.57v.08a4.55 4.55 0 0 0 3.63 4.44c-.4.08-.8.13-1.21.16l-.81-.08a4.54 4.54 0 0 0 4.2 3.15 9.56 9.56 0 0 1-5.66 1.94l-1.05-.08c2 1.27 4.38 2.02 6.94 2.02 8.3 0 12.86-6.9 12.84-12.85.02-.24 0-.43 0-.65a8.68 8.68 0 0 0 2.26-2.34c-.82.38-1.7.62-2.6.72a4.37 4.37 0 0 0 1.95-2.51c-.84.53-1.81.9-2.83 1.13z">
                                </path>
                              </svg></a></div>
                          <div class="gf r ar"><a
                              href="//web.archive.org/web/20191204194043/https://medium.com/p/d8fcb41969ac/share/linkedIn?source=post_actions_header---------------------------"
                              class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" target="_blank"
                              rel="noopener"><svg width="29" height="29" viewbox="0 0 29 29" fill="none" class="q">
                                <path
                                  d="M5 6.36C5 5.61 5.63 5 6.4 5h16.2c.77 0 1.4.61 1.4 1.36v16.28c0 .75-.63 1.36-1.4 1.36H6.4c-.77 0-1.4-.6-1.4-1.36V6.36z">
                                </path>
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                  d="M10.76 20.9v-8.57H7.89v8.58h2.87zm-1.44-9.75c1 0 1.63-.65 1.63-1.48-.02-.84-.62-1.48-1.6-1.48-.99 0-1.63.64-1.63 1.48 0 .83.62 1.48 1.59 1.48h.01zM12.35 20.9h2.87v-4.79c0-.25.02-.5.1-.7.2-.5.67-1.04 1.46-1.04 1.04 0 1.46.8 1.46 1.95v4.59h2.87v-4.92c0-2.64-1.42-3.87-3.3-3.87-1.55 0-2.23.86-2.61 1.45h.02v-1.24h-2.87c.04.8 0 8.58 0 8.58z"
                                  fill="#fff"></path>
                              </svg></a></div>
                          <div class="gf r ar"><a
                              href="//web.archive.org/web/20191204194043/https://medium.com/p/d8fcb41969ac/share/facebook?source=post_actions_header---------------------------"
                              class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" target="_blank"
                              rel="noopener"><svg width="29" height="29" class="q">
                                <path
                                  d="M23.2 5H5.8a.8.8 0 0 0-.8.8V23.2c0 .44.35.8.8.8h9.3v-7.13h-2.38V13.9h2.38v-2.38c0-2.45 1.55-3.66 3.74-3.66 1.05 0 1.95.08 2.2.11v2.57h-1.5c-1.2 0-1.48.57-1.48 1.4v1.96h2.97l-.6 2.97h-2.37l.05 7.12h5.1a.8.8 0 0 0 .79-.8V5.8a.8.8 0 0 0-.8-.79">
                                </path>
                              </svg></a></div>
                          <div class="gg r ao">
                            <div>
                              <div class="cf"><a
                                  href="https://web.archive.org/web/20191204194043/https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40ly.lee%2Fsafer-simpler-embedded-rust-with-apache-mynewt-on-stm32-blue-pill-d8fcb41969ac&amp;source=post_actions_header--------------------------bookmark_sidebar-"
                                  class="at au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener"><svg width="25"
                                    height="25" viewbox="0 0 25 25">
                                    <path
                                      d="M19 6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14.66h.01c.01.1.05.2.12.28a.5.5 0 0 0 .7.03l5.67-4.12 5.66 4.13a.5.5 0 0 0 .71-.03.5.5 0 0 0 .12-.29H19V6zm-6.84 9.97L7 19.64V6a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v13.64l-5.16-3.67a.49.49 0 0 0-.68 0z"
                                      fill-rule="evenodd"></path>
                                  </svg></a></div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <p id="5422" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">Declarative and
                    Procedural Macros (plus </em><code class="dm gw gx gy gz b"><em class="gv">bindgen</em></code><em
                    class="gv"> and tips for Visual Studio Code) to protect Embedded Rust coders from stumbling into
                    embedded traps</em></p>
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm ha">
                      <div class="dl r dd dm">
                        <div class="hg r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/46/1*HsTY9-Ie90rR9VbZL19Kng.png?q=20"
                              width="3024" height="4032" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="3024" height="4032" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/6048/1*HsTY9-Ie90rR9VbZL19Kng.png"
                              width="3024" height="4032" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <blockquote class="hh hi hj">
                  <p id="c2f6" class="gh gi ec gv gj b gk gl gm gn go gp gq gr gs gt gu">I’m named <strong
                      class="gj hk">MyNewt</strong> not <strong class="gj hk">Mynewt</strong> because my handler is a
                    crazy coder named Lup and this lizard doesn’t speak on behalf of the wonderful <a
                      href="https://web.archive.org/web/20191204194043/https://mynewt.apache.org/latest/index.html"
                      class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Apache Mynewt</a> team</p>
                </blockquote>
                <p id="996d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">What’s great about <a
                    href="https://web.archive.org/web/20191204194043/https://mynewt.apache.org/latest/index.html"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"><strong class="gj hk">Apache
                      Mynewt</strong></a>? Today Mynewt runs on <a
                    href="https://web.archive.org/web/20191204194043/https://mynewt.apache.org/"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">many microcontroller platforms</a>
                  with <a
                    href="https://web.archive.org/web/20191204194043/https://mynewt.apache.org/latest/os/core_os/mynewt_os.html"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">preemptive multitasking</a>. (So
                  it won’t choke when <a class="at cg hl hm hn ho" target="_blank" rel="noopener"
                    href="/web/20191204194043/https://medium.com/@ly.lee/build-your-iot-sensor-network-stm32-blue-pill-nrf24l01-esp8266-apache-mynewt-thethings-io-ca7486523f5d">reading
                    sensors and transmitting data simultaneously</a>.)</p>
                <p id="be21" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Mynewt has drivers for many
                  sensors (like <a
                    href="https://web.archive.org/web/20191204194043/https://github.com/apache/mynewt-core/tree/master/hw/drivers/sensors/bme280"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">BME280</a>), networks (<a
                    href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/tree/master/libs/esp8266"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">ESP8266</a>, <a
                    href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/tree/master/libs/nrf24l01"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">nRF24L01</a>, …) and protocols (<a
                    href="https://web.archive.org/web/20191204194043/https://en.wikipedia.org/wiki/Constrained_Application_Protocol"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">CoAP</a>, <a
                    href="https://web.archive.org/web/20191204194043/https://en.wikipedia.org/wiki/CBOR"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">CBOR</a>, …).</p>
                <p id="9636" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">But Mynewt was <strong
                    class="gj hk">built with C</strong>, which has its problems…</p>
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm hp">
                      <div class="dl r dd dm">
                        <div class="hq r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/42/1*myd6rlZEiboqMsTMGziZQw.png?q=20"
                              width="2015" height="2884" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="2015" height="2884" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/4030/1*myd6rlZEiboqMsTMGziZQw.png"
                              width="2015" height="2884" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <blockquote class="hh hi hj">
                  <p id="b02e" class="gh gi ec gv gj b gk gl gm gn go gp gq gr gs gt gu">The C code appeared in an <a
                      class="at cg hl hm hn ho" target="_blank" rel="noopener"
                      href="/web/20191204194043/https://medium.com/@ly.lee/build-your-iot-sensor-network-stm32-blue-pill-nrf24l01-esp8266-apache-mynewt-thethings-io-ca7486523f5d">earlier
                      article</a> about Mynewt on STM32 Blue Pill</p>
                </blockquote>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm ha">
                      <div class="dl r dd dm">
                        <div class="ia r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/52/1*D3326wVykSqZaoi18FaJdg.png?q=20"
                              width="3024" height="3557" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="3024" height="3557" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/6048/1*D3326wVykSqZaoi18FaJdg.png"
                              width="3024" height="3557" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <blockquote class="hh hi hj">
                  <p id="9726" class="gh gi ec gv gj b gk gl gm gn go gp gq gr gs gt gu"><a
                      href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/src/send_coap.rs#L319-L376"
                      class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">The new Rust code is here</a>.
                    Based on the previous article on Rust and Mynewt…</p>
                </blockquote>
                <div class="ib ic id ie if ig"><a rel="noopener"
                    href="/web/20191204194043/https://medium.com/@ly.lee/hosting-embedded-rust-apps-on-apache-mynewt-with-stm32-blue-pill-c86b119fe5f?source=post_page-----d8fcb41969ac----------------------">
                    <section class="ij cl cm ak ce n ar ik il im in io ip iq ir is it iu iv iw ix iy">
                      <div class="iz n co p ja jb">
                        <h2 class="bj jc jd bl ec">
                          <div class="di ih fe ff ii fh">Hosting Embedded Rust apps on Apache Mynewt with STM32 Blue
                            Pill</div>
                        </h2>
                        <div class="je r">
                          <h3 class="bj dy ds bl bo">
                            <div class="di ih fe ff ii fh">Build IoT devices the smarter, safer way with Rust and Apache
                              Mynewt</div>
                          </h3>
                        </div>
                        <div class="jf r">
                          <h4 class="bj dy fw bl bo">
                            <div class="di ih fe ff ii fh">medium.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="jg r">
                        <div class="jh r ji jj jk jg jl jm jn"></div>
                      </div>
                    </section>
                  </a></div>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="db6f" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Declarative Macros in Rust</h1>
                <p id="6669" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu"><a
                    href="https://web.archive.org/web/20191204194043/https://doc.rust-lang.org/book/ch19-06-macros.html"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Declarative Macros in Rust</a>
                  have the form <code class="dm gw gx gy gz b">( pattern ) =&gt; { substitution }</code></p>
                <p id="2a48" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Here’s a simple Declarative Macro
                  <code class="dm gw gx gy gz b">add_88!()</code> that returns its argument plus 88…</p>
                <figure class="hb hc hd he hf cz">
                 
                  <p><script src="https://gist.github.com/lupyuen/32af6445eb258339fe2363b770b7d099.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a
                      href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/test-rust-macros/blob/master/src/main.rs#L4-L14"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/test-rust-macros/blob/master/src/main.rs#L4-L14</a>
                  </figcaption>
                </figure>
                <p id="ff99" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The Rust macro accepts a single
                  parameter <code class="dm gw gx gy gz b">$e</code>, which should be a valid Rust Expression (denoted
                  by <code class="dm gw gx gy gz b">expr</code>). In C we would code the macro as…</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="10e1" class="kk jp ec bk gz b ds kl km r kn">#define  add_88(e)  ((e) + 88)</span></pre>
                <p id="0c7f" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The Rust and C macro definitions
                  are similar, except that Rust insists on knowing whether the parameter will be an expression (<code
                    class="dm gw gx gy gz b">expr</code>), identifier (<code class="dm gw gx gy gz b">ident</code>),
                  type (<code class="dm gw gx gy gz b">ty</code>), statement (<code
                    class="dm gw gx gy gz b">stmt</code>), code block (<code class="dm gw gx gy gz b">block</code>)… (<a
                    href="https://web.archive.org/web/20191204194043/https://danielkeep.github.io/tlborm/book/mbe-macro-rules.html#captures"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Here’s the whole list</a>)</p>
                <p id="0b0d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">We may provide multiple patterns
                  like this to create an “overloaded function”…</p>
                <figure class="hb hc hd he hf cz">
             
                  <p><script src="https://gist.github.com/lupyuen/321477fd84b6e1fd0a52dea2c8253fe6.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a
                      href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/test-rust-macros/blob/master/src/main.rs#L4-L25"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/test-rust-macros/blob/master/src/main.rs#L4-L25</a>
                  </figcaption>
                </figure>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="315a" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Complex Pattern Matching in
                  Declarative Macros</h1>
                <p id="4fe8" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu">But wait… Rust macros can do so
                  much more because of pattern matching! Here’s a tiny snippet from a Rust macro that parses JSON code
                  (adapted from the <code
                    class="dm gw gx gy gz b"><a href="https://web.archive.org/web/20191204194043/https://crates.io/crates/serde_json" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">serde_json</a></code>
                  library)…</p>
                <figure class="hb hc hd he hf cz">
                  
                  <p><script src="https://gist.github.com/lupyuen/ef92789353dc883c4da72f950e577fb4.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy"><a
                      href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/src/mynewt/macros.rs#L105-L120"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/src/mynewt/macros.rs#L105-L120</a>
                  </figcaption>
                </figure>
                <p id="5ddc" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The pattern looks complicated…
                </p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="d556" class="kk jp ec bk gz b ds kl km r kn">(@$enc:ident <a href="https://web.archive.org/web/20191204194043/http://twitter.com/object" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">@object</a> $obj:ident [$($key:tt)+] ($value:expr) , $($rest:tt)*)</span></pre>
                <p id="a883" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The <code
                    class="dm gw gx gy gz b">parse!()</code> macro is meant to be called with these parameters…</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="f437" class="kk jp ec bk gz b ds kl km r kn">parse!( @json @object context [&quot;device&quot;] (&quot;010203&quot;) , (omitted) )</span></pre>
                <p id="ecd2" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Which is an intermediate step
                  that’s called when encoding our CoAP message in JSON: <code
                    class="dm gw gx gy gz b">coap!(@json { “device”: “010203”, … })</code></p>
                <p id="4409" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The macro parameters are matched
                  against the pattern like this…</p>
              </div>
            </div>
            <div class="cz ak">
              <figure class="hb hc hd he hf cz ak paragraph-image">
                <div class="db dc dd de ak">
                  <div class="dl r dd dm">
                    <div class="ko r">
                      <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                          src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/60/1*aWLhS3tgaWNlvxjkMsdETQ.png?q=20"
                          width="2992" height="1075" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                        width="2992" height="1075" role="presentation" /><noscript><img class="cp t u dh ak"
                          src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/5984/1*aWLhS3tgaWNlvxjkMsdETQ.png"
                          width="2992" height="1075" role="presentation" /></noscript>
                    </div>
                  </div>
                </div>
                <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Matching the parse!() macro parameters with the
                  macro pattern</figcaption>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <p id="a9f0" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">What’s a <strong
                    class="gj hk">Tag</strong>? Think of a Tag as an <code class="dm gw gx gy gz b">enum</code> — an
                  option that specifies how the macro should behave. For the first parameter of the macro we accept the
                  tag <code class="dm gw gx gy gz b">“@json”</code> to indicate that the macro should encode sensor data
                  in JSON format, or <code class="dm gw gx gy gz b">“@cbor”</code> for CBOR format. Tags may be used to
                  implement <a
                    href="https://web.archive.org/web/20191204194043/https://danielkeep.github.io/tlborm/book/pat-internal-rules.html"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">internal rules</a>.</p>
                <p id="e27d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">What’s a <a
                    href="https://web.archive.org/web/20191204194043/https://doc.rust-lang.org/reference/macros-by-example.html#metavariables"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"><strong class="gj hk">Token
                      Tree</strong></a>? It’s one or more Rust tokens that are logically grouped. Here are three
                  examples of Token Trees: <code class="dm gw gx gy gz b">x</code>, <code
                    class="dm gw gx gy gz b">(x + y)</code>, <code
                    class="dm gw gx gy gz b">{ println!(&quot;hi&quot;); }</code>.</p>
                <p id="a905" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The <code
                    class="dm gw gx gy gz b">+</code> and <code class="dm gw gx gy gz b">*</code> operators should be
                  familiar if you have used Regular Expressions. So <code class="dm gw gx gy gz b">$($key:tt)+</code>
                  means the <code class="dm gw gx gy gz b">$key</code> placeholder will be matched to one or more Token
                  Trees (denoted by <code class="dm gw gx gy gz b">tt</code>).</p>
                <p id="8110" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">In the <a
                    href="https://web.archive.org/web/20191204194043/https://gist.github.com/lupyuen/ef92789353dc883c4da72f950e577fb4"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">source code of the macro</a> there
                  are a couple of interesting things…</p>
                <p id="1041" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">1️⃣ <code
                    class="dm gw gx gy gz b">d!(…)</code> is a simple macro we created to dump the parameters of the
                  macro. Useful for debugging.</p>
                <p id="4f6d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">2️⃣ <code
                    class="dm gw gx gy gz b">coap_item_str!(…)</code> is a macro that will generate the JSON or CBOR
                  code for encoding the <code class="dm gw gx gy gz b">key: value</code> entry. The encoding format
                  depends on the first parameter.</p>
                <p id="8552" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">3️⃣ The macro is recursive! Once
                  the rule has encoded the <code class="dm gw gx gy gz b">key: value</code> entry, it continues to
                  encode the rest of the input JSON (<code class="dm gw gx gy gz b">$rest</code>) by calling itself!</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="642e" class="kk jp ec bk gz b ds kl km r kn">parse!( @$enc @object $obj () ($($rest)*) ($($rest)*) )</span></pre>
                <p id="c6c8" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">That’s how our <code
                    class="dm gw gx gy gz b">coap!()</code> macro (<a
                    href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/src/mynewt/macros.rs#L47-L1253"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">complete source code here</a>)
                  recursively parses a JSON document and emits the CoAP encoding. Which makes Rust Declarative Macros
                  very powerful for parsing many types of code recursively. Even <a
                    href="https://web.archive.org/web/20191204194043/https://doc.rust-lang.org/rust-by-example/macros/dsl.html"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"><strong class="gj hk">Domain
                      Specific Languages</strong></a>! Check out the details in the <a
                    href="https://web.archive.org/web/20191204194043/https://danielkeep.github.io/tlborm/book/README.html"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Little Book of Rust Macros</a>.
                </p>
                <blockquote class="hh hi hj">
                  <p id="3b31" class="gh gi ec gv gj b gk gl gm gn go gp gq gr gs gt gu"><em class="bk">🤔</em> You may
                    think… <strong class="gj hk">What’s the cost of embedding Rust code inside a C platform like
                      Mynewt?</strong> Do Rust macros inject a lot more code to make them run on a C platform?</p>
                  <p id="38eb" class="gh gi ec gv gj b gk gl gm gn go gp gq gr gs gt gu">Not at all! <strong
                      class="gj hk">The macros are expanded at compile time</strong>. And the Rust compiler is
                    incredibly clever at pattern matching and type inference. So these macros will take up exactly the
                    same RAM, ROM and CPU resources as the older C code! While keeping the code clear and simple!</p>
                </blockquote>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="27e2" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Two Legged Problems</h1>
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm kp">
                      <div class="dl r dd dm">
                        <div class="kq r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/60/1*8juHTUpQsGCD1QJNcfPZZw.png?q=20"
                              width="4032" height="3024" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="4032" height="3024" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/8064/1*8juHTUpQsGCD1QJNcfPZZw.png"
                              width="4032" height="3024" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm kr">
                      <div class="dl r dd dm">
                        <div class="ks r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/46/1*w2J11VAHZGh73yp2rKVzVw.png?q=20"
                              width="2969" height="3890" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="2969" height="3890" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/5938/1*w2J11VAHZGh73yp2rKVzVw.png"
                              width="2969" height="3890" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="e8c9" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Import C Functions into Rust
                  with bindgen</h1>
                <p id="35ee" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu">We could import a C function into
                  Rust by coding the Rust binding manually (<a class="at cg hl hm hn ho" target="_blank" rel="noopener"
                    href="/web/20191204194043/https://medium.com/@ly.lee/hosting-embedded-rust-apps-on-apache-mynewt-with-stm32-blue-pill-c86b119fe5f">as
                    explained earlier</a>). But writing the Rust bindings by hand for the entire Mynewt API is way too
                  tedious.</p>
                <p id="53ad" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Fortunately we have the <code
                    class="dm gw gx gy gz b"><a href="https://web.archive.org/web/20191204194043/https://rust-lang.github.io/rust-bindgen/" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">bindgen</a></code>
                  tool: It reads a Mynewt C function declaration like this (<code
                    class="dm gw gx gy gz b"><a href="https://web.archive.org/web/20191204194043/https://mynewt.apache.org/latest/os/core_os/task/task.html#c.os_task_init" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">os_task_init</a>()</code>
                  is the Mynewt function for creating background tasks)…</p>
                <figure class="hb hc hd he hf cz">
               
                  <p><script src="https://gist.github.com/lupyuen/2dbcecf3062522ef3c5e182b36a31713.js"></script></p>


                </figure>
                <p id="d8db" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">And produces the Rust binding
                  like this…</p>
                <figure class="hb hc hd he hf cz">
                  
                  <p><script src="https://gist.github.com/lupyuen/450476c651ca7bd65aa534508527e6cc.js"></script></p>


                </figure>
                <p id="83cd" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">We have a <a
                    href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/scripts/gen-bindings.sh"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">script that generates Rust
                    bindings</a> for Mynewt Core API, Sensor API, JSON API and CBOR API.</p>
                <p id="881a" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">There’s still manual tweaking
                  required… In the script we see many whitelisted and blacklisted C functions and types. These were
                  carefully chosen to avoid duplicates across the different APIs.</p>
                <p id="c448" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Rust is self-documenting, so the
                  Rust bindings for Mynewt automatically have documentation. Check out the <strong class="gj hk">Mynewt
                    API Documentation for Rust</strong>…</p>
                <div class="ib ic id ie if ig"><a
                    href="https://web.archive.org/web/20191204194043/https://lupyuen.github.io/stm32bluepill-mynewt-sensor/rust/mylib/mynewt/index.html?source=post_page-----d8fcb41969ac----------------------"
                    rel="noopener nofollow">
                    <section class="ij cl cm ak ce n ar ik il im in io ip iq ir is it iu iv iw ix iy">
                      <div class="iz n co p ja jb">
                        <h2 class="bj jc jd bl ec">
                          <div class="di ih fe ff ii fh">mylib::mynewt - Rust</div>
                        </h2>
                        <div class="je r">
                          <h3 class="bj dy ds bl bo">
                            <div class="di ih fe ff ii fh">API documentation for the Rust `mynewt` mod in crate `mylib`.
                            </div>
                          </h3>
                        </div>
                        <div class="jf r">
                          <h4 class="bj dy fw bl bo">
                            <div class="di ih fe ff ii fh">lupyuen.github.io</div>
                          </h4>
                        </div>
                      </div>
                      <div class="jg r">
                        <div class="kt r ji jj jk jg jl jm jn"></div>
                      </div>
                    </section>
                  </a></div>
                <blockquote class="hh hi hj">
                  <p id="b217" class="gh gi ec gv gj b gk gl gm gn go gp gq gr gs gt gu"><em class="bk">💎</em> Normally
                    <code class="dm gw gx gy gz b">bindgen</code> reads an entire C header file to generate Rust
                    bindings for all functions declared in the file. But Mynewt uses many include folders that will
                    totally confuse <code class="dm gw gx gy gz b">bindgen</code>.</p>
                  <p id="15c3" class="gh gi ec gv gj b gk gl gm gn go gp gq gr gs gt gu">That’s why <a
                      href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/scripts/gen-bindings.sh#L30-L42"
                      class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">the script passes the
                      options</a> <code class="dm gw gx gy gz b">-CC -E -dD</code> to <code
                      class="dm gw gx gy gz b">gcc</code> to create a C file that has all the include files (for that
                    specific API) concatenated into one long source file. Which works great with <code
                      class="dm gw gx gy gz b">bindgen</code>!</p>
                </blockquote>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="2344" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">The Restless bindgen Horde</h1>
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm kp">
                      <div class="dl r dd dm">
                        <div class="ku r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/48/1*arL-I0TiGF9H8n19h4bucA.png?q=20"
                              width="4032" height="5000" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="4032" height="5000" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/8064/1*arL-I0TiGF9H8n19h4bucA.png"
                              width="4032" height="5000" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm ha">
                      <div class="dl r dd dm">
                        <div class="hg r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/46/1*Uural5MulPQjJNx9TUmOxA.png?q=20"
                              width="3024" height="4032" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="3024" height="4032" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/6048/1*Uural5MulPQjJNx9TUmOxA.png"
                              width="3024" height="4032" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm ha">
                      <div class="dl r dd dm">
                        <div class="hg r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/46/1*N15W1MZigKNerGZaSughnQ.png?q=20"
                              width="3024" height="4032" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="3024" height="4032" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/6048/1*N15W1MZigKNerGZaSughnQ.png"
                              width="3024" height="4032" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <p id="f0b4" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Creating the safe wrapper in Rust
                  doesn’t need a lot of manual coding… <strong class="gj hk">Procedural Macros</strong> in Rust can do
                  the job for us automatically! First let’s understand what a Procedural Macro can do…</p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="74c0" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Create a Procedural Macro with
                  syn</h1>
                <p id="3942" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu">Here’s a simple Procedural Macro
                  named <code class="dm gw gx gy gz b">out!()</code> (shown in the pic above) that expands…</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="d7f6" class="kk jp ec bk gz b ds kl km r kn">out!( NETWORK_TASK )</span></pre>
                <p id="b0a1" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">into…</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="c48c" class="kk jp ec bk gz b ds kl km r kn">unsafe { &amp;mut NETWORK_TASK }</span></pre>
                <p id="ee82" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">…because to a C coder starting
                  Rust coding, <code class="dm gw gx gy gz b">unsafe &amp;mut</code> looks doubly intimidating, so we
                  use a macro to declare that <code class="dm gw gx gy gz b">NETWORK_TASK</code> will be modified by the
                  external function, like this: <code class="dm gw gx gy gz b">out!(NETWORK_TASK)</code></p>
                <figure class="hb hc hd he hf cz">
                
                  <p><script src="https://gist.github.com/lupyuen/500da7dd734d7dd9edfd1985675ea110.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a
                      href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L279-L292"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L279-L292</a>
                  </figcaption>
                </figure>
                <p id="505b" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Unlike Declarative Macros,
                  Procedural Macros are coded like a real Rust function. A Procedural Macro simply transforms a stream
                  of Rust source code tokens (<code class="dm gw gx gy gz b">TokenStream</code>) into the expanded
                  tokens, that will be fed back into the Rust compiler after expanding the macro.</p>
                <p id="806e" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><code
                    class="dm gw gx gy gz b">parse_macro_input!()</code> is provided by the <code
                    class="dm gw gx gy gz b"><a href="https://web.archive.org/web/20191204194043/https://docs.rs/syn/0.15.38/syn/index.html" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">syn</a></code><a
                    href="https://web.archive.org/web/20191204194043/https://docs.rs/syn/0.15.38/syn/index.html"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"> library</a> for parsing streams
                  of Rust source code tokens. We can parse any Rust code with it: Expressions, Statement Blocks, <code
                    class="dm gw gx gy gz b">Struct</code> Definitions, <code class="dm gw gx gy gz b">Extern</code>
                  Declarations, … Here we are parsing the input as a Rust Identifier, like a variable or constant name.
                </p>
                <p id="3fb8" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">We use <code
                    class="dm gw gx gy gz b">format!()</code> to create the desired code. Then we parse the code into a
                  <code class="dm gw gx gy gz b">TokenStream</code> and pass it back to the compiler.</p>
                <figure class="hb hc hd he hf cz">
            
                  <p><script src="https://gist.github.com/lupyuen/891a0a0e64d335a3ec33592de4378f06.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy"><a
                      href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L293-L306"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L293-L306</a>
                  </figcaption>
                </figure>
                <p id="a831" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">This <code
                    class="dm gw gx gy gz b">strn!()</code> macro is similar… It expands</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="bca3" class="kk jp ec bk gz b ds kl km r kn">strn!( &quot;network&quot; )</span></pre>
                <p id="9f38" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">into…</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="7823" class="kk jp ec bk gz b ds kl km r kn">&amp;Strn::new( b&quot;network\0&quot; )</span></pre>
                <p id="7084" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The macro code looks similar,
                  except that it parses the input as a Literal String (<code class="dm gw gx gy gz b">LitStr</code>)
                  instead of an Identifier. (And the expansion is different of course.) Why did we create <code
                    class="dm gw gx gy gz b">strn!()</code>?</p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="9805" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">C vs Rust Strings: Null vs
                  Non-Null Terminated</h1>
                <p id="9aef" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu">In the world of Embedded C,
                  strings are simple fixed arrays of ASCII bytes, terminated by a null <code
                    class="dm gw gx gy gz b">00</code> byte. Rust strings are more complicated — A Rust string is a <a
                    href="https://web.archive.org/web/20191204194043/https://doc.rust-lang.org/src/alloc/string.rs.html#283-285"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Vector of bytes</a>. A <a
                    href="https://web.archive.org/web/20191204194043/https://doc.rust-lang.org/std/vec/struct.Vec.html"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Rust Vector</a> is resizable, so
                  the vector uses an internal counter to remember its length. <strong class="gj hk">Strings in Rust are
                    not terminated by the null byte.</strong></p>
                <p id="073d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">This causes problems when
                  Embedded Rust coders call Mynewt APIs, drivers and other C functions… 1️⃣ They may use Rust strings as
                  though they were C strings, <strong class="gj hk">omitting the terminating null byte</strong> (and
                  causing the C code to crash) 2️⃣ Or they may create many <strong class="gj hk">temporary Rust
                    strings</strong> while appending the null byte before calling the C functions.</p>
                <p id="6303" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The solution we have chosen is a
                  simplistic one — We create a new type <code class="dm gw gx gy gz b">Strn</code> that represents a
                  <strong class="gj hk">null-terminated string that will never be modified</strong>. It contains a fixed
                  slice (array) of bytes that always ends with null. <code class="dm gw gx gy gz b">Strn</code> verifies
                  this when setting and getting the string.</p>
                <figure class="hb hc hd he hf cz dr kv cd kw kx ky kz la ba lb lc ld le lf lg">
                 
                  <p><script src="https://gist.github.com/lupyuen/aaaaa.js"></script></p>


                </figure>
                <p id="13ed" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The wrappers for Mynewt APIs only
                  accept <code class="dm gw gx gy gz b">Strn</code> for incoming strings, instead of the default <code
                    class="dm gw gx gy gz b">*const char</code>.</p>
                <p id="866f" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">How do we create an <code
                    class="dm gw gx gy gz b">Strn</code>? By calling the <code class="dm gw gx gy gz b">strn!()</code>
                  macro we just seen…</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="ab5b" class="kk jp ec bk gz b ds kl km r kn">strn!( &quot;network&quot; )</span></pre>
                <p id="4525" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Which expands into…</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="e4ab" class="kk jp ec bk gz b ds kl km r kn">&amp;Strn::new( b&quot;network\0&quot; )</span></pre>
                <p id="93db" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">This creates an <code
                    class="dm gw gx gy gz b">Strn</code> from the <a
                    href="https://web.archive.org/web/20191204194043/https://doc.rust-lang.org/reference/tokens.html#byte-string-literals"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Rust Byte String</a> <code
                    class="dm gw gx gy gz b">b&quot;network\0&quot;</code>. C strings behave more like Rust Byte
                  Strings, but unfortunately Byte Strings are harder to manipulate without a helper like <code
                    class="dm gw gx gy gz b">Strn</code>.</p>
                <p id="3664" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">No more missing terminating
                  nulls… No more temporary copies of strings just for adding nulls… We have made Mynewt APIs safer,
                  simpler and <strong class="gj hk">more efficient</strong> for Rust!</p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="798e" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Compose a Procedural Macro with
                  quote!{}</h1>
                <p id="7984" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu">Checking result codes returned by
                  C functions can be very tedious and we forget to check them sometimes. Let’s look at this macro <code
                    class="dm gw gx gy gz b">run!()</code> that was used in our sample code to transform a bunch of C
                  function calls (for encoding CoAP CBOR messages)…</p>
                <figure class="hb hc hd he hf cz">
                 
                  <p><script src="https://gist.github.com/lupyuen/a5fae5ccb212acb1299697fd0e3eea63.js"></script></p>


                </figure>
                <p id="ce29" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">…into this code with proper error
                  checking, via <code class="dm gw gx gy gz b">check_result()</code>…</p>
                <figure class="hb hc hd he hf cz">
       
                  <p><script src="https://gist.github.com/lupyuen/37f368a9fce66dfc6ad27aab89782e01.js"></script></p>


                </figure>
                <p id="8ad7" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">How should we generate the
                  expanded code in the <code class="dm gw gx gy gz b">run!()</code> macro? We could have used the <code
                    class="dm gw gx gy gz b">format!()</code> method shown earlier…</p>
                <figure class="hb hc hd he hf cz">
            
                  <p><script src="https://gist.github.com/lupyuen/1c7d6e0c96603dec358d747fceb01f2a.js"></script></p>


                </figure>
                <p id="4ded" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">But for generating a block of
                  code, calling the <code class="dm gw gx gy gz b">quote!{}</code> macro (from the <code
                    class="dm gw gx gy gz b"><a href="https://web.archive.org/web/20191204194043/https://docs.rs/quote/0.6.12/quote/" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">quote</a></code><a
                    href="https://web.archive.org/web/20191204194043/https://docs.rs/quote/0.6.12/quote/"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"> library</a>) looks cleaner…</p>
                <figure class="hb hc hd he hf cz">
               
                  <p><script src="https://gist.github.com/lupyuen/5c12260327f91e03223522c80c786e32.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a
                      href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L395-L402"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L395-L402</a>
                  </figcaption>
                </figure>
                <p id="70f4" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Note that we use <code
                    class="dm gw gx gy gz b">#stmts</code> as a placeholder to tell the macro to substitute the value of
                  <code class="dm gw gx gy gz b">stmts</code> into actual expanded tokens.</p>
                <p id="2f21" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">We also used <code
                    class="dm gw gx gy gz b">quote!{}</code> in our macro like this…</p>
                <figure class="hb hc hd he hf cz">
                
                  <p><script src="https://gist.github.com/lupyuen/31c698537437d781441fa64b3dc09d7c.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a
                      href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L371-L377"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L371-L377</a>
                  </figcaption>
                </figure>
                <p id="dac1" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><code
                    class="dm gw gx gy gz b">quote!{}</code> is used here like a template, injecting <code
                    class="dm gw gx gy gz b">stmt_tokens</code> into a chunk of Rust code. Super useful for generating
                  Rust code… in a Rust program!</p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="66c9" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Match Code Patterns with syn
                </h1>
                <p id="d4bd" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu">Procedural Macros are more
                  powerful than Declarative Macros because they can analyse the source code tokens (with the <code
                    class="dm gw gx gy gz b">syn</code> library) and expand them differently depending on the context.
                </p>
                <p id="3ec6" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Our <code
                    class="dm gw gx gy gz b">run!()</code> macro is picky — it only watches out for calls to functions
                  named <code class="dm gw gx gy gz b">cbor_encode_...</code>. And it wraps the call with an error
                  handler (and inserts the namespace <code class="dm gw gx gy gz b">tinycbor</code>): <br /><code
                    class="dm gw gx gy gz b">let res = tinycbor::cbor_encode_...</code></p>
                <p id="5d29" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">It doesn’t disturb other
                  statements like <code class="dm gw gx gy gz b">let encoder = ...</code> because wrapping this with an
                  error handler would be so wrong. So our macro needs to…</p>
                <p id="9853" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">1️⃣ Match a Statement…</p>
                <p id="566d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">2️⃣ That contains a Function
                  Call…</p>
                <p id="78d6" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">3️⃣ That looks like <code
                    class="dm gw gx gy gz b">cbor_encode_...</code></p>
                <p id="dbbd" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">That’s easy to do with the <code
                    class="dm gw gx gy gz b">syn</code> parser and Rust pattern matching…</p>
                <figure class="hb hc hd he hf cz">
                
                  <p><script src="https://gist.github.com/lupyuen/611e83b8fa4389d56a465e43b44a1564.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a
                      href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L358-L371"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L358-L371</a>
                  </figcaption>
                </figure>
                <p id="3d1b" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Rust has incredibly powerful
                  <code class="dm gw gx gy gz b">enums</code> that will let us match against patterns like <code
                    class="dm gw gx gy gz b">Semi(expr, ...)</code> and <code
                    class="dm gw gx gy gz b">Call(expr)</code>. This works really well with the <code
                    class="dm gw gx gy gz b">syn</code> parser for creating powerful source code transformations.</p>
                <p id="8b8a" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The complete <code
                    class="dm gw gx gy gz b">run</code> macro with calls to <code class="dm gw gx gy gz b">syn</code>
                  and <code class="dm gw gx gy gz b">quote</code> is shown below. Although the <code
                    class="dm gw gx gy gz b">run</code> macro is meant for calling Embedded C functions, the macro
                  applies a layer of error checking on top of the function calls, in a way that feels natural to the
                  Rust coder. Safer coding, made possible with Rust’s Procedural Macros!</p>
                <figure class="hb hc hd he hf cz">
                 
                  <p><script src="https://gist.github.com/lupyuen/cd673b0355e82e1279c8c97b54c80986.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a
                      href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L326-L404"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L326-L404</a>
                  </figcaption>
                </figure>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="cz ak">
              <figure class="hb hc hd he hf cz ak paragraph-image">
                <div class="dl r dd dm">
                  <div class="lh r">
                    <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                        src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/60/1*vuwYV1q4dTd04pSdx0YDgA.png?q=20"
                        width="2297" height="1197" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                      width="2297" height="1197" role="presentation" /><noscript><img class="cp t u dh ak"
                        src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/4594/1*vuwYV1q4dTd04pSdx0YDgA.png"
                        width="2297" height="1197" role="presentation" /></noscript>
                  </div>
                </div>
                <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Evolving the #[safe_wrap] macro</figcaption>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="84d3" class="jo jp ec bk bj jc jq li js lj ju lk jw ll jy lm ka">Put Everything Together:
                  #[safe_wrap] macro</h1>
                <p id="89bd" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu">Remember the <strong
                    class="gj hk">Safe Wrapper for Mynewt Functions</strong>? Now we can explain how the wrapper was
                  constructed automatically with Procedural Macros.</p>
                <p id="c70c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">To create the wrapper, we apply
                  the <code class="dm gw gx gy gz b">#[safe_wrap]</code> attribute to the Rust binding created by <code
                    class="dm gw gx gy gz b">bindgen</code>…</p>
                <figure class="hb hc hd he hf cz">
              
                  <p><script src="https://gist.github.com/lupyuen/86ee23381b5f9ff9182cc20ca90022dd.js"></script></p>


                </figure>
                <p id="adcb" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><code
                    class="dm gw gx gy gz b">#[safe_wrap]</code> is a Procedural Macro <a
                    href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L24-L107"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">defined here</a>…</p>
                <figure class="hb hc hd he hf cz">
                
                  <p><script src="https://gist.github.com/lupyuen/13f5b12c2ceda4b81b88e5ca77a64fa6.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a
                      href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L24-L107"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L24-L107</a>
                  </figcaption>
                </figure>
                <p id="5ede" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The macro calls <code
                    class="dm gw gx gy gz b"><a href="https://web.archive.org/web/20191204194043/https://docs.rs/syn/0.15.38/syn/macro.parse_macro_input.html" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">parse_macro_input</a>!()</code>
                  from the <a
                    href="https://web.archive.org/web/20191204194043/https://docs.rs/syn/0.15.38/syn/index.html"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">syn library</a>. The input to the
                  macro is parsed as an <code class="dm gw gx gy gz b">extern</code> function declaration (denoted by
                  <code class="dm gw gx gy gz b">ItemForeignMod</code>).</p>
                <figure class="hb hc hd he hf cz">
               
                  <p><script src="https://gist.github.com/lupyuen/f91332310b2d9246bccc15f7287ad222.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a
                      href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L24-L107"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L24-L107</a>
                  </figcaption>
                </figure>
                <p id="c46f" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Next, we inspect each parameter
                  of the <code class="dm gw gx gy gz b">extern</code> function and call <code
                    class="dm gw gx gy gz b"><a href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L185-L278" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">transform_arg_list</a>()</code>
                  to transform each parameter into three forms…</p>
                <figure class="hb hc hd he hf cz">
              
                  <p><script src="https://gist.github.com/lupyuen/4d48314165ba804987d32f48b1ac0f4a.js"></script></p>


                </figure>
                <p id="e7da" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">1️⃣ <strong class="gj hk">Wrapper
                    Declaration</strong>: How the parameter type is exposed via the wrapped function.</p>
                <p id="b8a0" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">For example, <code
                    class="dm gw gx gy gz b">*mut</code> for output pointers looks odd to C coders, so we rename it as
                  <code class="dm gw gx gy gz b">Out&lt;…&gt;</code>, which clearly states the intent (output pointer).
                </p>
                <p id="888e" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><code
                    class="dm gw gx gy gz b">*const c_char</code> for input strings is renamed to &amp;Strn, since the
                  <code class="dm gw gx gy gz b">Strn</code> type validates that the string is null-terminated. (Again,
                  <code class="dm gw gx gy gz b">Strn</code> signifies the intent.)</p>
                <p id="ec62" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">2️⃣ <strong
                    class="gj hk">Validation Statement</strong>: To validate each parameter if needed, like verifying
                  that all input strings are null-terminated. (We use the <code class="dm gw gx gy gz b">Strn</code>
                  type to perform the string validation.)</p>
                <p id="7af3" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">3️⃣ <strong class="gj hk">Call
                    Expression</strong>: Inside the wrapper, use this type cast expression to call the C function. Rust
                  is stricter than C about types, so we use type casting to handle tiny discrepancies like <code
                    class="dm gw gx gy gz b">i32</code> vs <code class="dm gw gx gy gz b">u32</code> (signed vs unsigned
                  integers).</p>
                <figure class="hb hc hd he hf cz">
              
                  <p><script src="https://gist.github.com/lupyuen/b510571b9385cb5ca189ff770789e7c2.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a
                      href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L24-L107"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/src/lib.rs#L24-L107</a>
                  </figcaption>
                </figure>
                <p id="f9f0" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Finally we use <code
                    class="dm gw gx gy gz b"><a href="https://web.archive.org/web/20191204194043/https://docs.rs/quote/0.6.12/quote/macro.quote.html" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">quote!</a></code>
                  macro to combine the three forms into the expanded output below. The <code
                    class="dm gw gx gy gz b">quote!</code> macro clearly shows the structure of the output, thus I
                  <strong class="gj hk">highly recommend </strong><code
                    class="dm gw gx gy gz b"><strong class="gj hk">quote!</strong></code><strong class="gj hk"> for
                    composing Procedural Macros</strong>.</p>
                <figure class="hb hc hd he hf cz">
              
                  <p><script src="https://gist.github.com/lupyuen/11af7179183a66de9fcfc7ac0d124101.js"></script></p>


                </figure>
                <p id="fb27" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">We use <code
                    class="dm gw gx gy gz b">quote_spanned!</code> instead of <code
                    class="dm gw gx gy gz b">quote!</code> in some spots…</p>
                <figure class="hb hc hd he hf cz">
           
                  <p><script src="https://gist.github.com/lupyuen/731a7140a8cca00edaf1cc95b4ce7bd6.js"></script></p>


                </figure>
                <p id="91b6" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">What’s a <strong
                    class="gj hk">Span</strong>? When the Rust Compiler sends a stream of tokens to our macro, it also
                  transmits the <strong class="gj hk">byte location of each token</strong> in the source file. So when
                  it hits a compilation error, the compiler can display the exact source code that caused the error.</p>
                <p id="e2a1" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Our macro is <strong
                    class="gj hk">synthesising source code</strong> — creating new source code based on the original
                  source code. So it’s possible that our synthesised source code will have errors. When that happens, we
                  should tell the Rust Compiler the precise location of the original code.</p>
                <p id="1998" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">That’s why it’s important for our
                  macros to <strong class="gj hk">preserve the Span information</strong>. We create three forms of each
                  parameter, but they are <strong class="gj hk">placed into different sections</strong>. By using <code
                    class="dm gw gx gy gz b"><a href="https://web.archive.org/web/20191204194043/https://docs.rs/quote/0.6.12/quote/macro.quote_spanned.html" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">quote_spanned!</a></code>
                  we preserve the original Span of each parameter. And the Rust Coder gets <strong
                    class="gj hk">meaningful, relevant error messages.</strong></p>
              </div>
            </div>
            <div class="cz ak">
              <figure class="hb hc hd he hf cz ak paragraph-image">
                <div class="dl r dd dm">
                  <div class="ln r">
                    <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                        src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/60/1*8fEonfXYa5rEaoQpJY-HEg.png?q=20"
                        width="2396" height="1419" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                      width="2396" height="1419" role="presentation" /><noscript><img class="cp t u dh ak"
                        src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/4792/1*8fEonfXYa5rEaoQpJY-HEg.png"
                        width="2396" height="1419" role="presentation" /></noscript>
                  </div>
                </div>
                <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Overview of the #[safe_wrap] attribute
                </figcaption>
              </figure>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="cz ak">
              <figure class="hb hc hd he hf cz">
                <div class="dl r dd">
                  <div class="lo r"><iframe
                      src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2F9aJqXl7TTkc%3Ffeature%3Doembed&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D9aJqXl7TTkc&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2F9aJqXl7TTkc%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube"
                      allowfullscreen="" frameborder="0" height="480" width="854"
                      title="Result, Ok and Err in Embedded Rust" class="cp t u dh ak" scrolling="auto"></iframe></div>
                </div>
                <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Result, Ok and Err in Embedded Rust</figcaption>
              </figure>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="3c2d" class="jo jp ec bk bj jc jq li js lj ju lk jw ll jy lm ka">What are Result&lt;&gt;, Ok()
                  and Err() in Rust?</h1>
                <p id="ade5" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu">In Rust, it’s customary for
                  functions to return <code class="dm gw gx gy gz b">Result&lt;…&gt;</code> instead of an error code
                  like C. That’s why our Safe Wrapper is declared as…</p>
                <figure class="hb hc hd he hf cz">
                 
                  <p><script src="https://gist.github.com/lupyuen/026adbd9e9b97f6cd063e376ddf69c47.js"></script></p>


                </figure>
                <p id="e4bb" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><code
                    class="dm gw gx gy gz b"><a href="https://web.archive.org/web/20191204194043/https://lupyuen.github.io/stm32bluepill-mynewt-sensor/rust/mylib/mynewt/result/type.MynewtResult.html" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">MynewtResult</a>&lt;…&gt;</code>
                  (derived from <code
                    class="dm gw gx gy gz b"><a href="https://web.archive.org/web/20191204194043/https://doc.rust-lang.org/nightly/core/result/enum.Result.html" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Result</a>&lt;…&gt;</code>)
                  is a Generic Type that contains either…</p>
                <p id="21a3" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">1️⃣ <code
                    class="dm gw gx gy gz b">Ok(result)</code> in which <code class="dm gw gx gy gz b">result</code> is
                  an optional result value</p>
                <p id="07c7" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">2️⃣ <code
                    class="dm gw gx gy gz b">Err(error_code)</code> in which <code
                    class="dm gw gx gy gz b">error_code</code> is the <a
                    href="https://web.archive.org/web/20191204194043/https://lupyuen.github.io/stm32bluepill-mynewt-sensor/rust/mylib/mynewt/result/enum.MynewtError.html"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Mynewt system error code</a></p>
                <p id="e88c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">How do we indicate the type of
                  the result value? Through the function definition…</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="f957" class="kk jp ec bk gz b ds kl km r kn">fn my_function() -&gt; MynewtResult&lt;i32&gt;</span></pre>
                <p id="4b32" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">…means that <code
                    class="dm gw gx gy gz b">my_function()</code> returns an integer result value or an error code.</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="3c12" class="kk jp ec bk gz b ds kl km r kn">fn my_function() -&gt; MynewtResult&lt;()&gt;</span></pre>
                <p id="0590" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">…means that <code
                    class="dm gw gx gy gz b">my_function()</code> returns no result value (a.k.a. <code
                    class="dm gw gx gy gz b">void</code>) but it may return an error code.</p>
                <p id="29f2" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">To return a result value, we
                  return <code class="dm gw gx gy gz b">Ok(value)</code> or if there’s nothing to be returned, <code
                    class="dm gw gx gy gz b">Ok(())</code></p>
                <p id="f084" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">To return an error, we return a
                  standard Mynewt error code wrapped with <code class="dm gw gx gy gz b">Err()</code> like this: <code
                    class="dm gw gx gy gz b">Err(MynewtError::SYS_EAGAIN)</code></p>
                <p id="7e1f" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">What happens when we call a
                  function that returns an error? For example…</p>
                <figure class="hb hc hd he hf cz">
              
                  <p><script src="https://gist.github.com/lupyuen/f26a458aca6cb7f259e7658fe08842f5.js"></script></p>


                </figure>
                <p id="9a34" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">See the strange <code
                    class="dm gw gx gy gz b">?</code> dangling at the end of the <code
                    class="dm gw gx gy gz b">task_init()</code> function call?</p>
                <p id="a6b4" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">It returns any errors immediately
                  when they occur. The function exits early without executing the rest of the function.</p>
                <p id="c7b1" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">So <code
                    class="dm gw gx gy gz b">Result&lt;…&gt;, Ok(…), Err(…)</code> and <code
                    class="dm gw gx gy gz b">?</code> really help to make Mynewt error handling so much easier.</p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="ff9e" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Debug Rust Macros with Visual
                  Studio Code</h1>
                <p id="2aa2" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu">Visual Studio Code is a great way
                  to debug Rust Declarative and Procedural Macros. Just follow these steps…</p>
                <p id="98b2" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">1️⃣ Install <a
                    href="https://web.archive.org/web/20191204194043/https://code.visualstudio.com/"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"><strong class="gj hk">Visual
                      Studio Code</strong></a>. Install <code
                    class="dm gw gx gy gz b"><strong class="gj hk">rustup</strong></code> according to the instructions
                  at <code
                    class="dm gw gx gy gz b"><a href="https://web.archive.org/web/20191204194043/https://rustup.rs/" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">rustup.rs</a></code>
                </p>
                <p id="4467" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">2️⃣ Select the <strong
                    class="gj hk">Nightly Build</strong> of the Rust Compiler…</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="2b22" class="kk jp ec bk gz b ds kl km r kn">rustup default nightly<br/>rustup update</span></pre>
                <p id="5d18" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk">3️⃣ For
                    Windows</strong>: Install the <a
                    href="https://web.archive.org/web/20191204194043/https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-wsl"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"><strong class="gj hk">Remote WSL
                      Extension</strong></a> for Visual Studio Code so that the Rust build runs in the Linux (Ubuntu)
                  environment, which has fewer problems. Otherwise you’ll have to install Rust twice according to <a
                    href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust/README.md"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">these instructions</a>.</p>
                <p id="bc8c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">4️⃣ Install the <a
                    href="https://web.archive.org/web/20191204194043/https://marketplace.visualstudio.com/items?itemName=rust-lang.rust"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"><strong class="gj hk">Rust
                      Language Support Extension</strong></a> for Visual Studio Code. If it won’t install properly, <a
                    href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust/README.md#install-rust-windows"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">check these instructions</a>.</p>
                <p id="fc62" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">5️⃣ Install the <a
                    href="https://web.archive.org/web/20191204194043/https://marketplace.visualstudio.com/items?itemName=SanaAjani.taskrunnercode"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"><strong class="gj hk">Task Runner
                      Extension</strong></a> for Visual Studio Code. This lets you click on build tasks easily in the
                  <code class="dm gw gx gy gz b">Task Runner</code> pane at lower left.</p>
                <p id="6645" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">5️⃣ In Visual Studio Code, click
                  <code
                    class="dm gw gx gy gz b"><strong class="gj hk">View → Command Palette → Git Clone</strong></code>.
                  Enter</p>
                <p id="e832" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><code
                    class="dm gw gx gy gz b">https://github.com/lupyuen/test-rust-macros</code></p>
                <p id="35e1" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">and select a local folder. This
                  Rust project contains demo macros used in the next section.</p>
                <p id="9c19" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">6️⃣ When prompted, open the
                  cloned repository and open the workspace</p>
                <p id="235b" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">7️⃣ In the <code
                    class="dm gw gx gy gz b"><strong class="gj hk">Workspace</strong></code> pane, open the file <code
                    class="dm gw gx gy gz b"><a href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/test-rust-macros/blob/master/src/main.rs" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"><strong class="gj hk">src/main.rs</strong></a></code>
                  to view the demo macros. We’ll be using the demo macros next…</p>
                <p id="04d2" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Here’s a video of the
                  installation steps. Click <code class="dm gw gx gy gz b">CC</code> to view the instructions…</p>
              </div>
            </div>
            <div class="cz">
              <div class="n p">
                <div class="lp lq lr ls lt lu ag lv ah lw aj ak">
                  <figure class="hb hc hd he hf cz">
                    <div class="dl r dd">
                      <div class="kq r"><iframe
                          src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2F5wh-iiEbtmA%3Ffeature%3Doembed&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D5wh-iiEbtmA&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2F5wh-iiEbtmA%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube"
                          allowfullscreen="" frameborder="0" height="480" width="640"
                          title="Expand Rust Macros in Visual Studio Code" class="cp t u dh ak"
                          scrolling="auto"></iframe></div>
                    </div>
                  </figure>
                </div>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="8bcd" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Watch Macro Expansion in Visual
                  Studio Code</h1>
                <p id="511e" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu">To see how simple macros are
                  expanded, use <code class="dm gw gx gy gz b">trace_macros!()</code> like this…</p>
                <figure class="hb hc hd he hf cz">
                
                  <p><script src="https://gist.github.com/lupyuen/2cf4428a85f8ac27bbcb9518eaf1a039.js"></script></p>


                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">From <a
                      href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/test-rust-macros/blob/master/src/main.rs#L170-L176"
                      class="at cg hl hm hn ho" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/test-rust-macros/blob/master/src/main.rs#L170-L176</a>
                  </figcaption>
                </figure>
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm lx">
                      <div class="dl r dd dm">
                        <div class="ly r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/60/1*pmGFQ2cRpqypaNDM1UYwEw.png?q=20"
                              width="1800" height="50" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="1800" height="50" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/3600/1*pmGFQ2cRpqypaNDM1UYwEw.png"
                              width="1800" height="50" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <figure class="du cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                  <div class="cl cm lz">
                    <div class="dl r dd dm">
                      <div class="me r">
                        <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                            src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/60/1*JaZnw3eMN5DAX6438ENxhg.png?q=20"
                            width="456" height="206" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                          width="456" height="206" role="presentation" /><noscript><img class="cp t u dh ak"
                            src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/912/1*JaZnw3eMN5DAX6438ENxhg.png"
                            width="456" height="206" role="presentation" /></noscript>
                      </div>
                    </div>
                  </div>
                </figure>
                <p id="9e20" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Mouse over the macro name, like
                  <code class="dm gw gx gy gz b">add_88</code> (located in the <code
                    class="dm gw gx gy gz b">main()</code> function)</p>
                <p id="33e4" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The macro expansion appears in a
                  pop-up</p>
                <p id="9f0e" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Click <code
                    class="dm gw gx gy gz b"><strong class="gj hk">Peek Problem</strong></code> if the expansion is long
                </p>
                <p id="5ef6" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">For complex macros, use this
                  method to view expanded macros in the Rust build log…</p>
                <p id="ebf3" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">1️⃣ In Visual Studio Code, browse
                  the <code class="dm gw gx gy gz b">Workspace</code> and open the file <code
                    class="dm gw gx gy gz b"><a href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/test-rust-macros/blob/master/.cargo/config" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"><strong class="gj hk">.cargo/config</strong></a></code>
                </p>
                <figure class="hb hc hd he hf cz">
              
                  <p><script src="https://gist.github.com/lupyuen/dfa6e9d64fbc0c29ed9f7795108ef8d8.js"></script></p>


                </figure>
                <p id="644f" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">2️⃣ Uncomment the first option…
                </p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="3480" class="kk jp ec bk gz b ds kl km r kn">&quot;-Z&quot;, &quot;unstable-options&quot;, &quot;--pretty&quot;, &quot;expanded&quot;,</span></pre>
                <p id="f4ee" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">3️⃣ Click <code
                    class="dm gw gx gy gz b"><strong class="gj hk">Terminal → Run Task → cargo build</strong></code></p>
                <p id="df12" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The expanded macro appears in the
                  <code class="dm gw gx gy gz b">cargo build</code> log…</p>
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                  <div class="cl cm mf">
                    <div class="dl r dd dm">
                      <div class="mg r">
                        <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                            src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/60/1*LWlJv4w_gjcf4bUaNFWKiA.png?q=20"
                            width="594" height="164" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                          width="594" height="164" role="presentation" /><noscript><img class="cp t u dh ak"
                            src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/1188/1*LWlJv4w_gjcf4bUaNFWKiA.png"
                            width="594" height="164" role="presentation" /></noscript>
                      </div>
                    </div>
                  </div>
                  <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Expanded macro in the cargo build log
                  </figcaption>
                </figure>
                <p id="2f36" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">4️⃣ With the Task Runner
                  Extension, we may also click <code class="dm gw gx gy gz b">cargo build</code> in the <code
                    class="dm gw gx gy gz b">Task Runner</code> pane at lower left</p>
                <p id="873d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Here’s a video of the macro
                  expansion. Click <code class="dm gw gx gy gz b">CC</code> to view the instructions…</p>
              </div>
            </div>
            <div class="cz">
              <div class="n p">
                <div class="lp lq lr ls lt lu ag lv ah lw aj ak">
                  <figure class="hb hc hd he hf cz">
                    <div class="dl r dd">
                      <div class="kq r"><iframe
                          src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2F5wh-iiEbtmA%3Fstart%3D91%26feature%3Doembed%26start%3D91&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D5wh-iiEbtmA&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2F5wh-iiEbtmA%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube"
                          allowfullscreen="" frameborder="0" height="480" width="640"
                          title="Expand Rust Macros in Visual Studio Code" class="cp t u dh ak"
                          scrolling="auto"></iframe></div>
                    </div>
                  </figure>
                </div>
              </div>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <p id="8a3d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">If you’re not using Visual Studio
                  Code, run this in the command line to see the expanded macros…</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="f2fd" class="kk jp ec bk gz b ds kl km r kn">cargo rustc -- -Z unstable-options --pretty expanded</span></pre>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="9f0b" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Macro Hygiene in Rust</h1>
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm ha">
                      <div class="dl r dd dm">
                        <div class="hg r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/46/1*5G_65RpkCuQTopRD8BBvqA.png?q=20"
                              width="3024" height="4032" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="3024" height="4032" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/6048/1*5G_65RpkCuQTopRD8BBvqA.png"
                              width="3024" height="4032" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm ha">
                      <div class="dl r dd dm">
                        <div class="hg r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/46/1*eY-XpoiemlJnIzzlnOAI3g.png?q=20"
                              width="3024" height="4032" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="3024" height="4032" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/6048/1*eY-XpoiemlJnIzzlnOAI3g.png"
                              width="3024" height="4032" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm ha">
                      <div class="dl r dd dm">
                        <div class="hg r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/46/1*NN-mIK5ou5CZUQO3f4m29Q.png?q=20"
                              width="3024" height="4032" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="3024" height="4032" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/6048/1*NN-mIK5ou5CZUQO3f4m29Q.png"
                              width="3024" height="4032" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <blockquote class="hh hi hj">
                  <p id="598e" class="gh gi ec gv gj b gk gl gm gn go gp gq gr gs gt gu">More about <a
                      href="https://web.archive.org/web/20191204194043/https://danielkeep.github.io/tlborm/book/mbe-min-hygiene.html"
                      class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Macro Hygiene</a></p>
                </blockquote>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="e621" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Debug Macro Hygiene in Visual
                  Studio Code</h1>
                <p id="250e" class="gh gi ec bk gj b gk kb gm kc go kd gq ke gs kf gu">The Rust Compiler can show us
                  information about the <code class="dm gw gx gy gz b">salt</code> variables and which context they
                  belong to…</p>
                <p id="e1cc" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">1️⃣ In Visual Studio Code, browse
                  the <code class="dm gw gx gy gz b">Workspace</code> and open the file <code
                    class="dm gw gx gy gz b"><a href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/test-rust-macros/blob/master/.cargo/config" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"><strong class="gj hk">.cargo/config</strong></a></code>
                </p>
                <figure class="hb hc hd he hf cz">
                 
                  <p><script src="https://gist.github.com/lupyuen/dfa6e9d64fbc0c29ed9f7795108ef8d8.js"></script></p>


                </figure>
                <p id="aae1" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">2️⃣ Uncomment the second option…
                </p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="64e4" class="kk jp ec bk gz b ds kl km r kn">&quot;-Z&quot;, &quot;unstable-options&quot;, &quot;--pretty&quot;, &quot;expanded,hygiene&quot;,</span></pre>
                <p id="0178" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Check that the first option is
                  commented.</p>
                <p id="c0d4" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">3️⃣ Click <code
                    class="dm gw gx gy gz b"><strong class="gj hk">Terminal → Run Task → cargo build</strong></code></p>
                <p id="07d1" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">The expanded macro with context
                  information appears in the <code class="dm gw gx gy gz b">cargo build</code> log. Here’s what it
                  means…</p>
              </div>
            </div>
            <div class="cz">
              <div class="n p">
                <div class="lp lq lr ls lt lu ag lv ah lw aj ak">
                  <figure class="hb hc hd he hf cz mi mj paragraph-image">
                    <div class="db dc dd de ak">
                      <div class="cl cm mh">
                        <div class="dl r dd dm">
                          <div class="mk r">
                            <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                                src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/60/1*6wOP9LJUgKViQjxEOmPnIQ.png?q=20"
                                width="5134" height="3482" role="presentation" /></div><img
                              class="df dg cp t u dh ak dr" width="5134" height="3482"
                              role="presentation" /><noscript><img class="cp t u dh ak"
                                src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/10268/1*6wOP9LJUgKViQjxEOmPnIQ.png"
                                width="5134" height="3482" role="presentation" /></noscript>
                          </div>
                        </div>
                      </div>
                    </div>
                    <figcaption class="bo ds dt du dv cn cl cm dw dx bj dy">Rust Compiler displaying the context of
                      every variable</figcaption>
                  </figure>
                </div>
              </div>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <p id="73dd" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Here’s a video of macro hygiene
                  in Visual Studio Code. Click <code class="dm gw gx gy gz b">CC</code> to view the instructions…</p>
              </div>
            </div>
            <div class="cz">
              <div class="n p">
                <div class="lp lq lr ls lt lu ag lv ah lw aj ak">
                  <figure class="hb hc hd he hf cz">
                    <div class="dl r dd">
                      <div class="kq r"><iframe
                          src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FUuPab1kXVQo%3Ffeature%3Doembed&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DUuPab1kXVQo&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2FUuPab1kXVQo%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube"
                          allowfullscreen="" frameborder="0" height="480" width="640"
                          title="Rust Macro Hygiene in Visual Studio Code" class="cp t u dh ak"
                          scrolling="auto"></iframe></div>
                    </div>
                  </figure>
                </div>
              </div>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <p id="3e88" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">If you’re not using Visual Studio
                  Code, run this in the command line to see the hygiene information…</p>
                <pre
                  class="hb hc hd he hf kh ki kj"><span id="d0fd" class="kk jp ec bk gz b ds kl km r kn">cargo rustc -- -Z unstable-options --pretty expanded,hygiene</span></pre>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="00ee" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Macro Context: Embedded vs
                  Desktop</h1>
                <blockquote class="hh hi hj">
                  <p id="70e5" class="gh gi ec gv gj b gk gl gm gn go gp gq gr gs gt gu"><em class="bk">🤔 </em>Macro
                    programming is also known as <a
                      href="https://web.archive.org/web/20191204194043/https://en.wikipedia.org/wiki/Metaprogramming"
                      class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"><strong
                        class="gj hk">Metaprogramming</strong></a>… Like “Inception”, it <strong class="gj hk">plays
                      weird tricks with your mind</strong>, as you code a program within a program… And you ask
                    yourself: “Which level am I at right now? What am I really coding for?”</p>
                </blockquote>
                <p id="a0c8" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">We are actually stacked on TWO
                  “Inception” Layers right now…</p>
                <p id="c48d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">1️⃣ We’re coding an Embedded Rust
                  program for STM32 Blue Pill. <code
                    class="dm gw gx gy gz b"><a href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/Cargo.toml#L33" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Cargo.toml</a></code><a
                    href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/Cargo.toml#L33"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"> is located here</a>.</p>
                <p id="c64c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">2️⃣ We’re coding a Procedural
                  Rust Macro, which transforms the source code of the Embedded Rust program. <code
                    class="dm gw gx gy gz b"><a href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/Cargo.toml#L23" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Cargo.toml</a></code><a
                    href="https://web.archive.org/web/20191204194043/https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-safe/macros/Cargo.toml#L23"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow"> is located here</a>.</p>
                <p id="a7b2" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">They run on different contexts…
                </p>
                <figure class="hb hc hd he hf cz">
              
                  <p><script src="https://gist.github.com/lupyuen/8c3e54f64e1252b8a5dcf3fa8c9d697b.js"></script></p>


                </figure>
                <p id="bfb3" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">So we may make the mistake of
                  adding <a href="https://web.archive.org/web/20191204194043/https://doc.rust-lang.org/std/index.html"
                    class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Rust Standard Library</a> features
                  to our Embedded Rust program. Which will produce Rust Compiler errors.</p>
                <p id="a387" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">As we code, always think
                  carefully… Which level are we coding on?</p>
                <p id="c5a8" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Looking for more Embedded Rust on
                  STM32 Blue Pill? Check this out…</p>
                <div class="ib ic id ie if ig"><a rel="noopener"
                    href="/web/20191204194043/https://medium.com/@ly.lee/hosting-embedded-rust-apps-on-apache-mynewt-with-stm32-blue-pill-c86b119fe5f?source=post_page-----d8fcb41969ac----------------------">
                    <section class="ij cl cm ak ce n ar ik il im in io ip iq ir is it iu iv iw ix iy">
                      <div class="iz n co p ja jb">
                        <h2 class="bj jc jd bl ec">
                          <div class="di ih fe ff ii fh">Hosting Embedded Rust apps on Apache Mynewt with STM32 Blue
                            Pill</div>
                        </h2>
                        <div class="je r">
                          <h3 class="bj dy ds bl bo">
                            <div class="di ih fe ff ii fh">Build IoT devices the smarter, safer way with Rust and Apache
                              Mynewt</div>
                          </h3>
                        </div>
                        <div class="jf r">
                          <h4 class="bj dy fw bl bo">
                            <div class="di ih fe ff ii fh">medium.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="jg r">
                        <div class="jh r ji jj jk jg jl jm jn"></div>
                      </div>
                    </section>
                  </a></div>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="5217" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">The Lizard Rests</h1>
                <figure class="hb hc hd he hf cz cl cm paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm ha">
                      <div class="dl r dd dm">
                        <div class="hg r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/46/1*XnWzSgqk3M3voF6rz92Tgw.png?q=20"
                              width="3024" height="4032" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="3024" height="4032" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/6048/1*XnWzSgqk3M3voF6rz92Tgw.png"
                              width="3024" height="4032" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <p id="7da3" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu">Check out the latest article on
                  Visual Embedded Rust…</p>
                <div class="ib ic id ie if ig"><a rel="noopener"
                    href="/web/20191204194043/https://medium.com/@ly.lee/visual-embedded-rust-programming-with-visual-studio-code-1bc1262e398c?source=post_page-----d8fcb41969ac----------------------">
                    <section class="ij cl cm ak ce n ar ik il im in io ip iq ir is it iu iv iw ix iy">
                      <div class="iz n co p ja jb">
                        <h2 class="bj jc jd bl ec">
                          <div class="di ih fe ff ii fh">Visual Embedded Rust Programming with Visual Studio Code</div>
                        </h2>
                        <div class="je r">
                          <h3 class="bj dy ds bl bo">
                            <div class="di ih fe ff ii fh">Create and edit Embedded Rust programs for STM32 Blue Pill
                              and Apache Mynewt… By dragging and dropping blocks!</div>
                          </h3>
                        </div>
                        <div class="jf r">
                          <h4 class="bj dy fw bl bo">
                            <div class="di ih fe ff ii fh">medium.com</div>
                          </h4>
                        </div>
                      </div>
                      <div class="jg r">
                        <div class="ml r ji jj jk jg jl jm jn"></div>
                      </div>
                    </section>
                  </a></div>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <h1 id="8d6c" class="jo jp ec bk bj jc jq jr js jt ju jv jw jx jy jz ka">Appendix: Index Of Images</h1>
                <blockquote class="hh hi hj">
                  <p id="c700" class="gh gi ec gv gj b gk gl gm gn go gp gq gr gs gt gu">This section is not meant for
                    humans; it’s for web crawlers to index the text content of the images</p>
                </blockquote>
                <figure class="hb hc hd he hf cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm ha">
                      <div class="dl r dd dm">
                        <div class="hg r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/46/1*HsTY9-Ie90rR9VbZL19Kng.png?q=20"
                              width="3024" height="4032" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="3024" height="4032" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/6048/1*HsTY9-Ie90rR9VbZL19Kng.png"
                              width="3024" height="4032" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <p id="1abc" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“Hello I’m MyNewt.
                    I’m an Embedded OS that runs on Bare Metal”</em></p>
                <p id="c113" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“Yep I’m open
                    source. Fully fluffy inside.”</em></p>
                <p id="0c49" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“Many types of
                    microcontrollers. I run on Super Blue Pill too.”</em></p>
                <p id="1c09" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“Why run Mynewt
                    instead of Embedded Rust on bare metal?”</em></p>
                <p id="d75d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">(Thanks to RedMart
                    for delivering the bare metal cans on Sunday)</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm hp">
                      <div class="dl r dd dm">
                        <div class="hq r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/42/1*myd6rlZEiboqMsTMGziZQw.png?q=20"
                              width="2015" height="2884" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="2015" height="2884" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/4030/1*myd6rlZEiboqMsTMGziZQw.png"
                              width="2015" height="2884" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <p id="0de1" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“What’s wrong with
                    C? The code gets messy when we do something simple… Like sending a JSON message over CoAP, using
                    macros…”</em></p>
                <p id="0ca7" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“It’s almost 2020.
                    Why do coders suffer like this?</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm ha">
                      <div class="dl r dd dm">
                        <div class="ia r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/52/1*D3326wVykSqZaoi18FaJdg.png?q=20"
                              width="3024" height="3557" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="3024" height="3557" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/6048/1*D3326wVykSqZaoi18FaJdg.png"
                              width="3024" height="3557" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <p id="1c5d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“Here’s the
                    solution in Rust… Simple Clean Rust Code”</em></p>
                <p id="559f" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“Just that the
                    code inside the curly brackets {…} isn’t really Rust, it’s JSON”</em></p>
                <p id="6437" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“How does Rust
                    support alien languages?”</em></p>
                <p id="235c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“Answer: Rust
                    supports them thru Declarative Macros”</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm mo">
                      <div class="dl r dd dm">
                        <div class="ko r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/60/1*aWLhS3tgaWNlvxjkMsdETQ.png?q=20"
                              width="2992" height="1075" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="2992" height="1075" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/5984/1*aWLhS3tgaWNlvxjkMsdETQ.png"
                              width="2992" height="1075" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <p id="7619" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">Encoding Format:
                    @json or @cbor</em></p>
                <p id="2c4d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">Parser State:
                    @object means that we are parsing an object</em></p>
                <p id="6094" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">Encoding Context:
                    Required for macro hygiene. Key of JSON entry / Value of JSON entry. Remaining JSON to be
                    parsed</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm kp">
                      <div class="dl r dd dm">
                        <div class="kq r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/60/1*8juHTUpQsGCD1QJNcfPZZw.png?q=20"
                              width="4032" height="3024" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="4032" height="3024" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/8064/1*8juHTUpQsGCD1QJNcfPZZw.png"
                              width="4032" height="3024" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <p id="04eb" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“My two-legged
                    friends are now thinking…”</em></p>
                <p id="63d3" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“What if I need to
                    call some code in Embedded C?”</em></p>
                <p id="e385" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“What if my sensor
                    or network drivers run only on C?”</em></p>
                <p id="22e2" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“The entire Mynewt
                    API is in C… How do we call that from Rust?”</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm kr">
                      <div class="dl r dd dm">
                        <div class="ks r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/46/1*w2J11VAHZGh73yp2rKVzVw.png?q=20"
                              width="2969" height="3890" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="2969" height="3890" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/5938/1*w2J11VAHZGh73yp2rKVzVw.png"
                              width="2969" height="3890" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <p id="c18d" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“Rust will let you
                    call any C function, even C functions defined in Mynewt!”</em></p>
                <p id="08fe" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“All you need to
                    provide: the Rust bindings for the functions”</em></p>
                <p id="c008" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“Which the bindgen
                    tool can generate automatically”</em></p>
                <p id="7e17" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“This C
                    declaration… is transformed into this Rust declaration by bindgen”</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm kp">
                      <div class="dl r dd dm">
                        <div class="ku r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/48/1*arL-I0TiGF9H8n19h4bucA.png?q=20"
                              width="4032" height="5000" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="4032" height="5000" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/8064/1*arL-I0TiGF9H8n19h4bucA.png"
                              width="4032" height="5000" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <p id="7903" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“With bindgen we
                    can import all the C functions from Mynewt into Rust… In a single click!”</em></p>
                <p id="1faa" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“But is the
                    imported horde all set to run on BARE METAL?”</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm ha">
                      <div class="dl r dd dm">
                        <div class="hg r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/46/1*Uural5MulPQjJNx9TUmOxA.png?q=20"
                              width="3024" height="4032" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="3024" height="4032" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/6048/1*Uural5MulPQjJNx9TUmOxA.png"
                              width="3024" height="4032" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <p id="a315" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“See how we are
                    rolling on top of Bare Metal? This is highly UNSAFE!”</em></p>
                <p id="6a69" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“We could tumble
                    down anytime and damage the Bare Metal. Or ourselves”</em></p>
                <p id="3b50" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“Calling an
                    imported C function from Rust is UNSAFE. Looks ugly too!”</em></p>
                <p id="53b0" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“In my fantasy,
                    calling a Mynewt function from Rust would be so safe and easy. Like this…”</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm ha">
                      <div class="dl r dd dm">
                        <div class="hg r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/46/1*N15W1MZigKNerGZaSughnQ.png?q=20"
                              width="3024" height="4032" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="3024" height="4032" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/6048/1*N15W1MZigKNerGZaSughnQ.png"
                              width="3024" height="4032" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <p id="2ed7" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“We should call
                    the Mynewt function thru a SAFE wrapper…”</em></p>
                <p id="7c98" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“Wrapper checks
                    incoming strings for null termination”</em></p>
                <p id="1ea9" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“Wrapper checks
                    that output pointers are valid”</em></p>
                <p id="64f4" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“The SAFE wrapper
                    protects Bare Metal from any damage. SAFER and SIMPLER coding… the power of Rust!”</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm ha">
                      <div class="dl r dd dm">
                        <div class="hg r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/46/1*5G_65RpkCuQTopRD8BBvqA.png?q=20"
                              width="3024" height="4032" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="3024" height="4032" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/6048/1*5G_65RpkCuQTopRD8BBvqA.png"
                              width="3024" height="4032" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <p id="6160" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“Sometimes working
                    with Rust feels like meeting a Food Safety Inspector…”</em></p>
                <p id="7e02" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk"><em
                      class="gv">“HEY YOU!!!”</em></strong></p>
                <p id="b604" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk"><em
                      class="gv">“Yes… Inspector?”</em></strong></p>
                <p id="80a4" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk"><em
                      class="gv">“You are violating the rules of Safety and Hygiene… NO LIZARDS
                      ALLOWED!!!”</em></strong></p>
                <p id="1741" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk"><em
                      class="gv">“I can explain…”</em></strong></p>
                <p id="840c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk"><em
                      class="gv">“NO LIZARDS ALLOWED!!!”</em></strong></p>
                <p id="4c25" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“What’s Hygiene?
                    Hygiene is keeping your bathroom clean. Hygiene is keeping your pet lizard’s cage clean”</em></p>
                <p id="5439" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“Hygiene means
                    Never do sneaky things to fool the Rust Compiler… Like pretending to be something else with the same
                    name”</em></p>
                <p id="5572" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“This is very odd
                    but 100% true… (Ask your Food Safety Inspector): Declarative Macros respect Hygiene, Procedural
                    Macros DO NOT respect Hygiene”</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm ha">
                      <div class="dl r dd dm">
                        <div class="hg r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/46/1*eY-XpoiemlJnIzzlnOAI3g.png?q=20"
                              width="3024" height="4032" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="3024" height="4032" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/6048/1*eY-XpoiemlJnIzzlnOAI3g.png"
                              width="3024" height="4032" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <p id="51e6" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“Pretend you’re
                    running a Restaurant Business (for humans, not lizards). A Food Safety Inspector walks into your
                    restaurant and orders the soup. The Inspector makes a complaint…”</em></p>
                <p id="e659" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk"><em
                      class="gv">“There’s no salt in the soup”</em></strong></p>
                <p id="680c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk"><em
                      class="gv">“Sorry Inspector, I’m really sure there’s salt in your Tomato Soup”</em></strong></p>
                <p id="a868" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk"><em
                      class="gv">“There’s no salt in the soup”</em></strong></p>
                <p id="ac6b" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk"><em
                      class="gv">“I wish I could show it to you… But there’s really SALT IN YOUR SOUP!”</em></strong>
                </p>
                <p id="7215" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk"><em
                      class="gv">“There’s no salt in the soup”</em></strong></p>
                <p id="9950" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><strong class="gj hk"><em
                      class="gv">“I am putting MY FINGER IN THE SOUP… There’s REALLY SALT IN THE SOUP!!! Why do you KEEP
                      SAYING THAT???”</em></strong></p>
                <p id="b104" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“There’s no salt
                    in the soup”</em></p>
                <p id="84d8" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“As you bash your
                    head against the menu, you realise one thing… The menu reads TOMATO SOUP with SEA SALT… But you
                    served the Inspector TOMATO SOUP with TABLE SALT”</em></p>
                <p id="51bf" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“The Inspector was
                    right… There was no SEA SALT in the soup. And SEA SALT is not the same as TABLE SALT, even though we
                    refer to them by the same name: SALT”</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm ha">
                      <div class="dl r dd dm">
                        <div class="hg r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/46/1*NN-mIK5ou5CZUQO3f4m29Q.png?q=20"
                              width="3024" height="4032" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="3024" height="4032" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/6048/1*NN-mIK5ou5CZUQO3f4m29Q.png"
                              width="3024" height="4032" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <p id="f011" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“Unfortunately for
                    Rust macro coders, this Hygiene problem is very real… The </em><code
                    class="dm gw gx gy gz b"><em class="gv">salt</em></code><em class="gv"> that’s inside the macro
                    here… Is NOT in the same context as the </em><code
                    class="dm gw gx gy gz b"><em class="gv">salt</em></code><em class="gv"> here…”</em></p>
                <p id="ada5" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“Because the
                    contexts are different, the Rust Compiler stops us from using the same </em><code
                    class="dm gw gx gy gz b"><em class="gv">salt</em></code><em class="gv"> from inside and outside the
                    macro…”</em></p>
                <p id="041c" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“The solution:
                    Pass the salt as a parameter. This forces the Rust Compiler to treat the two </em><code
                    class="dm gw gx gy gz b"><em class="gv">salts</em></code><em class="gv"> as the same”</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm mh">
                      <div class="dl r dd dm">
                        <div class="mk r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/60/1*6wOP9LJUgKViQjxEOmPnIQ.png?q=20"
                              width="5134" height="3482" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="5134" height="3482" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/10268/1*6wOP9LJUgKViQjxEOmPnIQ.png"
                              width="5134" height="3482" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <p id="ab5a" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“In </em><code
                    class="dm gw gx gy gz b"><em class="gv">make_bad_soup()</em></code><em class="gv">: Contexts don’t
                    match. Rust Compiler fails with Hygiene Error”</em></p>
                <p id="5d8b" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“In </em><code
                    class="dm gw gx gy gz b"><em class="gv">make_good_soup()</em></code><em class="gv">: Contexts match.
                    Rust Compiler is happy!”</em></p>
              </div>
            </div>
          </section>
          <hr class="hr dy hs ht hu dv hv hw hx hy hz" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah dz aj ak">
                <figure class="hb hc hd mm mn cz dr kv cd kw kx ky kz la ba lb ma mb mc md lg paragraph-image">
                  <div class="db dc dd de ak">
                    <div class="cl cm ha">
                      <div class="dl r dd dm">
                        <div class="hg r">
                          <div class="df dg cp t u dh ak di dj dk"><img class="cp t u dh ak do dp dq"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/46/1*XnWzSgqk3M3voF6rz92Tgw.png?q=20"
                              width="3024" height="4032" role="presentation" /></div><img class="df dg cp t u dh ak dr"
                            width="3024" height="4032" role="presentation" /><noscript><img class="cp t u dh ak"
                              src="https://web.archive.org/web/20191204194043im_/https://miro.medium.com/max/6048/1*XnWzSgqk3M3voF6rz92Tgw.png"
                              width="3024" height="4032" role="presentation" /></noscript>
                        </div>
                      </div>
                    </div>
                  </div>
                </figure>
                <p id="60ba" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“Rust has so many
                    goodies for Embedded Coders…”</em></p>
                <p id="ccca" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“Do we really want
                    to keep on coding Embedded C forever?”</em></p>
                <p id="2dee" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“Some of the
                    Arduino and C code I’ve seen… Made me fall off the tree!”</em></p>
                <p id="a8a3" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“As you sleep
                    tonight, dream of the safe, clear, simple code that you’ll be writing… In Embedded Rust”</em></p>
                <p id="5883" class="gh gi ec bk gj b gk gl gm gn go gp gq gr gs gt gu"><em class="gv">“I’m not really
                    green. FOOLED YA!”</em></p>
              </div>
            </div>
          </section>
        </div>
      </article>
    </div>
  </div>
</body>

</html>
<!--
     FILE ARCHIVED ON 19:40:43 Dec 04, 2019 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 01:29:47 Feb 23, 2021.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  exclusion.robots: 0.263
  captures_list: 1349.757
  LoadShardBlock: 1324.108 (3)
  RedisCDXSource: 0.597
  PetaboxLoader3.datanode: 1356.196 (4)
  esindex: 0.01
  PetaboxLoader3.resolve: 64.294
  exclusion.robots.policy: 0.252
  CDXLines.iter: 22.161 (3)
  load_resource: 127.117
-->