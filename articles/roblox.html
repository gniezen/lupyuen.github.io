<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <title>IoT Digital Twin with Roblox and The Things Network</title>

    
    <!-- Begin scripts/articles/*-header.html: Article Header for Custom Markdown files processed by rustdoc, like chip8.md -->
<meta property="og:title" 
    content="IoT Digital Twin with Roblox and The Things Network" 
    data-rh="true">
<meta property="og:description" 
    content="Can we use Roblox to monitor and control an IoT Device... Through LoRaWAN and The Things Network?"
    data-rh="true">
<meta property="og:image" 
    content="https://lupyuen.github.io/images/roblox-title.jpg">
<meta property="og:type" 
    content="article" data-rh="true">
<!-- End scripts/articles/*-header.html -->
<!-- Begin scripts/rustdoc-header.html: Header for Custom Markdown files processed by rustdoc, like chip8.md -->
<link rel="alternate" type="application/rss+xml" title="RSS Feed for lupyuen" href="/rss.xml" />
<link rel="stylesheet" type="text/css" href="../normalize.css">
<link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle">
<link rel="stylesheet" type="text/css" href="../dark.css">
<link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle">
<link rel="stylesheet" type="text/css" href="../prism.css">
<script src="../storage.js"></script><noscript>
<link rel="stylesheet" href="../noscript.css"></noscript>
<link rel="shortcut icon" href="../favicon.ico">
<style type="text/css">
    #crate-search {
        background-image: url("../down-arrow.svg");
    }
    a {
        color: #77d;
    }
</style>
<!-- End scripts/rustdoc-header.html -->


</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

        <!-- Begin scripts/rustdoc-before.html: Pre-HTML for Custom Markdown files processed by rustdoc, like chip8.md -->

    <!-- Begin Theme Picker -->
    <div class="theme-picker" style="left: 0"><button id="theme-picker" aria-label="Pick another theme!"><img src="../brush.svg"
        width="18" alt="Pick another theme!"></button>
        <div id="theme-choices"></div>
    </div>
    <script src="../theme.js"></script>
    <script src="../prism.js"></script>
    <!-- Theme Picker -->

    <!-- End scripts/rustdoc-before.html -->
    

    <h1 class="title">IoT Digital Twin with Roblox and The Things Network</h1>
    <nav id="TOC"><ul>
<li><a href="#roblox-mirrors-real-life">1 Roblox Mirrors Real Life</a><ul></ul></li>
<li><a href="#roblox-fetches-sensor-data">2 Roblox Fetches Sensor Data</a><ul>
<li><a href="#define-constants">2.1 Define Constants</a><ul></ul></li>
<li><a href="#import-modules">2.2 Import Modules</a><ul></ul></li>
<li><a href="#send-http-request">2.3 Send HTTP Request</a><ul></ul></li>
<li><a href="#decode-http-response">2.4 Decode HTTP Response</a><ul></ul></li>
<li><a href="#check-errors">2.5 Check Errors</a><ul></ul></li>
<li><a href="#return-sensor-data">2.6 Return Sensor Data</a><ul></ul></li></ul></li>
<li><a href="#roblox-mirroring-in-action">3 Roblox Mirroring In Action</a><ul></ul></li>
<li><a href="#decode-base64-and-cbor-in-roblox">4 Decode Base64 and CBOR in Roblox</a><ul></ul></li>
<li><a href="#render-temperature-with-roblox-particle-emitter">5 Render Temperature With Roblox Particle Emitter</a><ul></ul></li>
<li><a href="#whats-next">6 What‚Äôs Next</a><ul></ul></li>
<li><a href="#notes">7 Notes</a><ul></ul></li>
<li><a href="#appendix-install-roblox-studio">8 Appendix: Install Roblox Studio</a><ul></ul></li>
<li><a href="#appendix-fetching-sensor-data-from-the-things-network">9 Appendix: Fetching Sensor Data from The Things Network</a><ul></ul></li></ul></nav><p>üìù <em>12 Oct 2021</em></p>
<p><a href="https://developer.roblox.com/en-us/"><strong>Roblox</strong></a> is a <strong>Multiplayer Virtual World</strong> that lets us create <strong>3D Objects</strong> and interact with them. (Free to create and play)</p>
<p><a href="https://lupyuen.github.io/articles/ttn"><strong>The Things Network</strong></a> is a <strong>Public Wireless Network</strong> that connects many <strong>IoT Gadgets</strong> around the world. (It‚Äôs free too)</p>
<p><em>Can we connect Roblox to The Things Network‚Ä¶ To Monitor and Control Real-World Gadgets?</em></p>
<p><img src="https://lupyuen.github.io/images/digital-twin.jpg" alt="Digital Twin" /></p>
<p>Think of the possibilities‚Ä¶</p>
<ol>
<li>
<p>Walk around a <strong>Roblox House</strong> to <strong>monitor the temperature</strong> in our Smart Home. </p>
<p>Flip the lights on and off in the Virtual House, to <strong>control the lights</strong> in our Real Home.</p>
<p><a href="https://medium.com/@camden.o.b/how-we-could-make-a-roblox-smart-home-that-connects-to-the-real-world-e4d89b309516">(Check out this excellent article by Camden Bruce)</a></p>
</li>
<li>
<p>Wander about a <strong>Roblox Farm</strong> to check on <strong>Farm Crops and Livestock</strong> in real life.</p>
<p><a href="https://www.thethingsindustries.com/news/implementing-gps-cattle-tracking-solution-lorawan/">(Yes there are Cow Sensors)</a></p>
</li>
<li>
<p>Teach young learners about <strong>Internet of Things (IoT)</strong>‚Ä¶</p>
<p>How <strong>Sensors and Actuators</strong> work, and how they impact our lives.</p>
</li>
</ol>
<p>Sounds very ‚ÄúFree Guy‚Äù and ‚ÄúMatrix‚Äù-ish, but the above is actually a well-known concept in IoT: <strong>Digital Twin</strong>.</p>
<p><em>What‚Äôs a Digital Twin?</em></p>
<p>A <a href="https://en.m.wikipedia.org/wiki/Digital_twin"><strong>Digital Twin</strong></a> is a Virtual Object that <strong>mirrors a Real-World Object</strong> through <strong>Sensors and Actuators</strong>. (Like the pic above)</p>
<p>For today‚Äôs experiment we shall take this IoT Gadget: <a href="https://lupyuen.github.io/articles/pinedio"><strong>PineDio Stack BL604 RISC-V Board</strong></a>‚Ä¶</p>
<p><img src="https://lupyuen.github.io/images/ttn-title.jpg" alt="PineDio Stack BL604 RISC-V Board (foreground) talking to The Things Network via RAKWireless RAK7248 LoRaWAN Gateway (background)" /></p>
<p>And turn it into a <strong>Virtual Gadget in Roblox</strong> such that‚Ä¶</p>
<ul>
<li>
<p>If our <strong>Real Gadget</strong> feels hot‚Ä¶</p>
</li>
<li>
<p>Then our <strong>Virtual Gadget</strong> looks hot too!</p>
</li>
</ul>
<p>All <strong>Roblox Scripts</strong> may be found in this repo‚Ä¶</p>
<ul>
<li><a href="https://github.com/lupyuen/roblox-the-things-network"><strong>lupyuen/roblox-the-things-network</strong></a></li>
</ul>
<p>(Apologies if my Roblox looks rough‚Ä¶ This is my first time using Roblox üôè)</p>
<p><img src="https://lupyuen.github.io/images/roblox-title.jpg" alt="Cold / Hot / Normal IoT Objects rendered in Roblox" /></p>
<h1 id="roblox-mirrors-real-life" class="section-header"><a href="#roblox-mirrors-real-life">1 Roblox Mirrors Real Life</a></h1>
<p>The pic shows what we shall accomplish with Roblox‚Ä¶ </p>
<p>A Virtual Object that <strong>visualises the Live Temperature</strong> of our Real Object (PineDio Stack)</p>
<ul>
<li>
<p><strong>Freezing Cold</strong> (left)</p>
</li>
<li>
<p><strong>Normal Temperature</strong> (middle)</p>
<p>(Think Shrek and green fireflies)</p>
</li>
<li>
<p><strong>Fiery Hot</strong> (right)</p>
</li>
</ul>
<p>In fact we‚Äôll show <strong>10,000 Levels of Hotness / Coldness</strong>, thanks to a little Math. <a href="https://en.wikipedia.org/wiki/Linear_interpolation">(And Linear Interpolation)</a></p>
<ul>
<li><a href="https://www.youtube.com/watch?v=3CP7ELTAFLg"><strong>Watch the Demo Video on YouTube</strong></a></li>
</ul>
<p><em>What magic makes this mirroring possible?</em></p>
<p>This mirroring of real things in Roblox is possible because‚Ä¶</p>
<ol>
<li>
<p>Roblox lets us write <strong>Lua Scripts</strong> that can make <strong>HTTP Requests</strong> to the internet</p>
</li>
<li>
<p>The Things Network exposes a <strong>HTTP Service</strong> that lets us retrieve the <strong>Sensor Data</strong> (like Temperature) sent by IoT Gadgets</p>
</li>
</ol>
<p>Connect (1) to (2) and we‚Äôll get a Roblox Gadget that <strong>mirrors the Hot / Cold State</strong> of a Real Gadget.</p>
<p>Let‚Äôs talk about Roblox Lua Scripts and HTTP Requests‚Ä¶</p>
<p><a href="https://education.roblox.com/en-us/resources/intro-to-coding-coding-1-create-a-script">(More about Roblox Lua Scripting)</a></p>
<p><a href="https://lupyuen.github.io/articles/ttn">(More about The Things Network)</a></p>
<p><img src="https://lupyuen.github.io/images/roblox-http.jpg" alt="Roblox talking to The Things Network" /></p>
<h1 id="roblox-fetches-sensor-data" class="section-header"><a href="#roblox-fetches-sensor-data">2 Roblox Fetches Sensor Data</a></h1>
<p>Roblox provides a <strong>HttpService API</strong> that we may call in our Lua Scripts to <strong>fetch External HTTP URLs</strong> (via GET and POST)‚Ä¶</p>
<ul>
<li><a href="https://developer.roblox.com/en-us/api-reference/class/HttpService"><strong>Roblox HttpService API</strong></a></li>
</ul>
<p>Below we see HttpService in action, fetching the current <strong>latitude and longitude of International Space Station</strong>‚Ä¶</p>
<p><img src="https://lupyuen.github.io/images/roblox-script.png" alt="Roblox Lua Script calls HttpService" /></p>
<p><a href="https://developer.roblox.com/en-us/api-reference/class/HttpService">(Source code at the bottom of this page)</a></p>
<p>To <strong>fetch Sensor Data</strong> from The Things Network, we have created a <strong>getSensorData</strong> function in <a href="https://github.com/lupyuen/roblox-the-things-network/blob/main/DigitalTwin.lua#L19-L71">DigitalTwin.lua</a>.</p>
<p>When we run this Roblox Script‚Ä¶</p>
<div class="example-wrap"><pre class="language-lua"><code>-- Fetch the Sensor Data from The Things Network (LoRa)
local sensorData = getSensorData()

-- Show the Temperature
if sensorData then
  print(&quot;Temperature:&quot;)
  print(sensorData.t)
else
  print(&quot;Failed to get sensor data&quot;)
end</code></pre></div>
<p>We should see the <strong>Temperature Sensor Data</strong> fetched from The Things Network‚Ä¶</p>
<div class="example-wrap"><pre class="language-text"><code>Temperature: 1236</code></pre></div>
<p>(This means <code>12.36</code> ¬∫C, our values have been scaled by 100)</p>
<p>Let‚Äôs study the code inside our <a href="https://github.com/lupyuen/roblox-the-things-network/blob/main/DigitalTwin.lua#L19-L71"><strong>getSensorData</strong></a> function.</p>
<h2 id="define-constants" class="section-header"><a href="#define-constants">2.1 Define Constants</a></h2>
<p>TODO</p>
<ul>
<li><a href="https://github.com/lupyuen/roblox-the-things-network/blob/main/DigitalTwin.lua#L1-L71"><code>DigitalTwin.lua</code></a></li>
</ul>
<div class="example-wrap"><pre class="language-lua"><code>-- TODO: Change this to your Application ID for The Things Network
-- (Must have permission to Read Application Traffic)
local TTN_APPLICATION_ID = &quot;YOUR_APPLICATION_ID&quot;

-- TODO: Change this to your API Key for The Things Network
local TTN_API_KEY = &quot;YOUR_API_KEY&quot;

-- TODO: Change this to your region-specific URL for The Things Network
local TTN_URL = &quot;https://au1.cloud.thethings.network/api/v3/as/applications/&quot; .. TTN_APPLICATION_ID .. &quot;/packages/storage/uplink_message?limit=1&amp;order=-received_at&quot;</code></pre></div>
<p>(‚Äú<code>..</code>‚Äù in Lua means concatenate the strings)</p>
<h2 id="import-modules" class="section-header"><a href="#import-modules">2.2 Import Modules</a></h2>
<p>TODO</p>
<div class="example-wrap"><pre class="language-lua"><code>-- Load the Base64 and CBOR ModuleScripts from ServerStorage
local ServerStorage = game:GetService(&quot;ServerStorage&quot;)
local base64 = require(ServerStorage.Base64)
local cbor   = require(ServerStorage.Cbor)</code></pre></div>
<p>(We‚Äôll talk about Base64 and CBOR in a while)</p>
<p>TODO</p>
<div class="example-wrap"><pre class="language-lua"><code>-- Get the HttpService for making HTTP Requests
local HttpService = game:GetService(&quot;HttpService&quot;)</code></pre></div>
<p>Enable HTTP Requests: Click Home ‚Üí Game Settings ‚Üí Security ‚Üí Allow HTTP Requests</p>
<h2 id="send-http-request" class="section-header"><a href="#send-http-request">2.3 Send HTTP Request</a></h2>
<p>TODO</p>
<div class="example-wrap"><pre class="language-lua"><code>-- Fetch Sensor Data from The Things Network (LoRa) as a Lua Table
local function getSensorData()
  -- HTTPS JSON Response from The Things Network
  local response = nil
  -- Lua Table parsed from JSON response
  local data = nil
  -- Message Payload from the Lua Table (encoded with Base64)
  local frmPayload = nil
  -- Message Payload after Base64 Decoding
  local payload = nil
  -- Lua Table of Sensor Data after CBOR Decoding
  local sensorData = nil</code></pre></div>
<p>TODO</p>
<div class="example-wrap"><pre class="language-lua"><code>  -- Set the API Key in the HTTP Request Header	
  local headers = {
    [&quot;Authorization&quot;] = &quot;Bearer &quot; .. TTN_API_KEY,
  }</code></pre></div>
<p>TODO</p>
<div class="example-wrap"><pre class="language-lua"><code>  -- Wrap with pcall in case something goes wrong
  pcall(function ()
    -- Fetch the data from The Things Network, no caching
    response = HttpService:GetAsync(TTN_URL, false, headers)</code></pre></div><h2 id="decode-http-response" class="section-header"><a href="#decode-http-response">2.4 Decode HTTP Response</a></h2>
<p>TODO</p>
<div class="example-wrap"><pre class="language-lua"><code>    -- Decode the JSON response into a Lua Table
    data = HttpService:JSONDecode(response)</code></pre></div>
<p>TODO</p>
<div class="example-wrap"><pre class="language-lua"><code>    -- Get the Message Payload. If missing, pcall will catch the error.
    frmPayload = data.result.uplink_message.frm_payload</code></pre></div>
<p>TODO</p>
<div class="example-wrap"><pre class="language-lua"><code>    -- Base64 Decode the Message Payload
    payload = base64.decode(frmPayload)</code></pre></div>
<p>TODO</p>
<div class="example-wrap"><pre class="language-lua"><code>    -- Decode the CBOR Map to get Sensor Data
    sensorData = cbor.decode(payload)
  end)	</code></pre></div><h2 id="check-errors" class="section-header"><a href="#check-errors">2.5 Check Errors</a></h2>
<p>TODO</p>
<div class="example-wrap"><pre class="language-lua"><code>  -- Show the error
  if response == nil then
    print(&quot;Error returned by The Things Network&quot;)
  elseif data == nil then
    print(&quot;Failed to parse JSON response from The Things Network&quot;)
  elseif frmPayload == nil then
    print(&quot;Missing message payload&quot;)
  elseif payload == nil then
    print(&quot;Base64 decoding failed&quot;)
  elseif sensorData == nil then
    print(&quot;CBOR decoding failed&quot;)
  end</code></pre></div><h2 id="return-sensor-data" class="section-header"><a href="#return-sensor-data">2.6 Return Sensor Data</a></h2>
<p>TODO</p>
<div class="example-wrap"><pre class="language-lua"><code>  -- sensorData will be nil if our request failed or JSON failed to parse
  -- or Message Payload missing or Base64 / CBOR decoding failed
  return sensorData
end</code></pre></div>
<p>TODO6</p>
<p><img src="https://lupyuen.github.io/images/roblox-script2.png" alt="" /></p>
<h1 id="roblox-mirroring-in-action" class="section-header"><a href="#roblox-mirroring-in-action">3 Roblox Mirroring In Action</a></h1>
<p>TODO</p>
<p>Enable HTTP Requests: Click Home ‚Üí Game Settings ‚Üí Security ‚Üí Allow HTTP Requests</p>
<p>Under <code>Workspace</code>, create a <code>Part</code>.</p>
<p>Under the <code>Part</code>, create a <code>Script</code>.</p>
<p>Copy and paste the script from <a href="https://github.com/lupyuen/roblox-the-things-network/blob/main/DigitalTwin.lua"><code>DigitalTwin.lua</code></a></p>
<p>Follow the steps in the next section to copy and paste the ModuleScripts for <code>Base64</code> and <code>Cbor</code></p>
<h1 id="decode-base64-and-cbor-in-roblox" class="section-header"><a href="#decode-base64-and-cbor-in-roblox">4 Decode Base64 and CBOR in Roblox</a></h1>
<p>TODO</p>
<p>Under <code>ServerStorage</code>, create two <strong>ModuleScripts</strong>: <code>Base64</code> and <code>Cbor</code>.</p>
<p>Copy and paste the ModuleScripts from‚Ä¶</p>
<ul>
<li>
<p><a href="https://github.com/lupyuen/roblox-the-things-network/blob/main/Base64.lua"><code>Base64</code></a></p>
</li>
<li>
<p><a href="https://github.com/lupyuen/roblox-the-things-network/blob/main/Cbor.lua"><code>Cbor</code></a></p>
</li>
</ul>
<p>(Yep they need to be <strong>ModuleScripts</strong>. Normal Scripts won‚Äôt work)</p>
<p>To test Base64 and CBOR Decoding‚Ä¶</p>
<div class="example-wrap"><pre class="language-lua"><code>-- Load the Base64 and CBOR ModuleScripts from ServerStorage
local ServerStorage = game:GetService(&quot;ServerStorage&quot;)
local base64 = require(ServerStorage.Base64)
local cbor = require(ServerStorage.Cbor)

-- Base64 Decode the Message Payload
payload = base64.decode(&#39;omF0GQTUYWwZCSs=&#39;)
print(&quot;payload:&quot;)
print(payload)

-- Decode the CBOR Map
sensorData = cbor.decode(payload)
print(&quot;sensorData:&quot;)
print(sensorData)</code></pre></div>
<p>We should see‚Ä¶</p>
<div class="example-wrap"><pre class="language-text"><code>payload:
ÔøΩatÔøΩal

sensorData:
{
  [&quot;l&quot;] = 2347,
  [&quot;t&quot;] = 1236
}</code></pre></div>
<p>The ModuleScripts were copied from‚Ä¶</p>
<p><a href="https://github.com/iskolbin/lbase64/blob/master/base64.lua">iskolbin/lbase64</a></p>
<p><a href="https://github.com/Zash/lua-cbor/blob/master/cbor.lua">Zash/lua-cbor</a></p>
<p>This line in <a href="https://github.com/iskolbin/lbase64/blob/master/base64.lua">base64.lua</a> was changed from‚Ä¶</p>
<div class="example-wrap"><pre class="language-lua"><code>local extract = _G.bit32 and _G.bit32.extract</code></pre></div>
<p>To‚Ä¶</p>
<div class="example-wrap"><pre class="language-lua"><code>local extract = bit32 and bit32.extract</code></pre></div>
<p>TODO7</p>
<p><img src="https://lupyuen.github.io/images/roblox-script3.png" alt="" /></p>
<p>TODO8</p>
<p><img src="https://lupyuen.github.io/images/roblox-script4.png" alt="" /></p>
<p>TODO9</p>
<p><img src="https://lupyuen.github.io/images/roblox-script5.png" alt="" /></p>
<h1 id="render-temperature-with-roblox-particle-emitter" class="section-header"><a href="#render-temperature-with-roblox-particle-emitter">5 Render Temperature With Roblox Particle Emitter</a></h1>
<p>TODO</p>
<p>Let‚Äôs use a Roblox Particle Emitter to show the Temperature (t) of our object‚Ä¶</p>
<p><img src="https://lupyuen.github.io/images/roblox-title2.jpg" alt="Cold / Hot / Normal IoT Objects rendered in Roblox" /></p>
<p>We have defined 3 Particle Emitters: Cold (t=0), Normal (t=5000), Hot (t=10000).</p>
<p>To render the Temperature, we shall do Linear Interpolation of the 3 Particle Emitters‚Ä¶</p>
<div class="example-wrap"><pre class="language-yaml"><code>COLD Particle Emitter (t=0)
  Acceleration: 0, 0, 0
  Color: 0 0.333333 1 1 0 1 0.333333 1 1 0 
  Drag: 5
  EmissionDirection: Enum.NormalId.Top
  Lifetime: 5 10 
  LightEmission: 1
  LightInfluence: 1
  Orientation: Enum.ParticleOrientation.FacingCamera
  Rate: 20
  Rotation: 0 180 
  RotSpeed: -170 -170 
  Size: 0 1 0 1 1 0 
  Speed: 0 0 
  SpreadAngle: 10, 10
  Texture: rbxasset:textures/particles/sparkles_main.dds
  TimeScale: 1
  Transparency: 0 0 0 1 0 0 
  VelocityInheritance: 0
  ZOffset: 0

NORMAL Particle Emitter (t=5000)
  Acceleration: 0, 0, 0
  Color: 0 0.333333 0.666667 0 0 1 0.333333 0.666667 0 0 
  Drag: 10
  EmissionDirection: Enum.NormalId.Top
  Lifetime: 5 10 
  LightEmission: 0
  LightInfluence: 1
  Orientation: Enum.ParticleOrientation.FacingCamera
  Rate: 20
  Rotation: 0 0 
  RotSpeed: 0 0 
  Size: 0 0.2 0 1 0.2 0 
  Speed: 5 5 
  SpreadAngle: 50, 50
  Texture: rbxasset:textures/particles/sparkles_main.dds
  TimeScale: 1
  Transparency: 0 0 0 1 0 0 
  VelocityInheritance: 0
  ZOffset: 0

HOT Particle Emitter (t=10000)
  Acceleration: 0, 0, 0
  Color: 0 1 0.333333 0 0 1 1 0.333333 0 0 
  Drag: 0
  EmissionDirection: Enum.NormalId.Top
  Lifetime: 5 10 
  LightEmission: 0
  LightInfluence: 0
  Orientation: Enum.ParticleOrientation.FacingCamera
  Rate: 20
  Rotation: 0 0 
  RotSpeed: 0 0 
  Size: 0 0.4 0 1 0.4 0 
  Speed: 1 1 
  SpreadAngle: 50, 50
  Texture: rbxasset:textures/particles/sparkles_main.dds
  TimeScale: 1
  Transparency: 0 0 0 1 0 0 
  VelocityInheritance: 0
  ZOffset: 0</code></pre></div>
<p>Values to be interpolated‚Ä¶</p>
<div class="example-wrap"><pre class="language-yaml"><code>Color:
  COLD:
    0 0.333333 1 1 0 
    1 0.333333 1 1 0 
  NORMAL:
    0 0.333333 0.666667 0 0 
    1 0.333333 0.666667 0 0 
  HOT:
    0 1 0.333333 0 0 
    1 1 0.333333 0 0 

Drag:
  COLD: 5
  NORMAL: 10
  HOT: 0

LightEmission: 
  COLD: 1
  NORMAL: 0
  HOT: 0

LightInfluence: 
  COLD: 1
  NORMAL: 1
  HOT: 0

Rotation: 
  COLD: 0 180 
  NORMAL: 0 0 
  HOT: 0 0 

RotSpeed: 
  COLD: -170 -170 
  NORMAL: 0 0 
  HOT: 0 0 

Size: 
  COLD: 0 1 0 1 1 0 
  NORMAL: 0 0.2 0 1 0.2 0 
  HOT: 0 0.4 0 1 0.4 0 
  
Speed: 
  COLD: 0 0 
  NORMAL: 5 5 
  HOT: 1 1 

SpreadAngle: 
  COLD: 10, 10
  NORMAL: 50, 50
  HOT: 50, 50</code></pre></div>
<p>The properties of the Particle Emitters were dumped with the <code>dumpParticleEmitter</code> function in <a href="DigitalTwin.lua"><code>DigitalTwin.lua</code></a>.</p>
<p>Note that <code>rbxasset</code> won‚Äôt work for setting the Texture‚Ä¶</p>
<div class="example-wrap"><pre class="language-lua"><code>emitter.Texture = &quot;rbxasset:textures/particles/sparkles_main.dds&quot;</code></pre></div>
<p>But <code>rbxassetid</code> works OK‚Ä¶</p>
<div class="example-wrap"><pre class="language-lua"><code>-- Texture for the particles: &quot;star sparkle particle&quot; by @Vupatu
-- https://www.roblox.com/library/6490035152/star-sparkle-particle
emitter.Texture = &quot;rbxassetid://6490035152&quot;</code></pre></div>
<p>To create a Particle Emitter for Normal Temperature, we call <code>createParticleEmitter</code> in <a href="DigitalTwin.lua"><code>DigitalTwin.lua</code></a></p>
<div class="example-wrap"><pre class="language-lua"><code>-- Create a Particle Emitter for Normal Temperature
local emitter = createParticleEmitter()</code></pre></div>
<p>To interpolate the Particle Emitter for High / Mid / Low Temperatures, we call <code>updateParticleEmitter</code> in <a href="DigitalTwin.lua"><code>DigitalTwin.lua</code></a></p>
<div class="example-wrap"><pre class="language-lua"><code>-- Gradually update the emitter for Temperature=10,000 to 0
updateParticleEmitter(emitter, T_MAX)
wait(5)
for t = T_MAX, T_MIN, -600 do
  print(string.format(&quot;t: %d&quot;, t))
  updateParticleEmitter(emitter, t)
  wait(4)
end</code></pre></div>
<p>Here‚Äôs how the Interpolating Particle Emitter looks‚Ä¶</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=3CP7ELTAFLg"><strong>Watch the Demo Video on YouTube</strong></a></li>
</ul>
<p>TODO2</p>
<p><img src="https://lupyuen.github.io/images/roblox-emitter.png" alt="" /></p>
<p>TODO4</p>
<p><img src="https://lupyuen.github.io/images/roblox-interpolate.png" alt="" /></p>
<p>TODO1</p>
<p><img src="https://lupyuen.github.io/images/roblox-ar.jpg" alt="" /></p>
<h1 id="whats-next" class="section-header"><a href="#whats-next">6 What‚Äôs Next</a></h1>
<p>TODO</p>
<p>We shall head back and transmit BL602 / BL604‚Äôs <strong>Internal Temperature Sensor Data</strong> to The Things Network.</p>
<p>Many Thanks to my <a href="https://github.com/sponsors/lupyuen"><strong>GitHub Sponsors</strong></a> for supporting my work! This article wouldn‚Äôt have been possible without your support.</p>
<ul>
<li>
<p><a href="https://github.com/sponsors/lupyuen">Sponsor me a coffee</a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/articles/book">Read ‚ÄúThe RISC-V BL602 / BL604 Book‚Äù</a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io">Check out my articles</a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/rss.xml">RSS Feed</a></p>
</li>
</ul>
<p><em>Got a question, comment or suggestion? Create an Issue or submit a Pull Request here‚Ä¶</em></p>
<p><a href="https://github.com/lupyuen/lupyuen.github.io/blob/master/src/roblox.md"><code>lupyuen.github.io/src/roblox.md</code></a></p>
<h1 id="notes" class="section-header"><a href="#notes">7 Notes</a></h1>
<ol>
<li>This article is the expanded version of <a href="https://twitter.com/MisterTechBlog/status/1443824711050301444">this Twitter Thread</a></li>
</ol>
<h1 id="appendix-install-roblox-studio" class="section-header"><a href="#appendix-install-roblox-studio">8 Appendix: Install Roblox Studio</a></h1>
<p>TODO</p>
<p>Sign up</p>
<p>Login</p>
<p>Click ‚ÄúCreate‚Äù in top bar</p>
<p>Click ‚ÄúStart Creating‚Äù</p>
<p>For macOS: Delete Roblox Studio under the <strong>Applications Folder</strong>. Reboot and reinstall.</p>
<p>For Linux: <a href="https://roblox.fandom.com/wiki/Tutorial:Using_Roblox_on_Linux">See this</a></p>
<h1 id="appendix-fetching-sensor-data-from-the-things-network" class="section-header"><a href="#appendix-fetching-sensor-data-from-the-things-network">9 Appendix: Fetching Sensor Data from The Things Network</a></h1>
<p>TODO</p>
<p>The Things Network exposes an API (HTTP GET) to fetch the Uplink Messages transmitted by our IoT Device‚Ä¶</p>
<p><a href="https://www.thethingsindustries.com/docs/integrations/storage/retrieve/">Retrieve Uplink Messages</a></p>
<p>Here‚Äôs the command to fetch the latest Uplink Message‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>curl \
  -G &quot;https://au1.cloud.thethings.network/api/v3/as/applications/$YOUR_APPLICATION_ID/packages/storage/uplink_message&quot; \
  -H &quot;Authorization: Bearer $YOUR_API_KEY&quot; \
  -H &quot;Accept: text/event-stream&quot; \
  -d &quot;limit=1&quot; \
  -d &quot;order=-received_at&quot;</code></pre></div>
<p>Which returns‚Ä¶</p>
<div class="example-wrap"><pre class="language-json"><code>{
  &quot;result&quot;: {
    &quot;end_device_ids&quot;: {
      &quot;device_id&quot;: &quot;eui-YOUR_DEVICE_EUI&quot;,
      &quot;application_ids&quot;: {
        &quot;application_id&quot;: &quot;luppy-application&quot;
      },
      &quot;dev_eui&quot;: &quot;YOUR_DEVICE_EUI&quot;,
      &quot;dev_addr&quot;: &quot;YOUR_DEVICE_ADDR&quot;
    },
    &quot;received_at&quot;: &quot;2021-10-02T12:10:54.594006440Z&quot;,
    &quot;uplink_message&quot;: {
      &quot;f_port&quot;: 2,
      &quot;f_cnt&quot;: 3,
      &quot;frm_payload&quot;: &quot;omF0GQTUYWwZCSs=&quot;,
      &quot;rx_metadata&quot;: [
        {
          &quot;gateway_ids&quot;: {
            &quot;gateway_id&quot;: &quot;luppy-wisgate-rak7248&quot;,
            &quot;eui&quot;: &quot;YOUR_GATEWAY_EUI&quot;
          },
          &quot;time&quot;: &quot;2021-10-02T13:04:34.552513Z&quot;,
          &quot;timestamp&quot;: 3576406949,
          &quot;rssi&quot;: -53,
          &quot;channel_rssi&quot;: -53,
          &quot;snr&quot;: 12.2,
          &quot;location&quot;: {
            &quot;latitude&quot;: 1.27125,
            &quot;longitude&quot;: 103.80795,
            &quot;altitude&quot;: 70,
            &quot;source&quot;: &quot;SOURCE_REGISTRY&quot;
          },
          &quot;channel_index&quot;: 4
        }
      ],
      &quot;settings&quot;: {
        &quot;data_rate&quot;: {
          &quot;lora&quot;: {
            &quot;bandwidth&quot;: 125000,
            &quot;spreading_factor&quot;: 10
          }
        },
        &quot;data_rate_index&quot;: 2,
        &quot;coding_rate&quot;: &quot;4/5&quot;,
        &quot;frequency&quot;: &quot;922600000&quot;,
        &quot;timestamp&quot;: 3576406949,
        &quot;time&quot;: &quot;2021-10-02T13:04:34.552513Z&quot;
      },
      &quot;received_at&quot;: &quot;2021-10-02T12:10:54.385972437Z&quot;,
      &quot;consumed_airtime&quot;: &quot;0.370688s&quot;,
      &quot;network_ids&quot;: {
        &quot;net_id&quot;: &quot;000013&quot;,
        &quot;tenant_id&quot;: &quot;ttn&quot;,
        &quot;cluster_id&quot;: &quot;ttn-au1&quot;
      }
    }
  }
}</code></pre></div>
<p><code>result.uplink_message.frm_payload</code> contains the Sensor Data that we need, encoded with Base64 and CBOR‚Ä¶</p>
<div class="example-wrap"><pre class="language-json"><code>&quot;frm_payload&quot;: &quot;omF0GQTUYWwZCSs=&quot;</code></pre></div>
<p>Our Sensor Data is encoded with <a href="https://en.wikipedia.org/wiki/CBOR">CBOR</a> to keep the LoRa Packets small (max 12 bytes), due to the Fair Use Policy of The Things Network‚Ä¶</p>
<ul>
<li><a href="https://lupyuen.github.io/articles/ttn#fair-use-of-the-things-network">‚ÄúFair Use of The Things Network‚Äù</a></li>
</ul>
<p>More about CBOR Encoding‚Ä¶</p>
<ul>
<li><a href="https://lupyuen.github.io/articles/cbor">‚ÄúEncode Sensor Data with CBOR on BL602‚Äù</a></li>
</ul>
<p>TODO10</p>
<p><img src="https://lupyuen.github.io/images/roblox-ttn.jpg" alt="" /></p>

    
</body>
</html>